{"version":3,"file":"InputSection.js","sources":["pages_AI_Login_Match/AI/ai-chat/InputSection.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTov56CU5biI5b2V5LiO5YW25LuW5Lq65YWx5Lqr5paH5Lu2L3RlYWNoZXJEaXJlY3RvcnkvdnVl5a6e546wTG90dGll5Yqo55S75Luj56CBL3BhZ2VzX0FJX0xvZ2luX01hdGNoL0FJL2FpLWNoYXQvSW5wdXRTZWN0aW9uLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"input-section\">\r\n\t\t<input class=\"message-input\" \r\n\t\t\tv-model=\"inputValue\" \r\n\t\t\tplaceholder=\"请输入您的问题...\" \r\n\t\t\t:disabled=\"isProcessing\"\r\n\t\t\t@confirm=\"sendMessage\" />\r\n\t\t<button class=\"send-button\" @click=\"sendMessage\" :disabled=\"!inputValue.trim() || isProcessing\">\r\n\t\t\t<text class=\"send-button-text\">{{isProcessing ? '发送中...' : '发送'}}</text>\r\n\t\t</button>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n\t/**\r\n\t * @description 输入区域组件，支持流式传输\r\n\t * @property {Boolean} isProcessing - 是否正在处理消息\r\n\t * @property {String} chatMode - 聊天模式，用于设置topic\r\n\t * @event {Function} processing-start - 开始处理消息\r\n\t * @event {Function} processing-end - 结束处理消息\r\n\t * @event {Function} message-sent - 消息发送完成事件\r\n\t * @event {Function} stream-message - 流式消息片段事件\r\n\t * @event {Function} stream-complete - 流式传输完成事件\r\n\t * @event {Function} stream-error - 流式传输错误事件\r\n\t */\r\n\texport default {\r\n\t\tname: \"InputSection\",\r\n\t\tprops: {\r\n\t\t\tisProcessing: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tinputValue: ''\r\n\t\t\t};\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * @description 发送消息并处理流式回复\r\n\t\t\t */\r\n\t\t\tasync sendMessage() {\r\n\t\t\t\tif (!this.inputValue.trim()) return;\r\n\t\t\t\t\r\n\t\t\t\t// 通知父组件开始处理\r\n\t\t\t\tthis.$emit('processing-start');\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst result = await this.$store.dispatch('user/aiChat/sendQuestion', {\r\n\t\t\t\t\t\tcontent: this.inputValue.trim(),\r\n\t\t\t\t\t\t// 流式消息回调 - 接收每个消息片段\r\n\t\t\t\t\t\tonMessage: (messageInfo) => {\r\n\t\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:54','🔄 收到流式消息片段:', messageInfo);\r\n\t\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:55',`   - 片段内容: \"${messageInfo.content}\"`);\r\n\t\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:56',`   - 累积内容长度: ${messageInfo.fullContent ? messageInfo.fullContent.length : 0}`);\r\n\t\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:57',`   - 消息序号: ${messageInfo.messageCount || 0}`);\r\n\t\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:58',`   - 是否完成: ${messageInfo.isComplete}`);\r\n\t\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:59',`   - 会话ID: ${messageInfo.conversationId}`);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 通知父组件有新的流式消息片段\r\n\t\t\t\t\t\t\tthis.$emit('stream-message', {\r\n\t\t\t\t\t\t\t\tcontent: messageInfo.content,\r\n\t\t\t\t\t\t\t\tfullContent: messageInfo.fullContent,\r\n\t\t\t\t\t\t\t\tisComplete: messageInfo.isComplete,\r\n\t\t\t\t\t\t\t\tconversationId: messageInfo.conversationId,\r\n\t\t\t\t\t\t\t\tmessageCount: messageInfo.messageCount,\r\n\t\t\t\t\t\t\t\tisTimeout: messageInfo.isTimeout\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t// 流式传输完成回调\r\n\t\t\t\t\t\tonComplete: (finalMessage) => {\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:73','✅ 流式传输完成:', finalMessage);\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:74',`   - 最终内容长度: ${finalMessage.content ? finalMessage.content.length : 0}`);\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:75',`   - 总消息片段数: ${finalMessage.messageCount || 0}`);\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:76',`   - 会话ID: ${finalMessage.conversationId}`);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 通知父组件流式传输完成\r\n\t\t\t\t\t\t\tthis.$emit('stream-complete', {\r\n\t\t\t\t\t\t\t\tcontent: finalMessage.content,\r\n\t\t\t\t\t\t\t\tconversationId: finalMessage.conversationId,\r\n\t\t\t\t\t\t\t\tmessageCount: finalMessage.messageCount,\r\n\t\t\t\t\t\t\t\tisTimeout: finalMessage.isTimeout\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t// 错误处理回调\r\n\t\t\t\t\t\tonError: (error) => {\r\n\t\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:88','❌ 流式传输错误:', error);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 通知父组件发生错误\r\n\t\t\t\t\t\t\tthis.$emit('stream-error', error);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 显示错误提示\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: error.message || '发送失败',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (result.success) {\r\n\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:102','🎉 消息发送流程完成:', result);\r\n\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:103',`   - 最终数据: \"${result.data}\"`);\r\n\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:104',`   - 消息片段总数: ${result.messageCount || 0}`);\r\n\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:105',`   - 流式完成状态: ${result.isStreamComplete ? '✅' : '❌'}`);\r\n\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:106',`   - 是否超时: ${result.isTimeout ? '⚠️' : '✅'}`);\r\n\t\t\t\t\t\t// uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:107',`   - 会话ID: ${result.conversationId}`);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 清空输入框\r\n\t\t\t\t\t\tthis.inputValue = '';\r\n\t\t\t\t\t\t// 通知父组件消息发送成功\r\n\t\t\t\t\t\tthis.$emit('message-sent', {\r\n\t\t\t\t\t\t\t...result,\r\n\t\t\t\t\t\t\tcontroller: result.controller // 传递控制器供外部使用\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:117','❌ 消息发送失败:', result);\r\n\t\t\t\t\t\t// 显示错误信息\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: result.message || '发送失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:125','发送消息出错:', error);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '发送失败，请重试',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 通知父组件发生错误\r\n\t\t\t\t\tthis.$emit('stream-error', {\r\n\t\t\t\t\t\tmessage: '发送失败，请重试'\r\n\t\t\t\t\t});\r\n\t\t\t\t} finally {\r\n\t\t\t\t\t// 通知父组件处理结束\r\n\t\t\t\t\tthis.$emit('processing-end');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t/* 输入区域 */\r\n\t.input-section {\r\n\t\twidth: 100%;\r\n\t\theight: 129rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground-color:rgba(255, 255, 255, 1);\r\n\t\tmargin-top: 5rpx;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tz-index: 1000;\r\n\t}\r\n\t\r\n\t.message-input {\r\n\t\tflex: 1;\r\n\t\theight: 52rpx;\r\n\t\tbackground-color: #ffffff;\r\n\t\tborder: 2rpx solid rgba(151, 151, 151, 1);\r\n\t\tborder-radius: 8px;\r\n\t\tmargin-right: 30rpx;\r\n\t\tmargin-left: 30rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\tmargin-top: 20rpx;\r\n\t\tpadding-left: 20rpx;\r\n\t}\r\n\t\r\n\t.send-button {\r\n\t\twidth: 108rpx;\r\n\t\theight: 52rpx;\r\n\t\tbackground: linear-gradient(180deg, #A5A9F7 0%, rgba(70, 78, 248, 0.9) 100%);\r\n\t\tcolor: #fff;\r\n\t\tborder-radius: 8px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tborder: none;\r\n\t\tpadding: 0;\r\n\t\tmargin-right: 30rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\ttransition: all 0.3s; /* 添加过渡效果 */\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1); /* 添加阴影 */\r\n\t\tmargin-top: 20rpx;\r\n\t}\r\n\t\r\n\t.send-button:disabled {\r\n\t\tbackground-color: #f0f0f0; /* 更改为浅灰色背景，与功能按钮一致 */\r\n\t\tcolor: #999; /* 更暗的文字颜色 */\r\n\t\tborder: 2rpx solid #ddd; /* 添加边框 */\r\n\t\tbox-shadow: none; /* 禁用状态不显示阴影 */\r\n\t}\r\n\t\r\n\t.send-button-text {\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n</style> ","import Component from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/pages_AI_Login_Match/AI/ai-chat/InputSection.vue'\nwx.createComponent(Component)"],"names":["_sfc_main","defineComponent","result","messageInfo","finalMessage","uni","error","Component"],"mappings":"0DAyBCA,EAAeC,kBAAA,CACd,KAAM,eACN,MAAO,CACN,aAAc,CACb,KAAM,QACN,QAAS,EACV,CACA,EACD,MAAI,CACH,MAAO,CACN,WAAY,GAEb,EACD,QAAS,CAIF,aAAW,mDAChB,GAAI,CAAC,KAAK,WAAW,KAAM,EAAE,OAAM,QAAA,QAAA,IAAA,EAGnC,KAAK,MAAM,kBAAkB,EAE7B,GAAI,CACH,MAAMC,EAAS,MAAM,KAAK,OAAO,SAAS,2BAA4B,IAAA,cAAA,CACrE,QAAS,KAAK,WAAW,KAAM,EAE/B,UAAW,CAACC,EAAW,OAAA,CAStB,KAAK,MAAM,iBAAkB,IAAA,cAAA,CAC5B,QAASA,EAAY,QACrB,YAAaA,EAAY,YACzB,WAAYA,EAAY,WACxB,eAAgBA,EAAY,eAC5B,aAAcA,EAAY,aAC1B,UAAWA,EAAY,SACvB,CAAA,CAAA,CACD,EAED,WAAY,CAACC,EAAY,OAAA,CACxBC,EAAG,MAAC,MAAM,MAAM,yDAAyD,YAAaD,CAAY,EAClGC,EAAAA,MAAI,MAAM,MAAM,yDAAyD,gBAAgBD,EAAa,QAAUA,EAAa,QAAQ,OAAS,CAAC,EAAE,EACjJC,QAAI,MAAM,MAAM,yDAAyD,gBAAgBD,EAAa,cAAgB,CAAC,EAAE,EACzHC,QAAI,MAAM,MAAM,yDAAyD,cAAcD,EAAa,cAAc,EAAE,EAGpH,KAAK,MAAM,kBAAmB,IAAA,cAAA,CAC7B,QAASA,EAAa,QACtB,eAAgBA,EAAa,eAC7B,aAAcA,EAAa,aAC3B,UAAWA,EAAa,SACxB,CAAA,CAAA,CACD,EAED,QAAS,CAACE,EAAK,OAAA,CACdD,EAAG,MAAC,MAAM,QAAQ,yDAAyD,YAAaC,CAAK,EAG7F,KAAK,MAAM,eAAgBA,CAAK,EAGhCD,EAAAA,MAAI,UAAU,CACb,MAAOC,EAAM,SAAW,OACxB,KAAM,MACN,CAAA,CACF,CACA,CAAA,CAAA,EAEGJ,EAAO,SASV,KAAK,WAAa,GAElB,KAAK,MAAM,eACP,IAAA,cAAA,OAAA,OAAA,OAAA,OAAA,CAAA,EAAAA,CAAM,EACT,CAAA,WAAYA,EAAO,iBAGpBG,EAAG,MAAC,MAAM,QAAQ,0DAA0D,YAAaH,CAAM,EAE/FG,EAAAA,MAAI,UAAU,CACb,MAAOH,EAAO,SAAW,OACzB,KAAM,MACN,CAAA,EAED,OAAOI,EAAO,CACfD,EAAG,MAAC,MAAM,QAAQ,0DAA0D,UAAWC,CAAK,EAC5FD,EAAAA,MAAI,UAAU,CACb,MAAO,WACP,KAAM,MACN,CAAA,EAGD,KAAK,MAAM,eAAgB,IAAA,cAAA,CAC1B,QAAS,UACT,CAAA,CAAA,CACF,QAAU,CAET,KAAK,MAAM,gBAAgB,CAC5B,EACD,CAAA,CACD,EACD,2VC3ID,GAAG,gBAAgBE,CAAS"}