{"version":3,"file":"app.js","sources":["main.js"],"sourcesContent":["import App from './App'\r\nimport { createSSRApp } from 'vue'\r\nimport store from './store'\r\n\r\nimport { installDebugPlugin, installDebugForVue3 } from './utils/vuex-debug'\r\nimport { injectStoreSafety, checkStoreAvailability } from './store/inject-checker'\r\nimport loadingMixin from './mixin/loading.mixin.js'\r\n\r\nexport function createApp() {\r\n  const app = createSSRApp(App)\r\n\r\n  // ✅ 注册 Vuex\r\n  app.use(store)\r\n\r\n  // ✅ 依赖注入方式提供 store\r\n  app.provide('store', store)\r\n\r\n  // ✅ 全局挂载 $store（兼容旧代码）\r\n  app.config.globalProperties.$store = store\r\n\r\n  // ✅ 注册 mixin\r\n  app.mixin(loadingMixin)\r\n  app.mixin(injectStoreSafety)\r\n\r\n  // ✅ 全局错误处理\r\n  const handleError = (err) => {\r\n    console.error('捕获到全局错误:', err)\r\n    // 可添加错误上报逻辑\r\n  }\r\n\r\n  app.config.errorHandler = (err, vm, info) => {\r\n    console.error('Vue错误:', err)\r\n    console.info('错误来源:', info)\r\n    handleError(err)\r\n  }\r\n\r\n  // ✅ 开发环境调试\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    try {\r\n      installDebugPlugin(store)\r\n      installDebugForVue3(app, store)\r\n      checkStoreAvailability(store)\r\n      console.log('初始Vuex状态:', store.state)\r\n    } catch (e) {\r\n      console.error('调试插件初始化失败:', e)\r\n    }\r\n  }\r\n\r\n  // ✅ 微信小程序错误监听\r\n  if (uni.getSystemInfoSync().platform === 'mp-weixin') {\r\n    console.log('当前运行环境: 微信小程序')\r\n    \r\n    // 配置微信小程序特有的处理\r\n    try {\r\n      // 全局错误监听\r\n      uni.onError((err) => {\r\n        console.error('小程序错误:', err)\r\n        handleError(err)\r\n      })\r\n      \r\n      // 网络请求错误\r\n      uni.onNetworkStatusChange((res) => {\r\n        console.log('网络状态变化:', res.isConnected ? '已连接' : '已断开')\r\n        store.commit('app/setNetworkStatus', res.isConnected)\r\n      })\r\n      \r\n      // 确保全局变量设置\r\n      const app = getApp()\r\n      if (app && !app.globalData) {\r\n        app.globalData = {}\r\n      }\r\n    } catch (e) {\r\n      console.error('微信小程序配置失败:', e)\r\n    }\r\n  }\r\n\r\n  // ✅ 返回给 uni-app\r\n  return {\r\n    app\r\n  }\r\n}\r\n"],"names":["createSSRApp","store","loadingMixin","injectStoreSafety","uni","installDebugPlugin","installDebugForVue3","checkStoreAvailability","app"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQO,SAAS,YAAY;AACpB,QAAA,MAAMA,2BAAa,GAAG;AAG5B,MAAI,IAAIC,YAAAA,KAAK;AAGT,MAAA,QAAQ,SAASA,YAAAA,KAAK;AAGtB,MAAA,OAAO,iBAAiB,SAASA,YAAAA;AAGrC,MAAI,MAAMC,oBAAAA,YAAY;AACtB,MAAI,MAAMC,oBAAAA,iBAAiB;AAGrB,QAAA,cAAc,CAAC,QAAQ;AAC3BC,kBAAA,MAAA,MAAA,SAAA,iBAAc,YAAY,GAAG;AAAA,EAAA;AAI/B,MAAI,OAAO,eAAe,CAAC,KAAK,IAAI,SAAS;AAC3CA,kBAAA,sCAAc,UAAU,GAAG;AAC3BA,kBAAA,qCAAa,SAAS,IAAI;AAC1B,gBAAY,GAAG;AAAA,EAAA;AAI0B;AACrC,QAAA;AACFC,sBAAA,mBAAmBJ,YAAK,KAAA;AACxBK,0CAAoB,KAAKL,YAAAA,KAAK;AAC9BM,0BAAA,uBAAuBN,YAAK,KAAA;AAC5BG,oBAAA,MAAA,MAAA,OAAA,iBAAY,aAAaH,YAAAA,MAAM,KAAK;AAAA,aAC7B,GAAG;AACVG,oBAAA,MAAc,MAAA,SAAA,iBAAA,cAAc,CAAC;AAAA,IAC/B;AAAA,EACF;AAGA,MAAIA,oBAAI,oBAAoB,aAAa,aAAa;AACpDA,kBAAAA,MAAA,MAAA,OAAA,iBAAY,eAAe;AAGvB,QAAA;AAEEA,0BAAA,QAAQ,CAAC,QAAQ;AACnBA,sBAAA,MAAc,MAAA,SAAA,iBAAA,UAAU,GAAG;AAC3B,oBAAY,GAAG;AAAA,MAAA,CAChB;AAGGA,0BAAA,sBAAsB,CAAC,QAAQ;AACjCA,4BAAY,MAAA,OAAA,iBAAA,WAAW,IAAI,cAAc,QAAQ,KAAK;AAChDH,oBAAAA,MAAA,OAAO,wBAAwB,IAAI,WAAW;AAAA,MAAA,CACrD;AAGD,YAAMO,OAAM;AACRA,UAAAA,QAAO,CAACA,KAAI,YAAY;AAC1BA,aAAI,aAAa;MACnB;AAAA,aACO,GAAG;AACVJ,oBAAA,MAAc,MAAA,SAAA,iBAAA,cAAc,CAAC;AAAA,IAC/B;AAAA,EACF;AAGO,SAAA;AAAA,IACL;AAAA,EAAA;AAEJ;;;"}