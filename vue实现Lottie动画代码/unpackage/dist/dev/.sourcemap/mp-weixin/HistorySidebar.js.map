{"version":3,"file":"HistorySidebar.js","sources":["pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue"],"sourcesContent":["<template>\r\n\t<view class=\"history-sidebar\" :class=\"{visible: visible}\">\r\n\t\t<view class=\"sidebar-header\">\r\n\t\t\t<text class=\"sidebar-title\">历史记录</text>\r\n\t\t</view>\r\n\t\t<scroll-view class=\"history-list\" scroll-y=\"true\">\r\n\t\t\t<view class=\"empty-history\" v-if=\"historySummaries.length === 0\">\r\n\t\t\t\t<text class=\"empty-history-text\">暂无历史记录</text>\r\n\t\t\t</view>\r\n\t\t\t<view v-else>\r\n\t\t\t\t<view \r\n\t\t\t\t\tv-for=\"(item, index) in historySummaries\" \r\n\t\t\t\t\t:key=\"item.id\" \r\n\t\t\t\t\tclass=\"history-item\"\r\n\t\t\t\t\t:class=\"{'active': currentChatId === item.id}\"\r\n\t\t\t\t\t@click=\"loadChatHistory(item.id)\">\r\n\t\t\t\t\t<view class=\"history-item-content\">\r\n\t\t\t\t\t\t<text class=\"history-title\">{{item.abstract || item.title || '对话 ' + (index + 1)}}</text>\r\n\t\t\t\t\t\t<text class=\"history-time\">{{formatTime(item.updatedAt || item.createdAt)}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"history-actions\">\r\n\t\t\t\t\t\t<text class=\"mode-badge\" v-if=\"item.chatMode\">{{getModeLabel(item.chatMode)}}</text>\r\n\t\t\t\t\t\t<view class=\"history-delete\" @click.stop=\"deleteChatHistory(item.id, $event)\">\r\n\t\t\t\t\t\t\t<text class=\"delete-icon\">×</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n\timport { mapState, mapActions } from 'vuex';\r\n\t\r\n\t/**\r\n\t * @description 历史记录侧边栏组件\r\n\t * @property {Boolean} visible - 侧边栏是否可见\r\n\t * @event {Function} loadChat - 加载聊天历史记录\r\n\t * @event {Function} deleteChat - 删除聊天历史记录\r\n\t */\r\n\texport default {\r\n\t\tname: \"HistorySidebar\",\r\n\t\tprops: {\r\n\t\t\tvisible: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t/**\r\n\t\t\t * @description 从 Vuex 状态中获取数据\r\n\t\t\t */\r\n\t\t\t...mapState({\r\n\t\t\t\tconversations: state => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treturn state.user && state.user.aiChat && state.user.aiChat.aiChat \r\n\t\t\t\t\t\t\t? (state.user.aiChat.aiChat.conversations || []) \r\n\t\t\t\t\t\t\t: [];\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:61','获取 conversations 状态出错:', e);\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tactiveConversation: state => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treturn state.user && state.user.aiChat && state.user.aiChat.aiChat \r\n\t\t\t\t\t\t\t? state.user.aiChat.aiChat.activeConversation \r\n\t\t\t\t\t\t\t: null;\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:71','获取 activeConversation 状态出错:', e);\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 历史聊天摘要数组（只包含ID、标题等基本信息）\r\n\t\t\t * @returns {Array} 历史聊天摘要数组\r\n\t\t\t */\r\n\t\t\thistorySummaries() {\r\n\t\t\t\t// 添加防御性检查，确保 conversations 存在\r\n\t\t\t\tif (!this.conversations) {\r\n\t\t\t\t\tuni.__f__('warn','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:84','conversations 是 undefined');\r\n\t\t\t\t\treturn [];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn this.conversations.map(conv => ({\r\n\t\t\t\t\t\tid: conv.id,\r\n\t\t\t\t\t\tabstract: conv.abstract,\r\n\t\t\t\t\t\tchatMode: conv.chatMode,\r\n\t\t\t\t\t\tcreatedAt: conv.createdAt,\r\n\t\t\t\t\t\tupdatedAt: conv.updatedAt\r\n\t\t\t\t\t}));\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:97','处理 historySummaries 出错:', e);\r\n\t\t\t\t\treturn [];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 当前选中的聊天ID\r\n\t\t\t * @returns {String} 当前选中的聊天ID\r\n\t\t\t */\r\n\t\t\tcurrentChatId() {\r\n\t\t\t\treturn this.activeConversation;\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\t// 添加调试信息\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:112','=================== 调试信息开始 ===================');\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:113','完整的 Vuex store:', this.$store);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:114','Vuex store状态:', this.$store.state);\r\n\t\t\t\r\n\t\t\tif (this.$store.state.user) {\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:117','user模块状态:', this.$store.state.user);\r\n\t\t\t\t\r\n\t\t\t\tif (this.$store.state.user.aiChat) {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:120','aiChat模块状态:', this.$store.state.user.aiChat);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.$store.state.user.aiChat.aiChat) {\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:123','内层 aiChat:', this.$store.state.user.aiChat.aiChat);\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:124','内层 aiChat conversations:', this.$store.state.user.aiChat.aiChat.conversations);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:126','无法访问内层 aiChat!');\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:127','aiChat 模块完整内容:', JSON.stringify(this.$store.state.user.aiChat));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:130','无法访问 aiChat 模块!');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:133','无法访问 user 模块!');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:136','组件计算的 conversations:', this.conversations);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:137','组件计算的 historySummaries:', this.historySummaries);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:138','组件计算的 currentChatId:', this.currentChatId);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:139','=================== 调试信息结束 ===================');\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapActions({\r\n\t\t\t\tsetActiveConversation: 'user/aiChat/setCurrentChat',\r\n\t\t\t\tdeleteConversation: 'user/aiChat/deleteChat'\r\n\t\t\t}),\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 获取对话模式的中文标签\r\n\t\t\t * @param {String} mode - 对话模式\r\n\t\t\t * @returns {String} 对话模式的中文标签\r\n\t\t\t */\r\n\t\t\tgetModeLabel(mode) {\r\n\t\t\t\tconst modeLabels = {\r\n\t\t\t\t\t'general': '通用',\r\n\t\t\t\t\t'school': '择校',\r\n\t\t\t\t\t'career': '职业规划'\r\n\t\t\t\t};\r\n\t\t\t\treturn modeLabels[mode] || '通用';\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 加载聊天历史\r\n\t\t\t * @param {String} chatId - 聊天ID\r\n\t\t\t */\r\n\t\t\tloadChatHistory(chatId) {\r\n\t\t\t\t// 通过 Vuex action 设置当前活跃的对话\r\n\t\t\t\tthis.setActiveConversation(chatId);\r\n\t\t\t\t\r\n\t\t\t\t// 如果需要加载完整对话内容，还可以添加这个 action 调用\r\n\t\t\t\t// this.$store.dispatch('user/aiChat/loadChat', chatId);\r\n\t\t\t\t\r\n\t\t\t\t// 通知父组件\r\n\t\t\t\tthis.$emit('loadChat', chatId);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 删除历史记录\r\n\t\t\t * @param {String} chatId - 聊天ID\r\n\t\t\t * @param {Event} e - 事件对象，用于阻止冒泡\r\n\t\t\t */\r\n\t\t\tdeleteChatHistory(chatId, e) {\r\n\t\t\t\t// 确保阻止事件冒泡，避免触发点击加载历史记录\r\n\t\t\t\tif (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:188','删除历史记录:', chatId);\r\n\t\t\t\t// 通过 Vuex action 删除对话\r\n\t\t\t\tthis.deleteConversation(chatId);\r\n\t\t\t\t// 通知父组件\r\n\t\t\t\tthis.$emit('deleteChat', chatId);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 格式化时间\r\n\t\t\t * @param {Date|String} time - 时间对象或时间字符串\r\n\t\t\t * @returns {String} 格式化后的时间字符串\r\n\t\t\t */\r\n\t\t\tformatTime(time) {\r\n\t\t\t\tif (!time) return '';\r\n\t\t\t\t\r\n\t\t\t\tconst date = new Date(time);\r\n\t\t\t\tconst year = date.getFullYear();\r\n\t\t\t\tconst month = String(date.getMonth() + 1).padStart(2, '0');\r\n\t\t\t\tconst day = String(date.getDate()).padStart(2, '0');\r\n\t\t\t\tconst hours = String(date.getHours()).padStart(2, '0');\r\n\t\t\t\tconst minutes = String(date.getMinutes()).padStart(2, '0');\r\n\t\t\t\t\r\n\t\t\t\treturn `${year}-${month}-${day} ${hours}:${minutes}`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.history-sidebar {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 66vw; /* 占屏幕宽度的2/3 */\r\n\t\theight: 100vh;\r\n\t\tbackground-color: #ffffff;\r\n\t\ttransform: translateX(-100%);\r\n\t\ttransition: transform 0.3s ease;\r\n\t\tz-index: 999;\r\n\t\tbox-shadow: 0 0 20rpx rgba(0, 0, 0, 0.1);\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t\r\n\t.history-sidebar.visible {\r\n\t\ttransform: translateX(0);\r\n\t}\r\n\t\r\n\t.sidebar-header {\r\n\t\tpadding: 30rpx 20rpx;\r\n\t\tborder-bottom: 1rpx solid #eee;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\theight: 80rpx;\r\n\t}\r\n\t\r\n\t.sidebar-title {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\t\r\n\t.history-list {\r\n\t\tflex: 1;\r\n\t\theight: calc(100vh - 80rpx);\r\n\t\tpadding: 0;\r\n\t\tbackground-color: #f9f9f9;\r\n\t}\r\n\t\r\n\t.empty-history {\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 40rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\t\r\n\t.empty-history-text {\r\n\t\tcolor: #999;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\t\r\n\t.history-item {\r\n\t\tpadding: 30rpx 20rpx;\r\n\t\tbackground-color: #ffffff;\r\n\t\tmargin-bottom: 2rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tborder-bottom: 1rpx solid #f0f0f0;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\t\r\n\t.history-item:active {\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\t\r\n\t.history-item.active {\r\n\t\tbackground-color: #e6f7ff;\r\n\t\tborder-left: 4rpx solid #1890ff;\r\n\t}\r\n\t\r\n\t.history-item-content {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t\r\n\t.history-title {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t\tmargin-bottom: 10rpx;\r\n\t\t/* 单行文本截断 */\r\n\t\twhite-space: nowrap;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t\tmax-width: 80%;\r\n\t}\r\n\t\r\n\t.history-time {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\t\r\n\t.history-actions {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.mode-badge {\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: #fff;\r\n\t\tbackground-color: #1890ff;\r\n\t\tpadding: 6rpx 12rpx;\r\n\t\tborder-radius: 20rpx;\r\n\t\tmargin-right: 16rpx;\r\n\t}\r\n\t\r\n\t.history-delete {\r\n\t\twidth: 60rpx;\r\n\t\theight: 60rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tborder-radius: 50%;\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\t\r\n\t.delete-icon {\r\n\t\tfont-size: 36rpx;\r\n\t\tcolor: #ff4d4f;\r\n\t\tline-height: 1;\r\n\t}\r\n</style> "],"names":["_sfc_main","defineComponent","mapState","state","e","uni","conv","mapActions","mode","chatId","time","date","year","month","day","hours","minutes"],"mappings":"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"}