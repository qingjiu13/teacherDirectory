{"version":3,"file":"HistorySidebar.js","sources":["pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue"],"sourcesContent":["<template>\r\n\t<view class=\"history-sidebar\" :class=\"{visible: visible}\">\r\n\t\t<view class=\"sidebar-header\">\r\n\t\t\t<text class=\"sidebar-title\">历史记录</text>\r\n\t\t</view>\r\n\t\t<scroll-view \r\n\t\t\tclass=\"history-list\" \r\n\t\t\tscroll-y=\"true\"\r\n\t\t\t@scrolltolower=\"onScrollToLower\"\r\n\t\t\t:refresher-enabled=\"true\"\r\n\t\t\t:refresher-triggered=\"isRefreshing\"\r\n\t\t\t@refresherrefresh=\"onRefresh\"\r\n\t\t\t@refresherrestore=\"onRefreshRestore\"\r\n\t\t\tlower-threshold=\"50\"\r\n\t\t\tenable-back-to-top=\"true\"\r\n\t\t\tscroll-with-animation=\"true\">\r\n\t\t\t<!-- 今天 -->\r\n\t\t\t<view v-if=\"groupedHistory.today && groupedHistory.today.length\" class=\"history-group\">\r\n\t\t\t\t<view class=\"history-group-title\">今天</view>\r\n\t\t\t\t<view v-for=\"item in groupedHistory.today\" :key=\"item.id\" class=\"history-item-outer\" :class=\"{'active': currentChatId === item.id}\">\r\n\t\t\t\t\t<view v-if=\"currentChatId === item.id\" class=\"history-item-outer-gradient\" @click=\"loadChatHistory(item.id)\">\r\n\t\t\t\t\t\t<view class=\"history-item-inner\">\r\n\t\t\t\t\t\t\t<view class=\"history-item-content\">\r\n\t\t\t\t\t\t\t\t<text class=\"history-title\">{{item.abstract || '无标题'}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"history-actions\">\r\n\t\t\t\t\t\t\t\t<text class=\"mode-badge\" v-if=\"item.chatMode\">{{getModeLabel(item.chatMode)}}</text>\r\n\t\t\t\t\t\t\t\t<view class=\"history-delete\" @click.stop=\"deleteChatHistory(item.id, $event)\">\r\n    \t\t\t\t\t\t\t\t<image class=\"delete-icon-img\" src=\"../.././static/AIchat/delate.png\" mode=\"aspectFit\" />\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-else class=\"history-item-inner\" @click=\"loadChatHistory(item.id)\">\r\n\t\t\t\t\t\t<view class=\"history-item-content\">\r\n\t\t\t\t\t\t\t<text class=\"history-title\">{{item.abstract || '无标题'}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"history-actions\">\r\n\t\t\t\t\t\t\t<text class=\"mode-badge\" v-if=\"item.chatMode\">{{getModeLabel(item.chatMode)}}</text>\r\n\t\t\t\t\t\t\t<view class=\"history-delete\" @click.stop=\"deleteChatHistory(item.id, $event)\">\r\n    \t\t\t\t\t\t\t<image class=\"delete-icon-img\" src=\"../.././static/AIchat/delate.png\" mode=\"aspectFit\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 七天内 -->\r\n\t\t\t<view v-if=\"groupedHistory.week && groupedHistory.week.length\" class=\"history-group\">\r\n\t\t\t\t<view class=\"history-group-title\">七天内</view>\r\n\t\t\t\t<view v-for=\"item in groupedHistory.week\" :key=\"item.id\" class=\"history-item-outer\" :class=\"{'active': currentChatId === item.id}\">\r\n\t\t\t\t\t<view v-if=\"currentChatId === item.id\" class=\"history-item-outer-gradient\" @click=\"loadChatHistory(item.id)\">\r\n\t\t\t\t\t\t<view class=\"history-item-inner\">\r\n\t\t\t\t\t\t\t<view class=\"history-item-content\">\r\n\t\t\t\t\t\t\t\t<text class=\"history-title\">{{item.abstract || '无标题'}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"history-actions\">\r\n\t\t\t\t\t\t\t\t<text class=\"mode-badge\" v-if=\"item.chatMode\">{{getModeLabel(item.chatMode)}}</text>\r\n\t\t\t\t\t\t\t\t<view class=\"history-delete\" @click.stop=\"deleteChatHistory(item.id, $event)\">\r\n    \t\t\t\t\t\t\t\t<image class=\"delete-icon-img\" src=\"../.././static/AIchat/delate.png\" mode=\"aspectFit\" />\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-else class=\"history-item-inner\" @click=\"loadChatHistory(item.id)\">\r\n\t\t\t\t\t\t<view class=\"history-item-content\">\r\n\t\t\t\t\t\t\t<text class=\"history-title\">{{item.abstract || '无标题'}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"history-actions\">\r\n\t\t\t\t\t\t\t<text class=\"mode-badge\" v-if=\"item.chatMode\">{{getModeLabel(item.chatMode)}}</text>\r\n\t\t\t\t\t\t\t<view class=\"history-delete\" @click.stop=\"deleteChatHistory(item.id, $event)\">\r\n    \t\t\t\t\t\t\t<image class=\"delete-icon-img\" src=\"../.././static/AIchat/delate.png\" mode=\"aspectFit\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 30天内 -->\r\n\t\t\t<view v-if=\"groupedHistory.month && groupedHistory.month.length\" class=\"history-group\">\r\n\t\t\t\t<view class=\"history-group-title\">30天内</view>\r\n\t\t\t\t<view v-for=\"item in groupedHistory.month\" :key=\"item.id\" class=\"history-item-outer\" :class=\"{'active': currentChatId === item.id}\">\r\n\t\t\t\t\t<view v-if=\"currentChatId === item.id\" class=\"history-item-outer-gradient\" @click=\"loadChatHistory(item.id)\">\r\n\t\t\t\t\t\t<view class=\"history-item-inner\">\r\n\t\t\t\t\t\t\t<view class=\"history-item-content\">\r\n\t\t\t\t\t\t\t\t<text class=\"history-title\">{{item.abstract || '无标题'}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"history-actions\">\r\n\t\t\t\t\t\t\t\t<text class=\"mode-badge\" v-if=\"item.chatMode\">{{getModeLabel(item.chatMode)}}</text>\r\n\t\t\t\t\t\t\t\t<view class=\"history-delete\" @click.stop=\"deleteChatHistory(item.id, $event)\">\r\n    \t\t\t\t\t\t\t\t<image class=\"delete-icon-img\" src=\"../.././static/AIchat/delate.png\" mode=\"aspectFit\" />\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-else class=\"history-item-inner\" @click=\"loadChatHistory(item.id)\">\r\n\t\t\t\t\t\t<view class=\"history-item-content\">\r\n\t\t\t\t\t\t\t<text class=\"history-title\">{{item.abstract || '无标题'}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"history-actions\">\r\n\t\t\t\t\t\t\t<text class=\"mode-badge\" v-if=\"item.chatMode\">{{getModeLabel(item.chatMode)}}</text>\r\n\t\t\t\t\t\t\t<view class=\"history-delete\" @click.stop=\"deleteChatHistory(item.id, $event)\">\r\n    \t\t\t\t\t\t\t<image class=\"delete-icon-img\" src=\"../.././static/AIchat/delate.png\" mode=\"aspectFit\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 加载更多状态 -->\r\n\t\t\t<view class=\"load-more-container\" v-if=\"showLoadMore\">\r\n\t\t\t\t<view class=\"load-more-item\" v-if=\"isLoadingMore\">\r\n\t\t\t\t\t<text class=\"load-more-text\">正在加载更多...</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"load-more-item\" v-else-if=\"hasMoreData\">\r\n\t\t\t\t\t<text class=\"load-more-text\">上拉加载更多</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"load-more-item\" v-else>\r\n\t\t\t\t\t<text class=\"load-more-text no-more\">没有更多数据了</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 没有历史记录 -->\r\n\t\t\t<view class=\"empty-history\" v-if=\"!hasAnyHistory && !isLoadingMore\">\r\n\t\t\t\t<text class=\"empty-history-text\">暂无历史记录</text>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n\timport { mapState, mapActions } from 'vuex';\r\n\t// 导入时间戳格式化函数\r\n\timport { formatTimestamp } from '../../../components/timeStamp.js';\r\n\t\r\n\t/**\r\n\t * @description 历史记录侧边栏组件，按时间分组显示\r\n\t * @property {Boolean} visible - 侧边栏是否可见\r\n\t * @property {Object} groupedHistory - 按时间分组的历史记录\r\n\t * @property {String} currentChatId - 当前选中的聊天ID\r\n\t * @property {Object} pagination - 分页相关属性\r\n\t * @event {Function} loadChat - 加载聊天历史记录\r\n\t * @event {Function} deleteChat - 删除聊天历史记录\r\n\t */\r\n\texport default {\r\n\t\tname: \"HistorySidebar\",\r\n\t\tprops: {\r\n\t\t\tvisible: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\tgroupedHistory: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({ today: [], week: [], month: [] })\r\n\t\t\t},\r\n\t\t\tcurrentChatId: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0\r\n\t\t\t},\r\n\t\t\t// 分页相关 props\r\n\t\t\tpagination: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({\r\n\t\t\t\t\tpageNum: 1,\r\n\t\t\t\t\tpageSize: 10,\r\n\t\t\t\t\ttotal: 0,\r\n\t\t\t\t\ttotalPages: 0,\r\n\t\t\t\t\thasNext: false,\r\n\t\t\t\t\thasPrev: false,\r\n\t\t\t\t\tloading: false\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// 刷新状态\r\n\t\t\t\tisRefreshing: false,\r\n\t\t\t\t// 加载更多状态\r\n\t\t\t\tisLoadingMore: false,\r\n\t\t\t\t// 防抖定时器\r\n\t\t\t\tloadMoreTimer: null\r\n\t\t\t};\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t/**\r\n\t\t\t * @description 从 Vuex 状态中获取数据\r\n\t\t\t */\r\n\t\t\t...mapState({\r\n\t\t\t\tconversations: state => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treturn state.user && state.user.aiChat && state.user.aiChat.aiChat \r\n\t\t\t\t\t\t\t? (state.user.aiChat.aiChat.conversations || []) \r\n\t\t\t\t\t\t\t: [];\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:193','获取 conversations 状态出错:', e);\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tactiveConversation: state => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treturn state.user && state.user.aiChat && state.user.aiChat.aiChat \r\n\t\t\t\t\t\t\t? state.user.aiChat.aiChat.activeConversation \r\n\t\t\t\t\t\t\t: null;\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:203','获取 activeConversation 状态出错:', e);\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 按日期分类的历史记录\r\n\t\t\t * @returns {Object} 分类后的历史记录\r\n\t\t\t */\r\n\t\t\tgroupedConversationsByDate() {\r\n\t\t\t\t// 获取当前日期、一周前日期和一个月前日期的时间戳\r\n\t\t\t\tconst now = new Date();\r\n\t\t\t\tconst today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();\r\n\t\t\t\tconst weekAgo = today - 7 * 24 * 60 * 60 * 1000;\r\n\t\t\t\tconst monthAgo = today - 30 * 24 * 60 * 60 * 1000;\r\n\t\t\t\t\r\n\t\t\t\t// 分类存储\r\n\t\t\t\tconst result = {\r\n\t\t\t\t\ttoday: [],\r\n\t\t\t\t\tweek: [],\r\n\t\t\t\t\tmonth: []\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\t// 遍历所有对话记录进行分类\r\n\t\t\t\tthis.conversations.forEach(conv => {\r\n\t\t\t\t\t// 使用更新时间作为分类依据，如果没有时间戳则使用当前时间\r\n\t\t\t\t\tlet timestamp = conv.updatedAt || conv.createdAt;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 如果时间戳为空或无效，使用当前时间\r\n\t\t\t\t\tif (!timestamp || isNaN(timestamp)) {\r\n\t\t\t\t\t\ttimestamp = Date.now();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 格式化时间戳用于调试\r\n\t\t\t\t\tconst formattedDate = formatTimestamp(timestamp);\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:239',`对话 ${conv.id} 的时间: ${formattedDate}, 时间戳: ${timestamp}`);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 处理abstract字段显示\r\n\t\t\t\t\tconst processedConv = {\r\n\t\t\t\t\t\t...conv,\r\n\t\t\t\t\t\tabstract: this.processAbstract(conv.abstract)\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (timestamp >= today) {\r\n\t\t\t\t\t\tresult.today.push(processedConv);\r\n\t\t\t\t\t} else if (timestamp >= weekAgo) {\r\n\t\t\t\t\t\tresult.week.push(processedConv);\r\n\t\t\t\t\t} else if (timestamp >= monthAgo) {\r\n\t\t\t\t\t\tresult.month.push(processedConv);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// 按时间戳倒序排序（最新的在前面）\r\n\t\t\t\t['today', 'week', 'month'].forEach(key => {\r\n\t\t\t\t\tresult[key].sort((a, b) => {\r\n\t\t\t\t\t\tconst timeA = a.updatedAt || a.createdAt || Date.now();\r\n\t\t\t\t\t\tconst timeB = b.updatedAt || b.createdAt || Date.now();\r\n\t\t\t\t\t\treturn timeB - timeA;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 是否有任何历史记录\r\n\t\t\t * @returns {Boolean}\r\n\t\t\t */\r\n\t\t\thasAnyHistory() {\r\n\t\t\t\tconst g = this.groupedHistory;\r\n\t\t\t\treturn (g.today && g.today.length) || (g.week && g.week.length) || (g.month && g.month.length);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 是否显示加载更多组件\r\n\t\t\t * @returns {Boolean}\r\n\t\t\t */\r\n\t\t\tshowLoadMore() {\r\n\t\t\t\treturn this.hasAnyHistory && (this.hasMoreData || this.isLoadingMore);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 是否有更多数据可以加载\r\n\t\t\t * @returns {Boolean}\r\n\t\t\t */\r\n\t\t\thasMoreData() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 优先使用Vuex状态中的分页信息\r\n\t\t\t\t\tconst paginationState = this.$store.state.user?.aiChat?.aiChat?.pagination;\r\n\t\t\t\t\tif (paginationState) {\r\n\t\t\t\t\t\treturn paginationState.hasNext;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 如果Vuex状态不可用，则使用props\r\n\t\t\t\t\treturn this.pagination.hasNext;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:299','获取分页状态出错:', e);\r\n\t\t\t\t\treturn this.pagination.hasNext;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 当前页码\r\n\t\t\t * @returns {Number}\r\n\t\t\t */\r\n\t\t\tcurrentPage() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 优先使用Vuex状态中的分页信息\r\n\t\t\t\t\tconst paginationState = this.$store.state.user?.aiChat?.aiChat?.pagination;\r\n\t\t\t\t\tif (paginationState) {\r\n\t\t\t\t\t\treturn paginationState.pageNum;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 如果Vuex状态不可用，则使用props\r\n\t\t\t\t\treturn this.pagination.pageNum;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:318','获取分页状态出错:', e);\r\n\t\t\t\t\treturn this.pagination.pageNum;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 总页数\r\n\t\t\t * @returns {Number}\r\n\t\t\t */\r\n\t\t\ttotalPages() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 优先使用Vuex状态中的分页信息\r\n\t\t\t\t\tconst paginationState = this.$store.state.user?.aiChat?.aiChat?.pagination;\r\n\t\t\t\t\tif (paginationState) {\r\n\t\t\t\t\t\treturn paginationState.totalPages;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 如果Vuex状态不可用，则使用props\r\n\t\t\t\t\treturn this.pagination.totalPages;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:337','获取分页状态出错:', e);\r\n\t\t\t\t\treturn this.pagination.totalPages;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 是否正在加载分页数据\r\n\t\t\t * @returns {Boolean}\r\n\t\t\t */\r\n\t\t\tisPaginationLoading() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 优先使用Vuex状态中的分页信息\r\n\t\t\t\t\tconst paginationState = this.$store.state.user?.aiChat?.aiChat?.pagination;\r\n\t\t\t\t\tif (paginationState) {\r\n\t\t\t\t\t\treturn paginationState.loading;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 如果Vuex状态不可用，则使用props\r\n\t\t\t\t\treturn this.pagination.loading;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:356','获取分页状态出错:', e);\r\n\t\t\t\t\treturn this.pagination.loading;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\t/**\r\n\t\t\t * @description 监听对话列表变化，自动更新分组\r\n\t\t\t * @param {Array} newConversations - 新的对话列表\r\n\t\t\t * @param {Array} oldConversations - 旧的对话列表\r\n\t\t\t */\r\n\t\t\tconversations: {\r\n\t\t\t\thandler(newConversations, oldConversations) {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:369','=== 对话列表发生变化 ===');\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:370','新对话数量:', newConversations?.length || 0);\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:371','旧对话数量:', oldConversations?.length || 0);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 更新分组\r\n\t\t\t\t\tthis.initConversationGroups();\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:376','=== 分组更新完成 ===');\r\n\t\t\t\t},\r\n\t\t\t\tdeep: true,\r\n\t\t\t\timmediate: false\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 监听分页信息变化\r\n\t\t\t * @param {Object} newPagination - 新的分页信息\r\n\t\t\t * @param {Object} oldPagination - 旧的分页信息\r\n\t\t\t */\r\n\t\t\tpagination: {\r\n\t\t\t\thandler(newPagination, oldPagination) {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:389','=== 分页信息发生变化 ===');\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:390','新分页信息:', newPagination);\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:391','旧分页信息:', oldPagination);\r\n\t\t\t\t},\r\n\t\t\t\tdeep: true,\r\n\t\t\t\timmediate: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\t// 添加调试信息\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:399','=================== 调试信息开始 ===================');\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:400','完整的 Vuex store:', this.$store);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:401','Vuex store状态:', this.$store.state);\r\n\t\t\t\r\n\t\t\tif (this.$store.state.user) {\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:404','user模块状态:', this.$store.state.user);\r\n\t\t\t\t\r\n\t\t\t\tif (this.$store.state.user.aiChat) {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:407','aiChat模块状态:', this.$store.state.user.aiChat);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.$store.state.user.aiChat.aiChat) {\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:410','内层 aiChat:', this.$store.state.user.aiChat.aiChat);\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:411','内层 aiChat conversations:', this.$store.state.user.aiChat.aiChat.conversations);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:413','无法访问内层 aiChat!');\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:414','aiChat 模块完整内容:', JSON.stringify(this.$store.state.user.aiChat));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:417','无法访问 aiChat 模块!');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:420','无法访问 user 模块!');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:423','组件计算的 conversations:', this.conversations);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:424','组件计算的 historySummaries:', this.historySummaries);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:425','组件计算的 currentChatId:', this.currentChatId);\r\n\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:426','=================== 调试信息结束 ===================');\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t// 在组件挂载时初始化对话分类和加载历史记录\r\n\t\t\tthis.initConversationGroups();\r\n\t\t\tthis.loadInitialHistory();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapActions({\r\n\t\t\t\tsetActiveConversation: 'user/aiChat/setCurrentChat',\r\n\t\t\t\tdeleteConversation: 'user/aiChat/deleteChat',\r\n\t\t\t\tloadConversationDetail: 'user/aiChat/loadChat',\r\n\t\t\t\tloadConversationHistory: 'user/aiChat/loadConversationHistory',\r\n\t\t\t\tnextPage: 'user/aiChat/nextPage',\r\n\t\t\t\tprevPage: 'user/aiChat/prevPage',\r\n\t\t\t\trefreshPage: 'user/aiChat/refreshPage'\r\n\t\t\t}),\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 初始化加载对话历史\r\n\t\t\t */\r\n\t\t\tasync loadInitialHistory() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:449','=== 开始初始化加载对话历史 ===');\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 检查是否已有数据，如果没有则加载第一页\r\n\t\t\t\t\tif (this.conversations.length === 0) {\r\n\t\t\t\t\t\tconst result = await this.loadConversationHistory({\r\n\t\t\t\t\t\t\tpageNum: 1,\r\n\t\t\t\t\t\t\tpageSize: 10\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (result.success) {\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:459','初始化对话历史加载成功:', result.data.length, '条记录');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 更新分组\r\n\t\t\t\t\t\t\tthis.initConversationGroups();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:464','初始化对话历史加载失败:', result.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:467','已有对话数据，跳过初始化加载');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:470','=== 初始化加载对话历史完成 ===');\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:472','初始化加载对话历史异常:', error);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 初始化对话分组\r\n\t\t\t */\r\n\t\t\tinitConversationGroups() {\r\n\t\t\t\t// 初始化对话分组，将分组结果通过事件发送给父组件\r\n\t\t\t\tconst groupedConversations = this.groupedConversationsByDate;\r\n\t\t\t\tthis.$emit('updateGroups', groupedConversations);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理abstract字段显示，去除换行符和多余空格\r\n\t\t\t * @param {String} abstract - 原始abstract字段\r\n\t\t\t * @returns {String} 处理后的abstract字段\r\n\t\t\t */\r\n\t\t\tprocessAbstract(abstract) {\r\n\t\t\t\tif (!abstract) return '无标题';\r\n\t\t\t\t\r\n\t\t\t\t// 去除换行符、制表符，并将多个空格替换为单个空格\r\n\t\t\t\treturn abstract\r\n\t\t\t\t\t.replace(/[\\r\\n\\t]/g, ' ')\r\n\t\t\t\t\t.replace(/\\s+/g, ' ')\r\n\t\t\t\t\t.trim() || '无标题';\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 格式化时间戳为人类可读格式\r\n\t\t\t * @param {Number} timestamp - 时间戳\r\n\t\t\t * @param {String} format - 日期格式\r\n\t\t\t * @returns {String} 格式化后的日期字符串\r\n\t\t\t */\r\n\t\t\tformatDate(timestamp, format = 'YYYY-MM-DD') {\r\n\t\t\t\treturn formatTimestamp(timestamp, format);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 获取对话模式的中文标签\r\n\t\t\t * @param {String} mode - 对话模式\r\n\t\t\t * @returns {String} 对话模式的中文标签\r\n\t\t\t */\r\n\t\t\tgetModeLabel(mode) {\r\n\t\t\t\tconst modeLabels = {\r\n\t\t\t\t\t'general': '通用',\r\n\t\t\t\t\t'school': '择校',\r\n\t\t\t\t\t'career': '职业规划',\r\n\t\t\t\t\t'DOU_BAO_CHAT': '豆包聊天',\r\n\t\t\t\t\t// 兼容后端可能返回的其他值\r\n\t\t\t\t\t'': '通用',\r\n\t\t\t\t\tnull: '通用',\r\n\t\t\t\t\tundefined: '通用'\r\n\t\t\t\t};\r\n\t\t\t\treturn modeLabels[mode] || '通用';\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 加载聊天历史\r\n\t\t\t * @param {String|Number} chatId - 聊天ID\r\n\t\t\t */\r\n\t\t\tasync loadChatHistory(chatId) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:535','开始加载聊天历史:', chatId);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 显示加载提示\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '加载中...',\r\n\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 清除该对话的缓存数据，确保重新从后端获取\r\n\t\t\t\t\tconst conversationIndex = this.conversations.findIndex(conv => conv.id == chatId);\r\n\t\t\t\t\tif (conversationIndex !== -1) {\r\n\t\t\t\t\t\t// 清空该对话的消息缓存，强制重新加载\r\n\t\t\t\t\t\tthis.$store.commit('user/aiChat/UPDATE_CONVERSATION_DETAIL', {\r\n\t\t\t\t\t\t\t...this.conversations[conversationIndex],\r\n\t\t\t\t\t\t\tmessages: [] // 清空消息缓存\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:551','已清除对话缓存，强制重新加载:', chatId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 设置当前活跃的对话\r\n\t\t\t\t\tthis.setActiveConversation(chatId);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 强制从后端加载完整的对话内容\r\n\t\t\t\t\tconst result = await this.loadConversationDetail(chatId);\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:559','loadConversationDetail result:', result);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 隐藏加载提示\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (result.success) {\r\n\t\t\t\t\t\t// 安全地获取聊天模式，添加容错处理\r\n\t\t\t\t\t\tconst chatMode = result.conversation?.chatMode || 'general';\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:567','获取到的聊天模式:', chatMode);\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:568','对话信息:', result.conversation);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 更新 Vuex 中的聊天模式\r\n\t\t\t\t\t\tthis.$store.commit('user/aiChat/UPDATE_CHAT_MODE', chatMode);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:573','聊天历史加载成功，消息数量:', result.conversation?.messages?.length || 0);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 使用 $nextTick 确保 DOM 更新完成后再通知父组件\r\n\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\t// 通知父组件加载成功\r\n\t\t\t\t\t\t\tthis.$emit('loadChat', {\r\n\t\t\t\t\t\t\t\tchatId,\r\n\t\t\t\t\t\t\t\tsuccess: true,\r\n\t\t\t\t\t\t\t\tdata: result.data,\r\n\t\t\t\t\t\t\t\tconversation: result.conversation,\r\n\t\t\t\t\t\t\t\tchatMode: chatMode\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:588','聊天历史加载失败:', result.message);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: result.message || '加载聊天历史失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// 通知父组件加载失败\r\n\t\t\t\t\t\tthis.$emit('loadChat', {\r\n\t\t\t\t\t\t\tchatId,\r\n\t\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\t\tmessage: result.message\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\t// 隐藏加载提示\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:604','加载聊天历史异常:', error);\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:605','错误详情:', error.stack);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '加载聊天历史失败，请重试',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// 通知父组件加载异常\r\n\t\t\t\t\tthis.$emit('loadChat', {\r\n\t\t\t\t\t\tchatId,\r\n\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\tmessage: error.message || '加载异常'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 删除历史记录\r\n\t\t\t * @param {String} chatId - 聊天ID\r\n\t\t\t * @param {Event} e - 事件对象，用于阻止冒泡\r\n\t\t\t */\r\n\t\t\tasync deleteChatHistory(chatId, e) {\r\n\t\t\t\t// 确保阻止事件冒泡，避免触发点击加载历史记录\r\n\t\t\t\tif (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:632','开始删除历史记录:', chatId);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 显示确认对话框\r\n\t\t\t\t\tconst confirmResult = await new Promise((resolve) => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '确认删除',\r\n\t\t\t\t\t\t\tcontent: '确定要删除这条对话记录吗？删除后无法恢复。',\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tresolve(res.confirm);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\t\tresolve(false);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!confirmResult) {\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:649','用户取消删除操作');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 显示加载提示\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '正在删除...',\r\n\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 通过 Vuex action 删除对话\r\n\t\t\t\t\tconst result = await this.deleteConversation(chatId);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 隐藏加载提示\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (result.success) {\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:666','删除历史记录成功:', chatId);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '删除成功',\r\n\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 通知父组件删除成功\r\n\t\t\t\t\t\tthis.$emit('deleteChat', {\r\n\t\t\t\t\t\t\tchatId,\r\n\t\t\t\t\t\t\tsuccess: true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:678','删除历史记录失败:', result.message);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: result.message || '删除失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 通知父组件删除失败\r\n\t\t\t\t\t\tthis.$emit('deleteChat', {\r\n\t\t\t\t\t\t\tchatId,\r\n\t\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\t\tmessage: result.message\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\t// 隐藏加载提示\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:695','删除历史记录异常:', error);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '删除失败，请重试',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 通知父组件删除异常\r\n\t\t\t\t\tthis.$emit('deleteChat', {\r\n\t\t\t\t\t\tchatId,\r\n\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\tmessage: error.message || '删除异常'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理滚动到底部事件\r\n\t\t\t */\r\n\t\t\tonScrollToLower() {\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:714','=== 滚动到底部事件触发 ===');\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:715','当前页:', this.currentPage);\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:716','总页数:', this.totalPages);\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:717','是否有更多数据:', this.hasMoreData);\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:718','是否正在加载:', this.isLoadingMore);\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:719','分页是否在加载:', this.isPaginationLoading);\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:720','=========================');\r\n\t\t\t\t\r\n\t\t\t\t// 如果有更多数据且当前没有在加载，则加载下一页\r\n\t\t\t\tif (this.hasMoreData && !this.isLoadingMore && !this.isPaginationLoading) {\r\n\t\t\t\t\tthis.loadMoreData();\r\n\t\t\t\t} else if (!this.hasMoreData) {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:726','已经没有更多数据了');\r\n\t\t\t\t} else if (this.isLoadingMore || this.isPaginationLoading) {\r\n\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:728','正在加载中，跳过本次请求');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 加载更多数据\r\n\t\t\t */\r\n\t\t\tasync loadMoreData() {\r\n\t\t\t\t// 防抖处理\r\n\t\t\t\tif (this.loadMoreTimer) {\r\n\t\t\t\t\tclearTimeout(this.loadMoreTimer);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.loadMoreTimer = setTimeout(async () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:743','=== 开始加载更多数据 ===');\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:744','当前页码:', this.currentPage);\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:745','即将加载页码:', this.currentPage + 1);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.isLoadingMore = true;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 显示加载提示\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '正在加载更多...',\r\n\t\t\t\t\t\t\ticon: 'loading',\r\n\t\t\t\t\t\t\tduration: 2000,\r\n\t\t\t\t\t\t\tmask: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 通过 Vuex action 加载下一页数据\r\n\t\t\t\t\t\tconst result = await this.nextPage();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 隐藏加载提示\r\n\t\t\t\t\t\tuni.hideToast();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (result.success) {\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:764','=== 加载更多数据成功 ===');\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:765','新增数据条数:', result.data?.length || 0);\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:766','当前总数据条数:', this.conversations.length);\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:767','分页信息:', result.pagination);\r\n\t\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:768','========================');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 更新分组数据\r\n\t\t\t\t\t\t\tthis.initConversationGroups();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 通知父组件加载成功\r\n\t\t\t\t\t\t\tthis.$emit('loadMore', {\r\n\t\t\t\t\t\t\t\tsuccess: true,\r\n\t\t\t\t\t\t\t\tdata: result.data,\r\n\t\t\t\t\t\t\t\tpagination: result.pagination\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 如果没有更多数据了，显示提示\r\n\t\t\t\t\t\t\tif (!result.pagination?.hasNext) {\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '已加载全部数据',\r\n\t\t\t\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\t\t\t\tduration: 1500\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}, 500);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:791','=== 加载更多数据失败 ===');\r\n\t\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:792','失败原因:', result.message);\r\n\t\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:793','========================');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: result.message || '加载更多失败',\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 通知父组件加载失败\r\n\t\t\t\t\t\t\tthis.$emit('loadMore', {\r\n\t\t\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\t\t\tmessage: result.message\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:809','=== 加载更多数据异常 ===');\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:810','异常信息:', error);\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:811','异常堆栈:', error.stack);\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:812','========================');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 隐藏加载提示\r\n\t\t\t\t\t\tuni.hideToast();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '加载失败，请重试',\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 通知父组件加载异常\r\n\t\t\t\t\t\tthis.$emit('loadMore', {\r\n\t\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\t\tmessage: error.message || '加载异常'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tthis.isLoadingMore = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 300); // 300ms 防抖\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理刷新事件\r\n\t\t\t */\r\n\t\t\tasync onRefresh() {\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:838','开始刷新历史记录');\r\n\t\t\t\tthis.isRefreshing = true;\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 通过 Vuex action 刷新数据（重新加载当前页）\r\n\t\t\t\t\tconst result = await this.refreshPage();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (result.success) {\r\n\t\t\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:846','刷新历史记录成功:', result.data);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '刷新成功',\r\n\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\tduration: 1000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 通知父组件刷新成功\r\n\t\t\t\t\t\tthis.$emit('refresh', {\r\n\t\t\t\t\t\t\tsuccess: true,\r\n\t\t\t\t\t\t\tdata: result.data,\r\n\t\t\t\t\t\t\tpagination: result.pagination\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:860','刷新历史记录失败:', result.message);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: result.message || '刷新失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 通知父组件刷新失败\r\n\t\t\t\t\t\tthis.$emit('refresh', {\r\n\t\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\t\tmessage: result.message\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tuni.__f__('error','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:874','刷新历史记录异常:', error);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '刷新失败，请重试',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 通知父组件刷新异常\r\n\t\t\t\t\tthis.$emit('refresh', {\r\n\t\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\t\tmessage: error.message || '刷新异常'\r\n\t\t\t\t\t});\r\n\t\t\t\t} finally {\r\n\t\t\t\t\t// 延迟重置刷新状态，给用户足够的反馈时间\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.isRefreshing = false;\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理刷新恢复事件\r\n\t\t\t */\r\n\t\t\tonRefreshRestore() {\r\n\t\t\t\tuni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:897','刷新恢复');\r\n\t\t\t\tthis.isRefreshing = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tbeforeDestroy() {\r\n\t\t\t// 清理定时器\r\n\t\t\tif (this.loadMoreTimer) {\r\n\t\t\t\tclearTimeout(this.loadMoreTimer);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.history-sidebar {\r\n\t\tposition: fixed;\r\n\t\ttop: 206rpx;\r\n\t\tleft: 0;\r\n\t\twidth: 66vw;\r\n\t\theight: calc(100vh - 88rpx);\r\n\t\tbackground-color: #ffffff;\r\n\t\ttransform: translateX(-100%);\r\n\t\ttransition: transform 0.3s ease;\r\n\t\tz-index: 2000;\r\n\t\tbox-shadow: 0 0 20rpx rgba(0, 0, 0, 0.1);\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tpadding-left: 32rpx;\r\n\t\tpadding-right: 32rpx;\r\n\t}\r\n\t\r\n\t.history-sidebar.visible {\r\n\t\ttransform: translateX(0);\r\n\t}\r\n\t\r\n\t.sidebar-header {\r\n\t\tpadding: 30rpx 0 30rpx 0;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: flex-start;\r\n\t\theight: 80rpx;\r\n\t}\r\n\t\r\n\t.sidebar-title {\r\n\t\tfont-size: 36rpx;\r\n\t\tcolor: rgba(47, 47, 47, 1);\r\n\t\tfont-weight: 600;\r\n\t\tmargin-left: 20rpx;\r\n\t}\r\n\t\r\n\t.history-list {\r\n\t\tflex: 1;\r\n\t\theight: calc(100vh - 168rpx);\r\n\t\tpadding: 0;\r\n\t\tbackground-color: rgba(255, 255, 255, 1);\r\n\t\t/* 确保滚动功能正常工作 */\r\n\t\toverflow-y: auto;\r\n\t\t-webkit-overflow-scrolling: touch;\r\n\t}\r\n\t\r\n\t.empty-history {\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 40rpx 0;\r\n\t\tcolor: #999;\r\n\t}\r\n\t\r\n\t.empty-history-text {\r\n\t\tcolor: #999;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\t\r\n\t.history-item-outer {\r\n\t\twidth: 100%;\r\n\t\tborder-radius: 16px;\r\n\t\tmargin-bottom: 16rpx;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\t\r\n\t.history-item-outer-gradient {\r\n\t\twidth: 100%;\r\n\t\tborder-radius: 40rpx;\r\n\t\tpadding: 2rpx 2rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground: linear-gradient(180deg, rgba(228, 241, 255, 1) 0%, rgba(34, 136, 249, 1) 100%);\r\n\t}\r\n\t\r\n\t.history-item-inner {\r\n\t\twidth: 100%;\r\n\t\tborder-radius: 40rpx;\r\n\t\tbackground: #fff;\r\n\t\toverflow: hidden;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tposition: relative;\r\n\t\tpadding: 10rpx 20rpx;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\t\r\n\t.history-item-outer.active .history-item-inner::after{\r\n\t\tcontent: '';\r\n\t\tposition: absolute;\r\n\t\tleft: 0;\r\n\t\ttop: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tbackground: linear-gradient(180deg, rgba(194, 221, 250, 0.1) 11.54%, rgba(34, 136, 249, 0.1) 111.54%);\r\n\t}\r\n\t\r\n\t.history-item-content {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t\r\n\t.history-title {\r\n\t\tfont-family: PingFang SC;\r\n\t\tfont-weight: 400;\r\n\t\tfont-size: 26rpx;\r\n\t\tline-height: 120%;\r\n\t\tletter-spacing: -1.1rpx;\r\n\t\tcolor: rgba(0, 0, 0, 1);\r\n\t\t/* 单行文本截断 */\r\n\t\twhite-space: nowrap;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t\tmax-width: 80%;\r\n\t}\r\n\t\r\n\t.history-actions {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tflex-shrink: 0;\r\n\t}\r\n\t\r\n\t.mode-badge {\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: rgba(34, 136, 249, 0.8);\r\n\t\tpadding: 6rpx 12rpx;\r\n\t\tborder-radius: 20rpx;\r\n\t\tmargin-right: 16rpx;\r\n\t\tbackground-color: rgba(34, 136, 249, 0.1);\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t\r\n\t.history-delete {\r\n\t\twidth: 28rpx;\r\n\t\theight: 28rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tborder-radius: 50%;\r\n\t\tz-index: 1000;\r\n\t}\r\n\t\r\n\t.delete-icon-img {\r\n\t\twidth: 28rpx;\r\n\t\theight: 28rpx;\r\n\t}\r\n\t\r\n\t.history-group-title {\r\n\t\tfont-family: PingFang SC;\r\n\t\tfont-weight: 600;\r\n\t\tfont-size: 24rpx;\r\n\t\tline-height: 100%;\r\n\t\tletter-spacing: -1.1rpx;\r\n\t\tcolor: #888;\r\n\t\tfont-weight: bold;\r\n\t\tpadding: 20rpx 0 10rpx 0;\r\n\t\tmargin-left: 20rpx;\r\n\t\t/* 确保分组标题也能被滚动 */\r\n\t\tposition: relative;\r\n\t}\r\n\t\r\n\t.history-group {\r\n\t\tpadding-bottom: 40rpx;\r\n\t}\r\n\t\r\n\t.load-more-container {\r\n\t\theight: 100rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 20rpx 0;\r\n\t}\r\n\t\r\n\t.load-more-item {\r\n\t\tpadding: 20rpx 40rpx;\r\n\t\tborder-radius: 40rpx;\r\n\t\tbackground-color: rgba(34, 136, 249, 0.08);\r\n\t\tborder: 2rpx solid rgba(34, 136, 249, 0.15);\r\n\t\tmargin: 0 20rpx;\r\n\t\ttransition: all 0.3s ease;\r\n\t}\r\n\t\r\n\t.load-more-item:active {\r\n\t\tbackground-color: rgba(34, 136, 249, 0.15);\r\n\t\ttransform: scale(0.98);\r\n\t}\r\n\t\r\n\t.load-more-text {\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: rgba(34, 136, 249, 0.8);\r\n\t\tfont-weight: 500;\r\n\t\ttext-align: center;\r\n\t}\r\n\t\r\n\t.load-more-text.no-more {\r\n\t\tcolor: #999;\r\n\t\tfont-weight: 400;\r\n\t}\r\n</style> "],"names":["_sfc_main","defineComponent","mapState","state","e","uni","now","today","weekAgo","monthAgo","result","conv","timestamp","formattedDate","formatTimestamp","processedConv","key","a","b","timeA","g","paginationState","_c","_a","newConversations","oldConversations","newPagination","oldPagination","mapActions","error","groupedConversations","abstract","format","mode","chatId","conversationIndex","chatMode","_b","resolve","res","__awaiter"],"mappings":"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"}