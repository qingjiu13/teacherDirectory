{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 加载状态显示 -->\r\n    <view class=\"loading-container\" v-if=\"!pageReady\">\r\n      <view class=\"loading-spinner\"></view>\r\n      <view class=\"loading-text\">加载中...</view>\r\n    </view>\r\n    \r\n    <!-- 主页面内容 -->\r\n    <view class=\"page-container\" v-else>\r\n      <view class=\"header\">\r\n        <view class=\"main-title\">一站式对接</view>\r\n        <view class=\"sub-title\">目标院校专业学长学姐</view>\r\n      </view>\r\n  \t\t<c-lottie class=\"match-animation\"\r\n  \t\t\tref=\"cLottieRef\"\r\n  \t\t\t:src=\"animationSrc\"\r\n  \t\t\twidth=\"600rpx\"\r\n        :autoPlay=\"false\"\r\n  \t\t\theight=\"600rpx\"\r\n  \t\t\t:loop=\"true\"\r\n        @dataReady=\"onDataReady\"\r\n  \t\t></c-lottie>\r\n      <view class=\"button-area\">\r\n        <button class=\"match-button\" @click.stop=\"matchAnimation\">精准匹配</button>\r\n      </view>\r\n  \r\n      <!-- <AICartoon /> -->\r\n      <TabBar pageName=\"index\" />\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"uts\">\r\n// import AICartoon from '@/components/AI-cartoon/AI-cartoon.vue'\r\nimport TabBar from '@/components/tab-bar/tab-bar.vue'\r\nimport { Navigator } from '@/router/Router.js'\r\nimport { ref, onMounted, onActivated } from \"vue\";\r\n\r\nconst cLottieRef = ref()\r\nconst animationSrc = ref('')\r\nconst defaultSrc = 'https://lottie.host/aa045d36-86ee-46d3-9705-1eeb65b38465/V6aAFX4Fmk.json'\r\nconst animationLoaded = ref(false)\r\nconst loading = ref(false)\r\nconst pageReady = ref(false)\r\nlet loadTimeout = null\r\n\r\n/**\r\n * 组件属性\r\n * @type {Object}\r\n */\r\nconst props = defineProps({\r\n  src: {\r\n    type: String,\r\n    default: defaultSrc\r\n  }\r\n})\r\n\r\n/**\r\n * 从URL中提取唯一键\r\n * @param {String} url - 动画URL\r\n * @returns {String} 唯一键\r\n */\r\nconst getAnimationKey = (url) => {\r\n  return url.split('/').pop().split('.')[0]\r\n}\r\n\r\n/**\r\n * 检查缓存状态\r\n * @param {String} key - 存储键名\r\n * @returns {Boolean} 是否已缓存\r\n */\r\nconst checkCached = (key) => {\r\n  const storageKey = `lottie_${key}`\r\n  try {\r\n    const stored = uni.getStorageSync(storageKey)\r\n    return !!stored\r\n  } catch (e) {\r\n    uni.__f__('error','at pages/index/index.vue:79','检查缓存状态失败', e)\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * 预加载并缓存动画数据\r\n * @param {String} url - 动画URL\r\n * @param {String} key - 存储键名\r\n * @returns {Promise<Boolean>} 是否成功\r\n */\r\nconst preloadLottieAnimation = async (url, key) => {\r\n  if (loading.value) return false\r\n  \r\n  loading.value = true\r\n  const storageKey = `lottie_${key}`\r\n  \r\n  // 检查是否已缓存\r\n  if (checkCached(key)) {\r\n    uni.__f__('log','at pages/index/index.vue:98','动画已缓存，无需预加载')\r\n    loading.value = false\r\n    return true\r\n  }\r\n  \r\n  // 从网络加载\r\n  uni.__f__('log','at pages/index/index.vue:104','从网络预加载Lottie动画')\r\n  try {\r\n    const { data } = await uni.request({\r\n      url: url,\r\n      method: 'GET'\r\n    })\r\n    \r\n    // 保存到本地缓存\r\n    try {\r\n      uni.setStorageSync(storageKey, data)\r\n      uni.__f__('log','at pages/index/index.vue:114','Lottie动画已缓存到本地')\r\n      loading.value = false\r\n      return true\r\n    } catch (e) {\r\n      uni.__f__('error','at pages/index/index.vue:118','保存缓存失败', e)\r\n      loading.value = false\r\n      return false\r\n    }\r\n  } catch (e) {\r\n    uni.__f__('error','at pages/index/index.vue:123','获取动画文件失败', e)\r\n    loading.value = false\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * 初始化动画\r\n */\r\nconst initAnimation = async () => {\r\n  // 清除可能存在的超时计时器\r\n  if (loadTimeout) {\r\n    clearTimeout(loadTimeout)\r\n  }\r\n  \r\n  // 重置页面准备状态\r\n  pageReady.value = false\r\n  \r\n  // 设置动画源\r\n  animationSrc.value = props.src\r\n  \r\n  // 检查是否已经缓存了动画数据\r\n  const animationKey = getAnimationKey(props.src)\r\n  const isCached = checkCached(animationKey)\r\n  \r\n  // 预加载动画到缓存（不影响当前显示）\r\n  preloadLottieAnimation(props.src, animationKey)\r\n  \r\n  // 设置超时处理，最长等待3秒\r\n  loadTimeout = setTimeout(() => {\r\n    uni.__f__('log','at pages/index/index.vue:153','动画加载超时，强制显示页面')\r\n    pageReady.value = true\r\n  }, 3000)\r\n  \r\n  // 如果已经缓存，可能不会触发dataReady事件，需要主动检查\r\n  if (isCached) {\r\n    uni.__f__('log','at pages/index/index.vue:159','检测到缓存数据，预先设置动画加载状态')\r\n    animationLoaded.value = true\r\n    // 短暂延迟后显示页面\r\n    setTimeout(() => {\r\n      pageReady.value = true\r\n    }, 500)\r\n  }\r\n}\r\n\r\n/**\r\n * 数据准备完成回调\r\n */\r\nconst onDataReady = () => {\r\n  uni.__f__('log','at pages/index/index.vue:172','动画数据准备完成，触发dataReady事件')\r\n  animationLoaded.value = true\r\n  \r\n  // 清除加载超时计时器\r\n  if (loadTimeout) {\r\n    clearTimeout(loadTimeout)\r\n    loadTimeout = null\r\n  }\r\n  \r\n  // 动画准备好后，标记页面可以显示\r\n  setTimeout(() => {\r\n    uni.__f__('log','at pages/index/index.vue:183','设置页面为可显示状态')\r\n    pageReady.value = true\r\n  }, 100)\r\n}\r\n\r\n/**\r\n * 执行匹配动画\r\n */\r\nconst matchAnimation = () => {\r\n  if (!animationLoaded.value) {\r\n    uni.__f__('log','at pages/index/index.vue:193','动画尚未加载完成')\r\n    return\r\n  }\r\n  \r\n  cLottieRef.value.call('play')\r\n  setTimeout(() => {\r\n    cLottieRef.value.call('stop')\r\n    navigateToMatch()\r\n  }, 1000)\r\n}\r\n\r\n/**\r\n * 导航到匹配页面\r\n */\r\nconst navigateToMatch = () => {\r\n  Navigator.toMatch()\r\n}\r\n\r\n// 组件挂载时初始化\r\nonMounted(() => {\r\n  uni.__f__('log','at pages/index/index.vue:213','组件挂载，初始化动画')\r\n  initAnimation()\r\n})\r\n\r\n// 在页面被激活时确保动画已加载（如从其他页面返回时）\r\nonActivated(() => {\r\n  uni.__f__('log','at pages/index/index.vue:219','页面激活')\r\n  if (!animationSrc.value) {\r\n    initAnimation()\r\n  } else {\r\n    // 如果已有源但页面未准备好，强制准备\r\n    if (!pageReady.value) {\r\n      uni.__f__('log','at pages/index/index.vue:225','动画源已存在但页面未准备好，强制显示')\r\n      pageReady.value = true\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<style >\r\n.container {\r\n  position: relative;\r\n  width: 100%;\r\n  min-height: 100vh;\r\n}\r\n\r\n/* 加载状态样式 */\r\n.loading-container {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  background-color: #f8f8f8;\r\n  z-index: 999;\r\n}\r\n\r\n.loading-spinner {\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  border: 8rpx solid #f3f3f3;\r\n  border-top: 8rpx solid #3498db;\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n\r\n.loading-text {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n}\r\n\r\n.page-container {\r\n  position: relative;\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  box-sizing: border-box;\r\n  padding-bottom: 120rpx;\r\n  background-color: #f8f8f8;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-left: 200rpx;\r\n  margin-top: 80rpx;\r\n  width: 100%;\r\n}\r\n\r\n.main-title {\r\n  font-size: 48rpx;\r\n  font-weight: 550;\r\n  margin-bottom: 20rpx;\r\n  color: #333;\r\n}\r\n\r\n.sub-title {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  margin-bottom: 40rpx;\r\n  font-weight: 450;\r\n  text-align: left;\r\n}\r\n\r\n.button-area {\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-top: 60rpx;\r\n}\r\n\r\n.match-button {\r\n  width: 480rpx;\r\n  height: 80rpx;\r\n  background-color: #ffffff;\r\n  color: #333;\r\n  border: 1px solid #dddddd;\r\n  border-radius: 40rpx;\r\n  font-size: 32rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n  transition: all 0.3s ease;\r\n  padding: 0;\r\n  font-weight: 500;\r\n  line-height: 80rpx;\r\n}\r\n\r\n.match-animation {\r\n  position: relative;\r\n  margin-top: 50rpx;\r\n  top: 0;\r\n  left: 0;\r\n}\r\n\r\n</style>","import MiniProgramPage from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","__awaiter","Navigator","onMounted","onActivated","MiniProgramPage"],"mappings":"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"}