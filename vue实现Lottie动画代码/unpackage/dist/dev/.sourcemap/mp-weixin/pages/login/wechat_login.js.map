{"version":3,"file":"wechat_login.js","sources":["pages/login/wechat_login.vue","../../../HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vd2VjaGF0X2xvZ2luLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"login-container\">\r\n    <!-- 顶部背景图 -->\r\n    <view class=\"header-bg\">\r\n      <image class=\"bg-image\" src=\"/static/image/login_qianduan_test.png\" mode=\"widthFix\"></image>\r\n    </view>\r\n    \r\n    <!-- 内容区域 -->\r\n    <view class=\"content\">\r\n      <!-- 欢迎文案 -->\r\n      <view class=\"welcome-text\">\r\n        <text class=\"title\">欢迎使用</text>\r\n        <text class=\"subtitle\">请先登录以享受完整服务</text>\r\n      </view>\r\n      \r\n      <!-- 用户头像占位 -->\r\n      <view class=\"avatar-container\">\r\n        <image class=\"avatar\" :src=\"userInfo.avatarUrl || '/static/image/tab-bar/default_avatar.png'\" mode=\"aspectFill\"></image>\r\n        <text class=\"nickname\" v-if=\"userInfo.nickName\">{{userInfo.nickName}}</text>\r\n        <text class=\"nickname\" v-else>未登录</text>\r\n      </view>\r\n      \r\n      <!-- 微信登录按钮 -->\r\n      <button class=\"login-btn\" open-type=\"getUserInfo\" @getuserinfo=\"onGetUserInfo\" v-if=\"!hasLogin\">\r\n        <image class=\"wechat-icon\" src=\"/static/image/tab-bar/default_avatar.png\"></image>\r\n        <text>微信一键登录</text>\r\n      </button>\r\n      \r\n      <!-- 已登录状态 -->\r\n      <button class=\"login-btn logged-in\" v-else @click=\"toHome\">\r\n        <text>进入应用</text>\r\n      </button>\r\n      \r\n      <!-- 协议声明 -->\r\n\t\t<view class=\"agreement\">\r\n\t\t  <text>登录即表示同意</text>\r\n\t\t  <view class=\"link-group\">\r\n\t\t\t<text class=\"link\" @click=\"showAgreement\">《用户协议》</text>\r\n\t\t\t<text>和</text>\r\n\t\t\t<text class=\"link\" @click=\"showPrivacy\">《隐私政策》</text>\r\n\t\t  </view>\r\n\t\t</view>\r\n    </view>\r\n    \r\n\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n\t\r\nimport { Navigator } from '../../router/Router';\r\n\t\r\nexport default {\r\n  data() {\r\n    return {\r\n      hasLogin: false,\r\n      userInfo: {\r\n        nickName: '',\r\n        avatarUrl: ''\r\n      }\r\n    }\r\n  },\r\n  onLoad() {\r\n    this.checkLoginStatus();\r\n  },\r\n  methods: {\r\n    // 检查登录状态\r\n    checkLoginStatus() {\r\n      const userInfo = uni.getStorageSync('userInfo');\r\n      const token = uni.getStorageSync('token');\r\n      \r\n      if (userInfo && token) {\r\n        this.userInfo = userInfo;\r\n        this.hasLogin = true;\r\n      }\r\n    },\r\n    \r\n    // 获取用户信息\r\n    onGetUserInfo(e) {\r\n      if (e.detail.errMsg === 'getUserInfo:ok') {\r\n        // 用户授权成功\r\n        this.userInfo = e.detail.userInfo;\r\n        this.loginWithWechat();\r\n      } else {\r\n        // 用户拒绝授权\r\n        uni.showToast({\r\n          title: '您已拒绝授权',\r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n    \r\n    // 微信登录\r\n    loginWithWechat() {\r\n      uni.showLoading({\r\n        title: '登录中...'\r\n      });\r\n      \r\n      // 这里替换为你的实际登录逻辑\r\n      // 1. 调用微信登录接口获取code\r\n      uni.login({\r\n        provider: 'weixin',\r\n        success: (loginRes) => {\r\n          // 2. 将code发送到你的后端服务器获取token\r\n          // 这里模拟一个登录请求\r\n          setTimeout(() => {\r\n            uni.hideLoading();\r\n            \r\n            // 模拟登录成功\r\n            const token = 'mock_token_' + Date.now();\r\n            uni.setStorageSync('token', token);\r\n            uni.setStorageSync('userInfo', this.userInfo);\r\n            \r\n            this.hasLogin = true;\r\n            \r\n            uni.showToast({\r\n              title: '登录成功',\r\n              icon: 'success'\r\n            });\r\n            \r\n            // 登录成功后跳转首页\r\n            this.toHome();\r\n          }, 1500);\r\n        },\r\n        fail: (err) => {\r\n          uni.hideLoading();\r\n          uni.showToast({\r\n            title: '登录失败',\r\n            icon: 'none'\r\n          });\r\n          uni.__f__('error','at pages/login/wechat_login.vue:131','微信登录失败:', err);\r\n        }\r\n      });\r\n    },\r\n    \r\n    // 跳转首页\r\n    toHome() {\r\n\t\tNavigator.toLogin()\r\n    },\r\n    \r\n    // 显示用户协议\r\n    showAgreement() {\r\n      uni.navigateTo({\r\n        url: '/pages/agreement/index?type=user'\r\n      });\r\n    },\r\n    \r\n    // 显示隐私政策\r\n    showPrivacy() {\r\n      uni.navigateTo({\r\n        url: '/pages/agreement/index?type=privacy'\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-container {\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: #f8f8f8;\r\n  \r\n  .header-bg {\r\n    width: 100%;\r\n    height: 300rpx;\r\n    position: relative;\r\n    \r\n    .bg-image {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n  }\r\n  \r\n  .content {\r\n    flex: 1;\r\n    padding: 0 60rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    \r\n    .welcome-text {\r\n      margin-top: 40rpx;\r\n      margin-bottom: 80rpx;\r\n      text-align: center;\r\n      \r\n      .title {\r\n        display: block;\r\n        font-size: 48rpx;\r\n        font-weight: bold;\r\n        color: #333;\r\n      }\r\n      \r\n      .subtitle {\r\n        display: block;\r\n        font-size: 28rpx;\r\n        color: #999;\r\n        margin-top: 20rpx;\r\n      }\r\n    }\r\n    \r\n    .avatar-container {\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      margin-bottom: 80rpx;\r\n      \r\n      .avatar {\r\n        width: 140rpx;\r\n        height: 140rpx;\r\n        border-radius: 50%;\r\n        border: 4rpx solid #fff;\r\n        box-shadow: 0 10rpx 20rpx rgba(0, 0, 0, 0.1);\r\n      }\r\n      \r\n      .nickname {\r\n        margin-top: 20rpx;\r\n        font-size: 32rpx;\r\n        color: #333;\r\n      }\r\n    }\r\n    \r\n    .login-btn {\r\n      width: 100%;\r\n      height: 90rpx;\r\n      line-height: 90rpx;\r\n      border-radius: 45rpx;\r\n      background: linear-gradient(to right, #07C160, #09BB07);\r\n      color: #fff;\r\n      font-size: 32rpx;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      border: none;\r\n      box-shadow: 0 10rpx 20rpx rgba(7, 193, 96, 0.3);\r\n      \r\n      &.logged-in {\r\n        background: linear-gradient(to right, #1989fa, #3194fa);\r\n        box-shadow: 0 10rpx 20rpx rgba(25, 137, 250, 0.3);\r\n      }\r\n      \r\n      .wechat-icon {\r\n        width: 40rpx;\r\n        height: 40rpx;\r\n        margin-right: 15rpx;\r\n      }\r\n    }\r\n    \r\n.agreement {\r\n  margin-top: 40rpx;\r\n  font-size: 24rpx;\r\n  color: #999;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  flex-wrap: nowrap;\r\n  flex-direction: row;\r\n\r\n  .link-group {\r\n    display: flex;\r\n    flex-direction: row;\r\n    flex-wrap: nowrap;\r\n    gap: 6rpx; // 控制《用户协议》和之间的间距\r\n    margin-left: 8rpx;\r\n  }\r\n\r\n  .link {\r\n    color: #1989fa;\r\n  }\r\n}\r\n  }\r\n  \r\n}\r\n</style>","import MiniProgramPage from 'D:/github/teacherDirectory/vue实现Lottie动画代码/pages/login/wechat_login.vue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","Navigator"],"mappings":";;;;AAoDA,MAAA,YAAeA,8BAAA;AAAA,EACb,OAAI;AACF,WAAO;AAAA,MACL,UAAU;AAAA,MACV,UAAU,IAAA,cAAA;AAAA,QACR,UAAU;AAAA,QACV,WAAW;AAAA,OACb;AAAA;EAEH;AAAA,EACD,SAAM;AACJ,SAAK,iBAAgB;AAAA,EACtB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,mBAAgB;AACd,YAAM,WAAWC,cAAAA,MAAI,eAAe,UAAU;AAC9C,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExC,UAAI,YAAY,OAAO;AACrB,aAAK,WAAW;AAChB,aAAK,WAAW;AAAA,MAClB;AAAA,IACD;AAAA;AAAA,IAGD,cAAc,IAAC,MAAA;AACb,UAAI,EAAE,OAAO,WAAW,kBAAkB;AAExC,aAAK,WAAW,EAAE,OAAO;AACzB,aAAK,gBAAe;AAAA,MACpB,OAAK;AAELA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAA;AAAA,MACH;AAAA,IACD;AAAA;AAAA,IAGD,kBAAe;AACbA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,MACR,CAAA;AAIDA,oBAAAA,MAAI,MAAM;AAAA,QACR,UAAU;AAAA,QACV,SAAS,CAAC,aAAQ;AAGhB,qBAAW,MAAA;AACTA,0BAAG,MAAC,YAAW;AAGf,kBAAM,QAAQ,gBAAgB,KAAK,IAAG;AACtCA,0BAAAA,MAAI,eAAe,SAAS,KAAK;AACjCA,0BAAAA,MAAI,eAAe,YAAY,KAAK,QAAQ;AAE5C,iBAAK,WAAW;AAEhBA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YACP,CAAA;AAGD,iBAAK,OAAM;AAAA,UACZ,GAAE,IAAI;AAAA,QACR;AAAA,QACD,MAAM,CAAC,QAAG;AACRA,wBAAG,MAAC,YAAW;AACfA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACP,CAAA;AACDA,wBAAG,MAAC,MAAM,SAAQ,uCAAsC,WAAW,GAAG;AAAA,QACxE;AAAA,MACD,CAAA;AAAA,IACF;AAAA;AAAA,IAGD,SAAM;AACRC,oBAAS,UAAC,QAAO;AAAA,IACd;AAAA;AAAA,IAGD,gBAAa;AACXD,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACN,CAAA;AAAA,IACF;AAAA;AAAA,IAGD,cAAW;AACTA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACN,CAAA;AAAA,IACH;AAAA,EACF;CACF;;;;;;;;;;;;;;;;;;;;;;ACzJA,GAAG,WAAW,eAAe;"}