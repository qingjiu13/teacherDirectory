{"version":3,"file":"main.js","sources":["uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.vue","pagesChat/components/loading/loading.vue","pagesChat/components/long-press-menu/long-press-menu.vue","pagesChat/components/chat-item/chat-item.vue","pagesChat/main.js"],"sourcesContent":["<template>\n\t<view class=\"uni-searchbar\">\n\t\t<view :style=\"{borderRadius:radius+'px',backgroundColor: bgColor}\" class=\"uni-searchbar__box\"\n\t\t\t@click=\"searchClick\">\n\t\t\t<view class=\"uni-searchbar__box-icon-search\">\n\t\t\t\t<slot name=\"searchIcon\">\n\t\t\t\t\t<uni-icons color=\"#c0c4cc\" size=\"18\" type=\"search\" />\n\t\t\t\t</slot>\n\t\t\t</view>\n\t\t\t<input v-if=\"show || searchVal\" :focus=\"showSync\" :disabled=\"readonly\" :placeholder=\"placeholderText\" :maxlength=\"maxlength\"\n\t\t\t\tclass=\"uni-searchbar__box-search-input\" confirm-type=\"search\" type=\"text\" v-model=\"searchVal\"\n\t\t\t\t@confirm=\"confirm\" @blur=\"blur\" @focus=\"emitFocus\" />\n\t\t\t<text v-else class=\"uni-searchbar__text-placeholder\">{{ placeholder }}</text>\n\t\t\t<view v-if=\"show && (clearButton==='always'||clearButton==='auto'&&searchVal!=='') &&!readonly\"\n\t\t\t\tclass=\"uni-searchbar__box-icon-clear\" @click=\"clear\">\n\t\t\t\t<slot name=\"clearIcon\">\n\t\t\t\t\t<uni-icons color=\"#c0c4cc\" size=\"20\" type=\"clear\" />\n\t\t\t\t</slot>\n\t\t\t</view>\n\t\t</view>\n\t\t<text @click=\"cancel\" class=\"uni-searchbar__cancel\"\n\t\t\tv-if=\"cancelButton ==='always' || show && cancelButton ==='auto'\">{{cancelTextI18n}}</text>\n\t</view>\n</template>\n\n<script lang=\"uts\">\n\timport {\n\t\tinitVueI18n\n\t} from '@dcloudio/uni-i18n'\n\timport messages from './i18n/index.js'\n\tconst {\n\t\tt\n\t} = initVueI18n(messages)\n\n\t/**\n\t * SearchBar 搜索栏\n\t * @description 搜索栏组件，通常用于搜索商品、文章等\n\t * @tutorial https://ext.dcloud.net.cn/plugin?id=866\n\t * @property {Number} radius 搜索栏圆角\n\t * @property {Number} maxlength 输入最大长度\n\t * @property {String} placeholder 搜索栏Placeholder\n\t * @property {String} clearButton = [always|auto|none] 是否显示清除按钮\n\t * \t@value always 一直显示\n\t * \t@value auto 输入框不为空时显示\n\t * \t@value none 一直不显示\n\t * @property {String} cancelButton = [always|auto|none] 是否显示取消按钮\n\t * \t@value always 一直显示\n\t * \t@value auto 输入框不为空时显示\n\t * \t@value none 一直不显示\n\t * @property {String} cancelText 取消按钮的文字\n\t * @property {String} bgColor 输入框背景颜色\n\t * @property {Boolean} focus 是否自动聚焦\n\t * @property {Boolean} readonly 组件只读，不能有任何操作，只做展示\n\t * @event {Function} confirm uniSearchBar 的输入框 confirm 事件，返回参数为uniSearchBar的value，e={value:Number}\n\t * @event {Function} input uniSearchBar 的 value 改变时触发事件，返回参数为uniSearchBar的value，e=value\n\t * @event {Function} cancel 点击取消按钮时触发事件，返回参数为uniSearchBar的value，e={value:Number}\n\t * @event {Function} clear 点击清除按钮时触发事件，返回参数为uniSearchBar的value，e={value:Number}\n\t * @event {Function} blur input失去焦点时触发事件，返回参数为uniSearchBar的value，e={value:Number}\n\t */\n\n\texport default {\n\t\tname: \"UniSearchBar\",\n\t\temits: ['input', 'update:modelValue', 'clear', 'cancel', 'confirm', 'blur', 'focus'],\n\t\tprops: {\n\t\t\tplaceholder: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: \"\"\n\t\t\t},\n\t\t\tradius: {\n\t\t\t\ttype: [Number, String],\n\t\t\t\tdefault: 5\n\t\t\t},\n\t\t\tclearButton: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: \"auto\"\n\t\t\t},\n\t\t\tcancelButton: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: \"auto\"\n\t\t\t},\n\t\t\tcancelText: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: \"\"\n\t\t\t},\n\t\t\tbgColor: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: \"#F8F8F8\"\n\t\t\t},\n\t\t\tmaxlength: {\n\t\t\t\ttype: [Number, String],\n\t\t\t\tdefault: 100\n\t\t\t},\n\t\t\tvalue: {\n\t\t\t\ttype: [Number, String],\n\t\t\t\tdefault: \"\"\n\t\t\t},\n\t\t\tmodelValue: {\n\t\t\t\ttype: [Number, String],\n\t\t\t\tdefault: \"\"\n\t\t\t},\n\t\t\tfocus: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false\n\t\t\t},\n\t\t\treadonly: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tshow: false,\n\t\t\t\tshowSync: false,\n\t\t\t\tsearchVal: ''\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tcancelTextI18n() {\n\t\t\t\treturn this.cancelText || t(\"uni-search-bar.cancel\")\n\t\t\t},\n\t\t\tplaceholderText() {\n\t\t\t\treturn this.placeholder || t(\"uni-search-bar.placeholder\")\n\t\t\t}\n\t\t},\n\t\twatch: {\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t\tmodelValue: {\n\t\t\t\timmediate: true,\n\t\t\t\thandler(newVal) {\n\t\t\t\t\tthis.searchVal = newVal\n\t\t\t\t\tif (newVal) {\n\t\t\t\t\t\tthis.show = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tfocus: {\n\t\t\t\timmediate: true,\n\t\t\t\thandler(newVal) {\n\t\t\t\t\tif (newVal) {\n\t\t\t\t\t\tif(this.readonly) return\n\t\t\t\t\t\tthis.show = true;\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\tthis.showSync = true\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tsearchVal(newVal, oldVal) {\n\t\t\t\tthis.$emit(\"input\", newVal)\n\n\t\t\t\tthis.$emit(\"update:modelValue\", newVal)\n\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tsearchClick() {\n\t\t\t\tif(this.readonly) return\n\t\t\t\tif (this.show) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.show = true;\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.showSync = true\n\t\t\t\t})\n\t\t\t},\n\t\t\tclear() {\n\t\t\t\tthis.$emit(\"clear\", {\n\t\t\t\t\tvalue: this.searchVal\n\t\t\t\t})\n\t\t\t\tthis.searchVal = \"\"\n\t\t\t},\n\t\t\tcancel() {\n\t\t\t\tif(this.readonly) return\n\t\t\t\tthis.$emit(\"cancel\", {\n\t\t\t\t\tvalue: this.searchVal\n\t\t\t\t});\n\t\t\t\tthis.searchVal = \"\"\n\t\t\t\tthis.show = false\n\t\t\t\tthis.showSync = false\n\n\t\t\t\tuni.hideKeyboard()\n\n\n\n\n\t\t\t},\n\t\t\tconfirm() {\n\n\t\t\t\tuni.hideKeyboard();\n\n\n\n\n\t\t\t\tthis.$emit(\"confirm\", {\n\t\t\t\t\tvalue: this.searchVal\n\t\t\t\t})\n\t\t\t},\n\t\t\tblur() {\n\n\t\t\t\tuni.hideKeyboard();\n\n\n\n\n\t\t\t\tthis.$emit(\"blur\", {\n\t\t\t\t\tvalue: this.searchVal\n\t\t\t\t})\n\t\t\t},\n\t\t\temitFocus(e) {\n\t\t\t\tthis.$emit(\"focus\", e.detail)\n\t\t\t}\n\t\t}\n\t};\n</script>\n\n<style lang=\"scss\">\n\t$uni-searchbar-height: 36px;\n\n\t.uni-searchbar {\n\n\t\tdisplay: flex;\n\n\t\tflex-direction: row;\n\t\tposition: relative;\n\t\tpadding: 10px;\n\t\t// background-color: #fff;\n\t}\n\n\t.uni-searchbar__box {\n\n\t\tdisplay: flex;\n\t\tbox-sizing: border-box;\n\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t\tflex: 1;\n\t\tjustify-content: center;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\theight: $uni-searchbar-height;\n\t\tpadding: 5px 8px 5px 0px;\n\t}\n\n\t.uni-searchbar__box-icon-search {\n\n\t\tdisplay: flex;\n\n\t\tflex-direction: row;\n\t\t// width: 32px;\n\t\tpadding: 0 8px;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tcolor: #B3B3B3;\n\t}\n\n\t.uni-searchbar__box-search-input {\n\t\tflex: 1;\n\t\tfont-size: 14px;\n\t\tcolor: #333;\n\t}\n\n\t.uni-searchbar__box-icon-clear {\n\t\talign-items: center;\n\t\tline-height: 24px;\n\t\tpadding-left: 8px;\n\n\n\n\t}\n\n\t.uni-searchbar__text-placeholder {\n\t\tfont-size: 14px;\n\t\tcolor: #B3B3B3;\n\t\tmargin-left: 5px;\n\t}\n\n\t.uni-searchbar__cancel {\n\t\tpadding-left: 10px;\n\t\tline-height: $uni-searchbar-height;\n\t\tfont-size: 14px;\n\t\tcolor: #333333;\n\n\n\n\t}\n</style>\n","<template>\n\t<view class=\"loading-box\" :style=\"loadingStyle\">\n\t\t<view class=\"rotate iconfont icon-loading\" :style=\"icontStyle\"></view>\n\t\t<slot></slot>\n\t</view>\n</template>\n\n<script lang=\"uts\">\n\nexport default {\n\tdata() {\n\t\treturn {}\n\t},\n\tprops: {\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 100\n\t\t},\n\t\tmask: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t}\n\t},\n\tcomputed: {\n\t\ticontStyle() {\n\t\t\treturn `font-size:${this.size}rpx`;\n\t\t},\n\t\tloadingStyle() {\n\t\t\treturn this.mask ? \"background: rgba(0, 0, 0, 0.3);\" : \"\";\n\t\t}\n\t}\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.loading-box {\n\twidth: 100%;\n\theight: 100%;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\tz-index: 10000;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.rotate {\n\tanimation: rotate 2s ease-in-out infinite;\n\n}\n\n@keyframes rotate {\n\tfrom {\n\t\ttransform: rotate(0deg)\n\t}\n\n\tto {\n\t\ttransform: rotate(360deg)\n\t}\n}\n</style>","<template>\n\t<view>\n\t\t<view @longpress.stop=\"onLongPress($event)\" @touchmove=\"onTouchMove\" @touchend=\"onTouchEnd\">\n\t\t\t<slot></slot>\n\t\t</view>\n\t\t<view v-if=\"isShowMenu\" class=\"menu-mask\" @touchstart=\"onClose()\" @contextmenu.prevent=\"\"></view>\n\t\t<view v-if=\"isShowMenu\" class=\"menu\" :style=\"menuStyle\">\n\t\t\t<view class=\"menu-item\" v-for=\"(item) in items\" :key=\"item.key\" @click.prevent=\"onSelectMenu(item)\">\n\t\t\t\t<text :style=\"itemStyle(item)\"> {{ item.name }}</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"uts\">\nexport default {\n\tname: \"long-press-menu\",\n\tdata() {\n\t\treturn {\n\t\t\tisShowMenu: false,\n\t\t\tisTouchMove: false,\n\t\t\tstyle: \"\"\n\t\t}\n\t},\n\tprops: {\n\t\titems: {\n\t\t\ttype: Array\n\t\t}\n\t},\n\tmethods: {\n\t\tonLongPress(e) {\n\t\t\tif (this.isTouchMove) {\n\t\t\t\t// 屏幕移动时不弹出\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tuni.getSystemInfo({\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tlet touches = e.touches[0];\n\t\t\t\t\tlet style = \"\";\n\t\t\t\t\t/* 因 非H5端不兼容 style 属性绑定 Object ，所以拼接字符 */\n\t\t\t\t\tif (touches.clientY > (res.windowHeight / 2)) {\n\t\t\t\t\t\tstyle = `bottom:${res.windowHeight - touches.clientY}px;`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyle = `top:${touches.clientY}px;`;\n\t\t\t\t\t}\n\t\t\t\t\tif (touches.clientX > (res.windowWidth / 2)) {\n\t\t\t\t\t\tstyle += `right:${res.windowWidth - touches.clientX}px;`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyle += `left:${touches.clientX}px;`;\n\t\t\t\t\t}\n\t\t\t\t\tthis.menuStyle = style;\n\t\t\t\t\t//\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tthis.isShowMenu = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tonTouchMove() {\n\t\t\tthis.onClose();\n\t\t\tthis.isTouchMove = true;\n\t\t},\n\t\tonTouchEnd() {\n\t\t\tthis.isTouchMove = false;\n\t\t},\n\t\tonSelectMenu(item) {\n\t\t\tthis.$emit(\"select\", item);\n\t\t\tthis.isShowMenu = false;\n\t\t},\n\t\tonClose() {\n\t\t\tthis.isShowMenu = false;\n\t\t},\n\t\titemStyle(item) {\n\t\t\tif (item.color) {\n\t\t\t\treturn `color:${item.color};`\n\t\t\t}\n\t\t\treturn `color:#000;`;\n\t\t}\n\t}\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.menu-mask {\n\tposition: fixed;\n\tleft: 0;\n\ttop: 0;\n\tright: 0;\n\tbottom: 0;\n\twidth: 100%;\n\theight: 100%;\n\tz-index: 999;\n}\n\n.menu {\n\tposition: fixed;\n\tborder-radius: 4px;\n\toverflow: hidden;\n\tbackground-color: #fff;\n\tz-index: 1000;\n\tbox-shadow: $im-box-shadow-dark;\n\n\t.menu-item {\n\t\theight: 28px;\n\t\tmin-width: 120rpx;\n\t\tline-height: 28px;\n\t\tfont-size: $im-font-size-small;\n\t\tdisplay: flex;\n\t\tpadding: 6px 20px;\n\t\tjustify-content: flex-start;\n\n\t\t&:hover {\n\t\t\tbackground: $im-bg-active;\n\t\t}\n\n\t\t.menu-icon {\n\t\t\tmargin-right: 10rpx;\n\t\t}\n\t}\n}\n</style>","<template>\n\t<view class=\"chat-item\" :class=\"active ? 'active' : ''\">\n\t\t<!--rich-text中的表情包会屏蔽事件，所以这里用一个遮罩层捕获点击事件 -->\n\t\t<view class=\"mask\" @tap=\"showChatBox()\"></view>\n\t\t<view class=\"left\">\n\t\t\t<HeadImage :url=\"chat.headImage\" :name=\"chat.showName\"></HeadImage>\n\t\t</view>\n\t\t<view class=\"chat-right\">\n\t\t\t<view class=\"chat-name\">\n\t\t\t\t<view class=\"chat-name-text\">\n\t\t\t\t\t<view>{{ chat.showName }}</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"chat-time\">{{ formatTime(chat.lastSendTime, true) }}</view>\n\t\t\t</view>\n\t\t\t<view class=\"chat-content\">\n\t\t\t\t<view class=\"chat-at-text\">{{ atText }}</view>\n\t\t\t\t<view class=\"chat-send-name\" v-if=\"isShowSendName\">{{ chat.sendNickName + ':&nbsp;' }}</view>\n\t\t\t\t<rich-text class=\"chat-content-text\" :nodes=\"transformEmoji(chat.lastContent)\"></rich-text>\n\t\t\t\t<uni-badge v-if=\"chat.unreadCount > 0\" :max-num=\"99\" :text=\"chat.unreadCount\" />\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"uts\">\n// 导入date工具\nimport { toTimeText } from '../../common/date.js';\n// 导入emoji工具\nimport emoUtil from '../../common/emotion.js';\n// 导入头像组件\nimport HeadImage from '/pagesChat/components/head-image/head-image';\n// 导入消息类型工具\nimport * as msgType from '/pagesChat/common/messageType.js';\n// 导入消息类型常量\nimport { MESSAGE_TYPE } from '/pagesChat/common/enums.js';\n\nexport default {\n\tname: \"chatItem\",\n\tcomponents: {\n\t\tHeadImage\n\t},\n\tdata() {\n\t\treturn {\n\t\t\t// 本地消息类型常量\n\t\t\tMESSAGE_TYPE\n\t\t}\n\t},\n\tprops: {\n\t\tchat: {\n\t\t\ttype: Object\n\t\t},\n\t\tindex: {\n\t\t\ttype: Number\n\t\t},\n\t\tactive: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tchatStore: {\n\t\t\ttype: Object,\n\t\t\tdefault: null\n\t\t}\n\t},\n\t// 确保能在模板中使用$msgType\n\tbeforeCreate() {\n\t\t// 先检查全局属性是否可用\n\t\tif (!this.$msgType) {\n\t\t\t// 如果不可用，创建一个替代对象\n\t\t\tthis.$msgType = msgType;\n\t\t}\n\t},\n\tmethods: {\n\t\t/**\n\t\t * 格式化时间显示\n\t\t * @param {number} timestamp - 时间戳\n\t\t * @param {boolean} simple - 是否简化显示\n\t\t * @returns {string} 格式化后的时间字符串\n\t\t */\n\t\tformatTime(timestamp, simple) {\n\t\t\treturn toTimeText(timestamp, simple);\n\t\t},\n\t\t\n\t\t/**\n\t\t * 转换文本中的表情符号\n\t\t * @param {string} content - 包含表情符号的文本\n\t\t * @returns {string} 转换后的HTML字符串\n\t\t */\n\t\ttransformEmoji(content) {\n\t\t\tif (!content) return '';\n\t\t\treturn emoUtil.transform(content, 'emoji-img');\n\t\t},\n\t\t\n\t\tshowChatBox() {\n\t\t\t// 初始化期间进入会话会导致消息不刷新\n\t\t\tif(!getApp().$vm.isInit || (this.chatStore && this.chatStore.isLoading && this.chatStore.isLoading())){\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: \"正在初始化页面,请稍后...\",\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tuni.navigateTo({\n\t\t\t\turl: \"/pagesChat/chat-box?chatIdx=\" + this.index\n\t\t\t})\n\t\t}\n\t},\n\tcomputed: {\n\t\tisShowSendName() {\n\t\t\tif (!this.chat.sendNickName) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet size = this.chat.messages ? this.chat.messages.length : 0;\n\t\t\tif (size == 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// 只有群聊的普通消息需要显示名称\n\t\t\tlet lastMsg = this.chat.messages[size - 1];\n\t\t\t// 使用本地导入的msgType而不是依赖全局属性\n\t\t\treturn msgType.isNormal(lastMsg.type);\n\t\t},\n\t\tatText() {\n\t\t\tif (this.chat.atMe) {\n\t\t\t\treturn \"[有人@我]\"\n\t\t\t} else if (this.chat.atAll) {\n\t\t\t\treturn \"[@全体成员]\"\n\t\t\t}\n\t\t\treturn \"\";\n\t\t}\n\t}\n}\n</script>\n\n<style scoped lang=\"scss\">\n.chat-item {\n\theight: 132rpx;\n\tdisplay: flex;\n\tmargin-bottom: 2rpx;\n\tposition: relative;\n\tpadding: 18rpx 20rpx;\n\tflex-direction: row;\n\tbackground-color: transparent;\n\talign-items: center;\n\twhite-space: nowrap;\n\tbox-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.1);\n\n\t&:hover {\n\t\tbackground-color: $im-bg-active;\n\t}\n\n\t&.active {\n\t\tbackground-color: $im-bg-active;\n\t}\n\n\t.mask {\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tz-index: 99;\n\t}\n\n\t.left {\n\t\tposition: relative;\n\t\tdisplay: flex;\n\t\twidth: 100rpx;\n\t\theight: 100rpx;\n\t\tleft: 20rpx;\n\t\t\n\t}\n\n\t.chat-right {\n\t\theight: 100%;\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\tpadding-left: 20rpx;\n\t\ttext-align: left;\n\t\toverflow: hidden;\n\n\t\t.chat-name {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\n\t\t\t.chat-name-text {\n\t\t\t\tflex: 1;\n\t\t\t\tfont-size: $im-font-size-large;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\toverflow: hidden;\n\t\t\t\tdisplay: flex;\n\t\t\t\ttext-align: left;\n\t\t\t}\n\n\t\t\t.chat-time {\n\t\t\t\tfont-size: $im-font-size-smaller-extra;\n\t\t\t\tcolor: $im-text-color-lighter;\n\t\t\t\ttext-align: right;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\toverflow: hidden;\n\t\t\t}\n\t\t}\n\n\t\t.chat-content {\n\t\t\tdisplay: flex;\n\t\t\tfont-size: $im-font-size-smaller;\n\t\t\tcolor: $im-text-color-lighter;\n\t\t\tpadding-top: 8rpx;\n\t\t\tflex-direction: row;\n\t\t\t\n\t\t\t.chat-at-text {\n\t\t\t\tcolor: $im-color-danger;\n\t\t\t}\n\n\t\t\t.chat-send-name {\n\t\t\t\tfont-size: $im-font-size-smaller;\n\t\t\t}\n\n\t\t\t.chat-content-text {\n\t\t\t\tflex: 1;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\n\t\t\t}\n\n\t\t}\n\t}\n}\n</style>","import App from './App'\r\nimport request from './common/request';\r\nimport emotion from './common/emotion.js';\r\nimport url from './common/url.js';\r\nimport * as  enums from './common/enums.js';\r\nimport * as date from './common/date';\r\nimport * as socketApi from './common/wssocket';\r\nimport * as messageType from './common/messageType';\r\nimport { createSSRApp } from 'vue'\r\nimport uviewPlus from '@/uni_modules/uview-plus'\r\nimport * as pinia from 'pinia';\r\n\r\n// 引入store\r\nimport useChatStore from './store/chatStore.js';\r\nimport useFriendStore from './store/friendStore.js';\r\nimport useConfigStore from './store/configStore.js';\r\nimport useUserStore from './store/userStore.js';\r\nimport useGroupStore from './store/groupStore.js';\r\n\r\n// 引入环境配置\r\nimport UNI_APP from './env.js';\r\n\r\n// 引入uni-ui组件\r\nimport uniSearchBar from '@/uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.vue'\r\n\r\n// 创建Pinia实例\r\nconst piniaInstance = pinia.createPinia();\r\n\r\n// 导入分包所需的组件\r\nimport barGroup from '/pagesChat/components/bar/bar-group'\r\nimport arrowBar from '/pagesChat/components/bar/arrow-bar'\r\nimport btnBar from '/pagesChat/components/bar/btn-bar'\r\nimport switchBar from '/pagesChat/components/bar/switch-bar'\r\n\r\n// 导入聊天相关组件\r\nimport navBar from '/pagesChat/components/nav-bar/nav-bar'\r\nimport loading from '/pagesChat/components/loading/loading'\r\nimport longPressMenu from '/pagesChat/components/long-press-menu/long-press-menu'\r\nimport chatItem from '/pagesChat/components/chat-item/chat-item'\r\n\r\n// #ifdef H5\r\nimport * as recorder from './common/recorder-h5';\r\nimport ImageResize from \"quill-image-resize-mp\";\r\nimport Quill from \"quill\"; \r\n// 以下组件用于兼容部分手机聊天边框无法输入的问题\r\nwindow.Quill = Quill;  \r\nwindow.ImageResize = { default: ImageResize };  \r\n// 调试器\r\n// import VConsole from 'vconsole'\r\n// new VConsole();\r\n// #endif\r\n// #ifndef H5\r\nimport * as recorder from './common/recorder-app';\r\n// #endif\r\n\r\n// 全局 pinia 实例，以便在组件外部使用\r\nlet _app = null;\r\n\r\n// 添加webrtc配置到UNI_APP（如果不存在）\r\nif (!UNI_APP.WEBRTC) {\r\n  UNI_APP.WEBRTC = {\r\n    ICE_SERVERS: [\r\n      { urls: 'stun:stun.l.google.com:19302' },\r\n      { urls: 'stun:stun1.l.google.com:19302' }\r\n    ],\r\n    MAX_CHANNEL: 6 // 最大通话人数\r\n  };\r\n}\r\n\r\n// 预先创建的Store实例\r\nconst chatStore = useChatStore(piniaInstance);\r\nconst friendStore = useFriendStore(piniaInstance);\r\nconst configStore = useConfigStore(piniaInstance);\r\nconst userStore = useUserStore(piniaInstance);\r\nconst groupStore = useGroupStore(piniaInstance);\r\n\r\n// 重新修复导出的Store获取函数\r\nfunction getChatStore() {\r\n  return chatStore;\r\n}\r\n\r\nfunction getFriendStore() {\r\n  return friendStore;\r\n}\r\n\r\nfunction getConfigStore() {\r\n  return configStore;\r\n}\r\n\r\nfunction getUserStore() {\r\n  return userStore;\r\n}\r\n\r\nfunction getGroupStore() {\r\n  return groupStore;\r\n}\r\n\r\nexport function createApp() {\r\n  const app = createSSRApp(App)\r\n  // 保存 app 实例以便全局访问\r\n  _app = app;\r\n  \r\n  app.use(uviewPlus);\r\n  app.use(piniaInstance);\r\n  \r\n  // 注册导航和表单组件\r\n  app.component('bar-group', barGroup);\r\n  app.component('arrow-bar', arrowBar);\r\n  app.component('btn-bar', btnBar);\r\n  app.component('switch-bar', switchBar);\r\n  \r\n  // 注册聊天相关组件\r\n  app.component('nav-bar', navBar);\r\n  app.component('loading', loading);\r\n  app.component('long-press-menu', longPressMenu);\r\n  app.component('chat-item', chatItem);\r\n  \r\n  // 注册uni-ui组件\r\n  app.component('uni-search-bar', uniSearchBar);\r\n  \r\n  // 重要：将$enums添加为全局属性，确保所有组件都能访问\r\n  app.config.globalProperties.$enums = enums;\r\n  app.config.globalProperties.$http = request;\r\n  app.config.globalProperties.$wsApi = socketApi;\r\n  app.config.globalProperties.$msgType = messageType;\r\n  app.config.globalProperties.$emo = emotion;\r\n  app.config.globalProperties.$url = url;\r\n  app.config.globalProperties.$date = date;\r\n  app.config.globalProperties.$rc = recorder;\r\n  app.config.globalProperties.UNI_APP = UNI_APP;\r\n  \r\n  // 添加store实例到全局属性\r\n  app.config.globalProperties.chatStore = chatStore;\r\n  app.config.globalProperties.friendStore = friendStore;\r\n  app.config.globalProperties.configStore = configStore;\r\n  app.config.globalProperties.userStore = userStore;\r\n  app.config.globalProperties.groupStore = groupStore;\r\n  \r\n  // 添加获取store的方法到全局属性\r\n  app.config.globalProperties.getChatStore = getChatStore;\r\n  app.config.globalProperties.getFriendStore = getFriendStore;\r\n  app.config.globalProperties.getConfigStore = getConfigStore;\r\n  app.config.globalProperties.getUserStore = getUserStore;\r\n  app.config.globalProperties.getGroupStore = getGroupStore;\r\n  \r\n  return {\r\n    app,\r\n    pinia: piniaInstance\r\n  }\r\n}\r\n\r\n// 导出全局方法，让组件可以安全访问 pinia\r\nexport function getApp() {\r\n  return _app;\r\n}\r\n\r\n// 导出 pinia 实例，以便在组件外部使用\r\nexport function getPinia() {\r\n  return piniaInstance;\r\n}\r\n\r\n// 导出所有Store访问方法\r\nexport {\r\n  getChatStore,\r\n  getFriendStore,\r\n  getConfigStore,\r\n  getUserStore,\r\n  getGroupStore\r\n};\r\n\r\n// 导出环境配置，供其他模块使用\r\nexport default UNI_APP;\r\n"],"names":["t","initVueI18n","messages","_sfc_main$3","defineComponent","newVal","oldVal","uni","e","_sfc_main$2","_sfc_main$1","res","touches","style","item","HeadImage","_sfc_main","MESSAGE_TYPE","msgType","timestamp","simple","toTimeText","content","emoUtil","size","lastMsg","msgType.isNormal","piniaInstance","pinia.createPinia","UNI_APP","chatStore","useChatStore","friendStore","useFriendStore","configStore","useConfigStore","userStore","useUserStore","groupStore","useGroupStore","getChatStore","getFriendStore","getConfigStore","getUserStore","getGroupStore"],"mappings":"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"}