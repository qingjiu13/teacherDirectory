{"version":3,"file":"recorder-app.js","sources":["pagesChat/common/recorder-app.js"],"sourcesContent":["import UNI_APP from '/pagesChat/env.js';\n\nconst rc = uni.getRecorderManager();\n// 录音开始时间\nlet startTime = null;\nlet checkIsEnable = ()=>{\n\treturn true;\n}\n\nlet start = () => {\n\treturn new Promise((resolve, reject) => {\n\t\trc.onStart(() => {\n\t\t\tstartTime = new Date();\n\t\t\tresolve()\n\t\t});\n\t\trc.onError((e) => {\n\t\t\tconsole.log(e);\n\t\t\treject(e)\n\t\t})\n\t\trc.start({\n\t\t\tformat: 'mp3' // 录音格式，可选值：aac/mp3\n\t\t});\n\t})\n}\n\nlet close = () => {\n\trc.stop();\n}\n\nlet upload = () => {\n\treturn new Promise((resolve, reject) => {\n\t\trc.onStop((wavFile, a, b) => {\n\t\t\tuni.uploadFile({\n\t\t\t\turl: UNI_APP.BASE_URL + '/file/upload',\n\t\t\t\theader: {\n\t\t\t\t\taccessToken: uni.getStorageSync(\"loginInfo\").accessToken\n\t\t\t\t},\n\t\t\t\tfilePath: wavFile.tempFilePath,\n\t\t\t\tname: 'file',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tlet r = JSON.parse(res.data);\n\t\t\t\t\tif (r.code != 200) {\n\t\t\t\t\t\treject(r.message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst duration = (new Date().getTime() - startTime.getTime()) /\n\t\t\t\t\t\t\t1000\n\t\t\t\t\t\tconst data = {\n\t\t\t\t\t\t\tduration: Math.round(duration),\n\t\t\t\t\t\t\turl: r.data\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfail: (e) => {\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\t})\n}\n\nexport {\n\tcheckIsEnable,\n\tstart,\n\tclose,\n\tupload\n}"],"names":["uni"],"mappings":"4EAEWA,EAAAA,MAAI,mBAAkB"}