{"version":3,"file":"chat-message-item.js","sources":["pagesChat/components/chat-message-item/chat-message-item.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTov56CU5biI5b2V5LiO5YW25LuW5Lq65YWx5Lqr5paH5Lu2L3RlYWNoZXJEaXJlY3RvcnkvdnVl5a6e546wTG90dGll5Yqo55S75Luj56CBL3BhZ2VzQ2hhdC9jb21wb25lbnRzL2NoYXQtbWVzc2FnZS1pdGVtL2NoYXQtbWVzc2FnZS1pdGVtLnZ1ZQ"],"sourcesContent":["<template>\n  <template v-if=\"message.content && message.content.trim() !== ''\">\n    <view class=\"message-wrapper\" :class=\"{ self: isSelfMsg }\">\n      <view class=\"bubble-row\" :class=\"{ self: isSelfMsg }\">\n        <image\n          v-if=\"!isSelfMsg\"\n          class=\"avatar\"\n          :src=\"avatarSrc\"\n          mode=\"aspectFill\"\n        />\n        <view class=\"message-bubble\">\n          <text class=\"message-text\">{{ message.content }}</text>\n        </view>\n        <image\n          v-if=\"isSelfMsg\"\n          class=\"avatar\"\n          :src=\"avatarSrc\"\n          mode=\"aspectFill\"\n        />\n      </view>\n    </view>\n  </template>\n</template>\n\n<script setup lang=\"uts\">\nimport { computed, ref, onMounted, nextTick, watch } from \"vue\";\nconst ADMIN_ID = 1;\n// 默认头像路径\nconst DEFAULT_AVATAR = {\n  ai: \"/static/image/defaultAvatar/kefu.png\",\n  student: \"/static/image/defaultAvatar/student-man.png\",\n  teacher: \"/static/image/defaultAvatar/teacher-man.png\",\n  user: \"/static/image/defaultAvatar/student-man.png\",\n};\nconst props = defineProps({\n  message: { type: Object, required: true },\n  isSelf: { type: Boolean, default: false },\n});\nconst isAssistantMsg = computed(() => {\n  return (\n    props.message.senderId == ADMIN_ID || props.message.senderId === \"admin\"\n  );\n});\nconst avatarSrc = computed(() => {\n  // 小助手消息和欢迎语都用固定头像\n  if (isAssistantMsg.value) return DEFAULT_AVATAR.ai;\n  if (props.message.avatar) return props.message.avatar;\n  if (props.message.role === \"teacher\") return DEFAULT_AVATAR.teacher;\n  return DEFAULT_AVATAR.user;\n});\nconst spacerWidth = ref(48);\nconst nicknameRef = ref(null);\nconst updateSpacer = () => {\n  if (nicknameRef.value && nicknameRef.value.offsetWidth) {\n    spacerWidth.value = 40 + 8 + nicknameRef.value.offsetWidth;\n  } else {\n    spacerWidth.value = 48;\n  }\n};\nonMounted(() => {\n  nextTick(updateSpacer);\n});\nwatch(\n  () => props.message.nickname,\n  () => nextTick(updateSpacer)\n);\nconst isWelcomeMsg = computed(() => {\n  // 判断是否为小助手欢迎语（可根据id或内容）\n  return (\n    props.message.id === \"welcome\" ||\n    (props.message.senderId == ADMIN_ID &&\n      typeof props.message.content === \"string\" &&\n      props.message.content.includes(\"小助手\") &&\n      props.message.content.includes(\"帮\"))\n  );\n});\nconst isSelfMsg = computed(() => {\n  // 欢迎语强制左侧显示，其余按原逻辑\n  if (isWelcomeMsg.value) return false;\n  return props.isSelf;\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.message-wrapper {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  padding: 30rpx;\n  position: relative;\n\n  .avatar {\n    width: 80rpx;\n    height: 80rpx;\n    border-radius: 10rpx;\n    flex-shrink: 0;\n    display: inline-block;\n    vertical-align: top;\n  }\n  .bubble-row {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    justify-content: flex-start;\n    margin-top: 0;\n    width: 100%;\n    position: relative;\n  }\n  .bubble-row.self {\n    flex-direction: row;\n    justify-content: flex-end;\n    align-items: flex-end;\n  }\n  .bubble-spacer {\n    flex-shrink: 0;\n    height: 2rpx;\n  }\n  .message-bubble {\n    position: relative;\n    background: #fff;\n    border-radius: 16rpx;\n    box-shadow: 0 8rpx 16rpx rgba(0, 0, 0, 0.1);\n    padding: 20rpx 24rpx;\n    max-width: 70vw;\n    word-break: break-all;\n    overflow: visible;\n    font-size: 32rpx;\n    line-height: 1.5;\n  }\n  .message-bubble::before {\n    content: \" \";\n    position: absolute;\n    top: 24rpx;\n    left: -16rpx;\n    width: 0;\n    height: 0;\n    border-style: solid;\n    border-width: 12rpx 16rpx 12rpx 0;\n    border-color: transparent #ffffff transparent transparent;\n  }\n}\n.message-wrapper.self {\n  align-items: flex-end;\n  .message-bubble {\n    background: #d0ebff;\n    margin-right: 16rpx;\n    margin-left: 0;\n  }\n  .message-bubble::before {\n    content: \" \";\n    position: absolute;\n    top: 24rpx;\n    right: -16rpx;\n    left: auto;\n    width: 0;\n    height: 0;\n    border-style: solid;\n    border-width: 12rpx 0 12rpx 16rpx;\n    border-color: transparent transparent transparent #d0ebff;\n  }\n}\n</style>\n","import Component from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/pagesChat/components/chat-message-item/chat-message-item.vue'\nwx.createComponent(Component)"],"names":["ADMIN_ID","DEFAULT_AVATAR","props","__props","isAssistantMsg","computed","avatarSrc","spacerWidth","ref","nicknameRef","updateSpacer","onMounted","nextTick","watch","isWelcomeMsg","isSelfMsg","Component"],"mappings":"0DA0BMA,EAAW,4KAEjB,MAAMC,EAAiB,IAAA,cAAA,CACrB,GAAI,uCACJ,QAAS,8CACT,QAAS,8CACT,KAAM,6CACP,CAAA,EACKC,EAAQC,EAIRC,EAAiBC,EAAAA,SAAS,IAE5BH,EAAM,QAAQ,UAAYF,GAAYE,EAAM,QAAQ,WAAa,OAEpE,EACKI,EAAYD,EAAAA,SAAS,IAErBD,EAAe,MAAcH,EAAe,GAC5CC,EAAM,QAAQ,OAAeA,EAAM,QAAQ,OAC3CA,EAAM,QAAQ,OAAS,UAAkBD,EAAe,QACrDA,EAAe,IACvB,EACKM,EAAcC,MAAI,EAAE,EACpBC,EAAcD,MAAI,IAAI,EACtBE,EAAe,IAAA,CACfD,EAAY,OAASA,EAAY,MAAM,YACzCF,EAAY,MAAQ,GAASE,EAAY,MAAM,YAE/CF,EAAY,MAAQ,EAExB,EACAI,EAAAA,UAAU,IAAA,CACRC,EAAQ,WAACF,CAAY,CACvB,CAAC,EACDG,EAAAA,MACE,IAAMX,EAAM,QAAQ,SACpB,IAAMU,EAAQ,WAACF,CAAY,CAAC,EAE9B,MAAMI,EAAeT,EAAAA,SAAS,IAG1BH,EAAM,QAAQ,KAAO,WACpBA,EAAM,QAAQ,UAAYF,GACzB,OAAOE,EAAM,QAAQ,SAAY,UACjCA,EAAM,QAAQ,QAAQ,SAAS,KAAK,GACpCA,EAAM,QAAQ,QAAQ,SAAS,GAAG,CAEvC,EACKa,EAAYV,EAAAA,SAAS,IAErBS,EAAa,MAAc,GACxBZ,EAAM,MACd,+eC/ED,GAAG,gBAAgBc,CAAS"}