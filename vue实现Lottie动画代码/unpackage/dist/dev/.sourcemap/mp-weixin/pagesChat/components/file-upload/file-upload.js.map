{"version":3,"file":"file-upload.js","sources":["pagesChat/components/file-upload/file-upload.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTov56CU5biI5b2V5LiO5YW25LuW5Lq65YWx5Lqr5paH5Lu2L3RlYWNoZXJEaXJlY3RvcnkvdnVl5a6e546wTG90dGll5Yqo55S75Luj56CBL3BhZ2VzQ2hhdC9jb21wb25lbnRzL2ZpbGUtdXBsb2FkL2ZpbGUtdXBsb2FkLnZ1ZQ"],"sourcesContent":["<template>\n\t<view>\n\t\t<lsj-upload ref=\"lsjUpload\" :height=\"'100%'\" :option=\"option\" @uploadEnd=\"onUploadEnd\" @change=\"onChange\"\n\t\t\t:size=\"maxSize\" :instantly=\"true\">\n\t\t\t<slot>\n\t\t\t</slot>\n\t\t</lsj-upload>\n\t</view>\n</template>\n\n<script lang=\"uts\">\nimport UNI_APP from '/pagesChat/env.js';\n\nexport default {\n\tname: \"file-upload\",\n\tdata() {\n\t\treturn {\n\t\t\tfileMap: new Map(),\n\t\t\toption: {\n\t\t\t\turl: UNI_APP.BASE_URL + '/file/upload',\n\t\t\t\tname: 'file',\n\t\t\t\theader: {\n\t\t\t\t\taccessToken: uni.getStorageSync('loginInfo').accessToken\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tprops: {\n\t\tmaxSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 10\n\t\t},\n\t\tonBefore: {\n\t\t\ttype: Function,\n\t\t\tdefault: null\n\t\t},\n\t\tonSuccess: {\n\t\t\ttype: Function,\n\t\t\tdefault: null\n\t\t},\n\t\tonError: {\n\t\t\ttype: Function,\n\t\t\tdefault: null\n\t\t}\n\t},\n\tmethods: {\n\t\tshow() {\n\t\t\tthis.$refs.lsjUpload.show();\n\t\t},\n\t\thide() {\n\t\t\tthis.$refs.lsjUpload.hide();\n\t\t},\n\t\tonUploadEnd(item) {\n\t\t\tlet file = this.fileMap.get(item.path);\n\t\t\tif (item.type == 'fail') {\n\t\t\t\tthis.onError(file)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet res = JSON.parse(item.responseText);\n\t\t\tif (res.code == 200) {\n\t\t\t\t// 上传成功\n\t\t\t\tthis.onOk(file, res);\n\t\t\t} else if (res.code == 401) {\n\t\t\t\t// token已过期，重新获取token\n\t\t\t\tthis.refreshToken().then((res) => {\n\t\t\t\t\tlet newToken = res.data.accessToken;\n\t\t\t\t\tthis.option.header.accessToken = newToken;\n\t\t\t\t\tthis.$refs.lsjUpload.setData(this.option);\n\t\t\t\t\t// 重新上传\n\t\t\t\t\tthis.$refs.lsjUpload.upload(file.name);\n\t\t\t\t}).catch(() => {\n\t\t\t\t\tthis.onError(file, res);\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\t// 上传失败\n\t\t\t\tthis.onError(file, res);\n\t\t\t}\n\t\t},\n\t\tonChange(files) {\n\t\t\tif (!files.size) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfiles.forEach((file, name) => {\n\t\t\t\tif (!this.fileMap.has(file.path)) {\n\t\t\t\t\tthis.onBefore && this.onBefore(file)\n\t\t\t\t\tthis.fileMap.set(file.path, file);\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tonOk(file, res) {\n\t\t\tthis.fileMap.delete(file.path);\n\t\t\tthis.$refs.lsjUpload.clear(file.name);\n\t\t\tthis.onSuccess && this.onSuccess(file, res);\n\t\t},\n\t\tonFailed(file, res) {\n\t\t\tthis.fileMap.delete(file.path);\n\t\t\tthis.$refs.lsjUpload.clear(file.name);\n\t\t\tthis.onError && this.onError(file, res);\n\t\t},\n\t\trefreshToken() {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tlet loginInfo = uni.getStorageSync('loginInfo')\n\t\t\t\tuni.request({\n\t\t\t\t\tmethod: 'PUT',\n\t\t\t\t\turl: UNI_APP.BASE_URL + '/refreshToken',\n\t\t\t\t\theader: {\n\t\t\t\t\t\trefreshToken: loginInfo.refreshToken\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tresolve(res.data);\n\t\t\t\t\t},\n\t\t\t\t\tfail: (res) => {\n\t\t\t\t\t\treject(res);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t}\n\n}\n</script>\n\n<style></style>","import Component from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/pagesChat/components/file-upload/file-upload.vue'\nwx.createComponent(Component)"],"names":["_sfc_main","defineComponent","UNI_APP","uni","item","file","res","newToken","files","name","resolve","reject","loginInfo","Component"],"mappings":"oFAaAA,EAAeC,kBAAA,CACd,KAAM,cACN,MAAI,CACH,MAAO,CACN,QAAS,IAAI,IACb,OAAQ,IAAA,cAAA,CACP,IAAKC,EAAAA,QAAQ,SAAW,eACxB,KAAM,OACN,OAAQ,IAAA,cAAA,CACP,YAAaC,EAAG,MAAC,eAAe,WAAW,EAAE,YAC9C,EACD,EAED,EACD,MAAO,CACN,QAAS,CACR,KAAM,OACN,QAAS,EACT,EACD,SAAU,CACT,KAAM,SACN,QAAS,IACT,EACD,UAAW,CACV,KAAM,SACN,QAAS,IACT,EACD,QAAS,CACR,KAAM,SACN,QAAS,IACV,CACA,EACD,QAAS,CACR,MAAI,CACH,KAAK,MAAM,UAAU,MACrB,EACD,MAAI,CACH,KAAK,MAAM,UAAU,MACrB,EACD,YAAYC,EAAI,KAAA,CACf,IAAIC,EAAO,KAAK,QAAQ,IAAID,EAAK,IAAI,EACrC,GAAIA,EAAK,MAAQ,OAChB,YAAK,QAAQC,CAAI,EACX,KAEP,IAAIC,EAAM,IAAK,KAAA,MAAMF,EAAK,YAAY,EAClCE,EAAI,MAAQ,IAEf,KAAK,KAAKD,EAAMC,CAAG,EACTA,EAAI,MAAQ,IAEtB,KAAK,aAAc,EAAC,KAAK,CAACA,EAAG,OAAA,CAC5B,IAAIC,EAAWD,EAAI,KAAK,YACxB,KAAK,OAAO,OAAO,YAAcC,EACjC,KAAK,MAAM,UAAU,QAAQ,KAAK,MAAM,EAExC,KAAK,MAAM,UAAU,OAAOF,EAAK,IAAI,EACrC,EAAE,MAAM,IAAA,CACR,KAAK,QAAQA,EAAMC,CAAG,CACvB,CAAC,EAGD,KAAK,QAAQD,EAAMC,CAAG,CAEvB,EACD,SAASE,EAAK,KAAA,CACb,GAAI,CAACA,EAAM,KACV,OAAM,KAEPA,EAAM,QAAQ,CAACH,EAAI,KAAEI,EAAI,OAAA,CACnB,KAAK,QAAQ,IAAIJ,EAAK,IAAI,IAC9B,KAAK,UAAY,KAAK,SAASA,CAAI,EACnC,KAAK,QAAQ,IAAIA,EAAK,KAAMA,CAAI,EAElC,CAAC,CACD,EACD,KAAKA,EAAI,KAAEC,EAAG,KAAA,CACb,KAAK,QAAQ,OAAOD,EAAK,IAAI,EAC7B,KAAK,MAAM,UAAU,MAAMA,EAAK,IAAI,EACpC,KAAK,WAAa,KAAK,UAAUA,EAAMC,CAAG,CAC1C,EACD,SAASD,EAAI,KAAEC,EAAG,KAAA,CACjB,KAAK,QAAQ,OAAOD,EAAK,IAAI,EAC7B,KAAK,MAAM,UAAU,MAAMA,EAAK,IAAI,EACpC,KAAK,SAAW,KAAK,QAAQA,EAAMC,CAAG,CACtC,EACD,cAAY,CACX,OAAO,IAAI,QAAQ,CAACI,EAASC,IAAM,CAClC,IAAIC,EAAYT,EAAAA,MAAI,eAAe,WAAW,EAC9CA,EAAAA,MAAI,QAAQ,CACX,OAAQ,MACR,IAAKD,EAAAA,QAAQ,SAAW,gBACxB,OAAQ,IAAA,cAAA,CACP,aAAcU,EAAU,aACxB,EACD,QAAUN,GAAG,CACZI,EAAQJ,EAAI,IAAI,CAChB,EACD,KAAOA,GAAG,CACTK,EAAOL,CAAG,CACX,CACA,CAAA,CACF,CAAC,CACF,CACD,EAED,uXCtHA,GAAG,gBAAgBO,CAAS"}