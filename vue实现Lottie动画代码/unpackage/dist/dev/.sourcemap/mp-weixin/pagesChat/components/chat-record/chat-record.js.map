{"version":3,"file":"chat-record.js","sources":["pagesChat/components/chat-record/chat-record.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTov56CU5biI5b2V5LiO5YW25LuW5Lq65YWx5Lqr5paH5Lu2L3RlYWNoZXJEaXJlY3RvcnkvdnVl5a6e546wTG90dGll5Yqo55S75Luj56CBL3BhZ2VzQ2hhdC9jb21wb25lbnRzL2NoYXQtcmVjb3JkL2NoYXQtcmVjb3JkLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"chat-record\">\n\t\t<view class=\"chat-record-bar\" :class=\"{ recording: recording }\" id=\"chat-record-bar\" @click.stop=\"\"\n\t\t\t@touchstart.prevent=\"onStartRecord\" @touchmove.prevent=\"onTouchMove\" @touchend.prevent=\"onEndRecord\">\n\t\t\t{{ recording ? '正在录音' : '长按 说话' }}</view>\n\t\t<view v-if=\"recording\" class=\"chat-record-window\" :style=\"recordWindowStyle\">\n\t\t\t<view class=\"rc-wave\">\n\t\t\t\t<text class=\"note\" style=\"--d: 0\"></text>\n\t\t\t\t<text class=\"note\" style=\"--d: 1\"></text>\n\t\t\t\t<text class=\"note\" style=\"--d: 2\"></text>\n\t\t\t\t<text class=\"note\" style=\"--d: 3\"></text>\n\t\t\t\t<text class=\"note\" style=\"--d: 4\"></text>\n\t\t\t\t<text class=\"note\" style=\"--d: 5\"></text>\n\t\t\t\t<text class=\"note\" style=\"--d: 6\"></text>\n\t\t\t</view>\n\t\t\t<view class=\"rc-tip\">{{ recordTip }}</view>\n\t\t\t<view class=\"cancel-btn\" @click=\"onCancel\">\n\t\t\t\t<uni-icons :class=\"moveToCancel ? 'red' : 'black'\" type=\"clear\" :size=\"moveToCancel ? 45 : 40\"></uni-icons>\n\t\t\t</view>\n\t\t\t<view class=\"opt-tip\" :class=\"moveToCancel ? 'red' : 'black'\">{{ moveToCancel ? '松手取消' : '松手发送,上划取消' }}</view>\n\t\t</view>\n\n\t</view>\n</template>\n\n<script lang=\"uts\">\nexport default {\n\tname: \"chat-record\",\n\tdata() {\n\t\treturn {\n\t\t\trecording: false,\n\t\t\tmoveToCancel: false,\n\t\t\trecordBarTop: 0,\n\t\t\tdruation: 0,\n\t\t\trcTimer: null\n\t\t}\n\t},\n\tmethods: {\n\t\tonTouchMove(e) {\n\t\t\tconst moveY = e.touches[0].clientY;\n\t\t\tthis.moveToCancel = moveY < this.recordBarTop - 40;\n\t\t},\n\t\tonCancel() {\n\t\t\tif (this.recording) {\n\t\t\t\tthis.moveToCancel = true;\n\t\t\t\tthis.onEndRecord();\n\t\t\t}\n\t\t},\n\t\tonStartRecord() {\n\t\t\t/* 用户第一次使用语音会唤醒录音权限请求，此时会导致@touchend失效，\n\t\t\t\t一直处于录音状态，这里允许用户再次点击发送语音并结束录音 */\n\t\t\tif (this.recording) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tuni.__f__('log','at pagesChat/components/chat-record/chat-record.vue:55',\"开始录音\")\n\t\t\tthis.moveToCancel = false;\n\t\t\tthis.initRecordBar();\n\t\t\tif(!this.$rc.checkIsEnable()){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$rc.start().then(() => {\n\t\t\t\tthis.recording = true;\n\t\t\t\tuni.__f__('log','at pagesChat/components/chat-record/chat-record.vue:63',\"开始录音成功\")\n\t\t\t\t// 开始计时\n\t\t\t\tthis.startTimer();\n\t\t\t}).catch((e) => {\n\t\t\t\tuni.__f__('log','at pagesChat/components/chat-record/chat-record.vue:67',\"录音失败\" + JSON.stringify(e))\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: \"录音失败\",\n\t\t\t\t\ticon: \"none\"\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tonEndRecord() {\n\t\t\tif(!this.recording){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.recording = false;\n\t\t\t// 停止计时\n\t\t\tthis.stopTimer();\n\t\t\t// 停止录音\n\t\t\tthis.$rc.close();\n\t\t\t// 触屏位置是否移动到了取消区域\n\t\t\tif (this.moveToCancel) {\n\t\t\t\tuni.__f__('log','at pagesChat/components/chat-record/chat-record.vue:85',\"录音取消\")\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// 大于1秒才发送\n\t\t\tif (this.druation <= 1) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: \"说话时间太短\",\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$rc.upload().then((data) => {\n\t\t\t\tthis.$emit(\"send\", data);\n\t\t\t}).catch((e) => {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: e,\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\tstartTimer() {\n\t\t\tthis.druation = 0;\n\t\t\tthis.stopTimer();\n\t\t\tthis.rcTimer = setInterval(() => {\n\t\t\t\tthis.druation++;\n\t\t\t\t// 大于60s,直接结束\n\t\t\t\tif (this.druation >= 60) {\n\t\t\t\t\tthis.onEndRecord();\n\t\t\t\t}\n\t\t\t}, 1000)\n\t\t},\n\t\tstopTimer() {\n\t\t\tthis.rcTimer && clearInterval(this.rcTimer);\n\t\t\tthis.rcTimer = null;\n\t\t},\n\t\tinitRecordBar() {\n\t\t\tconst query = uni.createSelectorQuery().in(this);\n\t\t\tquery.select('#chat-record-bar').boundingClientRect((rect) => {\n\t\t\t\t// 顶部高度位置\n\t\t\t\tthis.recordBarTop = rect.top;\n\t\t\t}).exec()\n\t\t}\n\t},\n\tcomputed: {\n\t\trecordWindowStyle() {\n\t\t\tconst windowHeight = uni.getSystemInfoSync().windowHeight;\n\t\t\tconst bottom = windowHeight - this.recordBarTop + 12;\n\t\t\treturn `bottom:${bottom}px;`\n\t\t},\n\t\trecordTip() {\n\t\t\tif (this.druation > 50) {\n\t\t\t\treturn `${60 - this.druation}s后将停止录音`;\n\t\t\t}\n\t\t\treturn `录音时长:${this.druation}s`;\n\t\t}\n\t},\n\tunmounted() {\n\t\tthis.stopTimer();\n\t\tthis.recording = false;\n\t}\n\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.chat-record {\n\t.rc-wave {\n\t\tdisplay: flex;\n\t\talign-items: flex-end;\n\t\tjustify-content: center;\n\t\tposition: relative;\n\t\theight: 80rpx;\n\n\t\t.note {\n\t\t\tbackground: linear-gradient(to top, $im-color-primary-light-1 0%, $im-color-primary-light-6 100%);\n\t\t\twidth: 4px;\n\t\t\theight: 50%;\n\t\t\tborder-radius: 5rpx;\n\t\t\tmargin-right: 4px;\n\t\t\tanimation: loading 0.5s infinite linear;\n\t\t\tanimation-delay: calc(0.1s * var(--d));\n\n\t\t\t@keyframes loading {\n\t\t\t\t0% {\n\t\t\t\t\tbackground-image: linear-gradient(to right, $im-color-primary-light-1 0%, $im-color-primary-light-6 100%);\n\t\t\t\t\theight: 20%;\n\t\t\t\t\tborder-radius: 5rpx;\n\t\t\t\t}\n\n\t\t\t\t50% {\n\t\t\t\t\tbackground-image: linear-gradient(to top, $im-color-primary-light-1 0%, $im-color-primary-light-6 100%);\n\t\t\t\t\theight: 80%;\n\t\t\t\t\tborder-radius: 5rpx;\n\t\t\t\t}\n\n\t\t\t\t100% {\n\t\t\t\t\tbackground-image: linear-gradient(to top, $im-color-primary-light-1 0%, $im-color-primary-light-6 100%);\n\t\t\t\t\theight: 20%;\n\t\t\t\t\tborder-radius: 5rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t.chat-record-bar {\n\t\tpadding: 10rpx;\n\t\tmargin: 10rpx;\n\t\tborder-radius: 10rpx;\n\t\ttext-align: center;\n\t\tbox-shadow: $im-box-shadow;\n\n\t\t&.recording {\n\t\t\tbackground-color: $im-color-primary;\n\t\t\tcolor: #fff;\n\t\t}\n\t}\n\n\t.chat-record-window {\n\t\tposition: fixed;\n\t\tleft: 0;\n\t\tright: 0;\n\t\theight: 360rpx;\n\t\tbackground-color: rgba(255, 255, 255, 0.95);\n\t\tpadding: 30rpx;\n\n\t\t.icon-microphone {\n\t\t\ttext-align: center;\n\t\t\tfont-size: 80rpx;\n\t\t\tpadding: 10rpx;\n\n\t\t}\n\n\t\t.rc-tip {\n\t\t\ttext-align: center;\n\t\t\tfont-size: $im-font-size-small;\n\t\t\tcolor: $im-text-color-light;\n\t\t\tmargin-top: 20rpx;\n\t\t}\n\n\t\t.cancel-btn {\n\t\t\ttext-align: center;\n\t\t\tmargin-top: 40rpx;\n\t\t\theight: 80rpx;\n\n\t\t}\n\n\t\t.opt-tip {\n\t\t\ttext-align: center;\n\t\t\tfont-size: 30rpx;\n\t\t\tpadding: 20rpx;\n\t\t}\n\n\t\t.red {\n\t\t\tcolor: $im-color-danger !important;\n\t\t}\n\n\t}\n}\n</style>","import Component from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/pagesChat/components/chat-record/chat-record.vue'\nwx.createComponent(Component)"],"names":["_sfc_main","defineComponent","e","moveY","uni","data","rect","Component"],"mappings":"0DA0BAA,EAAeC,kBAAA,CACd,KAAM,cACN,MAAI,CACH,MAAO,CACN,UAAW,GACX,aAAc,GACd,aAAc,EACd,SAAU,EACV,QAAS,KAEV,EACD,QAAS,CACR,YAAYC,EAAC,KAAA,CACZ,MAAMC,EAAQD,EAAE,QAAQ,CAAC,EAAE,QAC3B,KAAK,aAAeC,EAAQ,KAAK,aAAe,EAChD,EACD,UAAQ,CACH,KAAK,YACR,KAAK,aAAe,GACpB,KAAK,YAAW,EAEjB,EACD,eAAa,CASZ,GANI,KAAK,YAGTC,EAAAA,MAAI,MAAM,MAAM,yDAAyD,MAAM,EAC/E,KAAK,aAAe,GACpB,KAAK,cAAa,EACf,CAAC,KAAK,IAAI,iBACZ,OAAM,KAEP,KAAK,IAAI,MAAO,EAAC,KAAK,IAAA,CACrB,KAAK,UAAY,GACjBA,EAAAA,MAAI,MAAM,MAAM,yDAAyD,QAAQ,EAEjF,KAAK,WAAU,CACf,CAAA,EAAE,MAAM,CAACF,EAAC,OAAA,CACVE,QAAI,MAAM,MAAM,yDAAyD,OAAS,SAAK,UAAUF,CAAC,CAAC,EACnGE,EAAAA,MAAI,UAAU,CACb,MAAO,OACP,KAAM,MACN,CAAA,CACF,CAAC,CACD,EACD,aAAW,CACV,GAAG,CAAC,KAAK,UACR,OAAM,KAQP,GANA,KAAK,UAAY,GAEjB,KAAK,UAAS,EAEd,KAAK,IAAI,QAEL,KAAK,aACRA,OAAAA,EAAAA,MAAI,MAAM,MAAM,yDAAyD,MAAM,EACzE,KAGP,GAAI,KAAK,UAAY,EACpBA,OAAAA,EAAAA,MAAI,UAAU,CACb,MAAO,SACP,KAAM,MACN,CAAA,EACK,KAEP,KAAK,IAAI,OAAM,EAAG,KAAK,CAACC,EAAI,OAAA,CAC3B,KAAK,MAAM,OAAQA,CAAI,CACvB,CAAA,EAAE,MAAM,CAACH,EAAC,OAAA,CACVE,EAAAA,MAAI,UAAU,CACb,MAAOF,EACP,KAAM,MACN,CAAA,CACF,CAAC,CACD,EACD,YAAU,CACT,KAAK,SAAW,EAChB,KAAK,UAAS,EACd,KAAK,QAAU,YAAY,IAAA,CAC1B,KAAK,WAED,KAAK,UAAY,IACpB,KAAK,YAAW,CAEjB,EAAE,GAAI,CACP,EACD,WAAS,CACR,KAAK,SAAW,cAAc,KAAK,OAAO,EAC1C,KAAK,QAAU,IACf,EACD,eAAa,CACEE,EAAAA,MAAI,oBAAqB,EAAC,GAAG,IAAI,EACzC,OAAO,kBAAkB,EAAE,mBAAmB,CAACE,EAAI,OAAA,CAExD,KAAK,aAAeA,EAAK,GAC1B,CAAC,EAAE,KAAI,CACR,CACA,EACD,SAAU,CACT,mBAAiB,CAGhB,MAAO,UAFcF,EAAAA,MAAI,kBAAiB,EAAG,aACf,KAAK,aAAe,EAC3B,KACvB,EACD,WAAS,CACR,OAAI,KAAK,SAAW,GACZ,GAAG,GAAK,KAAK,QAAQ,UAEtB,QAAQ,KAAK,QAAQ,GAC7B,CACA,EACD,WAAS,CACR,KAAK,UAAS,EACd,KAAK,UAAY,EAClB,EAED,yyBChJA,GAAG,gBAAgBG,CAAS"}