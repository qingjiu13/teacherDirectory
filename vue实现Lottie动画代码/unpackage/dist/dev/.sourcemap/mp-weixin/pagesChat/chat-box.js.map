{"version":3,"file":"chat-box.js","sources":["pagesChat/chat-box.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNDaGF0XGNoYXQtYm94LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"background-image\">\n      <!--\n        @file ./images/background1.png\n        @description 登录页背景图1，分包页面通过相对路径./images/background1.png按需加载\n      -->\n      <image\n        src=\"/static/image/bgPicture/background1.png\"\n        mode=\"aspectFill\" alt=\"背景图\"\n      />\n    </view>\n    <view class=\"background-image\">\n      <!--\n        @file ./images/background.png\n        @description 登录页背景图2，分包页面通过相对路径./images/background.png按需加载\n      -->\n      <image\n        src=\"/static/image/bgPicture/background.png\"\n        mode=\"aspectFill\" alt=\"背景图\"\n      />\n    </view>\n\t<Header :title=\"'对话'\" @back=\"handleBack\"/>\n\t<view class=\"page chat-box\">\n\t\t<view class=\"chat-main-box\" :style=\"{height: chatMainHeight+'px'}\">\n\t\t\t<view class=\"chat-msg\" @click=\"switchChatTabBox('none')\">\n\t\t\t\t<scroll-view class=\"scroll-box\" scroll-y=\"true\" upper-threshold=\"200\" @scrolltoupper=\"onScrollToTop\"\n\t\t\t\t\t:scroll-into-view=\"'chat-item-' + scrollMsgIdx\">\n\t\t\t\t\t<view v-if=\"chat\" v-for=\"(msgInfo, idx) in chat.messages\" :key=\"idx\">\n\t\t\t\t\t\t<ChatMessageItem :ref=\"'message'+msgInfo.id\" v-if=\"idx >= showMinIdx\"\n\t\t\t\t\t\t\t:headImage=\"headImage(msgInfo) || ''\" @call=\"onRtCall(msgInfo)\" :showName=\"showName(msgInfo) || '未知'\"\n\t\t\t\t\t\t\t@recall=\"onRecallMessage\" @delete=\"onDeleteMessage\" @copy=\"onCopyMessage\"\n\t\t\t\t\t\t\t@longPressHead=\"onLongPressHead(msgInfo)\" @download=\"onDownloadFile\"\n\t\t\t\t\t\t\t@audioStateChange=\"onAudioStateChange\" :id=\"'chat-item-' + idx\" :msgInfo=\"msgInfo || {}\"\n\t\t\t\t\t\t\t:groupMembers=\"groupMembers || []\">\n\t\t\t\t\t\t</ChatMessageItem>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</view>\n\t\t\t<view v-if=\"atUserIds.length > 0\" class=\"chat-at-bar\" @click=\"openAtBox()\">\n\t\t\t\t<view class=\"iconfont icon-at\">:&nbsp;</view>\n\t\t\t\t<scroll-view v-if=\"atUserIds.length > 0\" class=\"chat-at-scroll-box\" scroll-x=\"true\" scroll-left=\"120\">\n\t\t\t\t\t<view class=\"chat-at-items\">\n\t\t\t\t\t\t<view v-for=\"m in atUserItems\" class=\"chat-at-item\" :key=\"m.userId\">\n\t\t\t\t\t\t\t<HeadImage :name=\"m.showNickName\" :url=\"m.headImage\" size=\"minier\"></HeadImage>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</view>\n\t\t\t<view class=\"send-bar\" :style=\"{ zIndex: sendBarZIndex }\">\n\t\t\t\t<!-- <view v-if=\"!showRecord\" class=\"iconfont icon-voice-circle\" @click=\"onRecorderInput()\"></view> -->\n\t\t\t\t<!-- <view v-else class=\"iconfont icon-keyboard\" @click=\"onKeyboardInput()\"></view> -->\n\t\t\t\t<ChatRecord v-if=\"showRecord\" class=\"chat-record\" @send=\"onSendRecord\"></ChatRecord>\n\t\t\t\t<view v-else class=\"send-container\">\n\t\t\t\t\t<view class=\"send-text\">\n\t\t\t\t\t\t<textarea id=\"textInput\" class=\"send-text-area\" :placeholder=\"isReceipt ? '[回执消息]' : ''\"\n\t\t\t\t\t\t\t:disabled=\"isReadOnly\" @focus=\"onTextareaFocus\" @blur=\"onTextareaBlur\" \n\t\t\t\t\t\t\t@input=\"onTextareaInput\" confirm-type=\"send\" return-key-type=\"send\" \n\t\t\t\t\t\t\t@confirm=\"sendTextMessage\" :adjust-position=\"true\" v-model=\"textContent\"\n\t\t\t\t\t\t\t:hold-keyboard=\"false\" :auto-height=\"true\" :show-confirm-bar=\"true\">\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"send-actions\">\n\t\t\t\t\t\t<view v-if=\"chat && chat.type == 'GROUP'\" class=\"iconfont icon-at\" @click=\"openAtBox()\"></view>\n\t\t\t\t\t\t<!-- <view class=\"iconfont icon-icon_emoji\" @click=\"onShowEmoChatTab()\">\n\t\t\t\t\t\t\t<image class=\"icon\" src=\"/pagesChat/static/icon_side/AI.png\" mode=\"aspectFill\" lazy-load=\"true\"></image>\n\t\t\t\t\t\t</view> -->\n\t\t\t\t\t\t<view v-if=\"isEmpty\" class=\"iconfont icon-add\" @click=\"onShowToolsChatTab()\">\n\t\t\t\t\t\t\t<image class=\"icon\" src=\"/pagesChat/static/icon_side/AI.png\" mode=\"aspectFill\" lazy-load=\"true\"></image>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"chat-tab-bar\">\n\t\t\t<view v-if=\"chatTabBox == 'tools'\" class=\"chat-tools\" :style=\"{height: keyboardHeight+'px'}\">\n\t\t\t\t<view class=\"chat-tools-item\">\n\t\t\t\t\t<FileUpload ref=\"fileUpload\" :onBefore=\"onUploadFileBefore\" :onSuccess=\"onUploadFileSuccess\"\n\t\t\t\t\t\t:onError=\"onUploadFileFail\">\n\t\t\t\t\t\t<view class=\"tool-icon\">\n\t\t\t\t\t\t\t<image class=\"icon\" src=\"/pagesChat/static/icon_side/AI.png\" mode=\"aspectFill\" lazy-load=\"true\"></image>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</FileUpload>\n\t\t\t\t\t<view class=\"tool-name\">文件</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"chat-tools-item\">\n\t\t\t\t\t<ImageUpload :maxCount=\"9\" sourceType=\"album\" :onBefore=\"onUploadImageBefore\"\n\t\t\t\t\t\t:onSuccess=\"onUploadImageSuccess\" :onError=\"onUploadImageFail\">\n\t\t\t\t\t\t<view class=\"tool-icon\">\n\t\t\t\t\t\t\t<image class=\"icon\" src=\"/pagesChat/static/icon_side/AI.png\" mode=\"aspectFill\" lazy-load=\"true\"></image>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</ImageUpload>\n\t\t\t\t\t<view class=\"tool-name\">相册</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"chat-tools-item\">\n\t\t\t\t\t<ImageUpload sourceType=\"camera\" :onBefore=\"onUploadImageBefore\" :onSuccess=\"onUploadImageSuccess\"\n\t\t\t\t\t\t:onError=\"onUploadImageFail\">\n\t\t\t\t\t\t<view class=\"tool-icon\">\n\t\t\t\t\t\t\t<image class=\"icon\" src=\"/pagesChat/static/icon_side/AI.png\" mode=\"aspectFill\" lazy-load=\"true\"></image>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</ImageUpload>\n\t\t\t\t\t<view class=\"tool-name\">拍摄</view>\n\t\t\t\t</view>\n\t\t\t\t<!-- <view class=\"chat-tools-item\" @click=\"onRecorderInput()\">\n\t\t\t\t\t<view class=\"tool-icon iconfont icon-microphone\"></view>\n\t\t\t\t\t<view class=\"tool-name\">语音消息</view>\n\t\t\t\t</view> -->\n\t\t\t\t<view v-if=\"chat.type == 'GROUP' && memberSize<=500\" class=\"chat-tools-item\" @click=\"switchReceipt()\">\n\t\t\t\t\t<view class=\"tool-icon iconfont icon-receipt\" :class=\"isReceipt ? 'active' : ''\"></view>\n\t\t\t\t\t<view class=\"tool-name\">回执消息</view>\n\t\t\t\t</view>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t\t</view>\n\t\t<scroll-view\n\t\t\tv-if=\"chatTabBox === 'emo'\"\n\t\t\tclass=\"chat-emotion\"\n\t\t\tscroll-y=\"true\"\n\t\t\t:style=\"{ height: keyboardHeight + 'px' }\"\n\t\t\t>\n\t\t\t<view class=\"emotion-item-list\">\n\t\t\t\t<image\n\t\t\t\tclass=\"emotion-item emoji-large\"\n\t\t\t\tv-for=\"(emoText, i) in $emo.emoTextList\"\n\t\t\t\t:key=\"i\"\n\t\t\t\t:title=\"emoText\"\n\t\t\t\t:src=\"$emo.textToPath(emoText)\"\n\t\t\t\t@click=\"selectEmoji(emoText)\"\n\t\t\t\tmode=\"aspectFill\"\n\t\t\t\tlazy-load=\"true\"\n\t\t\t\t></image>\n\t\t\t</view>\n\t\t</scroll-view>\n\n\t\t</view>\n\t\t<!-- @用户时选择成员 -->\n\t\t<ChatAtBox ref=\"atBox\" :ownerId=\"group.ownerId\" :members=\"groupMembers\"\n\t\t\t@complete=\"onAtComplete\"></ChatAtBox>\n\t\t<!-- 群语音通话时选择成员 -->\n\n\n\n\n\n\t</view>\n</template>\n\n<script lang=\"uts\">\nimport UNI_APP from './env.js';\n// 引入模拟数据和服务\nimport Header from '@/components/navigationTitleBar/header';\nimport mockChatService from './common/mockChatService.js';\nimport { getMockUserById, getMockGroupById, getMockCurrentUser, mockChats } from './common/mockData.js';\nimport ChatMessageItem from './components/chat-message-item/chat-message-item';\nimport ChatRecord from './components/chat-record/chat-record';\nimport FileUpload from './components/file-upload/file-upload';\nimport ImageUpload from './components/image-upload/image-upload';\nimport HeadImage from './components/head-image/head-image';\nimport ChatAtBox from './components/chat-at-box/chat-at-box';\nimport GroupMemberSelector from './components/group-member-selector/group-member-selector';\nimport GroupRtcJoin from './components/group-rtc-join/group-rtc-join';\nimport ChatItem from './components/chat-item/chat-item';\nimport Loading from './components/loading/loading';\nimport LongPressMenu from './components/long-press-menu/long-press-menu';\n// 导入enums等工具\nimport * as enums from './common/enums.js';\nimport * as messageType from './common/messageType.js';\nimport emotion from './common/emotion.js';\nimport url from './common/url.js';\n// 直接引入store获取函数\nimport { getChatStore, getFriendStore, getConfigStore, getUserStore, getGroupStore } from './main.js';\n\nexport default {\n\tcomponents: {\n\t\tHeader,\n\t\tChatMessageItem,\n\t\tChatRecord,\n\t\tFileUpload,\n\t\tImageUpload,\n\t\tChatAtBox,\n\t\tHeadImage,\n\t\tGroupMemberSelector,\n\t\tGroupRtcJoin,\n\t\tChatItem,\n\t\tLoading,\n\t\tLongPressMenu\n\t},\n\tdata() {\n\t\treturn {\n\t\t\ttextContent: '',\n\t\t\tchat: {},\n\t\t\tuserInfo: {},\n\t\t\tgroup: {},\n\t\t\tgroupMembers: [],\n\t\t\tisReceipt: false, // 是否回执消息\n\t\t\tscrollMsgIdx: 0, // 滚动条定位为到哪条消息\n\t\t\tchatTabBox: 'none',\n\t\t\tshowRecord: false,\n\t\t\tchatMainHeight: 0, // 聊天窗口高度\n\t\t\tkeyboardHeight: 290, // 键盘高度\n\t\t\twindowHeight: 1000, // 窗口高度\n\t\t\tinitHeight: 1000, // h5初始高度\n\t\t\tatUserIds: [],\n\t\t\tneedScrollToBottom: false, // 需要滚动到底部 \n\t\t\tshowMinIdx: 0, // 下标小于showMinIdx的消息不显示，否则可能很卡\n\t\t\treqQueue: [], // 请求队列\n\t\t\tisSending: false, // 是否正在发送请求\n\t\t\tisShowKeyBoard: false, // 键盘是否正在弹起 \n\t\t\tisEmpty: true, // 输入框是否为空\n\t\t\tisFocus: false, // 输入框是否焦点\n\t\t\tisReadOnly: false, // 输入框是否只读\n\t\t\tplayingAudio: null, // 当前正在播放的录音消息\n\t\t\t// 是否使用模拟数据\n\t\t\tuseMockData: true,\n\t\t\t// 模拟用户数据\n\t\t\tmockCurrentUser: null,\n\t\t\t// 存储引用\n\t\t\tchatStore: null,\n\t\t\tfriendStore: null,\n\t\t\tconfigStore: null,\n\t\t\tuserStore: null,\n\t\t\tgroupStore: null,\n\t\t\t// 输入框层级\n\t\t\tsendBarZIndex: 2, // 默认z-index值\n\t\t}\n\t},\n\tcreated() {\n\t\t// 确保组件中可以使用这些全局属性\n\t\tif (!this.$enums) this.$enums = enums;\n\t\tif (!this.$msgType) this.$msgType = messageType;\n\t\tif (!this.$emo) this.$emo = emotion;\n\t\tif (!this.$url) this.$url = url;\n\t\t\n\t\t// 初始化store引用\n\t\ttry {\n\t\t\t// 优先从直接导入的函数获取\n\t\t\tthis.chatStore = getChatStore();\n\t\t\tthis.friendStore = getFriendStore();\n\t\t\tthis.configStore = getConfigStore();\n\t\t\tthis.userStore = getUserStore();\n\t\t\tthis.groupStore = getGroupStore();\n\t\t\t\n\t\t\t// 如果导出的函数无法获取，尝试从全局属性获取\n\t\t\tif (!this.chatStore && this.$) {\n\t\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:257','chat-box.vue: 尝试从全局属性获取Store');\n\t\t\t\tthis.chatStore = this.$chatStore;\n\t\t\t\tthis.friendStore = this.$friendStore;\n\t\t\t\tthis.configStore = this.$configStore;\n\t\t\t\tthis.userStore = this.$userStore;\n\t\t\t\tthis.groupStore = this.$groupStore;\n\t\t\t}\n\t\t\t\n\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:265','chat-box.vue: 获取Store成功:', \n\t\t\t\t'chatStore=', !!this.chatStore, \n\t\t\t\t'friendStore=', !!this.friendStore\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:270','chat-box.vue: 获取Store失败:', error);\n\t\t}\n\t\t\n\t\t// 初始化当前用户\n\t\tthis.mockCurrentUser = getMockCurrentUser();\n\t\t\n\t\t// 添加数据检查，确保模拟数据已初始化\n\t\tif (this.useMockData && (!this.chatStore || !this.chatStore.chats || this.chatStore.chats.length === 0)) {\n\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:278','chat-box.vue: 强制初始化模拟数据');\n\t\t\tthis.initMockData();\n\t\t}\n\t},\n\tmethods: {\n\t\thandleBack() {\n\t\t\tuni.navigateBack();\n\t\t},\n\t\tonRecorderInput() {\n\t\t\tthis.showRecord = true;\n\t\t\tthis.switchChatTabBox('none');\n\t\t},\n\t\tonKeyboardInput() {\n\t\t\tthis.showRecord = false;\n\t\t\tthis.switchChatTabBox('none');\n\t\t},\n\t\tonSendRecord(data) {\n\t\t\t// 检查是否被封禁\n\t\t\tif (this.isBanned) {\n\t\t\t\tthis.showBannedTip();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet msgInfo = {\n\t\t\t\tcontent: JSON.stringify(data),\n\t\t\t\ttype: this.$enums.MESSAGE_TYPE.AUDIO,\n\t\t\t\treceipt: this.isReceipt\n\t\t\t}\n\t\t\t// 填充对方id\n\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\tthis.sendMessageRequest(msgInfo).then((m) => {\n\t\t\t\tm.selfSend = true;\n\t\t\t\tthis.chatStore.insertMessage(m, this.chat);\n\t\t\t\t// 会话置顶\n\t\t\t\tthis.moveChatToTop();\n\t\t\t\t// 滚动到底部\n\t\t\t\tthis.scrollToBottom();\n\t\t\t\tthis.isReceipt = false;\n\n\t\t\t})\n\t\t},\n\t\tonRtCall(msgInfo) {\n\t\t\tif (msgInfo.type == this.$enums.MESSAGE_TYPE.ACT_RT_VOICE) {\n\t\t\t\tthis.onPriviteVoice();\n\t\t\t} else if (msgInfo.type == this.$enums.MESSAGE_TYPE.ACT_RT_VIDEO) {\n\t\t\t\tthis.onPriviteVideo();\n\t\t\t}\n\t\t},\n\t\tonPriviteVideo() {\n\t\t\tconst friendInfo = encodeURIComponent(JSON.stringify(this.friend));\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/chat/chat-private-video?mode=video&friend=${friendInfo}&isHost=true`\n\t\t\t})\n\t\t},\n\t\tonPriviteVoice() {\n\t\t\tconst friendInfo = encodeURIComponent(JSON.stringify(this.friend));\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/chat/chat-private-video?mode=voice&friend=${friendInfo}&isHost=true`\n\t\t\t})\n\t\t},\n\t\tonGroupVideo() {\n\t\t\t// 邀请成员发起通话\n\t\t\tlet ids = [this.mine.id];\n\t\t\tthis.$refs.selBox.init(ids, ids, []);\n\t\t\tthis.$refs.selBox.open();\n\t\t},\n\t\tonInviteOk(ids) {\n\t\t\tif (ids.length < 2) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet users = [];\n\t\t\tids.forEach(id => {\n\t\t\t\tlet m = this.groupMembers.find(m => m.userId == id);\n\t\t\t\t// 只取部分字段,压缩url长度\n\t\t\t\tusers.push({\n\t\t\t\t\tid: m.userId,\n\t\t\t\t\tnickName: m.showNickName,\n\t\t\t\t\theadImage: m.headImage,\n\t\t\t\t\tisCamera: false,\n\t\t\t\t\tisMicroPhone: true\n\t\t\t\t})\n\t\t\t})\n\t\t\tconst groupId = this.group.id;\n\t\t\tconst inviterId = this.mine.id;\n\t\t\tconst userInfos = encodeURIComponent(JSON.stringify(users));\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/chat/chat-group-video?groupId=${groupId}&isHost=true\n\t\t\t\t\t\t&inviterId=${inviterId}&userInfos=${userInfos}`\n\t\t\t})\n\t\t},\n\t\tmoveChatToTop() {\n\t\t\tlet chatIdx = this.chatStore.findChatIdx(this.chat);\n\t\t\tthis.chatStore.moveTop(chatIdx);\n\t\t},\n\t\tswitchReceipt() {\n\t\t\tthis.isReceipt = !this.isReceipt;\n\t\t},\n\t\topenAtBox() {\n\t\t\tthis.$refs.atBox.init(this.atUserIds);\n\t\t\tthis.$refs.atBox.open();\n\t\t},\n\t\tonAtComplete(atUserIds) {\n\t\t\tthis.atUserIds = atUserIds;\n\t\t},\n\t\tonLongPressHead(msgInfo) {\n\t\t\tif (!msgInfo.selfSend && this.chat.type == \"GROUP\" && this.atUserIds.indexOf(msgInfo.sendId) < 0) {\n\t\t\t\tthis.atUserIds.push(msgInfo.sendId);\n\t\t\t}\n\t\t},\n\t\theadImage(msgInfo) {\n\t\t\tif (!msgInfo) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t\n\t\t\ttry {\n\t\t\t\tif (this.chat && this.chat.type == 'GROUP') {\n\t\t\t\t\tlet member = this.groupMembers.find((m) => m && m.userId == msgInfo.sendId);\n\t\t\t\t\treturn member ? member.headImage : \"\";\n\t\t\t\t} else {\n\t\t\t\t\treturn msgInfo.selfSend ? (this.mine && this.mine.headImageThumb ? this.mine.headImageThumb : '') : \n\t\t\t\t\t\t(this.chat && this.chat.headImage ? this.chat.headImage : '');\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:400','获取头像出错:', error);\n\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tshowName(msgInfo) {\n\t\t\tif (!msgInfo) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t\n\t\t\ttry {\n\t\t\t\tif (this.chat && this.chat.type == 'GROUP') {\n\t\t\t\t\tlet member = this.groupMembers.find((m) => m && m.userId == msgInfo.sendId);\n\t\t\t\t\treturn member ? member.showNickName : \"\";\n\t\t\t\t} else {\n\t\t\t\t\treturn msgInfo.selfSend ? (this.mine && this.mine.nickName ? this.mine.nickName : '') : \n\t\t\t\t\t\t(this.chat && this.chat.showName ? this.chat.showName : '');\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:418','获取名称出错:', error);\n\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\tsendTextMessage() {\n\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:423','键盘发送按钮被点击');\n\t\t\t\n\t\t\t// 检查是否被封禁\n\t\t\tif (this.isBanned) {\n\t\t\t\tthis.showBannedTip();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tlet sendText = this.textContent || '';\n\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:432','发送文本内容:', sendText);\n\t\t\t\n\t\t\tif (!sendText.trim() && this.atUserIds.length == 0) {\n\t\t\t\treturn uni.showToast({\n\t\t\t\t\ttitle: \"不能发送空白信息\",\n\t\t\t\t\ticon: \"none\"\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tlet receiptText = this.isReceipt ? \"【回执消息】\" : \"\";\n\t\t\tlet atText = this.createAtText();\n\t\t\t\n\t\t\t// 清空输入框（在验证通过后）\n\t\t\tthis.textContent = '';\n\t\t\tthis.isEmpty = true;\n\t\t\t\n\t\t\tif (this.useMockData) {\n\t\t\t\t// 使用模拟数据\n\t\t\t\tconst message = {\n\t\t\t\t\ttmpId: 'tmp_' + Date.now(),\n\t\t\t\t\ttype: this.$enums.MESSAGE_TYPE.TEXT,\n\t\t\t\t\tcontent: receiptText + this.html2Escape(sendText) + atText,\n\t\t\t\t\tstatus: this.$enums.MESSAGE_STATUS.UNSEND\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tmockChatService.sendMessage(message, {\n\t\t\t\t\ttype: this.chat.type,\n\t\t\t\t\ttargetId: this.chat.targetId\n\t\t\t\t}).then(() => {\n\t\t\t\t\t// 滚动到底部\n\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// 清空@成员和回执标记\n\t\t\t\tthis.atUserIds = [];\n\t\t\t\tthis.isReceipt = false;\n\t\t\t} else {\n\t\t\t\t// 使用原接口\n\t\t\t\tlet msgInfo = {\n\t\t\t\t\tcontent: receiptText + this.html2Escape(sendText) + atText,\n\t\t\t\t\tatUserIds: this.atUserIds,\n\t\t\t\t\treceipt: this.isReceipt,\n\t\t\t\t\ttype: 0\n\t\t\t\t}\n\t\t\t\t// 清空@成员和回执标记\n\t\t\t\tthis.atUserIds = [];\n\t\t\t\tthis.isReceipt = false;\n\t\t\t\t// 填充对方id\n\t\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\t\tthis.sendMessageRequest(msgInfo).then((m) => {\n\t\t\t\t\tm.selfSend = true;\n\t\t\t\t\tthis.chatStore.insertMessage(m, this.chat);\n\t\t\t\t\t// 会话置顶\n\t\t\t\t\tthis.moveChatToTop();\n\t\t\t\t}).finally(() => {\n\t\t\t\t\t// 滚动到底部\n\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcreateAtText() {\n\t\t\tlet atText = \"\";\n\t\t\tthis.atUserIds.forEach((id) => {\n\t\t\t\tif (id == -1) {\n\t\t\t\t\tatText += ` @全体成员`;\n\t\t\t\t} else {\n\t\t\t\t\tlet member = this.groupMembers.find((m) => m.userId == id);\n\t\t\t\t\tif (member) {\n\t\t\t\t\t\tatText += ` @${member.showNickName}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\treturn atText;\n\t\t},\n\t\tfillTargetId(msgInfo, targetId) {\n\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\tmsgInfo.groupId = targetId;\n\t\t\t} else {\n\t\t\t\tmsgInfo.recvId = targetId;\n\t\t\t}\n\t\t},\n\t\tscrollToBottom() {\n\t\t\tlet size = this.messageSize;\n\t\t\tif (size > 0) {\n\t\t\t\tthis.scrollToMsgIdx(size - 1);\n\t\t\t}\n\t\t},\n\t\tscrollToMsgIdx(idx) {\n\t\t\t// 如果scrollMsgIdx值没变化，滚动条不会移动\n\t\t\tif (idx == this.scrollMsgIdx && idx > 0) {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t// 先滚动到上一条\n\t\t\t\t\tthis.scrollMsgIdx = idx - 1;\n\t\t\t\t\t// 再滚动目标位置\n\t\t\t\t\tthis.scrollToMsgIdx(idx);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.scrollMsgIdx = idx;\n\t\t\t});\n\t\t},\n\t\tonShowEmoChatTab() {\n\t\t\tthis.showRecord = false;\n\t\t\t// 简单关闭表情栏时的键盘\n\t\t\tuni.hideKeyboard();\n\t\t\t// 直接切换到表情栏，不进行复杂的键盘监听操作\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.switchChatTabBox('emo');\n\t\t\t}, 100);\n\t\t},\n\t\tonShowToolsChatTab() {\n\t\t\tthis.showRecord = false;\n\t\t\t// 简单关闭工具栏时的键盘\n\t\t\tuni.hideKeyboard();\n\t\t\t// 直接切换到工具栏，不进行复杂的键盘监听操作\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.switchChatTabBox('tools');\n\t\t\t}, 100);\n\t\t},\n\t\tswitchChatTabBox(chatTabBox) {\n\t\t\tthis.chatTabBox = chatTabBox;\n\t\t\tthis.reCalChatMainHeight();\n\t\t\t\n\t\t\t// 移除键盘监听的重新启用，让系统原生处理\n\t\t\tif (chatTabBox != 'tools' && this.$refs.fileUpload) {\n\t\t\t\tthis.$refs.fileUpload.hide()\n\t\t\t}\n\t\t},\n\t\tselectEmoji(emoText) {\n\t\t\t// 直接在文本内容中插入表情文字\n\t\t\tthis.textContent = (this.textContent || '') + emoText;\n\t\t\tthis.isEmpty = false;\n\t\t},\n\t\tonUploadImageBefore(file) {\n\t\t\t// 检查是否被封禁\n\t\t\tif (this.isBanned) {\n\t\t\t\tthis.showBannedTip();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet data = {\n\t\t\t\toriginUrl: file.path,\n\t\t\t\tthumbUrl: file.path\n\t\t\t}\n\t\t\tlet msgInfo = {\n\t\t\t\tid: 0,\n\t\t\t\ttmpId: this.generateId(),\n\t\t\t\tfileId: file.uid,\n\t\t\t\tsendId: this.mine.id,\n\t\t\t\tcontent: JSON.stringify(data),\n\t\t\t\tsendTime: new Date().getTime(),\n\t\t\t\tselfSend: true,\n\t\t\t\ttype: this.$enums.MESSAGE_TYPE.IMAGE,\n\t\t\t\treadedCount: 0,\n\t\t\t\tloadStatus: \"loading\",\n\t\t\t\tstatus: this.$enums.MESSAGE_STATUS.UNSEND\n\t\t\t}\n\t\t\t// 填充对方id\n\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\t// 插入消息\n\t\t\tthis.chatStore.insertMessage(msgInfo, this.chat);\n\t\t\t// 会话置顶\n\t\t\tthis.moveChatToTop();\n\t\t\t// 借助file对象保存\n\t\t\tfile.msgInfo = msgInfo;\n\t\t\tfile.chat = this.chat;\n\t\t\t// 滚到最低部\n\t\t\tthis.scrollToBottom();\n\t\t\treturn true;\n\t\t},\n\t\tonUploadImageSuccess(file, res) {\n\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\tmsgInfo.content = JSON.stringify(res.data);\n\t\t\tmsgInfo.receipt = this.isReceipt\n\t\t\tthis.sendMessageRequest(msgInfo).then((m) => {\n\t\t\t\tmsgInfo.loadStatus = 'ok';\n\t\t\t\tmsgInfo.id = m.id;\n\t\t\t\tthis.isReceipt = false;\n\t\t\t\tthis.chatStore.insertMessage(msgInfo, file.chat);\n\t\t\t})\n\t\t},\n\t\tonUploadImageFail(file, err) {\n\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\tmsgInfo.loadStatus = 'fail';\n\t\t\tthis.chatStore.insertMessage(msgInfo, file.chat);\n\t\t},\n\t\tonUploadFileBefore(file) {\n\t\t\t// 检查是否被封禁\n\t\t\tif (this.isBanned) {\n\t\t\t\tthis.showBannedTip();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet data = {\n\t\t\t\tname: file.name,\n\t\t\t\tsize: file.size,\n\t\t\t\turl: file.path\n\t\t\t}\n\t\t\tlet msgInfo = {\n\t\t\t\tid: 0,\n\t\t\t\ttmpId: this.generateId(),\n\t\t\t\tsendId: this.mine.id,\n\t\t\t\tcontent: JSON.stringify(data),\n\t\t\t\tsendTime: new Date().getTime(),\n\t\t\t\tselfSend: true,\n\t\t\t\ttype: this.$enums.MESSAGE_TYPE.FILE,\n\t\t\t\treadedCount: 0,\n\t\t\t\tloadStatus: \"loading\",\n\t\t\t\tstatus: this.$enums.MESSAGE_STATUS.UNSEND\n\t\t\t}\n\t\t\t// 填充对方id\n\t\t\tthis.fillTargetId(msgInfo, this.chat.targetId);\n\t\t\t// 插入消息\n\t\t\tthis.chatStore.insertMessage(msgInfo, this.chat);\n\t\t\t// 会话置顶\n\t\t\tthis.moveChatToTop();\n\t\t\t// 借助file对象保存\n\t\t\tfile.msgInfo = msgInfo;\n\t\t\tfile.chat = this.chat;\n\t\t\t// 滚到最低部\n\t\t\tthis.scrollToBottom();\n\t\t\treturn true;\n\t\t},\n\t\tonUploadFileSuccess(file, res) {\n\t\t\tlet data = {\n\t\t\t\tname: file.name,\n\t\t\t\tsize: file.size,\n\t\t\t\turl: res.data\n\t\t\t}\n\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\tmsgInfo.content = JSON.stringify(data);\n\t\t\tmsgInfo.receipt = this.isReceipt\n\t\t\tthis.sendMessageRequest(msgInfo).then((m) => {\n\t\t\t\tmsgInfo.loadStatus = 'ok';\n\t\t\t\tmsgInfo.id = m.id;\n\t\t\t\tthis.isReceipt = false;\n\t\t\t\tthis.chatStore.insertMessage(msgInfo, file.chat);\n\t\t\t})\n\t\t},\n\t\tonUploadFileFail(file, res) {\n\t\t\tlet msgInfo = JSON.parse(JSON.stringify(file.msgInfo));\n\t\t\tmsgInfo.loadStatus = 'fail';\n\t\t\tthis.chatStore.insertMessage(msgInfo, file.chat);\n\t\t},\n\t\tonDeleteMessage(msgInfo) {\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '删除消息',\n\t\t\t\tcontent: '确认删除消息?',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tif (!res.cancel) {\n\t\t\t\t\t\tif (this.useMockData) {\n\t\t\t\t\t\t\t// 使用模拟数据\n\t\t\t\t\t\t\tmockChatService.deleteMessage(msgInfo, {\n\t\t\t\t\t\t\t\ttype: this.chat.type,\n\t\t\t\t\t\t\t\ttargetId: this.chat.targetId\n\t\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: \"删除成功\",\n\t\t\t\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// 使用原接口\n\t\t\t\t\t\t\tthis.chatStore.deleteMessage(msgInfo, this.chat);\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: \"删除成功\",\n\t\t\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tonRecallMessage(msgInfo) {\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '撤回消息',\n\t\t\t\tcontent: '确认撤回消息?',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tif (!res.cancel) {\n\t\t\t\t\t\tif (this.useMockData) {\n\t\t\t\t\t\t\t// 使用模拟数据\n\t\t\t\t\t\t\tmockChatService.recallMessage(msgInfo, {\n\t\t\t\t\t\t\t\ttype: this.chat.type,\n\t\t\t\t\t\t\t\ttargetId: this.chat.targetId\n\t\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: '撤回成功',\n\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// 使用原接口\n\t\t\t\t\t\t\tlet url = `/message/${this.chat.type.toLowerCase()}/recall/${msgInfo.id}`\n\t\t\t\t\t\t\tthis.$http({\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tmethod: 'DELETE'\n\t\t\t\t\t\t\t}).then((m) => {\n\t\t\t\t\t\t\t\tm.selfSend = true;\n\t\t\t\t\t\t\t\tthis.chatStore.recallMessage(m, this.chat);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tonCopyMessage(msgInfo) {\n\t\t\tuni.setClipboardData({\n\t\t\t\tdata: msgInfo.content,\n\t\t\t\tsuccess: () => {\n\t\t\t\t\tuni.showToast({ title: '复制成功' });\n\t\t\t\t},\n\t\t\t\tfail: () => {\n\t\t\t\t\tuni.showToast({ title: '复制失败', icon: 'none' });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonDownloadFile(msgInfo) {\n\t\t\tlet url = JSON.parse(msgInfo.content).url;\n\t\t\tuni.downloadFile({\n\t\t\t\turl: url,\n\t\t\t\tsuccess(res) {\n\t\t\t\t\tif (res.statusCode === 200) {\n\t\t\t\t\t\tvar filePath = encodeURI(res.tempFilePath);\n\t\t\t\t\t\tuni.openDocument({\n\t\t\t\t\t\t\tfilePath: filePath,\n\t\t\t\t\t\t\tshowMenu: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfail(e) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: \"文件下载失败\",\n\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonScrollToTop() {\n\t\t\tif (this.showMinIdx == 0) {\n\t\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:770',\"消息已滚动到顶部\")\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 防止滚动条定格在顶部，不能一直往上滚\n\t\t\tthis.scrollToMsgIdx(this.showMinIdx);\n\n\t\t\t// 多展示20条信息\n\t\t\tthis.showMinIdx = this.showMinIdx > 20 ? this.showMinIdx - 20 : 0;\n\t\t},\n\t\tonShowMore() {\n\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: \"/pages/group/group-info?id=\" + this.group.id\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: \"/pages/common/user-info?id=\" + this.userInfo.id\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tonTextareaFocus(e) {\n\t\t\ttry {\n\t\t\t\tthis.isFocus = true;\n\t\t\t\t\n\t\t\t\t// 如果有展开项，先收起再重新获得焦点\n\t\t\t\tif (this.chatTabBox !== 'none') {\n\t\t\t\t\t// 先让输入框失去焦点，阻止键盘立刻弹起\n\t\t\t\t\tuni.hideKeyboard();\n\t\t\t\t\t\n\t\t\t\t\t// 收起所有展开项\n\t\t\t\t\tthis.switchChatTabBox('none');\n\t\t\t\t\t\n\t\t\t\t\t// 延迟后重新让输入框获得焦点\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t// 重新获得焦点\n\t\t\t\t\t\tconst query = uni.createSelectorQuery().in(this);\n\t\t\t\t\t\tquery.select('#textInput').focus();\n\t\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\t\tthis.reCalChatMainHeight();\n\t\t\t\t\t}, 200);\n\t\t\t\t} else {\n\t\t\t\t\t// 如果没有展开项，直接处理\n\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.reCalChatMainHeight();\n\t\t\t\t\t}, 50);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:819','输入框获取焦点错误:', error);\n\t\t\t}\n\t\t},\n\t\tonTextareaBlur(e) {\n\t\t\ttry {\n\t\t\t\tthis.isFocus = false;\n\t\t\t\t// 简化失焦处理\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.reCalChatMainHeight();\n\t\t\t\t}, 50);\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:830','输入框失去焦点错误:', error);\n\t\t\t}\n\t\t},\n\t\tonTextareaInput(e) {\n\t\t\ttry {\n\t\t\t\tthis.textContent = e.detail.value;\n\t\t\t\t// 检查输入内容是否为空\n\t\t\t\tthis.isEmpty = !this.textContent || this.textContent.trim() === '';\n\t\t\t\t\n\t\t\t\t// 调整输入框高度（延时确保UI更新）\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t// 重新计算布局\n\t\t\t\t\tthis.reCalChatMainHeight();\n\t\t\t\t\t\n\t\t\t\t\t// 如果焦点在输入框，滚动到底部\n\t\t\t\t\tif (this.isFocus) {\n\t\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}, 50);\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:850','处理文本输入错误:', error);\n\t\t\t}\n\t\t},\n\t\tonAudioStateChange(state, msgInfo) {\n\t\t\tconst playingAudio = this.$refs['message' + msgInfo.id][0]\n\t\t\tif (state == 'PLAYING' && playingAudio != this.playingAudio) {\n\t\t\t\t// 停止之前的录音\n\t\t\t\tthis.playingAudio && this.playingAudio.stopPlayAudio();\n\t\t\t\t// 记录当前正在播放的消息\n\t\t\t\tthis.playingAudio = playingAudio;\n\t\t\t}\n\t\t},\n\t\tloadReaded(fid) {\n\t\t\tif (this.useMockData) {\n\t\t\t\t// 模拟数据无需加载已读状态\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tthis.$http({\n\t\t\t\turl: `/message/private/maxReadedId?friendId=${fid}`,\n\t\t\t\tmethod: 'get'\n\t\t\t}).then((id) => {\n\t\t\t\tthis.chatStore.readedMessage({\n\t\t\t\t\tfriendId: fid,\n\t\t\t\t\tmaxId: id\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\treadedMessage() {\n\t\t\tif (this.unreadCount == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (this.useMockData) {\n\t\t\t\t// 使用模拟数据时直接重置未读计数\n\t\t\t\tif (this.chat) {\n\t\t\t\t\tthis.chat.unreadCount = 0;\n\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tlet url = \"\"\n\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\turl = `/message/group/readed?groupId=${this.chat.targetId}`\n\t\t\t} else {\n\t\t\t\turl = `/message/private/readed?friendId=${this.chat.targetId}`\n\t\t\t}\n\t\t\tthis.$http({\n\t\t\t\turl: url,\n\t\t\t\tmethod: 'PUT'\n\t\t\t}).then(() => {\n\t\t\t\tthis.chatStore.resetUnreadCount(this.chat)\n\t\t\t\tthis.scrollToBottom();\n\t\t\t})\n\t\t},\n\t\tloadGroup(groupId) {\n\t\t\tif (this.useMockData) {\n\t\t\t\t// 使用模拟数据\n\t\t\t\tconst group = getMockGroupById(groupId);\n\t\t\t\tif (group) {\n\t\t\t\t\tthis.group = {\n\t\t\t\t\t\tid: group.id,\n\t\t\t\t\t\tshowGroupName: group.showGroupName,\n\t\t\t\t\t\theadImageThumb: group.headImageThumb,\n\t\t\t\t\t\tmemberCount: group.memberCount,\n\t\t\t\t\t\tisBanned: false,\n\t\t\t\t\t\townerId: 1 // 假设当前用户是群主\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t// 模拟群成员\n\t\t\t\t\tthis.groupMembers = [];\n\t\t\t\t\tgroup.members.forEach(memberId => {\n\t\t\t\t\t\tconst user = getMockUserById(memberId);\n\t\t\t\t\t\tif (user) {\n\t\t\t\t\t\t\tthis.groupMembers.push({\n\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\tshowNickName: user.nickName,\n\t\t\t\t\t\t\t\theadImage: user.headImageThumb,\n\t\t\t\t\t\t\t\tquit: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tthis.$http({\n\t\t\t\turl: `/group/find/${groupId}`,\n\t\t\t\tmethod: 'GET'\n\t\t\t}).then((group) => {\n\t\t\t\tthis.group = group;\n\t\t\t\tthis.chatStore.updateChatFromGroup(group);\n\t\t\t\tthis.groupStore.updateGroup(group);\n\t\t\t});\n\n\t\t\tthis.$http({\n\t\t\t\turl: `/group/members/${groupId}`,\n\t\t\t\tmethod: 'GET'\n\t\t\t}).then((groupMembers) => {\n\t\t\t\tthis.groupMembers = groupMembers;\n\t\t\t});\n\t\t},\n\t\tupdateFriendInfo() {\n\t\t\tif (this.isFriend) {\n\t\t\t\t// store的数据不能直接修改，深拷贝一份store的数据\n\t\t\t\tlet friend = JSON.parse(JSON.stringify(this.friend));\n\t\t\t\tfriend.headImage = this.userInfo.headImageThumb;\n\t\t\t\tfriend.nickName = this.userInfo.nickName;\n\t\t\t\tfriend.showNickName = friend.remarkNickName ? friend.remarkNickName : friend.nickName;\n\t\t\t\t// 更新好友列表中的昵称和头像\n\t\t\t\tthis.friendStore.updateFriend(friend);\n\t\t\t\t// 更新会话中的头像和昵称\n\t\t\t\tthis.chatStore.updateChatFromFriend(friend);\n\t\t\t} else {\n\t\t\t\tthis.chatStore.updateChatFromUser(this.userInfo);\n\t\t\t}\n\t\t},\n\t\tloadFriend(friendId) {\n\t\t\tif (this.useMockData) {\n\t\t\t\t// 使用模拟数据\n\t\t\t\tconst user = getMockUserById(friendId);\n\t\t\t\tif (user) {\n\t\t\t\t\tthis.userInfo = {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\tnickName: user.nickName,\n\t\t\t\t\t\theadImageThumb: user.headImageThumb,\n\t\t\t\t\t\tstate: user.state,\n\t\t\t\t\t\tisBanned: false\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t// 获取好友用户信息\n\t\t\tthis.$http({\n\t\t\t\turl: `/user/find/${friendId}`,\n\t\t\t\tmethod: 'GET'\n\t\t\t}).then((userInfo) => {\n\t\t\t\tthis.userInfo = userInfo;\n\t\t\t\tthis.updateFriendInfo();\n\t\t\t})\n\t\t},\n\t\trpxTopx(rpx) {\n\t\t\t// rpx转换成px\n\t\t\tlet info = uni.getSystemInfoSync()\n\t\t\tlet px = info.windowWidth * rpx / 750;\n\t\t\treturn Math.floor(rpx);\n\t\t},\n\t\thtml2Escape(strHtml) {\n\t\t\treturn strHtml.replace(/[<>&\"]/g, function(c) {\n\t\t\t\treturn {\n\t\t\t\t\t'<': '&lt;',\n\t\t\t\t\t'>': '&gt;',\n\t\t\t\t\t'&': '&amp;',\n\t\t\t\t\t'\"': '&quot;'\n\t\t\t\t} [c];\n\t\t\t});\n\t\t},\n\t\tsendMessageRequest(msgInfo) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t// 请求入队列，防止请求\"后发先至\"，导致消息错序\n\t\t\t\tthis.reqQueue.push({ msgInfo, resolve, reject });\n\t\t\t\tthis.processReqQueue();\n\t\t\t})\n\t\t},\n\t\tprocessReqQueue() {\n\t\t\tif (this.reqQueue.length && !this.isSending) {\n\t\t\t\tthis.isSending = true;\n\t\t\t\tconst reqData = this.reqQueue.shift();\n\t\t\t\t\n\t\t\t\tif (this.useMockData) {\n\t\t\t\t\t// 使用模拟数据发送消息\n\t\t\t\t\tmockChatService.sendMessage(reqData.msgInfo, {\n\t\t\t\t\t\ttype: this.chat.type,\n\t\t\t\t\t\ttargetId: this.chat.targetId\n\t\t\t\t\t}).then(result => {\n\t\t\t\t\t\treqData.resolve(result.message);\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\treqData.reject(error);\n\t\t\t\t\t}).finally(() => {\n\t\t\t\t\t\tthis.isSending = false;\n\t\t\t\t\t\t// 发送下一条请求\n\t\t\t\t\t\tthis.processReqQueue();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// 使用原接口\n\t\t\t\t\tthis.$http({\n\t\t\t\t\t\turl: this.messageAction,\n\t\t\t\t\t\tmethod: 'post',\n\t\t\t\t\t\tdata: reqData.msgInfo\n\t\t\t\t\t}).then((res) => {\n\t\t\t\t\t\treqData.resolve(res)\n\t\t\t\t\t}).catch((e) => {\n\t\t\t\t\t\treqData.reject(e)\n\t\t\t\t\t}).finally(() => {\n\t\t\t\t\t\tthis.isSending = false;\n\t\t\t\t\t\t// 发送下一条请求\n\t\t\t\t\t\tthis.processReqQueue();\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treCalChatMainHeight() {\n\t\t\tsetTimeout(() => {\n\t\t\t\ttry {\n\t\t\t\t\tlet h = this.windowHeight;\n\t\t\t\t\t// 减去标题栏高度\n\t\t\t\t\th -= 50;\n\t\t\t\t\t\n\t\t\t\t\t// 如果显示表情栏或工具栏，减去其高度\n\t\t\t\t\tif (this.chatTabBox === 'emo' || this.chatTabBox === 'tools') {\n\t\t\t\t\t\th -= this.keyboardHeight;\n\t\t\t\t\t\tthis.sendBarZIndex = 1001;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.sendBarZIndex = 2;\n\t\t\t\t\t}\n\t\t\t\t\t\n\n\t\t\t\t\th -= uni.getSystemInfoSync().statusBarHeight;\n\n\t\t\t\t\t\n\t\t\t\t\tthis.chatMainHeight = h;\n\t\t\t\t\t\n\t\t\t\t\t// 只在工具栏显示时滚动到底部，输入框焦点时让系统处理\n\t\t\t\t\tif (this.chatTabBox != 'none') {\n\t\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t\t\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t} catch (e) {\n\t\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:1093','重新计算聊天主窗口高度错误:', e);\n\t\t\t\t}\n\t\t\t}, 30);\n\t\t},\n\t\tlistenKeyBoard() {\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t\t// app实现键盘监听\n\t\t\tuni.onKeyboardHeightChange(this.keyBoardListener);\n\n\t\t},\n\t\tunListenKeyboard() {\n\n\n\n\n\n\n\t\t\tuni.offKeyboardHeightChange(this.keyBoardListener);\n\n\t\t},\n\t\tkeyBoardListener(res) {\n\t\t\t// 只记录键盘状态，不进行高度计算\n\t\t\tthis.isShowKeyBoard = res.height > 0;\n\t\t},\n\t\tresizeListener() {\n\t\t\t// 简化resize监听，只记录状态\n\t\t\tlet keyboardHeight = 0;\n\t\t\t\n\t\t\tif (window.visualViewport && uni.getSystemInfoSync().platform == 'ios') {\n\t\t\t\tkeyboardHeight = 0;\n\t\t\t}\n\t\t\t\n\t\t\tthis.isShowKeyBoard = keyboardHeight > 150;\n\t\t},\n\t\tfocusInListener() {\n\t\t\t// 简化焦点监听\n\t\t\tthis.isShowKeyBoard = true;\n\t\t},\n\t\tfocusOutListener() {\n\t\t\t// 简化失焦监听\n\t\t\tthis.isShowKeyBoard = false;\n\t\t},\n\t\tshowBannedTip() {\n\t\t\tlet msgInfo = {\n\t\t\t\ttmpId: this.generateId(),\n\t\t\t\tsendId: this.mine.id,\n\t\t\t\tsendTime: new Date().getTime(),\n\t\t\t\ttype: this.$enums.MESSAGE_TYPE.TIP_TEXT\n\t\t\t}\n\t\t\tif (this.chat.type == \"PRIVATE\") {\n\t\t\t\tmsgInfo.recvId = this.mine.id\n\t\t\t\tmsgInfo.content = \"该用户已被管理员封禁,原因:\" + this.userInfo.reason\n\t\t\t} else {\n\t\t\t\tmsgInfo.groupId = this.group.id;\n\t\t\t\tmsgInfo.content = \"本群聊已被管理员封禁,原因:\" + this.group.reason\n\t\t\t}\n\t\t\tthis.chatStore.insertMessage(msgInfo, this.chat);\n\t\t},\n\t\tgenerateId() {\n\t\t\t// 生成临时id \n\t\t\treturn String(new Date().getTime()) + String(Math.floor(Math.random() * 1000));\n\t\t},\n\t\tinitMockData() {\n\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:1175','chat-box.vue: 开始初始化模拟数据');\n\t\t\ttry {\n\t\t\t\tif (!this.chatStore) {\n\t\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:1178','chat-box.vue: chatStore不可用，初始化失败');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 初始化模拟数据\n\t\t\t\tthis.chatStore.initChats({\n\t\t\t\t\tchats: JSON.parse(JSON.stringify(mockChats)),\n\t\t\t\t\tprivateMsgMaxId: 5000,\n\t\t\t\t\tgroupMsgMaxId: 6000\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:1189','chat-box.vue: 模拟数据初始化成功，共', mockChats.length, '条会话');\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:1191','chat-box.vue: 初始化模拟数据失败', error);\n\t\t\t}\n\t\t},\n\t},\n\tcomputed: {\n\t\tmine() {\n\t\t\tif (this.useMockData) {\n\t\t\t\t// 使用模拟数据\n\t\t\t\treturn this.mockCurrentUser || getMockCurrentUser();\n\t\t\t}\n\t\t\treturn this.userStore.userInfo;\n\t\t},\n\t\tfriend() {\n\t\t\tif (this.useMockData) {\n\t\t\t\t// 模拟数据模式下不使用好友存储\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn this.friendStore.findFriend(this.userInfo.id);\n\t\t},\n\t\ttitle() {\n\t\t\tif (!this.chat) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\tlet title = this.chat.showName;\n\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\tlet size = this.groupMembers.filter(m => !m.quit).length;\n\t\t\t\ttitle += `(${size})`;\n\t\t\t}\n\t\t\treturn title;\n\t\t},\n\t\tmessageAction() {\n\t\t\treturn `/message/${this.chat.type.toLowerCase()}/send`;\n\t\t},\n\t\tmessageSize() {\n\t\t\tif (!this.chat || !this.chat.messages) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn this.chat.messages.length;\n\t\t},\n\t\tunreadCount() {\n\t\t\tif (!this.chat || !this.chat.unreadCount) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn this.chat.unreadCount;\n\t\t},\n\t\tisBanned() {\n\t\t\treturn (this.chat.type == \"PRIVATE\" && this.userInfo.isBanned) ||\n\t\t\t\t(this.chat.type == \"GROUP\" && this.group.isBanned)\n\t\t},\n\t\tatUserItems() {\n\t\t\tlet atUsers = [];\n\t\t\tthis.atUserIds.forEach((id) => {\n\t\t\t\tif (id == -1) {\n\t\t\t\t\tatUsers.push({\n\t\t\t\t\t\tid: -1,\n\t\t\t\t\t\tshowNickName: \"全体成员\"\n\t\t\t\t\t})\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet member = this.groupMembers.find((m) => m.userId == id);\n\t\t\t\tif (member) {\n\t\t\t\t\tatUsers.push(member);\n\t\t\t\t}\n\t\t\t})\n\t\t\treturn atUsers;\n\t\t},\n\t\tmemberSize() {\n\t\t\treturn this.groupMembers.filter(m => !m.quit).length;\n\t\t}\n\t},\n\twatch: {\n\t\tmessageSize: function(newSize, oldSize) {\n\t\t\t// 接收到消息时滚动到底部\n\t\t\tif (newSize > oldSize) {\n\t\t\t\tlet pages = getCurrentPages();\n\t\t\t\tlet curPage = pages[pages.length - 1].route;\n\t\t\t\tif (curPage == \"pages/chat/chat-box\") {\n\t\t\t\t\tthis.scrollToBottom();\n\t\t\t\t} else {\n\t\t\t\t\tthis.needScrollToBottom = true;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tunreadCount: {\n\t\t\thandler(newCount, oldCount) {\n\t\t\t\tif (newCount > 0) {\n\t\t\t\t\t// 消息已读\n\t\t\t\t\tthis.readedMessage()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tonLoad(options) {\n\t\tif (this.useMockData) {\n\t\t\t// 使用模拟数据\n\t\t\tthis.mockCurrentUser = getMockCurrentUser();\n\t\t\t\n\t\t\t// 从模拟数据加载聊天数据\n\t\t\tconst chatIdx = options.chatIdx || 0;\n\t\t\t\n\t\t\ttry {\n\t\t\t\t// 先直接从mockChats获取数据\n\t\t\t\tuni.__f__('log','at pagesChat/chat-box.vue:1293','chat-box.vue: 直接从mockChats获取聊天数据');\n\t\t\t\tthis.chat = JSON.parse(JSON.stringify(mockChats[chatIdx]));\n\t\t\t\t\n\t\t\t\t// 确保消息有sendId字段\n\t\t\t\tif (this.chat && this.chat.messages) {\n\t\t\t\t\tthis.chat.messages.forEach(msg => {\n\t\t\t\t\t\tif (!msg.sendId && msg.senderId) {\n\t\t\t\t\t\t\tmsg.sendId = msg.senderId;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 将数据加载到chatStore中\n\t\t\t\tif (this.chatStore && this.chatStore.initChats) {\n\t\t\t\t\tthis.chatStore.initChats({\n\t\t\t\t\t\tchats: mockChats,\n\t\t\t\t\t\tprivateMsgMaxId: 5000,\n\t\t\t\t\t\tgroupMsgMaxId: 6000\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// 初始状态只显示20条消息\n\t\t\t\tlet size = this.messageSize;\n\t\t\t\tthis.showMinIdx = size > 20 ? size - 20 : 0;\n\t\t\t\t\n\t\t\t\t// 消息已读\n\t\t\t\tthis.readedMessage();\n\t\t\t\t\n\t\t\t\t// 加载好友或群聊信息\n\t\t\t\tif (this.chat && this.chat.type == \"GROUP\") {\n\t\t\t\t\tthis.loadGroup(this.chat.targetId);\n\t\t\t\t} else if (this.chat) {\n\t\t\t\t\tthis.loadFriend(this.chat.targetId);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:1328','chat-box.vue: 加载聊天数据出错', error);\n\t\t\t}\n\t\t} else {\n\t\t\t// 使用原有方式\n\t\t\ttry {\n\t\t\t\t// 确保chatStore和chats存在\n\t\t\t\tif (!this.chatStore || !this.chatStore.chats || !this.chatStore.chats.length) {\n\t\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:1335','chat-box.vue: chatStore或chats不存在');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 聊天数据\n\t\t\t\tthis.chat = this.chatStore.chats[options.chatIdx];\n\t\t\t\t\n\t\t\t\t// 初始状态只显示20条消息\n\t\t\t\tlet size = this.messageSize;\n\t\t\t\tthis.showMinIdx = size > 20 ? size - 20 : 0;\n\t\t\t\t\n\t\t\t\t// 消息已读\n\t\t\t\tthis.readedMessage();\n\t\t\t\t\n\t\t\t\t// 加载好友或群聊信息\n\t\t\t\tif (this.chat.type == \"GROUP\") {\n\t\t\t\t\tthis.loadGroup(this.chat.targetId);\n\t\t\t\t} else {\n\t\t\t\t\tthis.loadFriend(this.chat.targetId);\n\t\t\t\t\tthis.loadReaded(this.chat.targetId);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 激活当前会话\n\t\t\t\tthis.chatStore.activeChat(options.chatIdx);\n\t\t\t} catch (error) {\n\t\t\t\tuni.__f__('error','at pagesChat/chat-box.vue:1360','chat-box.vue: 加载聊天数据出错', error);\n\t\t\t}\n\t\t}\n\t\t\n\t\t// 复位回执消息\n\t\tthis.isReceipt = false;\n\t\t// 计算聊天窗口高度\n\t\tthis.$nextTick(() => {\n\t\t\tthis.windowHeight = uni.getSystemInfoSync().windowHeight;\n\t\t\tthis.reCalChatMainHeight();\n\n\n\n\n\n\n\t\t});\n\t},\n\tonUnload() {\n\t\t// 由于不再使用自定义键盘监听，移除相关清理\n\t\t// this.unListenKeyboard();\n\t},\n\tonShow() {\n\t\tif (this.needScrollToBottom) {\n\t\t\t// 页面滚到底部\n\t\t\tthis.scrollToBottom();\n\t\t\tthis.needScrollToBottom = false;\n\t\t}\n\t}\n}\n</script>\n\n<style lang=\"scss\">\n.background-image {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  z-index: 0;\n  pointer-events: none;\n}\n\n.background-image image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n.chat-box {\n\t$icon-color: rgba(0, 0, 0, 0.88);\n\tposition: relative;\n\tbackground-color:transparent;\n\n\t.header {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\theight: 60rpx;\n\t\tpadding: 5px;\n\t\tbackground-color:transparent;\n\t\tline-height: 50px;\n\t\tfont-size: $im-font-size-large;\n\t\tbox-shadow: $im-box-shadow-lighter;\n\t\tz-index: 1;\n\n\t\t.btn-side {\n\t\t\tposition: absolute;\n\t\t\tline-height: 60rpx;\n\t\t\tcursor: pointer;\n\n\t\t\t&.right {\n\t\t\t\tright: 30rpx;\n\t\t\t}\n\t\t}\n\t}\n\n\t.chat-main-box {\n\n\n\n\n\t\ttop: calc($im-nav-bar-height + var(--status-bar-height));\n\n\t\tposition: fixed;\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tz-index: 2;\n\n\t\t.chat-msg {\n\t\t\tflex: 1;\n\t\t\tpadding: 0;\n\t\t\toverflow: hidden;\n\t\t\tposition: relative;\n\t\t\tbackground-color: transparent;\n\n\t\t\t.scroll-box {\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\n\t\t.chat-at-bar {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tpadding: 0 10rpx;\n\n\t\t\t.icon-at {\n\t\t\t\tfont-size: $im-font-size-larger;\n\t\t\t\tcolor: $im-color-primary;\n\t\t\t\tfont-weight: bold;\n\t\t\t}\n\n\t\t\t.chat-at-scroll-box {\n\t\t\t\tflex: 1;\n\t\t\t\twidth: 80%;\n\n\t\t\t\t.chat-at-items {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\theight: 70rpx;\n\n\t\t\t\t\t.chat-at-item {\n\t\t\t\t\t\tpadding: 0 3rpx;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\t.send-bar {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t\tpadding: 10rpx 20rpx;\n\t\t\tborder-top: $im-border solid 1px;\n\t\t\tbackground-color: $im-bg;\n\t\t\tmin-height: 100rpx;\n\t\t\tmargin-bottom: 14rpx;\n\t\t\tposition: relative;\n\n\t\t\t.iconfont {\n\t\t\t\tfont-size: 60rpx;\n\t\t\t\tmargin: 0 10rpx;\n\t\t\t\tcolor: $icon-color;\n\t\t\t\tmin-width: 60rpx;\n\n\t\t\t}\n\t\t\t.icon{\n\t\t\t\twidth: 60rpx;\n\t\t\t\theight: 60rpx;\n\t\t\t}\n\n\t\t\t.chat-record {\n\t\t\t\tflex: 1;\n\t\t\t}\n\n\t\t\t.send-container {\n\t\t\t\tflex: 1;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: row;\n\t\t\t\tposition: relative;\n\n\t\t\t\t.send-text {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\toverflow: auto;\n\t\t\t\t\tpadding: 0 20rpx;\n\n\t\t\t\t\tborder-radius: 8rpx;\n\t\t\t\t\tfont-size: $im-font-size;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tmargin: 0 10rpx;\n\n\n\t\t\t\t\t.send-text-area {\n\t\t\t\t\t\tbackground-color: white;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\theight: auto;\n\t\t\t\t\t\tmin-height: 70rpx;\n\t\t\t\t\t\tmax-height: 300rpx; /* 约为10行文字高度 */\n\t\t\t\t\t\toverflow-y: auto; /* 确保可以滚动 */\n\t\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t\t\tborder-radius: 8rpx;\n\t\t\t\t\t}\n\t\t\t\t\n\n\n\n\t\t\t\t\t.btn-send {\n\t\t\t\t\t\tmargin: 5rpx;\n\t\t\t\t\t\theight: 60rpx;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t.send-actions{\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: row;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\t.chat-tab-bar {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tbackground-color: $im-bg;\n\t\twidth: 100%;\n\t\tbackground-color: white;\n\t\tz-index: 1000;\n\n\t\t.chat-tools {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t\tflex-wrap: wrap;\n\t\t\talign-items: top;\n\t\t\theight: 90rpx;\n\t\t\tpadding: 40rpx;\n\t\t\tbox-sizing: border-box;\n\t\t\twidth: 100%;\n\n\t\t\t.chat-tools-item {\n\t\t\t\twidth: 25%;\n\t\t\t\tpadding: 16rpx;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\talign-items: center;\n\t\t\t\t.icon{\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t}\n\n\t\t\t\t.tool-icon {\n\t\t\t\t\tfont-size: 54rpx;\n\t\t\t\t\tborder-radius: 20%;\n\t\t\t\t\tbackground-color: white;\n\t\t\t\t\tcolor: $icon-color;\n\t\t\t\t\twidth: 60rpx;\n\t\t\t\t\theight: 60rpx;\n\t\t\t\t\t.icon{\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t&:active {\n\t\t\t\t\t\tbackground-color: $im-bg-active;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.tool-name {\n\t\t\t\t\theight: 60rpx;\n\t\t\t\t\tline-height: 60rpx;\n\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t.chat-emotion {\n\t\t\theight: 310px;\n\t\t\tpadding: 20rpx;\n\t\t\tbox-sizing: border-box;\n\n\t\t\t.emotion-item-list {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-wrap: wrap;\n\t\t\t\tgap: 10rpx; // 控制横向与纵向的间距\n\t\t\t\tjustify-content: flex-start;\n\t\t\t\tflex-direction: row;\n\t\t\t\theight: 100%;\n\t\t\t}\n\n\t\t\t\t.emotion-item {\n\t\t\t\t\twidth: calc((100% - 70rpx) / 8); // 减去7个gap再平分8个表情\n\t\t\t\t\theight: calc((100% - 70rpx) / 8);\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t}\n\t\t\t}\n\n\n\t}\n}\n</style>","import MiniProgramPage from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/pagesChat/chat-box.vue'\nwx.createPage(MiniProgramPage)"],"names":["Header","ChatMessageItem","ChatRecord","FileUpload","ImageUpload","HeadImage","ChatAtBox","GroupMemberSelector","GroupRtcJoin","ChatItem","Loading","LongPressMenu","_sfc_main","defineComponent","enums","messageType","emotion","url","getChatStore","getFriendStore","getConfigStore","getUserStore","getGroupStore","uni","error","getMockCurrentUser","data","msgInfo","m","friendInfo","ids","users","id","groupId","inviterId","userInfos","chatIdx","atUserIds","member","sendText","receiptText","atText","message","mockChatService","targetId","size","idx","chatTabBox","emoText","file","res","err","url_1","filePath","e","state","playingAudio","fid","group","getMockGroupById","memberId","user","getMockUserById","groupMembers","friend","friendId","userInfo","rpx","strHtml","c","resolve","reject","reqData","result","h_1","keyboardHeight","mockChats","title","atUsers","newSize","oldSize","pages","newCount","oldCount","options","msg","MiniProgramPage"],"mappings":"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"}