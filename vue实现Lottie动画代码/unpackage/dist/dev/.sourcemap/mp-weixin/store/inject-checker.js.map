{"version":3,"file":"inject-checker.js","sources":["store/inject-checker.js"],"sourcesContent":["/**\r\n * 用于确保Vuex store被正确注入到Vue实例\r\n * 仅支持Vue 3\r\n */\r\nimport { getCurrentInstance, inject } from 'vue'\r\n\r\n/**\r\n * 检查store是否可用的方法\r\n * @param {Object} store - Vuex store实例\r\n * @returns {boolean} 返回store是否可用\r\n */\r\nexport const checkStoreAvailability = (store) => {\r\n  if (!store) {\r\n    console.error('store参数未提供');\r\n    return false;\r\n  }\r\n  \r\n  // 检查user模块是否注册\r\n  try {\r\n    const userState = store.state.user;\r\n    if (!userState) {\r\n      console.error('user模块不存在');\r\n      return false;\r\n    }\r\n    \r\n    // 检查baseInfo子模块\r\n    if (!userState.baseInfo) {\r\n      console.error('user/baseInfo模块不存在');\r\n      return false;\r\n    }\r\n    \r\n    console.log('Vuex store正常可用');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('检查Vuex模块时出错:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * 为组件注入$store安全访问方法的混入 (Vue 3版本)\r\n */\r\nexport const injectStoreSafety = {\r\n  beforeCreate() {\r\n    // 创建安全访问对象\r\n    this.$safeStore = createSafeStoreAccess();\r\n  }\r\n};\r\n\r\n/**\r\n * 创建安全访问store的方法\r\n * 仅支持Vue 3\r\n * @returns {Object} 安全访问方法对象\r\n */\r\nfunction createSafeStoreAccess() {\r\n  return {\r\n    // 安全获取state\r\n    state: (path) => {\r\n      try {\r\n        // 获取store (Vue 3方式)\r\n        const store = getStoreFromComponent();\r\n        if (!store) return null;\r\n        \r\n        const parts = path.split('.');\r\n        let current = store.state;\r\n        \r\n        for (const part of parts) {\r\n          if (!current || typeof current !== 'object') return null;\r\n          current = current[part];\r\n        }\r\n        \r\n        return current;\r\n      } catch (error) {\r\n        console.error(`安全获取state路径 ${path} 时出错:`, error);\r\n        return null;\r\n      }\r\n    },\r\n    \r\n    // 安全调用getter\r\n    getter: (name) => {\r\n      try {\r\n        const store = getStoreFromComponent();\r\n        return store && store.getters[name];\r\n      } catch (error) {\r\n        console.error(`安全获取getter ${name} 时出错:`, error);\r\n        return null;\r\n      }\r\n    },\r\n    \r\n    // 安全dispatch\r\n    dispatch: (type, payload) => {\r\n      try {\r\n        const store = getStoreFromComponent();\r\n        if (!store) {\r\n          console.warn(`store不可用，dispatch ${type} 被跳过`);\r\n          return Promise.resolve(null);\r\n        }\r\n        return store.dispatch(type, payload);\r\n      } catch (error) {\r\n        console.error(`安全调用dispatch ${type} 时出错:`, error);\r\n        return Promise.reject(error);\r\n      }\r\n    },\r\n    \r\n    // 安全commit\r\n    commit: (type, payload) => {\r\n      try {\r\n        const store = getStoreFromComponent();\r\n        if (!store) {\r\n          console.warn(`store不可用，commit ${type} 被跳过`);\r\n          return;\r\n        }\r\n        store.commit(type, payload);\r\n      } catch (error) {\r\n        console.error(`安全调用commit ${type} 时出错:`, error);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * 从组件实例获取store\r\n * 仅支持Vue 3\r\n * @returns {Object|null} Vuex store或null\r\n */\r\nfunction getStoreFromComponent() {\r\n  // Vue 3方式 - 使用getCurrentInstance或inject\r\n  const instance = getCurrentInstance();\r\n  \r\n  // 尝试从当前实例获取\r\n  if (instance && instance.proxy && instance.proxy.$store) {\r\n    return instance.proxy.$store;\r\n  }\r\n  \r\n  // 尝试使用inject获取\r\n  try {\r\n    const storeFromInject = inject('store', null);\r\n    if (storeFromInject) {\r\n      return storeFromInject;\r\n    }\r\n  } catch (e) {\r\n    // inject可能不在setup上下文中被调用\r\n    console.debug('注入store失败:', e);\r\n  }\r\n  \r\n  // 尝试从app实例中获取\r\n  try {\r\n    const app = getApp();\r\n    if (app && app.$vm && app.$vm.$store) {\r\n      return app.$vm.$store;\r\n    }\r\n  } catch (e) {\r\n    console.warn('无法从app获取store:', e);\r\n  }\r\n  \r\n  // 尝试从uni全局对象获取\r\n  if (typeof uni !== 'undefined' && uni.$store) {\r\n    return uni.$store;\r\n  }\r\n  \r\n  // 所有方法都失败\r\n  console.warn('无法获取store实例');\r\n  return null;\r\n} "],"names":["uni","getCurrentInstance","inject"],"mappings":"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"}