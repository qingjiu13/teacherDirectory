{"version":3,"file":"mutations.js","sources":["store/user/chat/mutations.js"],"sourcesContent":["/**\r\n * chat模块的mutations\r\n * @module store/user/chat/mutations\r\n */\r\n\r\nexport default {\r\n        // 会话相关\r\n        SET_CURRENT_SESSION(state, session) {\r\n            state.currentSession = {...state.currentSession, ...session}\r\n          },\r\n          \r\n          ADD_OR_UPDATE_SESSION(state, session) {\r\n            if (!state.sessions.byId[session.sessionId]) {\r\n              state.sessions.allIds.unshift(session.sessionId)\r\n            }\r\n            state.sessions.byId[session.sessionId] = {...state.sessions.byId[session.sessionId], ...session}\r\n          },\r\n          \r\n          REMOVE_SESSION(state, sessionId) {\r\n            delete state.sessions.byId[sessionId]\r\n            state.sessions.allIds = state.sessions.allIds.filter(id => id !== sessionId)\r\n          },\r\n          \r\n          UPDATE_SESSION_LAST_MESSAGE(state, {sessionId, message}) {\r\n            const session = state.sessions.byId[sessionId]\r\n            if (session) {\r\n              session.lastMessage = message\r\n              session.lastMessageTime = message.time\r\n            }\r\n          },\r\n          \r\n          // 消息相关\r\n          ADD_MESSAGE(state, {sessionId, message}) {\r\n            if (!state.messages.bySessionId[sessionId]) {\r\n              state.messages.bySessionId[sessionId] = {\r\n                hasMore: true,\r\n                isLoading: false,\r\n                list: []\r\n              }\r\n            }\r\n            state.messages.bySessionId[sessionId].list.push(message)\r\n          },\r\n          \r\n          PREPEND_MESSAGES(state, {sessionId, messages}) {\r\n            if (!state.messages.bySessionId[sessionId]) {\r\n              state.messages.bySessionId[sessionId] = {\r\n                hasMore: true,\r\n                isLoading: false,\r\n                list: []\r\n              }\r\n            }\r\n            state.messages.bySessionId[sessionId].list.unshift(...messages)\r\n          },\r\n          \r\n          UPDATE_MESSAGE_STATUS(state, {sessionId, messageId, status}) {\r\n            const messages = state.messages.bySessionId[sessionId]?.list\r\n            if (messages) {\r\n              const msg = messages.find(m => m.id === messageId)\r\n              if (msg) msg.status = status\r\n            }\r\n          },\r\n          \r\n          // 用户信息相关\r\n          UPDATE_USER_INFO(state, userInfo) {\r\n            state.userInfos[userInfo.userId] = {...state.userInfos[userInfo.userId], ...userInfo}\r\n          },\r\n          \r\n          // 连接状态相关\r\n          SET_CONNECTION_STATUS(state, {isConnected, isConnecting}) {\r\n            state.connection.isConnected = isConnected\r\n            state.connection.isConnecting = isConnecting\r\n            if (isConnected) {\r\n              state.connection.lastError = null\r\n              state.connection.reconnectCount = 0\r\n            }\r\n          },\r\n          \r\n          SET_CONNECTION_ERROR(state, error) {\r\n            state.connection.lastError = error\r\n            state.connection.reconnectCount++\r\n          }\r\n}; \r\n"],"names":[],"mappings":";AAKA,MAAe,YAAA;AAAA;AAAA,EAEP,oBAAoB,OAAO,SAAS;AAChC,UAAM,iBAAiB,EAAC,GAAG,MAAM,gBAAgB,GAAG,QAAO;AAAA,EAC5D;AAAA,EAED,sBAAsB,OAAO,SAAS;AACpC,QAAI,CAAC,MAAM,SAAS,KAAK,QAAQ,SAAS,GAAG;AAC3C,YAAM,SAAS,OAAO,QAAQ,QAAQ,SAAS;AAAA,IAChD;AACD,UAAM,SAAS,KAAK,QAAQ,SAAS,IAAI,EAAC,GAAG,MAAM,SAAS,KAAK,QAAQ,SAAS,GAAG,GAAG,QAAO;AAAA,EAChG;AAAA,EAED,eAAe,OAAO,WAAW;AAC/B,WAAO,MAAM,SAAS,KAAK,SAAS;AACpC,UAAM,SAAS,SAAS,MAAM,SAAS,OAAO,OAAO,QAAM,OAAO,SAAS;AAAA,EAC5E;AAAA,EAED,4BAA4B,OAAO,EAAC,WAAW,QAAO,GAAG;AACvD,UAAM,UAAU,MAAM,SAAS,KAAK,SAAS;AAC7C,QAAI,SAAS;AACX,cAAQ,cAAc;AACtB,cAAQ,kBAAkB,QAAQ;AAAA,IACnC;AAAA,EACF;AAAA;AAAA,EAGD,YAAY,OAAO,EAAC,WAAW,QAAO,GAAG;AACvC,QAAI,CAAC,MAAM,SAAS,YAAY,SAAS,GAAG;AAC1C,YAAM,SAAS,YAAY,SAAS,IAAI;AAAA,QACtC,SAAS;AAAA,QACT,WAAW;AAAA,QACX,MAAM,CAAE;AAAA,MACT;AAAA,IACF;AACD,UAAM,SAAS,YAAY,SAAS,EAAE,KAAK,KAAK,OAAO;AAAA,EACxD;AAAA,EAED,iBAAiB,OAAO,EAAC,WAAW,SAAQ,GAAG;AAC7C,QAAI,CAAC,MAAM,SAAS,YAAY,SAAS,GAAG;AAC1C,YAAM,SAAS,YAAY,SAAS,IAAI;AAAA,QACtC,SAAS;AAAA,QACT,WAAW;AAAA,QACX,MAAM,CAAE;AAAA,MACT;AAAA,IACF;AACD,UAAM,SAAS,YAAY,SAAS,EAAE,KAAK,QAAQ,GAAG,QAAQ;AAAA,EAC/D;AAAA,EAED,sBAAsB,OAAO,EAAC,WAAW,WAAW,OAAM,GAAG;;AAC3D,UAAM,YAAW,WAAM,SAAS,YAAY,SAAS,MAApC,mBAAuC;AACxD,QAAI,UAAU;AACZ,YAAM,MAAM,SAAS,KAAK,OAAK,EAAE,OAAO,SAAS;AACjD,UAAI;AAAK,YAAI,SAAS;AAAA,IACvB;AAAA,EACF;AAAA;AAAA,EAGD,iBAAiB,OAAO,UAAU;AAChC,UAAM,UAAU,SAAS,MAAM,IAAI,EAAC,GAAG,MAAM,UAAU,SAAS,MAAM,GAAG,GAAG,SAAQ;AAAA,EACrF;AAAA;AAAA,EAGD,sBAAsB,OAAO,EAAC,aAAa,aAAY,GAAG;AACxD,UAAM,WAAW,cAAc;AAC/B,UAAM,WAAW,eAAe;AAChC,QAAI,aAAa;AACf,YAAM,WAAW,YAAY;AAC7B,YAAM,WAAW,iBAAiB;AAAA,IACnC;AAAA,EACF;AAAA,EAED,qBAAqB,OAAO,OAAO;AACjC,UAAM,WAAW,YAAY;AAC7B,UAAM,WAAW;AAAA,EAClB;AACX;;"}