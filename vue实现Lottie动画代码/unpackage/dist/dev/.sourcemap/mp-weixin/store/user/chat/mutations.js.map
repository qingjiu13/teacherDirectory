{"version":3,"file":"mutations.js","sources":["store/user/chat/mutations.js"],"sourcesContent":["/**\r\n * chat模块的mutations\r\n * @module store/user/chat/mutations\r\n */\r\n\r\nexport default {\r\n        // 会话相关\r\n        SET_CURRENT_SESSION(state, session) {\r\n            state.currentSession = {...state.currentSession, ...session}\r\n          },\r\n          \r\n          ADD_OR_UPDATE_SESSION(state, session) {\r\n            if (!state.sessions.byId[session.sessionId]) {\r\n              state.sessions.allIds.unshift(session.sessionId)\r\n            }\r\n            state.sessions.byId[session.sessionId] = {...state.sessions.byId[session.sessionId], ...session}\r\n          },\r\n          \r\n          REMOVE_SESSION(state, sessionId) {\r\n            delete state.sessions.byId[sessionId]\r\n            state.sessions.allIds = state.sessions.allIds.filter(id => id !== sessionId)\r\n          },\r\n          \r\n          UPDATE_SESSION_LAST_MESSAGE(state, {sessionId, message}) {\r\n            const session = state.sessions.byId[sessionId]\r\n            if (session) {\r\n              session.lastMessage = message\r\n              session.lastMessageTime = message.time\r\n            }\r\n          },\r\n          \r\n          // 消息相关\r\n          ADD_MESSAGE(state, {sessionId, message}) {\r\n            if (!state.messages.bySessionId[sessionId]) {\r\n              state.messages.bySessionId[sessionId] = {\r\n                hasMore: true,\r\n                isLoading: false,\r\n                list: []\r\n              }\r\n            }\r\n            state.messages.bySessionId[sessionId].list.push(message)\r\n          },\r\n          \r\n          PREPEND_MESSAGES(state, {sessionId, messages}) {\r\n            if (!state.messages.bySessionId[sessionId]) {\r\n              state.messages.bySessionId[sessionId] = {\r\n                hasMore: true,\r\n                isLoading: false,\r\n                list: []\r\n              }\r\n            }\r\n            state.messages.bySessionId[sessionId].list.unshift(...messages)\r\n          },\r\n          \r\n          UPDATE_MESSAGE_STATUS(state, {sessionId, messageId, status}) {\r\n            const messages = state.messages.bySessionId[sessionId]?.list\r\n            if (messages) {\r\n              const msg = messages.find(m => m.id === messageId)\r\n              if (msg) msg.status = status\r\n            }\r\n          },\r\n          \r\n          // 用户信息相关\r\n          UPDATE_USER_INFO(state, userInfo) {\r\n            state.userInfos[userInfo.userId] = {...state.userInfos[userInfo.userId], ...userInfo}\r\n          },\r\n          \r\n          // 连接状态相关\r\n          SET_CONNECTION_STATUS(state, {isConnected, isConnecting}) {\r\n            state.connection.isConnected = isConnected\r\n            state.connection.isConnecting = isConnecting\r\n            if (isConnected) {\r\n              state.connection.lastError = null\r\n              state.connection.reconnectCount = 0\r\n            }\r\n          },\r\n          \r\n          SET_CONNECTION_ERROR(state, error) {\r\n            state.connection.lastError = error\r\n            state.connection.reconnectCount++\r\n          }\r\n}; \r\n"],"names":["mutations","state","session","sessionId","id","message","messages","messageId","status","_a","msg","m","userInfo","isConnected","isConnecting","error"],"mappings":"aAKA,MAAeA,EAAA,CAEP,oBAAoBC,EAAOC,EAAS,CAChCD,EAAM,eAAiB,CAAC,GAAGA,EAAM,eAAgB,GAAGC,CAAO,CAC5D,EAED,sBAAsBD,EAAOC,EAAS,CAC/BD,EAAM,SAAS,KAAKC,EAAQ,SAAS,GACxCD,EAAM,SAAS,OAAO,QAAQC,EAAQ,SAAS,EAEjDD,EAAM,SAAS,KAAKC,EAAQ,SAAS,EAAI,CAAC,GAAGD,EAAM,SAAS,KAAKC,EAAQ,SAAS,EAAG,GAAGA,CAAO,CAChG,EAED,eAAeD,EAAOE,EAAW,CAC/B,OAAOF,EAAM,SAAS,KAAKE,CAAS,EACpCF,EAAM,SAAS,OAASA,EAAM,SAAS,OAAO,OAAOG,GAAMA,IAAOD,CAAS,CAC5E,EAED,4BAA4BF,EAAO,CAAC,UAAAE,EAAW,QAAAE,CAAO,EAAG,CACvD,MAAMH,EAAUD,EAAM,SAAS,KAAKE,CAAS,EACzCD,IACFA,EAAQ,YAAcG,EACtBH,EAAQ,gBAAkBG,EAAQ,KAErC,EAGD,YAAYJ,EAAO,CAAC,UAAAE,EAAW,QAAAE,CAAO,EAAG,CAClCJ,EAAM,SAAS,YAAYE,CAAS,IACvCF,EAAM,SAAS,YAAYE,CAAS,EAAI,CACtC,QAAS,GACT,UAAW,GACX,KAAM,CAAE,CACT,GAEHF,EAAM,SAAS,YAAYE,CAAS,EAAE,KAAK,KAAKE,CAAO,CACxD,EAED,iBAAiBJ,EAAO,CAAC,UAAAE,EAAW,SAAAG,CAAQ,EAAG,CACxCL,EAAM,SAAS,YAAYE,CAAS,IACvCF,EAAM,SAAS,YAAYE,CAAS,EAAI,CACtC,QAAS,GACT,UAAW,GACX,KAAM,CAAE,CACT,GAEHF,EAAM,SAAS,YAAYE,CAAS,EAAE,KAAK,QAAQ,GAAGG,CAAQ,CAC/D,EAED,sBAAsBL,EAAO,CAAC,UAAAE,EAAW,UAAAI,EAAW,OAAAC,CAAM,EAAG,OAC3D,MAAMF,GAAWG,EAAAR,EAAM,SAAS,YAAYE,CAAS,IAApC,YAAAM,EAAuC,KACxD,GAAIH,EAAU,CACZ,MAAMI,EAAMJ,EAAS,KAAKK,GAAKA,EAAE,KAAOJ,CAAS,EAC7CG,IAAKA,EAAI,OAASF,EACvB,CACF,EAGD,iBAAiBP,EAAOW,EAAU,CAChCX,EAAM,UAAUW,EAAS,MAAM,EAAI,CAAC,GAAGX,EAAM,UAAUW,EAAS,MAAM,EAAG,GAAGA,CAAQ,CACrF,EAGD,sBAAsBX,EAAO,CAAC,YAAAY,EAAa,aAAAC,CAAY,EAAG,CACxDb,EAAM,WAAW,YAAcY,EAC/BZ,EAAM,WAAW,aAAea,EAC5BD,IACFZ,EAAM,WAAW,UAAY,KAC7BA,EAAM,WAAW,eAAiB,EAErC,EAED,qBAAqBA,EAAOc,EAAO,CACjCd,EAAM,WAAW,UAAYc,EAC7Bd,EAAM,WAAW,gBAClB,CACX"}