{"version":3,"file":"actions.js","sources":["store/user/match/actions.js"],"sourcesContent":["/**\r\n * match模块的actions\r\n * @module store/user/match/actions\r\n */\r\n// API 基础URL\r\n// const API_BASE_URL = 'http://x62e45a8.natappfree.cc';\r\nimport { \r\n  getTeacherDetail,\r\n  getNonProfessionalOptions,\r\n  getSortModeOptions\r\n} from '../APIroute/match_api/match_api.js';\r\nimport { apiRequest } from '../JWT.js';\r\nimport { useGlobalStore } from '../../global.js';\r\nconst getApiPrefix = () => {\r\n  const globalStore = useGlobalStore()\r\n  return globalStore.apiBaseUrl\r\n}\r\n/**\r\n * 设置搜索关键词\r\n * @param {Object} context - Vuex上下文对象\r\n * @param {string} searchKey - 搜索关键词\r\n * @returns {Promise} 返回Promise对象\r\n */\r\nexport const setSearchKey = ({ commit, dispatch }, searchKey) => {\r\n  commit('SET_SEARCH_KEY', searchKey);\r\n  \r\n  // 当搜索关键词改变时，重新获取匹配的老师列表\r\n  return dispatch('fetchMatchTeacherList');\r\n};\r\n\r\n/**\r\n * 获取匹配的老师列表\r\n * @param {Object} context - Vuex上下文对象\r\n * @param {Object} payload - 请求参数\r\n * @param {boolean} [payload.loadMore=false] - 是否加载更多数据\r\n * @returns {Promise} 返回匹配的老师列表结果\r\n */\r\nexport const fetchMatchTeacherList = async ({ commit, rootState, state }, payload = {}) => {\r\n  try {\r\n    const isLoadMore = payload.loadMore === true;\r\n    const currentPage = isLoadMore ? state.currentPage + 1 : 1;\r\n\r\n    const nonProfessionalList = {\r\n      mathId: state.nonProfessionalList?.math?.selectedId || null,\r\n      englishId: state.nonProfessionalList?.english?.selectedId || null,\r\n      politicsId: state.nonProfessionalList?.politics?.selectedId || null,\r\n      otherId: state.nonProfessionalList?.other?.selectedId || null\r\n    };\r\n\r\n    const selectedSchool = rootState?.user?.schoolMajorRequest?.graduateSchoolSearch?.selectedSchoolId;\r\n    const selectedMajor = rootState?.user?.schoolMajorRequest?.graduateMajorSearch?.selectedMajorId;\r\n\r\n    const params = {\r\n      school: selectedSchool,\r\n      professional: selectedMajor,\r\n      nonProfessionalList,\r\n      sortMode: state.sortMode?.selectedId || null,\r\n      pageNum: currentPage,\r\n      pageSize: payload.pageSize || state.pageSize || 10,\r\n      searchKey: state.searchKey || ''\r\n    };\r\n\r\n    const response = await apiRequest(`${getApiPrefix()}/yanshilu/teacher/match`, 'POST', params);\r\n    console.log('匹配老师列表响应:', response);\r\n    if (response?.success && response.data.code === 200) {\r\n      const matchData = response.data.data;\r\n      const teacherList = matchData.data || [];\r\n\r\n      if (isLoadMore) {\r\n        commit('APPEND_MATCH_LIST', teacherList);\r\n      } else {\r\n        commit('SET_MATCH_LIST', teacherList);\r\n      }\r\n\r\n      commit('SET_PAGINATION', {\r\n        currentPage,\r\n        hasMore: matchData.hasMore || false\r\n      });\r\n\r\n      console.log('匹配老师列表更新成功:', teacherList);\r\n    } else {\r\n      console.warn('匹配接口返回数据格式异常:', response);\r\n    }\r\n\r\n    return response;\r\n  } catch (error) {\r\n    console.error('获取匹配老师列表失败:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * 获取非专业课选项\r\n * @param {Object} context - Vuex上下文对象\r\n * @param {Object} payload - 请求参数\r\n * @param {string} payload.type - 非专业课类型\r\n * @returns {Promise} 返回非专业课选项列表\r\n */\r\nexport const fetchNonProfessionalOptions = ({ commit, rootState }, { type }) => {\r\n  const userId = rootState.user.baseInfo.id;\r\n  \r\n  const params = {\r\n    userId: userId,\r\n    type: type\r\n  };\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    getNonProfessionalOptions(params)\r\n      .then(response => {\r\n        resolve(response);\r\n      })\r\n      .catch(error => {\r\n        reject(error);\r\n      });\r\n  });\r\n};\r\n\r\n/**\r\n * 获取排序方式选项\r\n * @param {Object} context - Vuex上下文对象\r\n * @returns {Promise} 返回排序方式选项列表\r\n */\r\nexport const fetchSortModeOptions = ({ commit, rootState }) => {\r\n  const userId = rootState.user.baseInfo.id;\r\n  \r\n  const params = {\r\n    userId: userId\r\n  };\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    getSortModeOptions(params)\r\n      .then(response => {\r\n        // JWT.js的apiRequest返回 {success: true, data: ...} 格式\r\n        if (response && response.success && response.data) {\r\n          const sortData = response.data;\r\n          // 更新排序选项列表\r\n          commit('SET_SORT_OPTIONS', sortData.list || sortData);\r\n        }\r\n        resolve(response);\r\n      })\r\n      .catch(error => {\r\n        console.error('获取排序选项失败:', error);\r\n        reject(error);\r\n      });\r\n  });\r\n};\r\n\r\n/**\r\n * 选择非专业课\r\n * @param {Object} context - Vuex上下文对象\r\n * @param {Object} payload - 非专业课信息\r\n * @param {string} payload.type - 非专业课类型\r\n * @param {number} payload.id - 选项ID\r\n * @param {string} payload.name - 选项名称\r\n */\r\nexport const selectNonProfessional = ({ commit }, { type, id, name }) => {\r\n  commit('SET_NON_PROFESSIONAL_SELECTION', { type, id, name });\r\n};\r\n\r\n/**\r\n * 选择排序方式\r\n * @param {Object} context - Vuex上下文对象\r\n * @param {Object} payload - 排序信息\r\n * @param {number} payload.id - 排序ID\r\n * @param {string} payload.name - 排序名称\r\n */\r\nexport const selectSortMode = ({ commit }, { id, name }) => {\r\n  commit('SET_SELECTED_SORT_MODE', { id, name });\r\n};\r\n\r\n/**\r\n * 获取老师详细信息\r\n * @param {Object} context - Vuex上下文对象\r\n * @param {Object} payload - 请求参数\r\n * @param {number} payload.teacherId - 老师ID（数字类型）\r\n * @returns {Promise} 返回老师详细信息\r\n */\r\nexport const fetchTeacherDetail = ({ commit, rootState }, { teacherId }) => {\r\n  console.log('=== fetchTeacherDetail 开始执行 ===');\r\n  console.log('teacherId:', teacherId, '类型:', typeof teacherId);\r\n  \r\n  // 确保teacherId是数字类型\r\n  const normalizedTeacherId = Number(teacherId);\r\n  \r\n  if (!normalizedTeacherId || isNaN(normalizedTeacherId)) {\r\n    console.error('teacherId 无效，退出');\r\n    return Promise.reject(new Error('老师ID不能为空或无效'));\r\n  }\r\n  \r\n  // 构建请求参数\r\n  const params = {\r\n    teacherId: normalizedTeacherId\r\n  };\r\n  \r\n  console.log('构建的请求参数:', params);\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    console.log('准备调用 getTeacherDetail API...');\r\n    \r\n    getTeacherDetail(params)\r\n      .then(response => {\r\n        console.log('=== API 响应完整数据 ===');\r\n        console.log('response:', JSON.stringify(response, null, 2));\r\n        \r\n        // 检查返回的数据结构 - 格式：{success: true, data: {msg, code, data: {service: [...]}}}\r\n        if (response && response.success && response.data && response.data.code === 200) {\r\n          console.log('response.success 为 true，response.data.code 为 200，请求成功');\r\n          \r\n          if (response.data.data) {\r\n            console.log('response.data.data 存在');\r\n            console.log('response.data.data:', JSON.stringify(response.data.data, null, 2));\r\n            \r\n            const teacherDetail = response.data.data;\r\n            \r\n            console.log('准备调用 SET_TEACHER_DETAIL mutation...');\r\n            console.log('teacherId:', normalizedTeacherId);\r\n            console.log('detail:', JSON.stringify(teacherDetail, null, 2));\r\n            console.log('服务数量:', teacherDetail.service?.length || 0);\r\n            \r\n            // 更新老师详情到store\r\n            commit('SET_TEACHER_DETAIL', {\r\n              teacherId: normalizedTeacherId,\r\n              detail: teacherDetail\r\n            });\r\n            \r\n            console.log('SET_TEACHER_DETAIL mutation 调用完成');\r\n          } else {\r\n            console.error('response.data.data 不存在');\r\n            reject(new Error('响应数据中缺少data.data字段'));\r\n            return;\r\n          }\r\n        } else {\r\n          console.error('请求失败，success:', response?.success, 'code:', response?.data?.code, 'msg:', response?.data?.msg);\r\n          reject(new Error(response?.data?.msg || '获取老师详情失败'));\r\n          return;\r\n        }\r\n        \r\n        console.log('=== fetchTeacherDetail 成功完成 ===');\r\n        resolve(response);\r\n      })\r\n      .catch(error => {\r\n        console.error('=== fetchTeacherDetail 发生错误 ===');\r\n        console.error('错误详情:', error);\r\n        reject(error);\r\n      });\r\n  });\r\n};\r\n\r\nexport default {\r\n  setSearchKey,\r\n  fetchMatchTeacherList,\r\n  fetchNonProfessionalOptions,\r\n  fetchSortModeOptions,\r\n  selectNonProfessional,\r\n  selectSortMode,\r\n  fetchTeacherDetail\r\n};\r\n"],"names":["getApiPrefix","useGlobalStore","setSearchKey","commit","dispatch","searchKey","fetchMatchTeacherList","rootState","state","payload","isLoadMore","currentPage","nonProfessionalList","_b","_a","_d","_c","_f","_e","_h","_g","selectedSchool","_k","_j","_i","selectedMajor","_n","_m","_l","params","_o","response","apiRequest","uni","matchData","teacherList","error","fetchNonProfessionalOptions","type","resolve","reject","getNonProfessionalOptions","fetchSortModeOptions","getSortModeOptions","sortData","selectNonProfessional","id","name","selectSortMode","fetchTeacherDetail","teacherId","normalizedTeacherId","getTeacherDetail","teacherDetail","actions"],"mappings":"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"}