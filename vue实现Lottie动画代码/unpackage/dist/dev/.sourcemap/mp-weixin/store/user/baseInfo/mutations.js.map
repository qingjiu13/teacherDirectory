{"version":3,"file":"mutations.js","sources":["store/user/baseInfo/mutations.js"],"sourcesContent":["/**\r\n * baseInfo模块的mutations\r\n * @module store/user/baseInfo/mutations\r\n */\r\n\r\nexport default {\r\n    /**\r\n     * 更新用户角色\r\n     * @param {Object} state - 当前状态\r\n     * @param {string} role - 新的用户角色（学生或老师）\r\n     */\r\n    updateRole(state, role) {\r\n        console.log('updateRole mutation执行, 参数:', role);\r\n        // 更新显示的角色名称\r\n        state.userInfo.role = role === 'teacher' ? '老师' : '学生';\r\n        \r\n        // 保存到本地存储以便持久化\r\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\r\n            id: state.id,\r\n            avatar: state.avatar,\r\n            name: state.name,\r\n            gender: state.gender,\r\n            selfIntroduction: state.selfIntroduction,\r\n            wechatNumber: state.wechatNumber,\r\n            phoneNumber: state.phoneNumber,\r\n            role: role // 保存角色代码\r\n        }));\r\n        \r\n        // 同步更新角色到本地存储\r\n        uni.setStorageSync('userRole', role);\r\n        console.log('角色更新完成, 新角色:', state.userInfo.role);\r\n    },\r\n    \r\n    /**\r\n     * 设置用户完整信息\r\n     * @param {Object} state - 当前状态\r\n     * @param {Object} userData - 服务器返回的用户信息\r\n     */\r\n    SET_USER_INFO(state, userData) {\r\n        console.log('SET_USER_INFO mutation执行, 入参:', userData);\r\n        console.log('更新前state:', {\r\n            id: state.id,\r\n            name: state.name,\r\n            avatar: state.avatar\r\n        });\r\n        \r\n        // 更新基本信息\r\n        state.id = userData.id || '';\r\n        state.avatar = userData.avatar || '';\r\n        state.name = userData.nickname || userData.name || '';\r\n        state.gender = userData.gender || '';\r\n        state.selfIntroduction = userData.introduction || userData.selfIntroduction || '';\r\n        state.wechatNumber = userData.wechat || userData.wechatNumber || '';\r\n        state.phoneNumber = userData.phone || userData.phoneNumber || '';\r\n        state.password = userData.password || '';\r\n        \r\n        // 获取角色代码\r\n        const roleCode = userData.role || 'student';\r\n        \r\n        // 更新用户扩展信息\r\n        if (userData.userInfo) {\r\n            state.userInfo = {\r\n                ...state.userInfo,\r\n                ...userData.userInfo\r\n            };\r\n            \r\n            // 确保角色显示值与角色代码一致\r\n            if (!userData.userInfo.role || userData.userInfo.role === roleCode) {\r\n                state.userInfo.role = roleCode === 'teacher' ? '老师' : '学生';\r\n            }\r\n        } else {\r\n            // 如果没有提供 userInfo，仍然更新角色显示值\r\n            state.userInfo.role = roleCode === 'teacher' ? '老师' : '学生';\r\n        }\r\n        \r\n        // 保存到本地存储以便持久化\r\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\r\n            id: state.id,\r\n            avatar: state.avatar,\r\n            name: state.name,\r\n            gender: state.gender,\r\n            selfIntroduction: state.selfIntroduction,\r\n            wechatNumber: state.wechatNumber,\r\n            phoneNumber: state.phoneNumber,\r\n            role: roleCode\r\n        }));\r\n        \r\n        // 同步更新角色到本地存储\r\n        uni.setStorageSync('userRole', roleCode);\r\n        \r\n        console.log('更新后state:', {\r\n            id: state.id,\r\n            name: state.name,\r\n            avatar: state.avatar,\r\n            role: state.userInfo.role\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * 更新用户个人信息\r\n     * @param {Object} state - 当前状态\r\n     * @param {Object} userInfo - 用户个人信息对象\r\n     * @param {string} userInfo.avatar - 用户头像\r\n     * @param {string} userInfo.name - 用户姓名\r\n     * @param {string} userInfo.gender - 用户性别\r\n     * @param {string} userInfo.selfIntroduction - 用户自我介绍\r\n     * @param {string} userInfo.wechatNumber - 用户微信号\r\n     * @param {string} userInfo.phoneNumber - 用户手机号\r\n     * @param {string} userInfo.password - 用户密码\r\n     */\r\n    UPDATE_USER_INFO(state, userInfo) {\r\n        console.log('UPDATE_USER_INFO mutation执行, 入参:', userInfo);\r\n        \r\n        const { \r\n            avatar, \r\n            name, \r\n            nickname,\r\n            gender, \r\n            selfIntroduction,\r\n            introduction, \r\n            wechatNumber,\r\n            wechat,\r\n            phoneNumber,\r\n            phone,\r\n            password,\r\n            role\r\n        } = userInfo;\r\n        \r\n        // 只更新提供的字段（支持不同字段名）\r\n        if (avatar !== undefined) state.avatar = avatar;\r\n        if (name !== undefined) state.name = name;\r\n        if (nickname !== undefined) state.name = nickname;\r\n        if (gender !== undefined) state.gender = gender;\r\n        if (selfIntroduction !== undefined) state.selfIntroduction = selfIntroduction;\r\n        if (introduction !== undefined) state.selfIntroduction = introduction;\r\n        if (wechatNumber !== undefined) state.wechatNumber = wechatNumber;\r\n        if (wechat !== undefined) state.wechatNumber = wechat;\r\n        if (phoneNumber !== undefined) state.phoneNumber = phoneNumber;\r\n        if (phone !== undefined) state.phoneNumber = phone;\r\n        if (password !== undefined) state.password = password;\r\n        \r\n        // 处理角色更新\r\n        if (role !== undefined) {\r\n            // 更新角色显示值\r\n            state.userInfo.role = role === 'teacher' ? '老师' : '学生';\r\n            // 保存角色代码到本地存储\r\n            uni.setStorageSync('userRole', role);\r\n        }\r\n        \r\n        // 保存到本地存储以便持久化\r\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\r\n            id: state.id,\r\n            avatar: state.avatar,\r\n            name: state.name,\r\n            gender: state.gender,\r\n            selfIntroduction: state.selfIntroduction,\r\n            wechatNumber: state.wechatNumber,\r\n            phoneNumber: state.phoneNumber,\r\n            role: uni.getStorageSync('userRole') || 'student'\r\n        }));\r\n        \r\n        console.log('更新后state:', {\r\n            id: state.id,\r\n            name: state.name,\r\n            avatar: state.avatar\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * 更新用户个人档案（UPDATE_USER_INFO的别名，用于modify.vue页面）\r\n     * @param {Object} state - 当前状态\r\n     * @param {Object} profileData - 用户个人档案数据\r\n     */\r\n    UPDATE_USER_PROFILE(state, profileData) {\r\n        console.log('UPDATE_USER_PROFILE mutation执行, 入参:', profileData);\r\n        \r\n        // 直接调用UPDATE_USER_INFO mutation，保持逻辑一致\r\n        this.commit('user/baseInfo/UPDATE_USER_INFO', profileData);\r\n        \r\n        // 发送事件通知更新成功\r\n        uni.$emit('userProfileUpdated', {\r\n            timestamp: Date.now(),\r\n            data: profileData\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * 清除用户信息（用于登出）\r\n     * @param {Object} state - 当前状态\r\n     */\r\n    CLEAR_USER_INFO(state) {\r\n        console.log('CLEAR_USER_INFO mutation执行');\r\n        \r\n        // 重置所有用户信息为默认值\r\n        state.id = '';\r\n        state.avatar = '';\r\n        state.name = '';\r\n        state.gender = '';\r\n        state.selfIntroduction = '';\r\n        state.wechatNumber = '';\r\n        state.phoneNumber = '';\r\n        state.password = '';\r\n        \r\n        // 保持角色不变，只清除其他信息\r\n        const currentRole = state.userInfo.role;\r\n        state.userInfo = {\r\n            certificate: 0,\r\n            role: currentRole, // 保留当前角色\r\n            school: '',\r\n            major: '',\r\n            targetSchool: '',\r\n            targetMajor: '',\r\n            studentGrade: '',\r\n            teacherGrade: '',\r\n            teacherScore: 0,\r\n        };\r\n        \r\n        console.log('清除后state:', {\r\n            id: state.id,\r\n            name: state.name,\r\n            avatar: state.avatar,\r\n            role: state.userInfo.role\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * 更新用户扩展信息\r\n     * @param {Object} state - 当前模块状态\r\n     * @param {Object} userInfoData - 用户扩展信息\r\n     */\r\n    UPDATE_USER_INFO_DATA(state, userInfoData) {\r\n        console.log('UPDATE_USER_INFO_DATA mutation执行, 入参:', userInfoData);\r\n        \r\n        // 更新userInfo对象中的字段\r\n        state.userInfo = {\r\n            ...state.userInfo,\r\n            ...userInfoData\r\n        };\r\n        \r\n        // 保存到本地存储\r\n        uni.setStorageSync('userInfoData', JSON.stringify(state.userInfo));\r\n        \r\n        console.log('更新后userInfo:', state.userInfo);\r\n    }\r\n}; "],"names":["uni"],"mappings":"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"}