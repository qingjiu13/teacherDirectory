{"version":3,"file":"mutations.js","sources":["store/user/baseInfo/mutations.js"],"sourcesContent":["/**\r\n * baseInfo模块的mutations\r\n * @module store/user/baseInfo/mutations\r\n */\r\n\r\nexport default {\r\n    /**\r\n     * 更新用户角色\r\n     * @param {Object} state - 当前状态\r\n     * @param {string} role - 新的用户角色（学生或老师）\r\n     */\r\n    updateRole(state, role) {\r\n        // 更新显示的角色名称\r\n        state.userInfo.role = role === 'teacher' ? '老师' : '学生';\r\n        \r\n        // 保存到本地存储以便持久化\r\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\r\n            id: state.id,\r\n            avatar: state.avatar,\r\n            name: state.name,\r\n            gender: state.gender,\r\n            selfIntroduction: state.selfIntroduction,\r\n            wechatNumber: state.wechatNumber,\r\n            phoneNumber: state.phoneNumber,\r\n            role: role // 保存角色代码\r\n        }));\r\n        \r\n        // 同步更新角色到本地存储\r\n        uni.setStorageSync('userRole', role);\r\n    },\r\n    \r\n    /**\r\n     * 设置用户完整信息\r\n     * @param {Object} state - 当前状态\r\n     * @param {Object} userData - 服务器返回的用户信息\r\n     */\r\n    SET_USER_INFO(state, userData) {\r\n        // 更新基本信息\r\n        state.id = userData.id || '';\r\n        state.avatar = userData.avatar || '';\r\n        state.name = userData.nickname || userData.name || '';\r\n        state.gender = userData.gender || '';\r\n        state.selfIntroduction = userData.introduction || userData.selfIntroduction || '';\r\n        state.wechatNumber = userData.wechat || userData.wechatNumber || '';\r\n        state.phoneNumber = userData.phone || userData.phoneNumber || '';\r\n        state.password = userData.password || '';\r\n        \r\n        // 获取角色代码\r\n        const roleCode = userData.role || 'student';\r\n        \r\n        // 更新用户扩展信息\r\n        if (userData.userInfo) {\r\n            state.userInfo = {\r\n                ...state.userInfo,\r\n                ...userData.userInfo\r\n            };\r\n            \r\n            // 确保角色显示值与角色代码一致\r\n            if (!userData.userInfo.role || userData.userInfo.role === roleCode) {\r\n                state.userInfo.role = roleCode === 'teacher' ? '老师' : '学生';\r\n            }\r\n        } else {\r\n            // 如果没有提供 userInfo，仍然更新角色显示值\r\n            state.userInfo.role = roleCode === 'teacher' ? '老师' : '学生';\r\n        }\r\n        \r\n        // 保存到本地存储以便持久化\r\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\r\n            id: state.id,\r\n            avatar: state.avatar,\r\n            name: state.name,\r\n            gender: state.gender,\r\n            selfIntroduction: state.selfIntroduction,\r\n            wechatNumber: state.wechatNumber,\r\n            phoneNumber: state.phoneNumber,\r\n            role: roleCode\r\n        }));\r\n        \r\n        // 同步更新角色到本地存储\r\n        uni.setStorageSync('userRole', roleCode);\r\n    },\r\n    \r\n    /**\r\n     * 更新用户个人信息\r\n     * @param {Object} state - 当前状态\r\n     * @param {Object} userInfo - 用户个人信息对象\r\n     * @param {string} userInfo.avatar - 用户头像\r\n     * @param {string} userInfo.name - 用户姓名\r\n     * @param {string} userInfo.gender - 用户性别\r\n     * @param {string} userInfo.selfIntroduction - 用户自我介绍\r\n     * @param {string} userInfo.wechatNumber - 用户微信号\r\n     * @param {string} userInfo.phoneNumber - 用户手机号\r\n     * @param {string} userInfo.password - 用户密码\r\n     */\r\n    UPDATE_USER_INFO(state, userInfo) {\r\n        const { \r\n            avatar, \r\n            name, \r\n            nickname,\r\n            gender, \r\n            selfIntroduction,\r\n            introduction, \r\n            wechatNumber,\r\n            wechat,\r\n            phoneNumber,\r\n            phone,\r\n            password,\r\n            role\r\n        } = userInfo;\r\n        \r\n        // 只更新提供的字段（支持不同字段名）\r\n        if (avatar !== undefined) state.avatar = avatar;\r\n        if (name !== undefined) state.name = name;\r\n        if (nickname !== undefined) state.name = nickname;\r\n        if (gender !== undefined) state.gender = gender;\r\n        if (selfIntroduction !== undefined) state.selfIntroduction = selfIntroduction;\r\n        if (introduction !== undefined) state.selfIntroduction = introduction;\r\n        if (wechatNumber !== undefined) state.wechatNumber = wechatNumber;\r\n        if (wechat !== undefined) state.wechatNumber = wechat;\r\n        if (phoneNumber !== undefined) state.phoneNumber = phoneNumber;\r\n        if (phone !== undefined) state.phoneNumber = phone;\r\n        if (password !== undefined) state.password = password;\r\n        \r\n        // 处理角色更新\r\n        if (role !== undefined) {\r\n            // 更新角色显示值\r\n            state.userInfo.role = role === 'teacher' ? '老师' : '学生';\r\n            // 保存角色代码到本地存储\r\n            uni.setStorageSync('userRole', role);\r\n        }\r\n        \r\n        // 保存到本地存储以便持久化\r\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\r\n            id: state.id,\r\n            avatar: state.avatar,\r\n            name: state.name,\r\n            gender: state.gender,\r\n            selfIntroduction: state.selfIntroduction,\r\n            wechatNumber: state.wechatNumber,\r\n            phoneNumber: state.phoneNumber,\r\n            role: uni.getStorageSync('userRole') || 'student'\r\n        }));\r\n    },\r\n    \r\n    /**\r\n     * 清除用户信息（用于登出）\r\n     * @param {Object} state - 当前状态\r\n     */\r\n    CLEAR_USER_INFO(state) {\r\n        // 重置所有用户信息为默认值\r\n        state.id = '';\r\n        state.avatar = '';\r\n        state.name = '';\r\n        state.gender = '';\r\n        state.selfIntroduction = '';\r\n        state.wechatNumber = '';\r\n        state.phoneNumber = '';\r\n        state.password = '';\r\n        \r\n        // 保持角色不变，只清除其他信息\r\n        const currentRole = state.userInfo.role;\r\n        state.userInfo = {\r\n            certificate: 0,\r\n            role: currentRole, // 保留当前角色\r\n            school: '',\r\n            major: '',\r\n            targetSchool: '',\r\n            targetMajor: '',\r\n            studentGrade: '',\r\n            teacherGrade: '',\r\n            teacherScore: 0,\r\n        };\r\n    },\r\n}; "],"names":["uni"],"mappings":"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"}