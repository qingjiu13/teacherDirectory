{"version":3,"file":"mutations.js","sources":["store/user/baseInfo/mutations.js"],"sourcesContent":["/**\n * baseInfo模块的mutations\n * @module store/user/baseInfo/mutations\n */\n\nexport default {\n    /**\n     * 更新用户角色\n     * @param {Object} state - 当前状态\n     * @param {string} role - 新的用户角色（学生或老师）\n     */\n    updateRole(state, role) {\n        console.log('updateRole mutation执行, 参数:', role);\n        // 更新显示的角色名称\n        state.userInfo.role = role === 'teacher' ? '老师' : '学生';\n        \n        // 保存到本地存储以便持久化\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\n            id: state.id,\n            avatar: state.avatar,\n            name: state.name,\n            gender: state.gender,\n            selfIntroduction: state.selfIntroduction,\n            wechatNumber: state.wechatNumber,\n            phoneNumber: state.phoneNumber,\n            role: role // 保存角色代码\n        }));\n        \n        // 同步更新角色到本地存储\n        uni.setStorageSync('userRole', role);\n        console.log('角色更新完成, 新角色:', state.userInfo.role);\n    },\n    \n    /**\n     * 设置用户完整信息\n     * @param {Object} state - 当前状态\n     * @param {Object} userData - 服务器返回的用户信息\n     */\n    SET_USER_INFO(state, userData) {\n        console.log('SET_USER_INFO mutation执行, 入参:', userData);\n        console.log('更新前state:', {\n            id: state.id,\n            name: state.name,\n            avatar: state.avatar\n        });\n        \n        // 更新基本信息\n        state.id = userData.id || '';\n        state.avatar = userData.avatar || '';\n        state.name = userData.nickname || userData.name || '';\n        state.gender = userData.gender || '';\n        state.selfIntroduction = userData.introduction || userData.selfIntroduction || '';\n        state.wechatNumber = userData.wechat || userData.wechatNumber || '';\n        state.phoneNumber = userData.phone || userData.phoneNumber || '';\n        state.password = userData.password || '';\n        \n        // 获取角色代码\n        const roleCode = userData.role || 'student';\n        \n        // 更新用户扩展信息\n        if (userData.userInfo) {\n            state.userInfo = {\n                ...state.userInfo,\n                ...userData.userInfo\n            };\n            \n            // 确保角色显示值与角色代码一致\n            if (!userData.userInfo.role || userData.userInfo.role === roleCode) {\n                state.userInfo.role = roleCode === 'teacher' ? '老师' : '学生';\n            }\n        } else {\n            // 如果没有提供 userInfo，仍然更新角色显示值\n            state.userInfo.role = roleCode === 'teacher' ? '老师' : '学生';\n        }\n        \n        // 保存到本地存储以便持久化\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\n            id: state.id,\n            avatar: state.avatar,\n            name: state.name,\n            gender: state.gender,\n            selfIntroduction: state.selfIntroduction,\n            wechatNumber: state.wechatNumber,\n            phoneNumber: state.phoneNumber,\n            role: roleCode\n        }));\n        \n        // 同步更新角色到本地存储\n        uni.setStorageSync('userRole', roleCode);\n        \n        console.log('更新后state:', {\n            id: state.id,\n            name: state.name,\n            avatar: state.avatar,\n            role: state.userInfo.role\n        });\n    },\n    \n    /**\n     * 更新用户个人信息\n     * @param {Object} state - 当前状态\n     * @param {Object} userInfo - 用户个人信息对象\n     * @param {string} userInfo.avatar - 用户头像\n     * @param {string} userInfo.name - 用户姓名\n     * @param {string} userInfo.gender - 用户性别\n     * @param {string} userInfo.selfIntroduction - 用户自我介绍\n     * @param {string} userInfo.wechatNumber - 用户微信号\n     * @param {string} userInfo.phoneNumber - 用户手机号\n     * @param {string} userInfo.password - 用户密码\n     */\n    UPDATE_USER_INFO(state, userInfo) {\n        console.log('UPDATE_USER_INFO mutation执行, 入参:', userInfo);\n        \n        const { \n            avatar, \n            name, \n            nickname,\n            gender, \n            selfIntroduction,\n            introduction, \n            wechatNumber,\n            wechat,\n            phoneNumber,\n            phone,\n            password,\n            role\n        } = userInfo;\n        \n        // 只更新提供的字段（支持不同字段名）\n        if (avatar !== undefined) state.avatar = avatar;\n        if (name !== undefined) state.name = name;\n        if (nickname !== undefined) state.name = nickname;\n        if (gender !== undefined) state.gender = gender;\n        if (selfIntroduction !== undefined) state.selfIntroduction = selfIntroduction;\n        if (introduction !== undefined) state.selfIntroduction = introduction;\n        if (wechatNumber !== undefined) state.wechatNumber = wechatNumber;\n        if (wechat !== undefined) state.wechatNumber = wechat;\n        if (phoneNumber !== undefined) state.phoneNumber = phoneNumber;\n        if (phone !== undefined) state.phoneNumber = phone;\n        if (password !== undefined) state.password = password;\n        \n        // 处理角色更新\n        if (role !== undefined) {\n            // 更新角色显示值\n            state.userInfo.role = role === 'teacher' ? '老师' : '学生';\n            // 保存角色代码到本地存储\n            uni.setStorageSync('userRole', role);\n        }\n        \n        // 保存到本地存储以便持久化\n        uni.setStorageSync('userBaseInfo', JSON.stringify({\n            id: state.id,\n            avatar: state.avatar,\n            name: state.name,\n            gender: state.gender,\n            selfIntroduction: state.selfIntroduction,\n            wechatNumber: state.wechatNumber,\n            phoneNumber: state.phoneNumber,\n            role: uni.getStorageSync('userRole') || 'student'\n        }));\n        \n        console.log('更新后state:', {\n            id: state.id,\n            name: state.name,\n            avatar: state.avatar\n        });\n    },\n    \n    /**\n     * 更新用户个人档案（UPDATE_USER_INFO的别名，用于modify.vue页面）\n     * @param {Object} state - 当前状态\n     * @param {Object} profileData - 用户个人档案数据\n     */\n    UPDATE_USER_PROFILE(state, profileData) {\n        console.log('UPDATE_USER_PROFILE mutation执行, 入参:', profileData);\n        \n        // 直接调用UPDATE_USER_INFO mutation，保持逻辑一致\n        this.commit('user/baseInfo/UPDATE_USER_INFO', profileData);\n        \n        // 发送事件通知更新成功\n        uni.$emit('userProfileUpdated', {\n            timestamp: Date.now(),\n            data: profileData\n        });\n    },\n    \n    /**\n     * 清除用户信息（用于登出）\n     * @param {Object} state - 当前状态\n     */\n    CLEAR_USER_INFO(state) {\n        console.log('CLEAR_USER_INFO mutation执行');\n        \n        // 重置所有用户信息为默认值\n        state.id = '';\n        state.avatar = '';\n        state.name = '';\n        state.gender = '';\n        state.selfIntroduction = '';\n        state.wechatNumber = '';\n        state.phoneNumber = '';\n        state.password = '';\n        \n        // 保持角色不变，只清除其他信息\n        const currentRole = state.userInfo.role;\n        state.userInfo = {\n            certificate: 0,\n            role: currentRole, // 保留当前角色\n            school: '',\n            major: '',\n            targetSchool: '',\n            targetMajor: '',\n            studentGrade: '',\n            teacherGrade: '',\n            teacherScore: 0,\n        };\n        \n        console.log('清除后state:', {\n            id: state.id,\n            name: state.name,\n            avatar: state.avatar,\n            role: state.userInfo.role\n        });\n    },\n    \n    /**\n     * 更新用户扩展信息\n     * @param {Object} state - 当前模块状态\n     * @param {Object} userInfoData - 用户扩展信息\n     */\n    UPDATE_USER_INFO_DATA(state, userInfoData) {\n        console.log('UPDATE_USER_INFO_DATA mutation执行, 入参:', userInfoData);\n        \n        // 更新userInfo对象中的字段\n        state.userInfo = {\n            ...state.userInfo,\n            ...userInfoData\n        };\n        \n        // 保存到本地存储\n        uni.setStorageSync('userInfoData', JSON.stringify(state.userInfo));\n        \n        console.log('更新后userInfo:', state.userInfo);\n    }\n}; "],"names":["uni"],"mappings":"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"}