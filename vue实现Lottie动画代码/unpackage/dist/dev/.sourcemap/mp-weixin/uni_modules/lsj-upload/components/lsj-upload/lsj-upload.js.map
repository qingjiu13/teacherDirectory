{"version":3,"file":"lsj-upload.js","sources":["uni_modules/lsj-upload/components/lsj-upload/lsj-upload.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTov56CU5biI5b2V5LiO5YW25LuW5Lq65YWx5Lqr5paH5Lu2L3RlYWNoZXJEaXJlY3RvcnkvdnVl5a6e546wTG90dGll5Yqo55S75Luj56CBL3VuaV9tb2R1bGVzL2xzai11cGxvYWQvY29tcG9uZW50cy9sc2otdXBsb2FkL2xzai11cGxvYWQudnVl"],"sourcesContent":["<template>\n\t<view class=\"lsj-file\" :style=\"[getStyles]\">\n\t\t<view ref=\"lsj\" class=\"hFile\" :style=\"[getStyles]\" @click=\"onClick\">\n\t\t\t<slot><view class=\"defview\" :style=\"[getStyles]\">附件上传</view></slot>\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"uts\">\n// 查看文档：https://ext.dcloud.net.cn/plugin?id=5459\nimport {LsjFile} from './LsjFile.js' \nexport default {\n\tname: 'Lsj-upload',\n\tprops: {\n\t\t// 打印日志\n\t\tdebug: {type: Boolean,default: false},\n\t\t// 是否去重文件（同名文件覆盖）\n\t\tdistinct: {type: Boolean,default: false},\n\t\t// 自动上传\n\t\tinstantly: {type: Boolean,default: false},\n\t\t// 上传接口参数设置\n\t\toption: {type: Object,default: ()=>{}},\n\t\t// 文件大小上限\n\t\tsize: { type: Number, default: 10 },\n\t\t// 文件选择个数上限,超出后不触发点击\n\t\tcount: { type: Number, default: 9 },\n\t\t// 是否允许多选文件\n\t\tmultiple: {type:Boolean, default: true},\n\t\t// 允许上传的文件格式（多个以逗号隔开）\n\t\tformats: { type: String, default:''},\n\t\t// input file选择限制\n\t\taccept: {type: String,default: ''},\n\t\t// 微信选择文件类型 \n\t\t//all=从所有文件选择，\n\t\t//video=只能选择视频文件，\n\t\t//image=只能选择图片文件，\n\t\t//file=可以选择除了图片和视频之外的其它的文件\n\t\twxFileType: { type: String, default: 'all' },\n\t\t// webviewID需唯一，不同窗口也不要同Id\n\t\tchildId: { type: String, default: 'lsjUpload'  },\n\t\t// 文件选择触发面宽度\n\t\twidth: { type: String, default: '100%' },\n\t\t// 文件选择触发面高度\n\t\theight: { type: String, default: '80rpx' },\n\t\t\n\t\t// top,left,bottom,right仅position=absolute时才需要传入\n\t\ttop: { type: [String, Number], default: '' },\n\t\tleft: { type: [String, Number], default: '' },\n\t\tbottom: { type: [String, Number], default: '' },\n\t\tright: { type: [String, Number], default: '' },\n\t\t// nvue不支持跟随窗口滚动\n\t\tposition: { \n\t\t\ttype: String,\n\n\n\n\n\t\t\tdefault: 'static',\n\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\t\n\t\t}\n\t},\n\tcomputed: {\n\t\tgetStyles() {\n\t\t\tlet styles = {\n\t\t\t\twidth: this.width,\n\t\t\t\theight: this.height\n\t\t\t}\n\t\t\tif (this.position == 'absolute') {\n\t\t\t\tstyles['top'] = this.top\n\t\t\t\tstyles['bottom'] = this.bottom\n\t\t\t\tstyles['left'] = this.left\n\t\t\t\tstyles['right'] = this.right\n\t\t\t\tstyles['position'] = 'fixed'\n\t\t\t}\n\n\t\t\treturn styles\n\t\t}\n\t},\n\twatch: {\n\t\toption(v) {\n\n\n\n\t\t}\n\t},\n\tupdated() {\n\n\n\n\n\n\t},\n\tcreated() {\n\t\tuni.$on('$upload-show',this.emitShow);\n\t\tuni.$on('$upload-hide',this.hide);\n\t},\n\tbeforeDestroy() {\n\t\tuni.$off('$upload-show',this.emitShow);\n\t\tuni.$off('$upload-hide',this.hide);\n\n\n\n\t},\n\tmounted() {\n\t\tlet pages = getCurrentPages();\n\t\tthis.myRoute = pages[pages.length - 1].route;\n\t\tthis._size = 0;\n\t\tlet WEBID = 'lsj_' + this.childId + new Date().getTime();\n\t\tthis.lsjFile = new LsjFile({\n\t\t\tid: WEBID,\n\t\t\tdebug: this.debug,\n\t\t\twidth: this.width,\n\t\t\theight: this.height,\n\t\t\toption: this.option,\n\t\t\tinstantly: this.instantly,\n\t\t\t// 限制条件\n\t\t\tprohibited: {\n\t\t\t\t// 是否去重\n\t\t\t\tdistinct: this.distinct,\n\t\t\t\t// 大小\n\t\t\t\tsize: this.size,\n\t\t\t\t// 允许上传的格式\n\t\t\t\tformats: this.formats,\n\t\t\t\t// 限制选择的格式\n\t\t\t\taccept: this.accept,\n\t\t\t\tcount: this.count,\n\t\t\t\t// 是否多选\n\t\t\t\tmultiple: this.multiple,\n\t\t\t},\n\t\t\tonchange: this.onchange,\n\t\t\tonprogress: this.onprogress,\n\t\t});\n\t\tthis.create();\n\t},\n\tmethods: {\n\t\tsetFiles(array) {\n\t\t\tif (array instanceof Map) {\n\t\t\t\tfor (let [key, item] of array) {\n\t\t\t\t\titem['progress'] = 100;\n\t\t\t\t\titem['type'] = 'success';\n\t\t\t\t\tthis.lsjFile.files.set(key,item);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (Array.isArray(array)) {\n\t\t\t\tarray.forEach(item=>{\n\t\t\t\t\tif (item.name) { \n\t\t\t\t\t\titem['progress'] = 100;\n\t\t\t\t\t\titem['type'] = 'success';\n\t\t\t\t\t\tthis.lsjFile.files.set(item.name,item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.onchange(this.lsjFile.files);\n\t\t},\n\t\tsetData() {\n\t\t\tthis.lsjFile&&this.lsjFile.setData(...arguments);\n\t\t},\n\t\tgetDomStyles(callback) {\n\n\t\t\tlet view = uni\n\t\t\t\t.createSelectorQuery()\n\t\t\t\t.in(this)\n\t\t\t\t.select('.lsj-file')\n\t\t\tview.fields(\n\t\t\t\t{\n\t\t\t\t\tsize: true,\n\t\t\t\t\trect: true\n\t\t\t\t},\n\t\t\t\t({ height, width, top, left, right, bottom }) => {\n\t\t\t\t\tuni.createSelectorQuery()\n\t\t\t\t\t.selectViewport()\n\t\t\t\t\t.scrollOffset(({ scrollTop }) => {\n\t\t\t\t\t\treturn callback({\n\t\t\t\t\t\t\ttop: parseInt(top) + parseInt(scrollTop) + 'px',\n\t\t\t\t\t\t\tleft: parseInt(left) + 'px',\n\t\t\t\t\t\t\twidth: parseInt(width) + 'px',\n\t\t\t\t\t\t\theight: parseInt(height) + 'px'\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.exec()\n\t\t\t\t}\n\t\t\t).exec()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t},\n\t\temitShow() {\n\t\t\tlet pages = getCurrentPages();\n\t\t\tlet route = pages[pages.length - 1].route;\n\t\t\tif (route === this.myRoute) {\n\t\t\t\treturn this.show();\n\t\t\t}\n\t\t},\n\t\tshow() {\n\t\t\tthis.debug&&uni.__f__('log','at uni_modules/lsj-upload/components/lsj-upload/lsj-upload.vue:211','触发show函数');\n\t\t\tif (this._size && (this._size >= this.count)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isShow = true;\n\n\n\n\n\n\n\n\n\t\t},\n\t\thide() {\n\t\t\tthis.debug&&uni.__f__('log','at uni_modules/lsj-upload/components/lsj-upload/lsj-upload.vue:226','触发hide函数');\n\t\t\tthis.isShow = false;\n\n\n\n\n\n\n\n\n\n\n\n\t\t},\n\t\t/**\n\t\t * 手动提交上传\n\t\t * @param {string}name 文件名称，不传则上传所有type等于waiting和fail的文件\n\t\t */\n\t\tupload(name) {\n\t\t\tthis.lsjFile&&this.lsjFile.upload(name);\n\t\t},\n\t\t/**\n\t\t * @returns {Map} 已选择的文件Map集\n\t\t */\n\t\tonchange(files) {\n\t\t\tthis.$emit('change',files);\n\t\t\tthis._size = files.size;\n\t\t\treturn files.size >= this.count ? this.hide() : this.show();\n\t\t},\n\t\t/**\n\t\t * @returns {object} 当前上传中的对象\n\t\t */\n\t\tonprogress(item,end=false) {\n\t\t\tthis.$emit('progress',item);\n\t\t\tif (end) {\n\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\tthis.$emit('uploadEnd',item);\n\t\t\t\t},0);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 移除组件内缓存的某条数据\n\t\t * @param {string}name 文件名称,不指定默认清除所有文件\n\t\t */\n\t\tclear(name) {\n\t\t\tthis.lsjFile.clear(name);\n\t\t},\n\t\t// 创建选择器\n\t\tcreate() {\n\t\t\t// 若iOS端服务端处理不了跨域就将hybrid目录内的html放到服务端去，并将此处path改成服务器上的地址\n\t\t\tlet path = '/uni_modules/lsj-upload/hybrid/html/uploadFile.html';\n\t\t\tlet dom = this.lsjFile.create(path);\n\n\n\n\n\t\t\tthis.show();\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t},\n\t\t// 点击选择附件\n\t\tonClick() {\n\t\t\tif (this._size >= this.count) {\n\t\t\t\tthis.toast(`只允许上传${this.count}个文件`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\n\t\t\tif (!this.isShow) {return;}\n\t\t\tlet count = this.count - this._size;\n\t\t\tthis.lsjFile.chooseMessageFile(this.wxFileType,count);\n\n\t\t},\n\t\ttoast(msg) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: msg,\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t}\n\t}\n}\n</script>\n\n<style scoped>\n.lsj-file {\n\tdisplay: inline-block;\n}\n.defview {\n\tbackground-color: #007aff;\n\tcolor: #fff;\n\tborder-radius: 10rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 28rpx;\n}\n.hFile {\n\tposition: relative;\n\toverflow: hidden;\n}\n</style>\n","import Component from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/uni_modules/lsj-upload/components/lsj-upload/lsj-upload.vue'\nwx.createComponent(Component)"],"names":["_sfc_main","defineComponent","styles","v","uni","pages","WEBID","LsjFile","array","array_1","__values","array_1_1","_b","__read","key","item","callback","_a","height","width","top","left","scrollTop","name","files","end","count","msg","Component"],"mappings":"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"}