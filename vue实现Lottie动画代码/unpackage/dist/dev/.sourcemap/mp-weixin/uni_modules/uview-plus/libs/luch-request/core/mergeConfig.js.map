{"version":3,"file":"mergeConfig.js","sources":["uni_modules/uview-plus/libs/luch-request/core/mergeConfig.js"],"sourcesContent":["import { deepMerge, isUndefined } from '../utils'\n\n/**\n * 合并局部配置优先的配置，如果局部有该配置项则用局部，如果全局有该配置项则用全局\n * @param {Array} keys - 配置项\n * @param {Object} globalsConfig - 当前的全局配置\n * @param {Object} config2 - 局部配置\n * @return {{}}\n */\nconst mergeKeys = (keys, globalsConfig, config2) => {\n    const config = {}\n    keys.forEach((prop) => {\n        if (!isUndefined(config2[prop])) {\n            config[prop] = config2[prop]\n        } else if (!isUndefined(globalsConfig[prop])) {\n            config[prop] = globalsConfig[prop]\n        }\n    })\n    return config\n}\n/**\n *\n * @param globalsConfig - 当前实例的全局配置\n * @param config2 - 当前的局部配置\n * @return - 合并后的配置\n */\nexport default (globalsConfig, config2 = {}) => {\n    const method = config2.method || globalsConfig.method || 'GET'\n    let config = {\n        baseURL: globalsConfig.baseURL || '',\n        method,\n        url: config2.url || '',\n        params: config2.params || {},\n        custom: { ...(globalsConfig.custom || {}), ...(config2.custom || {}) },\n        header: deepMerge(globalsConfig.header || {}, config2.header || {})\n    }\n    const defaultToConfig2Keys = ['getTask', 'validateStatus']\n    config = { ...config, ...mergeKeys(defaultToConfig2Keys, globalsConfig, config2) }\n\n    // eslint-disable-next-line no-empty\n    if (method === 'DOWNLOAD') {\n    // #ifdef H5 || APP-PLUS\n        if (!isUndefined(config2.timeout)) {\n            config.timeout = config2.timeout\n        } else if (!isUndefined(globalsConfig.timeout)) {\n            config.timeout = globalsConfig.timeout\n        }\n    // #endif\n    } else if (method === 'UPLOAD') {\n        delete config.header['content-type']\n        delete config.header['Content-Type']\n        const uploadKeys = [\n            // #ifdef APP-PLUS || H5\n            'files',\n            // #endif\n            // #ifdef MP-ALIPAY\n            'fileType',\n            // #endif\n            // #ifdef H5\n            'file',\n            // #endif\n            'filePath',\n            'name',\n            // #ifdef H5 || APP-PLUS\n            'timeout',\n            // #endif\n            'formData'\n        ]\n        uploadKeys.forEach((prop) => {\n            if (!isUndefined(config2[prop])) {\n                config[prop] = config2[prop]\n            }\n        })\n        // #ifdef H5 || APP-PLUS\n        if (isUndefined(config.timeout) && !isUndefined(globalsConfig.timeout)) {\n            config.timeout = globalsConfig.timeout\n        }\n    // #endif\n    } else {\n        const defaultsKeys = [\n            'data',\n            // #ifdef H5 || APP-PLUS || MP-ALIPAY || MP-WEIXIN\n            'timeout',\n            // #endif\n            'dataType',\n            // #ifndef MP-ALIPAY\n            'responseType',\n            // #endif\n            // #ifdef APP-PLUS\n            'sslVerify',\n            // #endif\n            // #ifdef H5\n            'withCredentials',\n            // #endif\n            // #ifdef APP-PLUS\n            'firstIpv4'\n            // #endif\n        ]\n        config = { ...config, ...mergeKeys(defaultsKeys, globalsConfig, config2) }\n    }\n\n    return config\n}\n"],"names":["mergeKeys","keys","globalsConfig","config2","config","prop","isUndefined","mergeConfig","method","deepMerge"],"mappings":"4CASMA,EAAY,CAACC,EAAMC,EAAeC,IAAY,CAChD,MAAMC,EAAS,CAAE,EACjB,OAAAH,EAAK,QAASI,GAAS,CACdC,EAAW,YAACH,EAAQE,CAAI,CAAC,EAElBC,EAAW,YAACJ,EAAcG,CAAI,CAAC,IACvCD,EAAOC,CAAI,EAAIH,EAAcG,CAAI,GAFjCD,EAAOC,CAAI,EAAIF,EAAQE,CAAI,CAIvC,CAAK,EACMD,CACX,EAOAG,EAAe,CAACL,EAAeC,EAAU,KAAO,CAC5C,MAAMK,EAASL,EAAQ,QAAUD,EAAc,QAAU,MACzD,IAAIE,EAAS,CACT,QAASF,EAAc,SAAW,GAClC,OAAAM,EACA,IAAKL,EAAQ,KAAO,GACpB,OAAQA,EAAQ,QAAU,CAAE,EAC5B,OAAQ,CAAE,GAAID,EAAc,QAAU,CAAE,EAAG,GAAIC,EAAQ,QAAU,EAAK,EACtE,OAAQM,EAAS,UAACP,EAAc,QAAU,CAAA,EAAIC,EAAQ,QAAU,EAAE,CACrE,EAED,OAAAC,EAAS,CAAE,GAAGA,EAAQ,GAAGJ,EADI,CAAC,UAAW,gBAAgB,EACAE,EAAeC,CAAO,CAAG,EAG9EK,IAAW,aAQJA,IAAW,UAClB,OAAOJ,EAAO,OAAO,cAAc,EACnC,OAAOA,EAAO,OAAO,cAAc,EAChB,CAUf,WACA,OAIA,UACH,EACU,QAASC,GAAS,CACpBC,EAAW,YAACH,EAAQE,CAAI,CAAC,IAC1BD,EAAOC,CAAI,EAAIF,EAAQE,CAAI,EAE3C,CAAS,GA0BDD,EAAS,CAAE,GAAGA,EAAQ,GAAGJ,EAnBJ,CACjB,OAEA,UAEA,WAEA,cAWH,EACgDE,EAAeC,CAAO,CAAG,GAGvEC,CACX"}