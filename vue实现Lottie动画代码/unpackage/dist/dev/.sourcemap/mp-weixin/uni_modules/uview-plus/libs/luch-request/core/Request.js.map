{"version":3,"file":"Request.js","sources":["uni_modules/uview-plus/libs/luch-request/core/Request.js"],"sourcesContent":["/**\n * @Class Request\n * @description luch-request http请求插件\n * @version 3.0.7\n * @Author lu-ch\n * @Date 2021-09-04\n * @Email webwork.s@qq.com\n * 文档: https://www.quanzhan.co/luch-request/\n * github: https://github.com/lei-mu/luch-request\n * DCloud: http://ext.dcloud.net.cn/plugin?id=392\n * HBuilderX: beat-3.0.4 alpha-3.0.4\n */\n\nimport dispatchRequest from './dispatchRequest'\nimport InterceptorManager from './InterceptorManager'\nimport mergeConfig from './mergeConfig'\nimport defaults from './defaults'\nimport { isPlainObject } from '../utils'\nimport clone from '../utils/clone'\n\nexport default class Request {\n    /**\n   * @param {Object} arg - 全局配置\n   * @param {String} arg.baseURL - 全局根路径\n   * @param {Object} arg.header - 全局header\n   * @param {String} arg.method = [GET|POST|PUT|DELETE|CONNECT|HEAD|OPTIONS|TRACE] - 全局默认请求方式\n   * @param {String} arg.dataType = [json] - 全局默认的dataType\n   * @param {String} arg.responseType = [text|arraybuffer] - 全局默认的responseType。支付宝小程序不支持\n   * @param {Object} arg.custom - 全局默认的自定义参数\n   * @param {Number} arg.timeout - 全局默认的超时时间，单位 ms。默认60000。H5(HBuilderX 2.9.9+)、APP(HBuilderX 2.9.9+)、微信小程序（2.10.0）、支付宝小程序\n   * @param {Boolean} arg.sslVerify - 全局默认的是否验证 ssl 证书。默认true.仅App安卓端支持（HBuilderX 2.3.3+）\n   * @param {Boolean} arg.withCredentials - 全局默认的跨域请求时是否携带凭证（cookies）。默认false。仅H5支持（HBuilderX 2.6.15+）\n   * @param {Boolean} arg.firstIpv4 - 全DNS解析时优先使用ipv4。默认false。仅 App-Android 支持 (HBuilderX 2.8.0+)\n   * @param {Function(statusCode):Boolean} arg.validateStatus - 全局默认的自定义验证器。默认statusCode >= 200 && statusCode < 300\n   */\n    constructor(arg = {}) {\n        if (!isPlainObject(arg)) {\n            arg = {}\n            console.warn('设置全局参数必须接收一个Object')\n        }\n        this.config = clone({ ...defaults, ...arg })\n        this.interceptors = {\n            request: new InterceptorManager(),\n            response: new InterceptorManager()\n        }\n    }\n\n    /**\n   * @Function\n   * @param {Request~setConfigCallback} f - 设置全局默认配置\n   */\n    setConfig(f) {\n        this.config = f(this.config)\n    }\n\n    middleware(config) {\n        config = mergeConfig(this.config, config)\n        const chain = [dispatchRequest, undefined]\n        let promise = Promise.resolve(config)\n\n        this.interceptors.request.forEach((interceptor) => {\n            chain.unshift(interceptor.fulfilled, interceptor.rejected)\n        })\n\n        this.interceptors.response.forEach((interceptor) => {\n            chain.push(interceptor.fulfilled, interceptor.rejected)\n        })\n\n        while (chain.length) {\n            promise = promise.then(chain.shift(), chain.shift())\n        }\n\n        return promise\n    }\n\n    /**\n   * @Function\n   * @param {Object} config - 请求配置项\n   * @prop {String} options.url - 请求路径\n   * @prop {Object} options.data - 请求参数\n   * @prop {Object} [options.responseType = config.responseType] [text|arraybuffer] - 响应的数据类型\n   * @prop {Object} [options.dataType = config.dataType] - 如果设为 json，会尝试对返回的数据做一次 JSON.parse\n   * @prop {Object} [options.header = config.header] - 请求header\n   * @prop {Object} [options.method = config.method] - 请求方法\n   * @returns {Promise<unknown>}\n   */\n    request(config = {}) {\n        return this.middleware(config)\n    }\n\n    get(url, options = {}) {\n        return this.middleware({\n            url,\n            method: 'GET',\n            ...options\n        })\n    }\n\n    post(url, data, options = {}) {\n        return this.middleware({\n            url,\n            data,\n            method: 'POST',\n            ...options\n        })\n    }\n\n    // #ifndef MP-ALIPAY\n    put(url, data, options = {}) {\n        return this.middleware({\n            url,\n            data,\n            method: 'PUT',\n            ...options\n        })\n    }\n\n    // #endif\n\n    // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-BAIDU\n    delete(url, data, options = {}) {\n        return this.middleware({\n            url,\n            data,\n            method: 'DELETE',\n            ...options\n        })\n    }\n\n    // #endif\n\n    // #ifdef H5 || MP-WEIXIN\n    connect(url, data, options = {}) {\n        return this.middleware({\n            url,\n            data,\n            method: 'CONNECT',\n            ...options\n        })\n    }\n\n    // #endif\n\n    // #ifdef  H5 || MP-WEIXIN || MP-BAIDU\n    head(url, data, options = {}) {\n        return this.middleware({\n            url,\n            data,\n            method: 'HEAD',\n            ...options\n        })\n    }\n\n    // #endif\n\n    // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-BAIDU\n    options(url, data, options = {}) {\n        return this.middleware({\n            url,\n            data,\n            method: 'OPTIONS',\n            ...options\n        })\n    }\n\n    // #endif\n\n    // #ifdef H5 || MP-WEIXIN\n    trace(url, data, options = {}) {\n        return this.middleware({\n            url,\n            data,\n            method: 'TRACE',\n            ...options\n        })\n    }\n\n    // #endif\n\n    upload(url, config = {}) {\n        config.url = url\n        config.method = 'UPLOAD'\n        return this.middleware(config)\n    }\n\n    download(url, config = {}) {\n        config.url = url\n        config.method = 'DOWNLOAD'\n        return this.middleware(config)\n    }\n}\n\n/**\n * setConfig回调\n * @return {Object} - 返回操作后的config\n * @callback Request~setConfigCallback\n * @param {Object} config - 全局默认config\n */\n"],"names":["Request","arg","isPlainObject","uni","clone","defaults","InterceptorManager","f","config","mergeConfig","chain","dispatchRequest","promise","interceptor","url","options","data"],"mappings":"wPAoBe,MAAMA,CAAQ,CAezB,YAAYC,EAAM,GAAI,CACbC,EAAAA,cAAcD,CAAG,IAClBA,EAAM,CAAE,EACRE,EAAAA,MAAa,MAAA,OAAA,iEAAA,oBAAoB,GAErC,KAAK,OAASC,EAAK,MAAC,CAAE,GAAGC,EAAQ,SAAE,GAAGJ,EAAK,EAC3C,KAAK,aAAe,CAChB,QAAS,IAAIK,EAAAA,mBACb,SAAU,IAAIA,EAAAA,kBACjB,CACJ,CAMD,UAAUC,EAAG,CACT,KAAK,OAASA,EAAE,KAAK,MAAM,CAC9B,CAED,WAAWC,EAAQ,CACfA,EAASC,EAAW,YAAC,KAAK,OAAQD,CAAM,EACxC,MAAME,EAAQ,CAACC,EAAe,gBAAE,MAAS,EACzC,IAAIC,EAAU,QAAQ,QAAQJ,CAAM,EAUpC,IARA,KAAK,aAAa,QAAQ,QAASK,GAAgB,CAC/CH,EAAM,QAAQG,EAAY,UAAWA,EAAY,QAAQ,CACrE,CAAS,EAED,KAAK,aAAa,SAAS,QAASA,GAAgB,CAChDH,EAAM,KAAKG,EAAY,UAAWA,EAAY,QAAQ,CAClE,CAAS,EAEMH,EAAM,QACTE,EAAUA,EAAQ,KAAKF,EAAM,QAASA,EAAM,OAAO,EAGvD,OAAOE,CACV,CAaD,QAAQJ,EAAS,GAAI,CACjB,OAAO,KAAK,WAAWA,CAAM,CAChC,CAED,IAAIM,EAAKC,EAAU,GAAI,CACnB,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,OAAQ,MACR,GAAGC,CACf,CAAS,CACJ,CAED,KAAKD,EAAKE,EAAMD,EAAU,CAAA,EAAI,CAC1B,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,KAAAE,EACA,OAAQ,OACR,GAAGD,CACf,CAAS,CACJ,CAGD,IAAID,EAAKE,EAAMD,EAAU,CAAA,EAAI,CACzB,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,KAAAE,EACA,OAAQ,MACR,GAAGD,CACf,CAAS,CACJ,CAKD,OAAOD,EAAKE,EAAMD,EAAU,CAAA,EAAI,CAC5B,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,KAAAE,EACA,OAAQ,SACR,GAAGD,CACf,CAAS,CACJ,CAKD,QAAQD,EAAKE,EAAMD,EAAU,CAAA,EAAI,CAC7B,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,KAAAE,EACA,OAAQ,UACR,GAAGD,CACf,CAAS,CACJ,CAKD,KAAKD,EAAKE,EAAMD,EAAU,CAAA,EAAI,CAC1B,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,KAAAE,EACA,OAAQ,OACR,GAAGD,CACf,CAAS,CACJ,CAKD,QAAQD,EAAKE,EAAMD,EAAU,CAAA,EAAI,CAC7B,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,KAAAE,EACA,OAAQ,UACR,GAAGD,CACf,CAAS,CACJ,CAKD,MAAMD,EAAKE,EAAMD,EAAU,CAAA,EAAI,CAC3B,OAAO,KAAK,WAAW,CACnB,IAAAD,EACA,KAAAE,EACA,OAAQ,QACR,GAAGD,CACf,CAAS,CACJ,CAID,OAAOD,EAAKN,EAAS,GAAI,CACrB,OAAAA,EAAO,IAAMM,EACbN,EAAO,OAAS,SACT,KAAK,WAAWA,CAAM,CAChC,CAED,SAASM,EAAKN,EAAS,GAAI,CACvB,OAAAA,EAAO,IAAMM,EACbN,EAAO,OAAS,WACT,KAAK,WAAWA,CAAM,CAChC,CACL"}