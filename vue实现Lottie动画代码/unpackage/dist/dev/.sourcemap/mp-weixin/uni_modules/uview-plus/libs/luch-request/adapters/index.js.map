{"version":3,"file":"index.js","sources":["uni_modules/uview-plus/libs/luch-request/adapters/index.js"],"sourcesContent":["import buildURL from '../helpers/buildURL'\nimport buildFullPath from '../core/buildFullPath'\nimport settle from '../core/settle'\nimport { isUndefined } from '../utils'\n\n/**\n * 返回可选值存在的配置\n * @param {Array} keys - 可选值数组\n * @param {Object} config2 - 配置\n * @return {{}} - 存在的配置项\n */\nconst mergeKeys = (keys, config2) => {\n    const config = {}\n    keys.forEach((prop) => {\n        if (!isUndefined(config2[prop])) {\n            config[prop] = config2[prop]\n        }\n    })\n    return config\n}\nexport default (config) => new Promise((resolve, reject) => {\n    const fullPath = buildURL(buildFullPath(config.baseURL, config.url), config.params)\n    const _config = {\n        url: fullPath,\n        header: config.header,\n        complete: (response) => {\n            config.fullPath = fullPath\n            response.config = config\n            try {\n                // 对可能字符串不是json 的情况容错\n                if (typeof response.data === 'string') {\n                    response.data = JSON.parse(response.data)\n                }\n                // eslint-disable-next-line no-empty\n            } catch (e) {\n            }\n            settle(resolve, reject, response)\n        }\n    }\n    let requestTask\n    if (config.method === 'UPLOAD') {\n        delete _config.header['content-type']\n        delete _config.header['Content-Type']\n        const otherConfig = {\n        // #ifdef MP-ALIPAY\n            fileType: config.fileType,\n            // #endif\n            filePath: config.filePath,\n            name: config.name\n        }\n        const optionalKeys = [\n        // #ifdef APP-PLUS || H5\n            'files',\n            // #endif\n            // #ifdef H5\n            'file',\n            // #endif\n            // #ifdef H5 || APP-PLUS\n            'timeout',\n            // #endif\n            'formData'\n        ]\n        requestTask = uni.uploadFile({ ..._config, ...otherConfig, ...mergeKeys(optionalKeys, config) })\n    } else if (config.method === 'DOWNLOAD') {\n        // #ifdef H5 || APP-PLUS\n        if (!isUndefined(config.timeout)) {\n            _config.timeout = config.timeout\n        }\n        // #endif\n        requestTask = uni.downloadFile(_config)\n    } else {\n        const optionalKeys = [\n            'data',\n            'method',\n            // #ifdef H5 || APP-PLUS || MP-ALIPAY || MP-WEIXIN\n            'timeout',\n            // #endif\n            'dataType',\n            // #ifndef MP-ALIPAY\n            'responseType',\n            // #endif\n            // #ifdef APP-PLUS\n            'sslVerify',\n            // #endif\n            // #ifdef H5\n            'withCredentials',\n            // #endif\n            // #ifdef APP-PLUS\n            'firstIpv4'\n        // #endif\n        ]\n        requestTask = uni.request({ ..._config, ...mergeKeys(optionalKeys, config) })\n    }\n    if (config.getTask) {\n        config.getTask(requestTask, config)\n    }\n})\n"],"names":["mergeKeys","keys","config2","config","prop","isUndefined","adapter","resolve","reject","fullPath","buildURL","buildFullPath","_config","response","settle","requestTask","otherConfig","optionalKeys","uni"],"mappings":"kMAWMA,EAAY,CAACC,EAAMC,IAAY,CACjC,MAAMC,EAAS,CAAE,EACjB,OAAAF,EAAK,QAASG,GAAS,CACdC,EAAW,YAACH,EAAQE,CAAI,CAAC,IAC1BD,EAAOC,CAAI,EAAIF,EAAQE,CAAI,EAEvC,CAAK,EACMD,CACX,EACeG,EAACH,GAAW,IAAI,QAAQ,CAACI,EAASC,IAAW,CACxD,MAAMC,EAAWC,WAASC,EAAAA,cAAcR,EAAO,QAASA,EAAO,GAAG,EAAGA,EAAO,MAAM,EAC5ES,EAAU,CACZ,IAAKH,EACL,OAAQN,EAAO,OACf,SAAWU,GAAa,CACpBV,EAAO,SAAWM,EAClBI,EAAS,OAASV,EAClB,GAAI,CAEI,OAAOU,EAAS,MAAS,WACzBA,EAAS,KAAO,KAAK,MAAMA,EAAS,IAAI,EAG/C,MAAW,CACX,CACDC,SAAOP,EAASC,EAAQK,CAAQ,CACnC,CACJ,EACD,IAAIE,EACJ,GAAIZ,EAAO,SAAW,SAAU,CAC5B,OAAOS,EAAQ,OAAO,cAAc,EACpC,OAAOA,EAAQ,OAAO,cAAc,EACpC,MAAMI,EAAc,CAIhB,SAAUb,EAAO,SACjB,KAAMA,EAAO,IAChB,EACKc,EAAe,CAUjB,UACH,EACDF,EAAcG,EAAG,MAAC,WAAW,CAAE,GAAGN,EAAS,GAAGI,EAAa,GAAGhB,EAAUiB,EAAcd,CAAM,CAAC,CAAE,CACvG,SAAeA,EAAO,SAAW,WAMzBY,EAAcG,EAAAA,MAAI,aAAaN,CAAO,MACnC,CACH,MAAMK,EAAe,CACjB,OACA,SAEA,UAEA,WAEA,cAWH,EACDF,EAAcG,EAAAA,MAAI,QAAQ,CAAE,GAAGN,EAAS,GAAGZ,EAAUiB,EAAcd,CAAM,EAAG,CAC/E,CACGA,EAAO,SACPA,EAAO,QAAQY,EAAaZ,CAAM,CAE1C,CAAC"}