{"version":3,"file":"settings.js","sources":["pagesMine/settings/settings.vue","../../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNNaW5lXHNldHRpbmdzXHNldHRpbmdzLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"background-image\">\r\n    <image\r\n      class=\"background-image-img\"\r\n      src=\"/static/image/bgPicture/background1.png\"\r\n      mode=\"aspectFill\" alt=\"背景图\"\r\n    />\r\n  </view>\r\n  <view class=\"background-image\">\r\n    <image\r\n      class=\"background-image-img\"\r\n      src=\"/static/image/bgPicture/background.png\"\r\n      mode=\"aspectFill\" alt=\"背景图\"\r\n    />\r\n  </view>\r\n  <Header :title=\"'设置'\" @back=\"handleBack\"/>\r\n  <view class=\"container\">\r\n    <view class=\"settings-list\">\r\n      <!-- 切换身份 -->\r\n      <view class=\"settings-item\" @click=\"handleSwitchRole\">\r\n        <view class=\"icon-circle-info\">\r\n          <image src=\"/pagesMine/static/settings/exchange.png\" class=\"icon\" mode=\"widthFix\" />\r\n        </view>\r\n        <text class=\"settings-text\">切换身份（当前：{{isTeacher ? '老师' : '学生'}}）</text>\r\n      </view>\r\n      <!--修改个人信息-->\r\n      <view class=\"settings-item\" @click=\"handleModifyInfo\">\r\n        <view class=\"icon-circle-info\">\r\n          <image src=\"/pagesMine/static/settings/exchange.png\" class=\"icon\" mode=\"widthFix\" />\r\n        </view>\r\n        <text class=\"settings-text\">修改个人信息</text>\r\n      </view>\r\n      <!-- 退出登录 -->\r\n      <view class=\"settings-item\" @click=\"handleLogout\" v-if=\"isLoggedIn\">\r\n        <view class=\"icon-circle-info\">\r\n          <image src=\"/pagesMine/static/settings/logout.png\" class=\"icon\" mode=\"widthFix\" />\r\n        </view>\r\n        <text class=\"settings-text\">退出登录</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n/**\r\n * @description 设置页面\r\n */\r\nimport { Navigator } from '@/router/Router.js';\r\nimport store from '@/store';\r\nimport { mapGetters } from 'vuex';\r\nimport Header from '@/components/navigationTitleBar/header';\r\n\r\nexport default {\r\n  components: {\r\n    Header\r\n  },\r\n  data() {\r\n    return {\r\n      isLoggedIn: false, \r\n      switching: false,  // 角色切换中状态\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      isTeacher: 'user/baseInfo/isTeacher',\r\n      userRole: 'user/baseInfo/userRole',\r\n      profile: 'user/baseInfo/profile'\r\n    }),\r\n    isStudent() {\r\n      return !this.isTeacher;\r\n    }\r\n  },\r\n  onLoad() {\r\n    // 检查登录状态\r\n    this.isLoggedIn = store.getters['user/baseInfo/id'] !== '';\r\n  },\r\n  methods: {\r\n    handleBack() {\r\n      Navigator.toMine();\r\n    },\r\n    // 直接调用store的dispatch方法，替代mapActions\r\n    /**\r\n     * @description 处理修改个人信息\r\n     */\r\n    handleModifyInfo() {\r\n      Navigator.toModify();\r\n    },\r\n    /**\r\n     * @description 处理切换身份\r\n     */\r\n    handleSwitchRole() {\r\n      if (this.switching) return;\r\n      \r\n      // 确定切换的目标角色\r\n      const newRole = this.isTeacher ? 'student' : 'teacher';\r\n      \r\n      uni.showModal({\r\n        title: '切换身份',\r\n        content: `确定要切换到${newRole === 'teacher' ? '老师' : '学生'}模式吗？`,\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              this.switching = true;\r\n              \r\n              // 使用store.dispatch调用action\r\n              await store.dispatch('user/baseInfo/updateRole', newRole);\r\n              \r\n              uni.showToast({\r\n                title: newRole === 'teacher' ? '已切换为老师模式' : '已切换为学生模式',\r\n                icon: 'none'\r\n              });\r\n              \r\n              // 返回到\"我的\"页面并刷新\r\n              setTimeout(() => {\r\n                Navigator.reLaunch('/pagesMine/mine/mine_common');\r\n              }, 1500);\r\n            } catch (error) {\r\n              uni.__f__('error','at pagesMine/settings/settings.vue:118','切换角色失败:', error);\r\n              uni.showToast({\r\n                title: '切换角色失败',\r\n                icon: 'none'\r\n              });\r\n            } finally {\r\n              this.switching = false;\r\n            }\r\n          }\r\n        }\r\n      });\r\n    },\r\n    /**\r\n     * @description 处理退出登录\r\n     */\r\n    handleLogout() {\r\n      uni.showModal({\r\n        title: '提示',\r\n        content: '确定要退出登录吗？',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              // 使用store.dispatch调用登出action\r\n              await store.dispatch('user/baseInfo/logout');\r\n              \r\n              uni.showToast({\r\n                title: '已退出登录',\r\n                icon: 'success'\r\n              });\r\n              \r\n              // 增加延迟确保数据清除\r\n              setTimeout(() => {\r\n                // 返回到\"我的\"页面\r\n                Navigator.reLaunch('/pagesMine/mine/mine_common');\r\n              }, 1500);\r\n            } catch (error) {\r\n              uni.__f__('error','at pagesMine/settings/settings.vue:154','退出登录时出错:', error);\r\n              uni.showToast({\r\n                title: '退出登录时出错',\r\n                icon: 'none'\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  min-height: 100%;\r\n  background-color: transparent;\r\n  padding-top: 20rpx;\r\n}\r\n.background-image {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  z-index: 0;\r\n  pointer-events: none;\r\n}\r\n.background-image-img {\r\n  width: 100vw;\r\n  height: 100vh;\r\n  object-fit: cover;\r\n  display: block;\r\n}\r\n.settings-list {\r\n  width: 100%;\r\n}\r\n\r\n.settings-item {\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n  padding: 20rpx 0;\r\n  border-bottom: 2rpx solid rgba(217, 217, 217, 1);\r\n  min-height: 100rpx;\r\n}\r\n\r\n.icon-circle-info {\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n\r\n.icon {\r\n  width: 60rpx;\r\n  margin-left: 60rpx;\r\n}\r\n\r\n\r\n\r\n.settings-text {\r\n  height: 25rpx;\r\n  width: 100%;\r\n  font-size: 25rpx;\r\n  color: rgba(0, 0, 0, 1);\r\n  font-family: PingFang SC;\r\n  font-weight: 500;\r\n  line-height: 100%;\r\n  letter-spacing: -1.1rpx;\r\n  margin-left: 30rpx;\r\n}\r\n</style>","import MiniProgramPage from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/pagesMine/settings/settings.vue'\nwx.createPage(MiniProgramPage)"],"names":["Header","_sfc_main","defineComponent","mapGetters","store","Navigator","newRole","uni","res","__awaiter","error","MiniProgramPage"],"mappings":"iKAkDOA,EAAY,IAAA,gDAEnBC,EAAeC,kBAAA,CACb,WAAY,CACV,OAAAF,CACD,EACD,MAAI,CACF,MAAO,CACL,WAAY,GACZ,UAAW,GAEd,EACD,SAAQ,OAAA,OAAA,OAAA,OAAA,GACHG,EAAAA,WAAW,IAAA,cAAA,CACZ,UAAW,0BACX,SAAU,yBACV,QAAS,uBACV,CAAA,CAAA,CAAC,GACF,WAAS,CACP,MAAO,CAAC,KAAK,SACf,EACD,EACD,QAAM,CAEJ,KAAK,WAAaC,EAAK,MAAC,QAAQ,kBAAkB,IAAM,EACzD,EACD,QAAS,CACP,YAAU,CACRC,EAAS,UAAC,OAAM,CACjB,EAKD,kBAAgB,CACdA,EAAS,UAAC,SAAQ,CACnB,EAID,kBAAgB,CACd,GAAI,KAAK,UAAW,OAAM,KAG1B,MAAMC,EAAU,KAAK,UAAY,UAAY,UAE7CC,QAAI,UAAU,IAAA,cAAA,CACZ,MAAO,OACP,QAAS,SAASD,IAAY,UAAY,KAAO,IAAI,OACrD,QAAgBE,GAAGC,EAAAA,UAAA,KAAA,OAAA,OAAA,WAAA,CACjB,GAAID,EAAI,QACN,GAAI,CACF,KAAK,UAAY,GAGjB,MAAMJ,QAAM,SAAS,2BAA4BE,CAAO,EAExDC,EAAAA,MAAI,UAAU,CACZ,MAAOD,IAAY,UAAY,WAAa,WAC5C,KAAM,MACP,CAAA,EAGD,WAAW,IAAA,CACTD,YAAU,SAAS,6BAA6B,CACjD,EAAE,IAAI,CACP,OAAOK,EAAO,CACdH,EAAG,MAAC,MAAM,QAAQ,yCAAyC,UAAWG,CAAK,EAC3EH,EAAAA,MAAI,UAAU,CACZ,MAAO,SACP,KAAM,MACP,CAAA,CACH,QAAU,CACR,KAAK,UAAY,EACnB,CAEJ,CAAA,CACD,CAAA,CAAA,CACF,EAID,cAAY,CACVA,QAAI,UAAU,IAAA,cAAA,CACZ,MAAO,KACP,QAAS,YACT,QAAgBC,GAAGC,EAAAA,UAAA,KAAA,OAAA,OAAA,WAAA,CACjB,GAAID,EAAI,QACN,GAAI,CAEF,MAAMJ,EAAK,MAAC,SAAS,sBAAsB,EAE3CG,EAAAA,MAAI,UAAU,CACZ,MAAO,QACP,KAAM,SACP,CAAA,EAGD,WAAW,IAAA,CAETF,YAAU,SAAS,6BAA6B,CACjD,EAAE,IAAI,CACP,OAAOK,EAAO,CACdH,EAAG,MAAC,MAAM,QAAQ,yCAAyC,WAAYG,CAAK,EAC5EH,EAAAA,MAAI,UAAU,CACZ,MAAO,UACP,KAAM,MACP,CAAA,CACH,CAEJ,CAAA,CACD,CAAA,CAAA,CACH,CACF,EACF,6dCnKA,GAAG,WAAWI,CAAe"}