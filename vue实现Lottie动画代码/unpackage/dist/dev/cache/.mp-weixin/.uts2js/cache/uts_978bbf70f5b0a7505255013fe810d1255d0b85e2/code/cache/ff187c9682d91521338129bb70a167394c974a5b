{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description 用户资料修改页面\n */\nimport { mapState, mapGetters, mapActions, mapMutations } from 'vuex';\nimport { Navigator } from '@/router/Router.js';\nexport default defineComponent({\n    data() {\n        return {\n            userInfo: new UTSJSONObject({\n                avatar: '',\n                nickname: '',\n                introduction: '',\n                gender: '',\n                phone: '',\n                wechat: '',\n                password: '未设置'\n            }),\n            updating: false,\n            originalData: null // 用于存储原始数据以便对比变更\n        };\n    },\n    computed: new UTSJSONObject(Object.assign(Object.assign(Object.assign({}, mapState('user/baseInfo', new UTSJSONObject({\n        storeId: (state = null) => { return state.id; },\n        storeAvatar: (state = null) => { return state.avatar; },\n        storeName: (state = null) => { return state.name; },\n        storeGender: (state = null) => { return state.gender; },\n        storeSelfIntroduction: (state = null) => { return state.selfIntroduction; },\n        storeWechatNumber: (state = null) => { return state.wechatNumber; },\n        storePhoneNumber: (state = null) => { return state.phoneNumber; },\n        storePassword: (state = null) => { return state.password; },\n        storeUserRole: (state = null) => { return state.userInfo.role; }\n    }))), mapGetters('user/baseInfo', [\n        'profile',\n        'userRole',\n        'isTeacher'\n    ])), { \n        // 计算属性：数据是否已修改\n        isDataChanged() {\n            if (!this.originalData)\n                return false;\n            return UTS.JSON.stringify(this.userInfo) !== UTS.JSON.stringify(this.originalData);\n        } })),\n    onLoad() {\n        // 初始化用户信息\n        this.initUserInfo();\n    },\n    onShow() {\n        // 每次页面显示时重新加载数据\n        this.initUserInfo();\n    },\n    methods: Object.assign(Object.assign(Object.assign({}, mapActions('user/baseInfo', [\n        'getUserInfo'\n    ])), mapMutations('user/baseInfo', [\n        'UPDATE_USER_PROFILE'\n    ])), { \n        /**\n         * @description 初始化用户信息\n         */\n        initUserInfo() {\n            return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    uni.__f__('log', 'at pages/mine/modify.vue:170', '初始化用户信息...');\n                    // 从store获取用户数据\n                    this.userInfo = {\n                        avatar: this.storeAvatar || '',\n                        nickname: this.storeName || '',\n                        introduction: this.storeSelfIntroduction || '',\n                        gender: this.storeGender || '',\n                        phone: this.storePhoneNumber || '',\n                        wechat: this.storeWechatNumber || '',\n                        password: this.storePassword || '未设置'\n                    };\n                    uni.__f__('log', 'at pages/mine/modify.vue:183', '从store获取的用户信息:', this.userInfo);\n                    // 保存原始数据副本用于后续比较\n                    this.originalData = UTS.JSON.parse(UTS.JSON.stringify(this.userInfo));\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/modify.vue:188', '获取用户信息失败', error);\n                    uni.showToast({\n                        title: '获取用户信息失败',\n                        icon: 'none'\n                    });\n                }\n            });\n        },\n        /**\n         * @description 选择头像\n         */\n        chooseAvatar() {\n            uni.chooseImage(new UTSJSONObject({\n                count: 1,\n                sizeType: ['compressed'],\n                sourceType: ['album', 'camera'],\n                success: (res) => {\n                    const tempFilePath = res.tempFilePaths[0];\n                    // 在实际应用中，这里应该上传图片到服务器\n                    // 这里仅做演示，直接使用临时路径\n                    this.userInfo.avatar = tempFilePath;\n                }\n            }));\n        }, \n        /**\n         * @description 保存用户资料\n         */\n        saveProfile() {\n            return __awaiter(this, void 0, void 0, function* () {\n                // 基本验证\n                if (!this.userInfo.nickname) {\n                    uni.showToast({\n                        title: '昵称不能为空',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                // 手机号格式验证\n                if (this.userInfo.phone && !/^1\\d{10}$/.test(this.userInfo.phone)) {\n                    uni.showToast({\n                        title: '手机号格式不正确',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                // 检查数据是否有变更\n                if (!this.isDataChanged) {\n                    uni.showToast({\n                        title: '未检测到数据变更',\n                        icon: 'none'\n                    });\n                    setTimeout(() => {\n                        uni.navigateBack();\n                    }, 1500);\n                    return Promise.resolve(null);\n                }\n                try {\n                    this.updating = true;\n                    uni.__f__('log', 'at pages/mine/modify.vue:250', '开始保存用户资料...');\n                    // 准备要更新的数据\n                    const profileData = new UTSJSONObject({\n                        avatar: this.userInfo.avatar,\n                        nickname: this.userInfo.nickname,\n                        name: this.userInfo.nickname,\n                        selfIntroduction: this.userInfo.introduction,\n                        introduction: this.userInfo.introduction,\n                        gender: this.userInfo.gender,\n                        phoneNumber: this.userInfo.phone,\n                        phone: this.userInfo.phone,\n                        wechatNumber: this.userInfo.wechat,\n                        password: this.userInfo.password // 添加password字段到更新数据中\n                    });\n                    uni.__f__('log', 'at pages/mine/modify.vue:267', '要更新的用户资料:', profileData);\n                    // 使用mutation更新store中的数据\n                    this.UPDATE_USER_PROFILE(profileData);\n                    // 显示成功提示\n                    uni.showToast({\n                        title: '保存成功',\n                        icon: 'success'\n                    });\n                    // 更新原始数据，防止重复提交\n                    this.originalData = UTS.JSON.parse(UTS.JSON.stringify(this.userInfo));\n                    // 返回个人页面\n                    setTimeout(() => {\n                        uni.navigateBack();\n                    }, 1500);\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/modify.vue:286', '保存失败', error);\n                    uni.showToast({\n                        title: error.message || '保存失败',\n                        icon: 'none'\n                    });\n                }\n                finally {\n                    this.updating = false;\n                }\n            });\n        } })\n});\n//# sourceMappingURL=E:/yanshilu%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pages/mine/modify.vue?vue&type=script&lang.uts.js.map","references":["E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/vuex/types/index.d.ts","E:/yanshilu重新来过/vue实现Lottie动画代码/router/Router.js"],"uniExtApis":["uni.__f__","uni.showToast","uni.chooseImage","uni.navigateBack"],"map":"{\"version\":3,\"file\":\"modify.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"modify.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
