{"code":"import { defineComponent } from \"vue\";\nimport ChoiceSelected from '../../components/combobox/combobox';\nimport store from '../../store';\nexport default defineComponent({\n    components: {\n        ChoiceSelected,\n    },\n    data() {\n        return {\n            formData: new UTSJSONObject({\n                nickname: '',\n                gender: '男',\n                phone: '',\n                schoolIndex: -1,\n                majorIndex: -1,\n                targetSchoolIndex: -1,\n                targetMajorIndex: -1,\n                gradeIndex: -1\n            }),\n            schoolList: [\n                '北京大学',\n                '清华大学',\n                '复旦大学',\n                '上海交通大学',\n                '浙江大学',\n            ],\n            majorList: [\n                '计算机科学',\n                '电子工程',\n                '机械工程',\n                '经济学',\n                '法学',\n            ],\n            gradeList: ['大一', '大二', '大三', '大四', '研一', '研二', '研三'],\n            userRole: '' // 默认空值\n        };\n    },\n    computed: new UTSJSONObject({\n    // 不使用mapState而是通过methods直接获取\n    }),\n    methods: {\n        handleSchoolSelect(index = null) {\n            this.formData.schoolIndex = index;\n        },\n        handleMajorSelect(index = null) {\n            this.formData.majorIndex = index;\n        },\n        handleTargetSchoolSelect(index = null) {\n            this.formData.targetSchoolIndex = index;\n        },\n        handleTargetMajorSelect(index = null) {\n            this.formData.targetMajorIndex = index;\n        },\n        handleGradeSelect(index = null) {\n            this.formData.gradeIndex = index;\n        },\n        /**\n         * 获取当前用户角色\n         * @returns {string} 用户角色\n         */\n        getUserRole() {\n            try {\n                // 优先从store获取\n                if (store.state && store.state.user && store.state.user.baseInfo) {\n                    return store.state.user.baseInfo.userInfo.role;\n                }\n                // 从本地存储中获取备份\n                const localRole = uni.getStorageSync('userRole');\n                // 将存储的角色代码转换为显示名称\n                if (localRole === 'teacher') {\n                    return '老师';\n                }\n                else if (localRole === 'student') {\n                    return '学生';\n                }\n                else {\n                    return '学生'; // 默认为学生角色\n                }\n            }\n            catch (error) {\n                uni.__f__('error', 'at pages/login/login_detail.vue:192', '获取用户角色出错:', error);\n                return '学生'; // 默认返回学生角色\n            }\n        },\n        /**\n         * 提交表单信息\n         */\n        submitForm() {\n            // 验证表单内容\n            if (!this.validateForm()) {\n                return null;\n            }\n            try {\n                // 获取当前角色\n                const currentRole = this.getUserRole();\n                // 转换为角色代码用于存储\n                const roleCode = currentRole === '老师' ? 'teacher' : 'student';\n                // 构建用户信息对象\n                const userInfo = new UTSJSONObject({\n                    name: this.formData.nickname,\n                    gender: this.formData.gender,\n                    phoneNumber: this.formData.phone,\n                    role: roleCode,\n                    userInfo: new UTSJSONObject({\n                        school: this.schoolList[this.formData.schoolIndex] || '',\n                        major: this.majorList[this.formData.majorIndex] || '',\n                        studentGrade: currentRole === '学生' ? this.gradeList[this.formData.gradeIndex] || '' : '',\n                        teacherGrade: currentRole === '老师' ? this.gradeList[this.formData.gradeIndex] || '' : '',\n                    })\n                });\n                // 如果是学生角色，添加目标学校和目标专业\n                if (currentRole === '学生') {\n                    userInfo.userInfo.targetSchool = this.schoolList[this.formData.targetSchoolIndex] || '';\n                    userInfo.userInfo.targetMajor = this.majorList[this.formData.targetMajorIndex] || '';\n                }\n                // 使用导入的store实例更新用户信息\n                store.commit('user/baseInfo/UPDATE_USER_INFO', userInfo);\n                // 提示成功\n                uni.showToast({\n                    title: '信息保存成功',\n                    icon: 'success'\n                });\n                // 跳转到下一个页面\n                setTimeout(() => {\n                    uni.switchTab({\n                        url: '/pages/index/index'\n                    });\n                }, 1500);\n            }\n            catch (error) {\n                uni.__f__('error', 'at pages/login/login_detail.vue:247', '提交表单时出错:', error);\n                uni.showToast({\n                    title: '保存失败，请重试',\n                    icon: 'none'\n                });\n            }\n        },\n        /**\n         * 验证表单内容\n         * @returns {boolean} 验证是否通过\n         */\n        validateForm() {\n            if (!this.formData.nickname) {\n                uni.showToast({\n                    title: '请输入昵称',\n                    icon: 'none'\n                });\n                return false;\n            }\n            if (!this.formData.phone) {\n                uni.showToast({\n                    title: '请输入手机号',\n                    icon: 'none'\n                });\n                return false;\n            }\n            if (this.formData.schoolIndex === -1) {\n                uni.showToast({\n                    title: '请选择学校',\n                    icon: 'none'\n                });\n                return false;\n            }\n            if (this.formData.majorIndex === -1) {\n                uni.showToast({\n                    title: '请选择专业',\n                    icon: 'none'\n                });\n                return false;\n            }\n            // 学生角色时验证目标学校和目标专业\n            if (this.userRole === '学生') {\n                if (this.formData.targetSchoolIndex === -1) {\n                    uni.showToast({\n                        title: '请选择目标学校',\n                        icon: 'none'\n                    });\n                    return false;\n                }\n                if (this.formData.targetMajorIndex === -1) {\n                    uni.showToast({\n                        title: '请选择目标专业',\n                        icon: 'none'\n                    });\n                    return false;\n                }\n            }\n            if (this.formData.gradeIndex === -1) {\n                uni.showToast({\n                    title: '请选择年级',\n                    icon: 'none'\n                });\n                return false;\n            }\n            return true;\n        }\n    },\n    created() {\n        // 初始化用户角色\n        this.userRole = this.getUserRole();\n        uni.__f__('log', 'at pages/login/login_detail.vue:319', '当前用户角色:', this.userRole);\n    },\n    // 监听页面显示时更新角色\n    onShow() {\n        this.userRole = this.getUserRole();\n    }\n});\n//# sourceMappingURL=E:/yanshilu%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87/%E9%92%88%E5%AF%B9%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E7%9A%84%E4%BF%AE%E6%94%B9/pages/login/login_detail.vue?vue&type=script&lang.uts.js.map","references":["E:/yanshilu重新来过/针对无法启动的修改/components/combobox/combobox.vue.ts","E:/yanshilu重新来过/针对无法启动的修改/store/index.js"],"uniExtApis":["uni.getStorageSync","uni.__f__","uni.showToast","uni.switchTab"],"map":"{\"version\":3,\"file\":\"login_detail.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"login_detail.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\";AACA,OAAO,cAAc,MAAM,oCAAoC,CAAA;AAC/D,OAAO,KAAK,MAAM,aAAa,CAAA;AAE/B,+BAAe;IACb,UAAU,EAAE;QACV,cAAc;KACf;IACD,IAAI;QACF,OAAO;YACL,QAAQ,oBAAE;gBACR,QAAQ,EAAE,EAAE;gBACZ,MAAM,EAAE,GAAG;gBACX,KAAK,EAAE,EAAE;gBACT,WAAW,EAAE,CAAC,CAAC;gBACf,UAAU,EAAE,CAAC,CAAC;gBACd,iBAAiB,EAAE,CAAC,CAAC;gBACrB,gBAAgB,EAAE,CAAC,CAAC;gBACpB,UAAU,EAAE,CAAC,CAAC;aACf,CAAA;YACD,UAAU,EAAE;gBACV,MAAM;gBACN,MAAM;gBACN,MAAM;gBACN,QAAQ;gBACR,MAAM;aACP;YACD,SAAS,EAAE;gBACT,OAAO;gBACP,MAAM;gBACN,MAAM;gBACN,KAAK;gBACL,IAAI;aACL;YACD,SAAS,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;YACrD,QAAQ,EAAE,EAAE,CAAE,OAAO;SACtB,CAAC;IACJ,CAAC;IACD,QAAQ,oBAAE;IACR,6BAA6B;KAC9B,CAAA;IACD,OAAO,EAAE;QACP,kBAAkB,CAAC,KAAK,OAAA;YACtB,IAAI,CAAC,QAAQ,CAAC,WAAW,GAAG,KAAK,CAAC;QACpC,CAAC;QACD,iBAAiB,CAAC,KAAK,OAAA;YACrB,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,KAAK,CAAC;QACnC,CAAC;QACD,wBAAwB,CAAC,KAAK,OAAA;YAC5B,IAAI,CAAC,QAAQ,CAAC,iBAAiB,GAAG,KAAK,CAAC;QAC1C,CAAC;QACD,uBAAuB,CAAC,KAAK,OAAA;YAC3B,IAAI,CAAC,QAAQ,CAAC,gBAAgB,GAAG,KAAK,CAAC;QACzC,CAAC;QACD,iBAAiB,CAAC,KAAK,OAAA;YACrB,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,KAAK,CAAC;QACnC,CAAC;QACD;;;WAGG;QACH,WAAW;YACT,IAAI;gBACF,aAAa;gBACb,IAAI,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE;oBAChE,OAAO,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC;iBAChD;gBAED,aAAa;gBACb,MAAM,SAAS,GAAG,GAAG,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;gBACjD,kBAAkB;gBAClB,IAAI,SAAS,KAAK,SAAS,EAAE;oBAC3B,OAAO,IAAI,CAAC;iBACb;qBAAM,IAAI,SAAS,KAAK,SAAS,EAAE;oBAClC,OAAO,IAAI,CAAC;iBACb;qBAAM;oBACL,OAAO,IAAI,CAAC,CAAC,UAAU;iBACxB;aACF;YAAC,OAAO,KAAK,EAAE;gBACd,GAAG,CAAC,KAAK,CAAC,OAAO,EAAC,qCAAqC,EAAC,WAAW,EAAE,KAAK,CAAC,CAAC;gBAC5E,OAAO,IAAI,CAAC,CAAC,WAAW;aACzB;QACH,CAAC;QACD;;WAEG;QACH,UAAU;YACR,SAAS;YACT,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE;gBACxB,YAAO;aACR;YAED,IAAI;gBACF,SAAS;gBACT,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;gBACvC,cAAc;gBACd,MAAM,QAAQ,GAAG,WAAW,KAAK,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC;gBAE9D,WAAW;gBACX,MAAM,QAAQ,qBAAG;oBACf,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ;oBAC5B,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM;oBAC5B,WAAW,EAAE,IAAI,CAAC,QAAQ,CAAC,KAAK;oBAChC,IAAI,EAAE,QAAQ;oBACd,QAAQ,oBAAE;wBACR,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,EAAE;wBACxD,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,EAAE;wBACrD,YAAY,EAAE,WAAW,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE;wBACxF,YAAY,EAAE,WAAW,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE;qBACzF,CAAA;iBACF,CAAA,CAAC;gBAEF,sBAAsB;gBACtB,IAAI,WAAW,KAAK,IAAI,EAAE;oBACxB,QAAQ,CAAC,QAAQ,CAAC,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;oBACxF,QAAQ,CAAC,QAAQ,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,EAAE,CAAC;iBACtF;gBAED,qBAAqB;gBACrB,KAAK,CAAC,MAAM,CAAC,gCAAgC,EAAE,QAAQ,CAAC,CAAC;gBAEzD,OAAO;gBACP,GAAG,CAAC,SAAS,CAAC;oBACZ,KAAK,EAAE,QAAQ;oBACf,IAAI,EAAE,SAAS;iBAChB,CAAC,CAAC;gBAEH,WAAW;gBACX,UAAU,CAAC;oBACT,GAAG,CAAC,SAAS,CAAC;wBACZ,GAAG,EAAE,oBAAoB;qBAC1B,CAAC,CAAC;gBACL,CAAC,EAAE,IAAI,CAAC,CAAC;aACV;YAAC,OAAO,KAAK,EAAE;gBACd,GAAG,CAAC,KAAK,CAAC,OAAO,EAAC,qCAAqC,EAAC,UAAU,EAAE,KAAK,CAAC,CAAC;gBAC3E,GAAG,CAAC,SAAS,CAAC;oBACZ,KAAK,EAAE,UAAU;oBACjB,IAAI,EAAE,MAAM;iBACb,CAAC,CAAC;aACJ;QACH,CAAC;QACD;;;WAGG;QACH,YAAY;YACV,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;gBAC3B,GAAG,CAAC,SAAS,CAAC;oBACZ,KAAK,EAAE,OAAO;oBACd,IAAI,EAAE,MAAM;iBACb,CAAC,CAAC;gBACH,OAAO,KAAK,CAAC;aACd;YACD,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;gBACxB,GAAG,CAAC,SAAS,CAAC;oBACZ,KAAK,EAAE,QAAQ;oBACf,IAAI,EAAE,MAAM;iBACb,CAAC,CAAC;gBACH,OAAO,KAAK,CAAC;aACd;YACD,IAAI,IAAI,CAAC,QAAQ,CAAC,WAAW,KAAK,CAAC,CAAC,EAAE;gBACpC,GAAG,CAAC,SAAS,CAAC;oBACZ,KAAK,EAAE,OAAO;oBACd,IAAI,EAAE,MAAM;iBACb,CAAC,CAAC;gBACH,OAAO,KAAK,CAAC;aACd;YACD,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,KAAK,CAAC,CAAC,EAAE;gBACnC,GAAG,CAAC,SAAS,CAAC;oBACZ,KAAK,EAAE,OAAO;oBACd,IAAI,EAAE,MAAM;iBACb,CAAC,CAAC;gBACH,OAAO,KAAK,CAAC;aACd;YAED,mBAAmB;YACnB,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,EAAE;gBAC1B,IAAI,IAAI,CAAC,QAAQ,CAAC,iBAAiB,KAAK,CAAC,CAAC,EAAE;oBAC1C,GAAG,CAAC,SAAS,CAAC;wBACZ,KAAK,EAAE,SAAS;wBAChB,IAAI,EAAE,MAAM;qBACb,CAAC,CAAC;oBACH,OAAO,KAAK,CAAC;iBACd;gBACD,IAAI,IAAI,CAAC,QAAQ,CAAC,gBAAgB,KAAK,CAAC,CAAC,EAAE;oBACzC,GAAG,CAAC,SAAS,CAAC;wBACZ,KAAK,EAAE,SAAS;wBAChB,IAAI,EAAE,MAAM;qBACb,CAAC,CAAC;oBACH,OAAO,KAAK,CAAC;iBACd;aACF;YAED,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,KAAK,CAAC,CAAC,EAAE;gBACnC,GAAG,CAAC,SAAS,CAAC;oBACZ,KAAK,EAAE,OAAO;oBACd,IAAI,EAAE,MAAM;iBACb,CAAC,CAAC;gBACH,OAAO,KAAK,CAAC;aACd;YACD,OAAO,IAAI,CAAC;QACd,CAAC;KACF;IACD,OAAO;QACL,UAAU;QACV,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QACnC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,qCAAqC,EAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IAClF,CAAC;IACD,cAAc;IACd,MAAM;QACJ,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;IACrC,CAAC;CACF,EAAC\"}"}
