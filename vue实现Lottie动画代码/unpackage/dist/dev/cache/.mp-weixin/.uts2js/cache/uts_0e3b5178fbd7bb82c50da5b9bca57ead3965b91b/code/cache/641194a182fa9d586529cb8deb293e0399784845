{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description 我的页面（通用）\n */\nimport { Navigator, MineRoutes } from '@/router/Router.js';\nimport TabBar from '../../../components/tab-bar/tab-bar.vue';\nimport store from '@/store/index.js';\nimport { USE_MOCK_DATA } from '../../../store/user/baseInfo/config.js';\nexport default defineComponent(new UTSJSONObject({\n    components: {\n        TabBar\n    },\n    data() {\n        return {\n            userName: '',\n            userData: new UTSJSONObject({}),\n            isLoggedIn: false,\n            MineRoutes,\n            isLoading: false,\n            useMockData: USE_MOCK_DATA\n        };\n    },\n    computed: new UTSJSONObject({\n        // 直接从store获取状态\n        profile() {\n            var _a;\n            try {\n                return ((_a = store === null || store === void 0 ? void 0 : store.getters) === null || _a === void 0 ? void 0 : _a['user/baseInfo/profile']) || new UTSJSONObject({});\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.vue:112', '获取profile失败', e);\n                return new UTSJSONObject({});\n            }\n        },\n        userRole() {\n            var _a;\n            try {\n                return ((_a = store === null || store === void 0 ? void 0 : store.getters) === null || _a === void 0 ? void 0 : _a['user/baseInfo/userRole']) || 'student';\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.vue:120', '获取userRole失败', e);\n                return 'student';\n            }\n        },\n        isTeacher() {\n            var _a;\n            try {\n                return ((_a = store === null || store === void 0 ? void 0 : store.getters) === null || _a === void 0 ? void 0 : _a['user/baseInfo/isTeacher']) || false;\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.vue:128', '获取isTeacher失败', e);\n                return false;\n            }\n        }\n    }),\n    onLoad() {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                // 优先从本地存储恢复用户令牌\n                this.ensureUserLogin();\n                yield this.loadUserData();\n            }\n            catch (error) {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.vue:140', 'onLoad错误:', error);\n            }\n        });\n    },\n    onShow() {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                const storedUserRole = uni.getStorageSync('userRole');\n                if (storedUserRole) {\n                    yield this.updateUserRole(storedUserRole);\n                    yield this.loadUserData();\n                }\n                else {\n                    if (!this.profile || !this.profile.nickname) {\n                        yield this.loadUserData();\n                    }\n                    else {\n                        this.userData = new UTSJSONObject(Object.assign({}, this.profile));\n                        this.userName = this.profile.nickname || '用户';\n                    }\n                }\n            }\n            catch (error) {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.vue:159', 'onShow错误:', error);\n            }\n        });\n    },\n    methods: new UTSJSONObject({\n        /**\n         * @description 确保用户已登录\n         */\n        ensureUserLogin() {\n            if (this.useMockData && !uni.getStorageSync('userId')) {\n                // 在模拟模式下，自动设置模拟用户ID和令牌\n                uni.setStorageSync('userId', '123456');\n                uni.setStorageSync('user-token', 'mock_token_for_testing');\n            }\n        },\n        /**\n         * @description 更新用户角色\n         * @param {string} role - 用户角色\n         */\n        updateUserRole(role = null) {\n            return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    if (store && typeof store.dispatch === 'function') {\n                        yield store.dispatch('user/baseInfo/updateRole', role);\n                    }\n                    else {\n                        uni.__f__('warn', 'at pages/mine/mine/mine_common.vue:184', 'store.dispatch不可用，使用本地存储');\n                        uni.setStorageSync('userRole', role);\n                    }\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/mine/mine_common.vue:188', '更新用户角色失败', error);\n                    try {\n                        if (store && typeof store.commit === 'function') {\n                            store.commit('user/baseInfo/updateRole', role);\n                        }\n                        uni.setStorageSync('userRole', role);\n                    }\n                    catch (e) {\n                        uni.__f__('error', 'at pages/mine/mine/mine_common.vue:195', '更新用户角色本地存储失败', e);\n                    }\n                }\n            });\n        },\n        /**\n         * @description 加载用户数据\n         */\n        loadUserData() {\n            return __awaiter(this, void 0, void 0, function* () {\n                this.isLoading = true;\n                try {\n                    // 确保用户已登录（模拟模式下）\n                    this.ensureUserLogin();\n                    yield this.syncUserDataFromVuex();\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/mine/mine_common.vue:212', '加载用户数据失败', error);\n                }\n                finally {\n                    this.isLoading = false;\n                }\n            });\n        },\n        /**\n         * @description 从Vuex同步用户数据\n         */\n        syncUserDataFromVuex() {\n            return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    if (store && typeof store.dispatch === 'function') {\n                        const result = yield store.dispatch('user/baseInfo/getUserInfo');\n                        if (result && result.nickname) {\n                            this.userData = new UTSJSONObject(Object.assign({}, result));\n                            this.userName = result.nickname || '用户';\n                            this.isLoggedIn = true;\n                        }\n                        else if (this.profile && this.profile.nickname) {\n                            this.userData = new UTSJSONObject(Object.assign({}, this.profile));\n                            this.userName = this.profile.nickname || '用户';\n                            this.isLoggedIn = true;\n                        }\n                    }\n                    else {\n                        // 如果store不可用，加载模拟数据\n                        this.loadMockDataFallback();\n                    }\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/mine/mine_common.vue:240', '同步用户数据失败', error);\n                    // 加载模拟数据作为回退方案\n                    this.loadMockDataFallback();\n                }\n            });\n        },\n        /**\n         * @description 加载模拟数据作为回退\n         */\n        loadMockDataFallback() {\n            if (this.useMockData) {\n                this.userData = new UTSJSONObject({\n                    avatar: '/static/image/tab-bar/default_avatar.png',\n                    nickname: '模拟用户',\n                    role: 'teacher'\n                });\n                this.userName = '模拟用户';\n                this.isLoggedIn = true;\n            }\n        },\n        /**\n         * @description 处理头像点击\n         */\n        handleAvatarClick() {\n            this.handleEditProfile();\n        },\n        /**\n         * @description 处理登录文本点击\n         */\n        handleLoginClick() {\n            if (this.isLoggedIn) {\n                this.handleEditProfile();\n            }\n            else {\n                // 未登录时导航到登录页\n                Navigator.toLogin();\n            }\n        },\n        /**\n         * @description 跳转到修改个人信息页面\n         */\n        handleEditProfile() {\n            Navigator.toModify();\n        },\n        /**\n         * @description 页面跳转方法\n         * @param {string} url - 目标页面路径\n         */\n        navigateTo(url = null) {\n            Navigator.navigateTo(url);\n        }\n    })\n}));\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pages/mine/mine/mine_common.vue?vue&type=script&lang.uts.js.map","references":["E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/router/Router.js","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/components/tab-bar/tab-bar.vue.ts","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/store/index.js","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/store/user/baseInfo/config.js"],"uniExtApis":["uni.__f__","uni.getStorageSync","uni.setStorageSync"],"map":"{\"version\":3,\"file\":\"mine_common.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"mine_common.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
