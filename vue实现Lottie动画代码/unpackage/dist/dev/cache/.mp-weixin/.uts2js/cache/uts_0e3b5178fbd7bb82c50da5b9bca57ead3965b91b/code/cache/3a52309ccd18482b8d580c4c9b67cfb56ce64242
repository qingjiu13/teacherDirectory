{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\nimport { Navigator, IndexRoutes } from '../../router/Router';\nimport { mapState, mapMutations, mapActions } from 'vuex';\nexport default defineComponent(new UTSJSONObject({\n    data() {\n        return {\n            hasLogin: false,\n            userInfo: new UTSJSONObject({\n                nickName: '',\n                avatarUrl: ''\n            }),\n            showAgreementModal: false,\n            showPrivacyModal: false,\n        };\n    },\n    computed: new UTSJSONObject(Object.assign({}, mapState('user/baseInfo', ['isRegistered', 'id', 'avatar', 'name', 'phoneNumber']))),\n    onLoad() {\n        this.checkLoginStatus();\n    },\n    methods: new UTSJSONObject(Object.assign(Object.assign(Object.assign({}, mapMutations('user/baseInfo', ['SET_USER_INFO'])), mapActions('user/baseInfo', ['updateUserInfo'])), { \n        // 检查登录状态\n        checkLoginStatus() {\n            const token = uni.getStorageSync('token');\n            if (token && this.isRegistered) {\n                this.hasLogin = true;\n                // 从Vuex获取用户信息\n                this.userInfo = {\n                    nickName: this.name,\n                    avatarUrl: this.avatar\n                };\n            }\n        },\n        /**\n         * 微信登录方法\n         * @returns {void}\n         */\n        onWxLogin() {\n            uni.showLoading({\n                title: '登录中...'\n            });\n            uni.login(new UTSJSONObject({\n                provider: 'weixin',\n                success: (res) => { return __awaiter(this, void 0, void 0, function* () {\n                    try {\n                        const result = yield uni.request({\n                            method: \"POST\",\n                            url: \"http://localhost:8080/users/auth/wechat\",\n                            data: new UTSJSONObject({\n                                code: res.code\n                            })\n                        });\n                        uni.__f__('log', 'at pages/login/wechat_login.vue:149', result);\n                        // 检查请求是否成功\n                        if (result.statusCode === 200 && result.data) {\n                            // 存储token到本地\n                            uni.setStorageSync('token', result.data.token);\n                            // 存储用户ID\n                            if (result.data.userId) {\n                                uni.setStorageSync('userId', result.data.userId);\n                                // 使用Vuex mutation更新用户ID\n                                this.SET_USER_INFO(new UTSJSONObject({\n                                    id: result.data.userId,\n                                    isRegistered: 1 // 标记为已注册\n                                }));\n                            }\n                            uni.hideLoading();\n                            // 提示登录成功\n                            uni.showToast({\n                                title: '登录成功',\n                                icon: 'success',\n                                duration: 1500\n                            });\n                            // 设置登录状态\n                            this.hasLogin = true;\n                            // 跳转到信息完善页面\n                            setTimeout(() => {\n                                Navigator.redirectTo('/pages/login/login_detail');\n                            }, 1500);\n                        }\n                        else {\n                            uni.hideLoading();\n                            uni.showToast({\n                                title: '登录失败，请重试',\n                                icon: 'none'\n                            });\n                        }\n                    }\n                    catch (error) {\n                        uni.__f__('error', 'at pages/login/wechat_login.vue:191', '登录请求失败', error);\n                        uni.hideLoading();\n                        uni.showToast({\n                            title: '登录失败，请重试',\n                            icon: 'none'\n                        });\n                    }\n                }); },\n                fail: (err) => {\n                    uni.__f__('error', 'at pages/login/wechat_login.vue:200', '微信登录失败', err);\n                    uni.hideLoading();\n                    uni.showToast({\n                        title: '登录失败，请重试',\n                        icon: 'none'\n                    });\n                }\n            }));\n        },\n        /**\n         * 根据注册状态跳转到相应页面\n         * @returns {void}\n         */\n        toHome() {\n            Navigator.redirectTo(IndexRoutes.INDEX);\n        },\n        /**\n         * 显示用户协议弹窗\n         * @returns {void}\n         */\n        showAgreement() {\n            this.showAgreementModal = true;\n        },\n        /**\n         * 显示隐私政策弹窗\n         * @returns {void}\n         */\n        showPrivacy() {\n            this.showPrivacyModal = true;\n        },\n        /**\n         * 关闭弹窗\n         * @param {string} type - 要关闭的弹窗类型（'agreement'或'privacy'）\n         * @returns {void}\n         */\n        closeModal(type = null) {\n            if (type === 'agreement') {\n                this.showAgreementModal = false;\n            }\n            else if (type === 'privacy') {\n                this.showPrivacyModal = false;\n            }\n        } }))\n}));\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pages/login/wechat_login.vue?vue&type=script&lang.uts.js.map","references":["E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/router/Router.js","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/vuex/types/index.d.ts"],"uniExtApis":["uni.getStorageSync","uni.showLoading","uni.login","uni.request","uni.__f__","uni.setStorageSync","uni.hideLoading","uni.showToast"],"map":"{\"version\":3,\"file\":\"wechat_login.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"wechat_login.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
