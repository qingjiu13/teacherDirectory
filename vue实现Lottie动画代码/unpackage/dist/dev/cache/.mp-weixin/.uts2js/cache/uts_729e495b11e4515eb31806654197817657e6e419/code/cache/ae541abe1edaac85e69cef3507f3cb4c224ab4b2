{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description 用户资料修改页面\n */\nimport { mapState, mapGetters, mapActions } from 'vuex';\nimport { Navigator } from '@/router/Router.js';\nexport default defineComponent({\n    data() {\n        return {\n            userInfo: new UTSJSONObject({\n                avatar: '',\n                nickname: '',\n                introduction: '',\n                gender: '',\n                phone: '',\n                wechat: '',\n                password: '未设置'\n            }),\n            updating: false\n        };\n    },\n    computed: new UTSJSONObject(Object.assign({}, mapGetters('user/baseInfo', [\n        'profile',\n        'userRole',\n        'isTeacher'\n    ]))),\n    watch: {\n        updateLoading(val = null) {\n            this.updating = val;\n        }\n    },\n    onLoad() {\n        // 初始化用户信息\n        this.initUserInfo();\n    },\n    methods: Object.assign(Object.assign({}, mapActions('user/baseInfo', [\n        'getUserInfo',\n        'updateUserInfo'\n    ])), { \n        /**\n         * @description 初始化用户信息\n         */\n        initUserInfo() {\n            return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    // 从storage获取当前角色，确保使用正确的角色数据\n                    const currentRole = uni.getStorageSync('userRole') || 'student';\n                    uni.__f__('log', 'at pages/mine/modify.vue:151', '当前角色:', currentRole);\n                    // 尝试获取最新的用户信息\n                    yield this.getUserInfo();\n                    // 复制用户信息到本地状态\n                    this.userInfo = {\n                        avatar: this.profile.avatar || '',\n                        nickname: this.profile.nickname || '',\n                        introduction: this.profile.introduction || '',\n                        gender: this.profile.gender || '',\n                        phone: this.profile.phone || '',\n                        wechat: this.profile.wechat || '',\n                        password: this.profile.password || '未设置'\n                    };\n                    uni.__f__('log', 'at pages/mine/modify.vue:167', '获取的用户信息:', this.userInfo);\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/modify.vue:169', '获取用户信息失败', error);\n                    uni.showToast({\n                        title: '获取用户信息失败',\n                        icon: 'none'\n                    });\n                }\n            });\n        },\n        /**\n         * @description 选择头像\n         */\n        chooseAvatar() {\n            uni.chooseImage(new UTSJSONObject({\n                count: 1,\n                sizeType: ['compressed'],\n                sourceType: ['album', 'camera'],\n                success: (res) => {\n                    const tempFilePath = res.tempFilePaths[0];\n                    // 在实际应用中，这里应该上传图片到服务器\n                    // 这里仅做演示，直接使用临时路径\n                    this.userInfo.avatar = tempFilePath;\n                }\n            }));\n        },\n        /**\n         * @description 跳转到密码设置页面\n         */\n        navigateToPasswordPage() {\n            // 实际应用中应该跳转到密码设置页面\n            uni.showToast({\n                title: '密码设置功能开发中',\n                icon: 'none'\n            });\n        }, \n        /**\n         * @description 保存用户资料\n         */\n        saveProfile() {\n            return __awaiter(this, void 0, void 0, function* () {\n                // 基本验证\n                if (!this.userInfo.nickname) {\n                    uni.showToast({\n                        title: '昵称不能为空',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                // 手机号格式验证\n                if (this.userInfo.phone && !/^1\\d{10}$/.test(this.userInfo.phone)) {\n                    uni.showToast({\n                        title: '手机号格式不正确',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                try {\n                    this.updating = true;\n                    // 准备要更新的数据\n                    const profileData = new UTSJSONObject({\n                        avatar: this.userInfo.avatar,\n                        nickname: this.userInfo.nickname,\n                        introduction: this.userInfo.introduction,\n                        gender: this.userInfo.gender,\n                        phone: this.userInfo.phone,\n                        wechat: this.userInfo.wechat\n                    });\n                    // 调用store中的updateUserInfo action\n                    yield this.updateUserInfo(profileData);\n                    uni.showToast({\n                        title: '保存成功',\n                        icon: 'success'\n                    });\n                    // 返回个人页面\n                    setTimeout(() => {\n                        uni.navigateBack();\n                    }, 1500);\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/modify.vue:253', '保存失败', error);\n                    uni.showToast({\n                        title: error.message || '保存失败',\n                        icon: 'none'\n                    });\n                }\n                finally {\n                    this.updating = false;\n                }\n            });\n        } })\n});\n//# sourceMappingURL=E:/yanshilu%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87/%E9%92%88%E5%AF%B9%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E7%9A%84%E4%BF%AE%E6%94%B9/pages/mine/modify.vue?vue&type=script&lang.uts.js.map","references":["E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/vuex/types/index.d.ts","E:/yanshilu重新来过/针对无法启动的修改/router/Router.js"],"uniExtApis":["uni.getStorageSync","uni.__f__","uni.showToast","uni.chooseImage","uni.navigateBack"],"map":"{\"version\":3,\"file\":\"modify.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"modify.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\";;AACA;;GAEG;AACH,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AACxD,OAAO,EAAE,SAAS,EAAE,MAAM,oBAAoB,CAAC;AAE/C,+BAAe;IACd,IAAI;QACH,OAAO;YACN,QAAQ,oBAAE;gBACT,MAAM,EAAE,EAAE;gBACV,QAAQ,EAAE,EAAE;gBACZ,YAAY,EAAE,EAAE;gBAChB,MAAM,EAAE,EAAE;gBACV,KAAK,EAAE,EAAE;gBACT,MAAM,EAAE,EAAE;gBACV,QAAQ,EAAE,KAAK;aACf,CAAA;YACD,QAAQ,EAAE,KAAK;SACf,CAAA;IACF,CAAC;IACD,QAAQ,sCACJ,UAAU,CAAC,eAAe,EAAE;QAC9B,SAAS;QACT,UAAU;QACV,WAAW;KACX,CAAC,EACF;IACD,KAAK,EAAE;QACN,aAAa,CAAC,GAAG,OAAA;YAChB,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC;QACrB,CAAC;KACD;IACD,MAAM;QACL,UAAU;QACV,IAAI,CAAC,YAAY,EAAE,CAAC;IACrB,CAAC;IACD,OAAO,kCACH,UAAU,CAAC,eAAe,EAAE;QAC9B,aAAa;QACb,gBAAgB;KAChB,CAAC;QAEF;;WAEG;QACG,YAAY;;gBACjB,IAAI;oBACH,6BAA6B;oBAC7B,MAAM,WAAW,GAAG,GAAG,CAAC,cAAc,CAAC,UAAU,CAAC,IAAI,SAAS,CAAC;oBAChE,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,8BAA8B,EAAC,OAAO,EAAE,WAAW,CAAC,CAAC;oBAErE,cAAc;oBACd,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;oBAEzB,cAAc;oBACd,IAAI,CAAC,QAAQ,GAAG;wBACf,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,EAAE;wBACjC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAI,EAAE;wBACrC,YAAY,EAAE,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,EAAE;wBAC7C,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,EAAE;wBACjC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,EAAE;wBAC/B,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,EAAE;wBACjC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAI,KAAK;qBACxC,CAAC;oBAEF,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,8BAA8B,EAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAC1E;gBAAC,OAAO,KAAK,EAAE;oBACf,GAAG,CAAC,KAAK,CAAC,OAAO,EAAC,8BAA8B,EAAC,UAAU,EAAE,KAAK,CAAC,CAAC;oBACpE,GAAG,CAAC,SAAS,CAAC;wBACb,KAAK,EAAE,UAAU;wBACjB,IAAI,EAAE,MAAM;qBACZ,CAAC,CAAC;iBACH;YACF,CAAC;SAAA;QAED;;WAEG;QACH,YAAY;YACX,GAAG,CAAC,WAAW,mBAAC;gBACf,KAAK,EAAE,CAAC;gBACR,QAAQ,EAAE,CAAC,YAAY,CAAC;gBACxB,UAAU,EAAE,CAAC,OAAO,EAAE,QAAQ,CAAC;gBAC/B,OAAO,EAAE,CAAC,GAAG;oBACZ,MAAM,YAAY,GAAG,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;oBAC1C,sBAAsB;oBACtB,kBAAkB;oBAClB,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,YAAY,CAAC;gBACrC,CAAC;aACD,EAAC,CAAC;QACJ,CAAC;QAED;;WAEG;QACH,sBAAsB;YACrB,mBAAmB;YACnB,GAAG,CAAC,SAAS,CAAC;gBACb,KAAK,EAAE,WAAW;gBAClB,IAAI,EAAE,MAAM;aACZ,CAAC,CAAC;QACJ,CAAC;QAED;;WAEG;QACG,WAAW;;gBAChB,OAAO;gBACP,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;oBAC5B,GAAG,CAAC,SAAS,CAAC;wBACb,KAAK,EAAE,QAAQ;wBACf,IAAI,EAAE,MAAM;qBACZ,CAAC,CAAC;oBACH,6BAAO;iBACP;gBAED,UAAU;gBACV,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;oBAClE,GAAG,CAAC,SAAS,CAAC;wBACb,KAAK,EAAE,UAAU;wBACjB,IAAI,EAAE,MAAM;qBACZ,CAAC,CAAC;oBACH,6BAAO;iBACP;gBAED,IAAI;oBACH,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;oBAErB,WAAW;oBACX,MAAM,WAAW,qBAAG;wBACnB,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM;wBAC5B,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ;wBAChC,YAAY,EAAE,IAAI,CAAC,QAAQ,CAAC,YAAY;wBACxC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM;wBAC5B,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,KAAK;wBAC1B,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM;qBAC5B,CAAA,CAAC;oBAEF,iCAAiC;oBACjC,MAAM,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;oBAEvC,GAAG,CAAC,SAAS,CAAC;wBACb,KAAK,EAAE,MAAM;wBACb,IAAI,EAAE,SAAS;qBACf,CAAC,CAAC;oBAEH,SAAS;oBACT,UAAU,CAAC;wBACV,GAAG,CAAC,YAAY,EAAE,CAAC;oBACpB,CAAC,EAAE,IAAI,CAAC,CAAC;iBACT;gBAAC,OAAO,KAAK,EAAE;oBACf,GAAG,CAAC,KAAK,CAAC,OAAO,EAAC,8BAA8B,EAAC,MAAM,EAAE,KAAK,CAAC,CAAC;oBAChE,GAAG,CAAC,SAAS,CAAC;wBACb,KAAK,EAAE,KAAK,CAAC,OAAO,IAAI,MAAM;wBAC9B,IAAI,EAAE,MAAM;qBACZ,CAAC,CAAC;iBACH;wBAAS;oBACT,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;iBACtB;YACF,CAAC;SAAA,GACD;CACD,EAAA\"}"}
