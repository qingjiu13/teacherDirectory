{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent as _defineComponent } from 'vue';\nimport { resolveComponent as _resolveComponent, o as _o, sr as _sr, p as _p, gei as _gei, sei as _sei, e as _e } from \"vue\";\nconst __BINDING_COMPONENTS__ = '{\"c-lottie\":{\"name\":\"_easycom_c_lottie\",\"type\":\"unknown\"},\"TabBar\":{\"name\":\"TabBar\",\"type\":\"setup\"}}';\nif (!Array) {\n    const _easycom_c_lottie_1 = _resolveComponent(\"c-lottie\");\n    (_easycom_c_lottie_1)();\n}\nimport _easycom_c_lottie from 'E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/uni_modules/c-lottie/components/c-lottie/c-lottie.vue';\nif (!Math) {\n    (_easycom_c_lottie + TabBar)();\n}\nimport TabBar from '@/components/tab-bar/tab-bar.vue';\nimport { Navigator } from '@/router/Router.js';\nimport { ref, onMounted, onActivated } from \"vue\";\nconst defaultSrc = 'https://lottie.host/aa045d36-86ee-46d3-9705-1eeb65b38465/V6aAFX4Fmk.json';\nexport default /*#__PURE__*/ _defineComponent({\n    __name: 'index',\n    props: {\n        src: new UTSJSONObject({\n            type: String,\n            default: defaultSrc\n        })\n    },\n    setup(__props) {\n        // import AICartoon from '@/components/AI-cartoon/AI-cartoon.vue'\n        const cLottieRef = ref();\n        const animationSrc = ref('');\n        const animationLoaded = ref(false);\n        const loading = ref(false);\n        const pageReady = ref(false);\n        let loadTimeout = null;\n        /**\n         * 组件属性\n         * @type {Object}\n         */\n        const props = __props;\n        /**\n         * 从URL中提取唯一键\n         * @param {String} url - 动画URL\n         * @returns {String} 唯一键\n         */\n        const getAnimationKey = (url = null) => {\n            return url.split('/').pop().split('.')[0];\n        };\n        /**\n         * 检查缓存状态\n         * @param {String} key - 存储键名\n         * @returns {Boolean} 是否已缓存\n         */\n        const checkCached = (key = null) => {\n            const storageKey = `lottie_${key}`;\n            try {\n                const stored = uni.getStorageSync(storageKey);\n                return !!stored;\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages/index/index.vue:79', '检查缓存状态失败', e);\n                return false;\n            }\n        };\n        /**\n         * 预加载并缓存动画数据\n         * @param {String} url - 动画URL\n         * @param {String} key - 存储键名\n         * @returns {Promise<Boolean>} 是否成功\n         */\n        const preloadLottieAnimation = (url = null, key = null) => { return __awaiter(this, void 0, void 0, function* () {\n            if (loading.value)\n                return false;\n            loading.value = true;\n            const storageKey = `lottie_${key}`;\n            // 检查是否已缓存\n            if (checkCached(key)) {\n                uni.__f__('log', 'at pages/index/index.vue:98', '动画已缓存，无需预加载');\n                loading.value = false;\n                return true;\n            }\n            // 从网络加载\n            uni.__f__('log', 'at pages/index/index.vue:104', '从网络预加载Lottie动画');\n            try {\n                const data = (yield uni.request({\n                    url: url,\n                    method: 'GET'\n                })).data;\n                // 保存到本地缓存\n                try {\n                    uni.setStorageSync(storageKey, data);\n                    uni.__f__('log', 'at pages/index/index.vue:114', 'Lottie动画已缓存到本地');\n                    loading.value = false;\n                    return true;\n                }\n                catch (e) {\n                    uni.__f__('error', 'at pages/index/index.vue:118', '保存缓存失败', e);\n                    loading.value = false;\n                    return false;\n                }\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages/index/index.vue:123', '获取动画文件失败', e);\n                loading.value = false;\n                return false;\n            }\n        }); };\n        /**\n         * 初始化动画\n         */\n        const initAnimation = () => { return __awaiter(this, void 0, void 0, function* () {\n            // 清除可能存在的超时计时器\n            if (loadTimeout) {\n                clearTimeout(loadTimeout);\n            }\n            // 重置页面准备状态\n            pageReady.value = false;\n            // 设置动画源\n            animationSrc.value = props.src;\n            // 检查是否已经缓存了动画数据\n            const animationKey = getAnimationKey(props.src);\n            const isCached = checkCached(animationKey);\n            // 预加载动画到缓存（不影响当前显示）\n            preloadLottieAnimation(props.src, animationKey);\n            // 设置超时处理，最长等待3秒\n            loadTimeout = setTimeout(() => {\n                uni.__f__('log', 'at pages/index/index.vue:153', '动画加载超时，强制显示页面');\n                pageReady.value = true;\n            }, 3000);\n            // 如果已经缓存，可能不会触发dataReady事件，需要主动检查\n            if (isCached) {\n                uni.__f__('log', 'at pages/index/index.vue:159', '检测到缓存数据，预先设置动画加载状态');\n                animationLoaded.value = true;\n                // 短暂延迟后显示页面\n                setTimeout(() => {\n                    pageReady.value = true;\n                }, 500);\n            }\n        }); };\n        /**\n         * 数据准备完成回调\n         */\n        const onDataReady = () => {\n            uni.__f__('log', 'at pages/index/index.vue:172', '动画数据准备完成，触发dataReady事件');\n            animationLoaded.value = true;\n            // 清除加载超时计时器\n            if (loadTimeout) {\n                clearTimeout(loadTimeout);\n                loadTimeout = null;\n            }\n            // 动画准备好后，标记页面可以显示\n            setTimeout(() => {\n                uni.__f__('log', 'at pages/index/index.vue:183', '设置页面为可显示状态');\n                pageReady.value = true;\n            }, 100);\n        };\n        /**\n         * 执行匹配动画\n         */\n        const matchAnimation = () => {\n            if (!animationLoaded.value) {\n                uni.__f__('log', 'at pages/index/index.vue:193', '动画尚未加载完成');\n                return null;\n            }\n            cLottieRef.value.call('play');\n            setTimeout(() => {\n                cLottieRef.value.call('stop');\n                navigateToMatch();\n            }, 1000);\n        };\n        /**\n         * 导航到匹配页面\n         */\n        const navigateToMatch = () => {\n            Navigator.toMatch();\n        };\n        // 组件挂载时初始化\n        onMounted(() => {\n            uni.__f__('log', 'at pages/index/index.vue:213', '组件挂载，初始化动画');\n            initAnimation();\n        });\n        // 在页面被激活时确保动画已加载（如从其他页面返回时）\n        onActivated(() => {\n            uni.__f__('log', 'at pages/index/index.vue:219', '页面激活');\n            if (!animationSrc.value) {\n                initAnimation();\n            }\n            else {\n                // 如果已有源但页面未准备好，强制准备\n                if (!pageReady.value) {\n                    uni.__f__('log', 'at pages/index/index.vue:225', '动画源已存在但页面未准备好，强制显示');\n                    pageReady.value = true;\n                }\n            }\n        });\n        return (_ctx = null, _cache = null) => {\n            const __returned__ = _e(new UTSJSONObject({\n                a: !pageReady.value\n            }), !pageReady.value ? new UTSJSONObject({}) : new UTSJSONObject({\n                b: _sr(cLottieRef, '74acbeb4-0', new UTSJSONObject({\n                    \"k\": \"cLottieRef\"\n                })),\n                c: _o(onDataReady),\n                d: _p(new UTSJSONObject({\n                    src: animationSrc.value,\n                    width: '600rpx',\n                    autoPlay: false,\n                    height: '600rpx',\n                    loop: true\n                })),\n                e: _o(matchAnimation),\n                f: _p(new UTSJSONObject({\n                    pageName: 'index'\n                }))\n            }), new UTSJSONObject({\n                g: _sei(_gei(_ctx, ''), 'view')\n            }));\n            return __returned__;\n        };\n    }\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pages/index/index.vue?vue&type=script&setup=true&lang.uts.js.map","references":["E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/uni_modules/c-lottie/components/c-lottie/c-lottie.vue.ts","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/components/tab-bar/tab-bar.vue.ts","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/router/Router.js","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts"],"uniExtApis":["uni.getStorageSync","uni.__f__","uni.request","uni.setStorageSync"],"map":"{\"version\":3,\"file\":\"index.vue?vue&type=script&setup=true&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"index.vue?vue&type=script&setup=true&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
