"use strict";const s=require("../../common/vendor.js"),T=require("../index.js"),m=()=>{const r=_();if(s.index.__f__("log","at store/user/JWT.js:18","[调试] JWT Token:",r),!r)return s.index.__f__("log","at store/user/JWT.js:20","[调试] Token为空，返回null"),null;try{const t=s.jwtDecode(r);s.index.__f__("log","at store/user/JWT.js:25","[调试] JWT解码结果:",t),s.index.__f__("log","at store/user/JWT.js:26","[调试] decoded.userid:",t.userid),s.index.__f__("log","at store/user/JWT.js:27","[调试] decoded.sub:",t.sub);const a=t.userid;return s.index.__f__("log","at store/user/JWT.js:31","[调试] 最终用户ID:",a),s.index.__f__("log","at store/user/JWT.js:32","[调试] 最终用户ID类型:",typeof a),Number(a)||null}catch(t){return s.index.__f__("error","at store/user/JWT.js:36","[调试] JWT解析失败:",t),null}},_=()=>T.store.state.user.baseInfo.jwtToken,h=(r,t="GET",a={},g={})=>{const o={...{requireAuth:!0,showError:!0,customHeader:{}},...g};return new Promise((c,d)=>{const i=_();if(s.index.__f__("log","at store/user/JWT.js:71","token",i),o.requireAuth&&!i){const e={success:!1,error:{code:401,message:"未登录，请先登录"}};o.showError&&s.index.showToast({title:e.error.message,icon:"none",duration:2e3}),d(e);return}const l={"Content-Type":"application/json",...o.customHeader};i&&(l.Authorization=`Bearer ${i}`),s.index.request({url:r,method:t.toUpperCase(),data:a,header:l,success:e=>{var n,f;if(e.statusCode===200)e.data?e.data.code===200?c({success:!0,data:e.data}):c({success:!1,message:e.data.msg||e.data.message||"请求失败",data:e.data}):c({success:!0,data:null});else if(e.statusCode===401||e.statusCode===403){T.store.commit("user/baseInfo/CLEAR_JWT_TOKEN");const u={success:!1,error:{statusCode:e.statusCode,message:((n=e.data)==null?void 0:n.msg)||(e.statusCode===401?"认证已过期，请重新登录":"无权访问")}};o.showError&&s.index.showToast({title:u.error.message,icon:"none",duration:2e3}),d(u)}else{const u={success:!1,error:{statusCode:e.statusCode,message:((f=e.data)==null?void 0:f.msg)||`HTTP错误: ${e.statusCode}`}};o.showError&&s.index.showToast({title:u.error.message,icon:"none",duration:2e3}),d(u)}},fail:e=>{const n={success:!1,error:{message:e.errMsg||"网络请求失败"}};o.showError&&s.index.showToast({title:n.error.message,icon:"none",duration:2e3}),d(n)}})})};exports.apiRequest=h;exports.getCurrentToken=_;exports.getCurrentUserId=m;
//# sourceMappingURL=../../../.sourcemap/mp-weixin/store/user/JWT.js.map
