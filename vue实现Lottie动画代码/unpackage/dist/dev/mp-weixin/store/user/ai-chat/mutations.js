"use strict";const r=require("../../../common/vendor.js"),h={UPDATE_CONVERSATIONS_LIST(a,i){if(Array.isArray(i)){const t=i.map(e=>({id:e.id,abstract:e.abstract,chatMode:e.chatMode||"general",type:e.type,createdAt:e.createdAt,updatedAt:e.updatedAt,createBy:e.createBy,updateBy:e.updateBy,remark:e.remark,messages:e.messages||[]}));a.aiChat.conversations=t,r.index.__f__("log","at store/user/ai-chat/mutations.js:36","=== Mutations: 更新对话列表 ==="),r.index.__f__("log","at store/user/ai-chat/mutations.js:37","更新的对话数量:",t.length),r.index.__f__("log","at store/user/ai-chat/mutations.js:38","更新后的对话列表:",t),r.index.__f__("log","at store/user/ai-chat/mutations.js:39","============================")}},APPEND_CONVERSATIONS_LIST(a,i){if(Array.isArray(i)){const t=i.map(s=>({id:s.id,abstract:s.abstract,chatMode:s.chatMode||"general",type:s.type,createdAt:s.createdAt,updatedAt:s.updatedAt,createBy:s.createBy,updateBy:s.updateBy,remark:s.remark,messages:s.messages||[]})),e=new Set(a.aiChat.conversations.map(s=>s.id)),n=t.filter(s=>!e.has(s.id));a.aiChat.conversations=[...a.aiChat.conversations,...n],r.index.__f__("log","at store/user/ai-chat/mutations.js:72","=== Mutations: 追加对话列表 ==="),r.index.__f__("log","at store/user/ai-chat/mutations.js:73","新增对话数量:",n.length),r.index.__f__("log","at store/user/ai-chat/mutations.js:74","总对话数量:",a.aiChat.conversations.length),r.index.__f__("log","at store/user/ai-chat/mutations.js:75","============================")}},SET_HISTORY_SUMMARIES(a,i){a.aiChat.historySummaries||(a.aiChat.historySummaries=[]),Array.isArray(i)&&(a.aiChat.historySummaries=i)},ADD_CONVERSATION(a,i){if(!i||!i.id)return;const t=a.aiChat.conversations.findIndex(e=>e.id===i.id);t!==-1?a.aiChat.conversations.splice(t,1,i):a.aiChat.conversations.push(i)},REMOVE_CONVERSATION(a,i){i&&(a.aiChat.conversations=a.aiChat.conversations.filter(t=>t.id!==i))},ADD_HISTORY_SUMMARY(a,i){if(!i||!i.id)return;a.aiChat.historySummaries||(a.aiChat.historySummaries=[]);const t=a.aiChat.historySummaries.findIndex(e=>e.id===i.id);t!==-1?a.aiChat.historySummaries.splice(t,1,i):a.aiChat.historySummaries.push(i)},REMOVE_HISTORY_SUMMARY(a,i){i&&a.aiChat.historySummaries&&(a.aiChat.historySummaries=a.aiChat.historySummaries.filter(t=>t.id!==i))},UPDATE_CONVERSATION_DETAIL(a,i){if(!i||!i.id)return;const t=a.aiChat.conversations.findIndex(e=>e.id===i.id);t!==-1?a.aiChat.conversations[t]=i:a.aiChat.conversations.push(i),a.aiChat.activeConversation=i.id},UPDATE_CURRENT_CONVERSATION(a,i){a.aiChat.activeConversation=i},UPDATE_CHAT_MODE(a,i){a.aiChat.chatMode=i},UPDATE_USER_INFO(a,i){a.aiChat.userInfo={...a.aiChat.userInfo,...i}},UPDATE_USER_SCHOOL(a,i){a.aiChat.userInfo||(a.aiChat.userInfo={school:"",major:""}),a.aiChat.userInfo.school=i},UPDATE_USER_MAJOR(a,i){a.aiChat.userInfo||(a.aiChat.userInfo={school:"",major:""}),a.aiChat.userInfo.major=i},DELETE_CONVERSATION(a,i){a.aiChat.conversations=a.aiChat.conversations.filter(t=>t.id!==i),a.aiChat.activeConversation===i&&(a.aiChat.activeConversation=null)},UPDATE_PAGINATION(a,i){a.aiChat.pagination={...a.aiChat.pagination,...i,hasNext:i.pageNum<i.totalPages,hasPrev:i.pageNum>1}},SET_PAGE_NUM(a,i){a.aiChat.pagination.pageNum=i,a.aiChat.pagination.hasNext=i<a.aiChat.pagination.totalPages,a.aiChat.pagination.hasPrev=i>1},SET_PAGE_SIZE(a,i){a.aiChat.pagination.pageSize=i,a.aiChat.pagination.total>0&&(a.aiChat.pagination.totalPages=Math.ceil(a.aiChat.pagination.total/i),a.aiChat.pagination.hasNext=a.aiChat.pagination.pageNum<a.aiChat.pagination.totalPages)},SET_PAGINATION_LOADING(a,i){a.aiChat.pagination.loading=i},RESET_PAGINATION(a){a.aiChat.pagination={pageSize:10,pageNum:1,total:0,totalPages:0,hasNext:!1,hasPrev:!1,loading:!1}},ADD_MESSAGE_TO_CURRENT_CONVERSATION(a,i){if(!i.id)return;const t=a.aiChat.activeConversation;if(!t){r.index.__f__("warn","at store/user/ai-chat/mutations.js:351","没有活跃对话，消息将在收到conversationId后添加");return}let e=a.aiChat.conversations.findIndex(o=>o.id==t);if(e===-1){r.index.__f__("log","at store/user/ai-chat/mutations.js:362","对话不存在，创建临时对话结构:",t);const o={id:t,abstract:"新对话",chatMode:a.aiChat.chatMode||"general",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messages:[]};a.aiChat.conversations.push(o),e=a.aiChat.conversations.length-1}const n=a.aiChat.conversations[e];n.messages||(n.messages=[]),n.messages.findIndex(o=>o.id===i.id)===-1?(n.messages.push(i),n.updatedAt=new Date().toISOString(),r.index.__f__("log","at store/user/ai-chat/mutations.js:395","✅ 已添加消息到对话:",{conversationId:t,messageId:i.id,messageRole:i.role,totalMessages:n.messages.length})):r.index.__f__("log","at store/user/ai-chat/mutations.js:403","消息已存在，跳过添加:",i.id)},UPDATE_MESSAGE_CONTENT(a,i){if(!i||!i.messageId)return;const t=a.aiChat.activeConversation;if(!t)return;const e=a.aiChat.conversations.findIndex(n=>n.id===t);if(e!==-1){const n=a.aiChat.conversations[e];if(n.messages){const s=n.messages.findIndex(o=>o.id===i.messageId);if(s!==-1){const o=n.messages[s];o.content=i.content,i.hasOwnProperty("streaming")&&(o.streaming=i.streaming),i.hasOwnProperty("status")&&(o.status=i.status),i.hasOwnProperty("isComplete")&&(o.isComplete=i.isComplete),i.hasOwnProperty("isStreaming")&&(o.streaming=i.isStreaming),i.hasOwnProperty("hasError")&&(o.hasError=i.hasError),o.timestamp=new Date().toISOString(),n.updatedAt=new Date().toISOString()}}}},CLEAR_CURRENT_CONVERSATION_MESSAGES(a){const i=a.aiChat.activeConversation;if(!i)return;const t=a.aiChat.conversations.findIndex(e=>e.id===i);if(t!==-1){const e=a.aiChat.conversations[t];e.messages=[],e.updatedAt=new Date().toISOString()}},CREATE_NEW_CONVERSATION(a,i={}){a.aiChat.activeConversation=null,i.chatMode&&(a.aiChat.chatMode=i.chatMode),r.index.__f__("log","at store/user/ai-chat/mutations.js:512","✅ 已准备新对话状态，等待后端返回conversationId"),r.index.__f__("log","at store/user/ai-chat/mutations.js:513","   - 当前活跃对话ID:",a.aiChat.activeConversation),r.index.__f__("log","at store/user/ai-chat/mutations.js:514","   - 聊天模式:",a.aiChat.chatMode)},CREATE_CONVERSATION_FROM_BACKEND(a,i){if(!i||!i.conversationId)return;const{conversationId:t,abstract:e,messages:n=[]}=i,s=a.aiChat.conversations.findIndex(o=>o.id===t);if(s===-1){const o={id:t,abstract:e||"新对话",chatMode:a.aiChat.chatMode,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messages:n};a.aiChat.conversations.push(o),r.index.__f__("log","at store/user/ai-chat/mutations.js:547","已创建新对话:",t)}else{const o=a.aiChat.conversations[s];n.length>0&&(o.messages=n),o.updatedAt=new Date().toISOString(),r.index.__f__("log","at store/user/ai-chat/mutations.js:555","已更新现有对话:",t)}a.aiChat.activeConversation=t},SET_CURRENT_CONVERSATION_MESSAGES(a,i){if(!i||!i.conversationId||!Array.isArray(i.messages))return;const{conversationId:t,messages:e}=i,n=a.aiChat.conversations.findIndex(s=>s.id===t);if(n!==-1){const s=a.aiChat.conversations[n];s.messages=e,s.updatedAt=new Date().toISOString()}else{const s={id:t,abstract:e.length>0?e[0].content.substring(0,30)+(e[0].content.length>30?"...":""):"新对话",chatMode:a.aiChat.chatMode,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messages:e};a.aiChat.conversations.push(s)}a.aiChat.activeConversation=t}};exports.mutations=h;
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/store/user/ai-chat/mutations.js.map
