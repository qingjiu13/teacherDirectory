"use strict";const i=require("../../../common/vendor.js"),u=require("../APIroute/AIchat_api/AIchat_api.js"),A={setCurrentChat({commit:n},r){n("UPDATE_CURRENT_CONVERSATION",r)},async sendQuestion({commit:n,state:r},e){var s,t;try{const o={content:e.question,chatMode:((s=e.contextInfo)==null?void 0:s.mode)||r.aiChat.chatMode,conversationId:e.chatId||r.aiChat.activeConversation},a=await u.sendMessageToAI(o);if(a.success){n("UPDATE_CURRENT_CONVERSATION",a.conversationId);const _={id:`msg-${Date.now()}`,type:"user",content:e.question,timestamp:new Date().toISOString()},g={id:`msg-${Date.now()+1}`,type:"ai",content:a.aiResponse,timestamp:new Date().toISOString()},d=r.aiChat.conversations.find(c=>c.id===a.conversationId);if(d){const c={...d,messages:[...d.messages||[],_,g],updatedAt:new Date().toISOString()};n("UPDATE_CONVERSATION_DETAIL",c)}else{const c={id:a.conversationId,abstract:e.question.substring(0,30)+(e.question.length>30?"...":""),chatMode:r.aiChat.chatMode,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messages:[_,g]};n("UPDATE_CONVERSATION_DETAIL",c)}}return{success:a.success,data:a.aiResponse,chatId:a.conversationId,message:a.message}}catch(o){return i.index.__f__("error","at store/user/ai-chat/actions.js:101","AI问答出错:",o),{success:!1,error:o.error||o,message:((t=o.error)==null?void 0:t.message)||"请求失败"}}},async loadChat({commit:n},r){var e;try{const s=await u.getConversationDetail(r);if(s.success){const t={id:r,messages:s.messages,updatedAt:new Date().toISOString()};n("UPDATE_CONVERSATION_DETAIL",t)}return{success:s.success,data:s.messages}}catch(s){return i.index.__f__("error","at store/user/ai-chat/actions.js:140","加载对话详情失败:",s),{success:!1,error:s.error||s,message:((e=s.error)==null?void 0:e.message)||"加载对话详情失败"}}},async saveChat({commit:n,state:r},e){var s,t;try{const o=r.aiChat.conversations.find(a=>a.id===e.id);if(o)n("UPDATE_CONVERSATION_DETAIL",{...o,...e,updatedAt:new Date().toISOString()});else{const a={id:e.id,abstract:e.title||"新对话",chatMode:e.chatMode||"general",createdAt:((s=e.createdAt)==null?void 0:s.toISOString())||new Date().toISOString(),updatedAt:((t=e.updatedAt)==null?void 0:t.toISOString())||new Date().toISOString(),messages:e.messages||[]};n("UPDATE_CONVERSATION_DETAIL",a)}return{success:!0}}catch(o){return i.index.__f__("error","at store/user/ai-chat/actions.js:187","保存对话失败:",o),{success:!1,message:"保存对话失败"}}},async deleteChat({commit:n,state:r},e){var s;try{const t=await u.deleteConversation(e);return t.success&&(n("DELETE_CONVERSATION",e),r.aiChat.activeConversation===e&&n("UPDATE_CURRENT_CONVERSATION",null)),{success:t.success,message:t.message||(t.success?"删除成功":"删除失败")}}catch(t){return i.index.__f__("error","at store/user/ai-chat/actions.js:221","删除对话失败:",t),{success:!1,error:t.error||t,message:((s=t.error)==null?void 0:s.message)||"删除对话失败"}}},async loadConversationHistory({commit:n}){var r;try{const e=await u.getConversationHistory();return e.success&&e.conversations&&n("SET_CONVERSATIONS",e.conversations),{success:e.success,data:e.conversations}}catch(e){return i.index.__f__("error","at store/user/ai-chat/actions.js:250","获取对话历史失败:",e),{success:!1,error:e.error||e,message:((r=e.error)==null?void 0:r.message)||"获取对话历史失败"}}}};exports.actions=A;
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/store/user/ai-chat/actions.js.map
