"use strict";const s=require("../../../common/vendor.js"),{getUserInfo:c,updateUserInfo:n,updateRole:u}={getUserInfo:()=>Promise.resolve({success:!0,data:{id:"1566454",avatar:"/static/image/defaultAvatar/teacher-man.png",name:"张三",gender:"男",selfIntroduction:"我是一个热爱学习的人",wechatNumber:"1234567890",phoneNumber:"1234567890",password:"123456",isRegistered:0,userInfo:{certificate:0,role:"学生",school:"天津大学",major:"计算机科学与技术",targetSchool:"清华大学",targetMajor:"计算机科学与技术",studentGrade:"大三",teacherGrade:"研一",teacherScore:0}}}),updateUserInfo:o=>Promise.resolve({success:!0,data:{userInfo:o}}),updateRole:()=>Promise.resolve({success:!0})},i={async getUserInfo({commit:o,state:r}){s.index.__f__("log","at store/user/baseInfo/actions.js:45","getUserInfo action开始执行, 当前state:",{id:r.id,name:r.name});try{if(r.name&&r.name!=="")return s.index.__f__("log","at store/user/baseInfo/actions.js:53","本地已有数据，直接返回state"),{id:r.id,avatar:r.avatar,name:r.name,gender:r.gender,selfIntroduction:r.selfIntroduction,wechatNumber:r.wechatNumber,phoneNumber:r.phoneNumber,userInfo:r.userInfo};s.index.__f__("log","at store/user/baseInfo/actions.js:66","本地无数据，请求API");const e=await c();return s.index.__f__("log","at store/user/baseInfo/actions.js:68","API返回结果:",e),e.success?(o("SET_USER_INFO",e.data),s.index.__f__("log","at store/user/baseInfo/actions.js:73","提交SET_USER_INFO后，state变为:",{id:r.id,name:r.name}),e.data):(s.index.__f__("error","at store/user/baseInfo/actions.js:80","API返回失败:",e.error),Promise.reject(e.error||{message:"获取用户信息失败"}))}catch(e){return s.index.__f__("error","at store/user/baseInfo/actions.js:84","获取用户信息失败",e),Promise.reject(e)}},async updateUserInfo({commit:o},r){try{const e=await n(r);return e.success?(o("UPDATE_USER_INFO",r),{success:!0}):Promise.reject(e.error||{message:"更新用户信息失败"})}catch(e){return s.index.__f__("error","at store/user/baseInfo/actions.js:108","更新用户信息失败",e),Promise.reject(e)}},async updateUserInfoData({commit:o},r){try{const e=await n({userInfo:r});return e.success?(o("UPDATE_USER_INFO_DATA",r),{success:!0}):Promise.reject(e.error||{message:"更新用户扩展信息失败"})}catch(e){return s.index.__f__("error","at store/user/baseInfo/actions.js:132","更新用户扩展信息失败",e),Promise.reject(e)}},async updateRole({commit:o,state:r},e){s.index.__f__("log","at store/user/baseInfo/actions.js:144","updateRole action开始执行, 角色:",e,"当前role:",r.userInfo.role);try{const t=await u(e);return t.success?(o("updateRole",e),s.index.__f__("log","at store/user/baseInfo/actions.js:153","角色更新成功，新角色:",r.userInfo.role),s.index.setStorageSync("userRole",e),{success:!0,role:e}):Promise.reject(t.error||{message:"更新用户角色失败"})}catch(t){s.index.__f__("error","at store/user/baseInfo/actions.js:163","更新用户角色失败:",t);try{o("updateRole",e),s.index.setStorageSync("userRole",e)}catch(a){s.index.__f__("error","at store/user/baseInfo/actions.js:170","本地更新角色失败",a)}return Promise.reject(t)}},async logout({commit:o}){try{return o("CLEAR_USER_INFO"),s.index.removeStorageSync("userId"),s.index.removeStorageSync("token"),s.index.removeStorageSync("userInfo"),s.index.removeStorageSync("user-token"),s.index.removeStorageSync("userBaseInfo"),s.index.removeStorageSync("userInfoData"),s.index.removeStorageSync("userRole"),{success:!0,message:"退出登录成功"}}catch(r){return s.index.__f__("error","at store/user/baseInfo/actions.js:198","退出登录失败:",r),Promise.reject({message:"退出登录失败"})}}};exports.actions=i;
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/store/user/baseInfo/actions.js.map
