"use strict";const a=require("../../../common/vendor.js"),f=require("../APIroute/Login_api/Login_api.js"),{getUserInfo:g,updateUserInfo:d,updateRole:S}={getUserInfo:()=>Promise.resolve({success:!0,data:{id:"1566454",avatar:"/static/image/defaultAvatar/teacher-man.png",name:"张三",gender:"男",selfIntroduction:"我是一个热爱学习的人",wechatNumber:"1234567890",phoneNumber:"1234567890",password:"123456",isRegistered:0,userInfo:{certificate:0,role:"学生",school:"天津大学",major:"计算机科学与技术",targetSchool:"清华大学",targetMajor:"计算机科学与技术",studentGrade:"大三",teacherGrade:"研一"}}}),updateUserInfo:r=>Promise.resolve({success:!0,data:{userInfo:r}}),updateRole:()=>Promise.resolve({success:!0})},E={async getUserInfo({commit:r,state:s}){a.index.__f__("log","at store/user/baseInfo/actions.js:52","getUserInfo action开始执行, 当前state:",{id:s.id,name:s.name});try{if(s.name&&s.name!=="")return a.index.__f__("log","at store/user/baseInfo/actions.js:60","本地已有数据，直接返回state"),{id:s.id,avatar:s.avatar,name:s.name,gender:s.gender,selfIntroduction:s.selfIntroduction,wechatNumber:s.wechatNumber,phoneNumber:s.phoneNumber,userInfo:s.userInfo};a.index.__f__("log","at store/user/baseInfo/actions.js:73","本地无数据，请求API");const e=await g();return a.index.__f__("log","at store/user/baseInfo/actions.js:75","API返回结果:",e),e.success?(r("SET_USER_INFO",e.data),a.index.__f__("log","at store/user/baseInfo/actions.js:80","提交SET_USER_INFO后，state变为:",{id:s.id,name:s.name}),e.data):(a.index.__f__("error","at store/user/baseInfo/actions.js:87","API返回失败:",e.error),Promise.reject(e.error||{message:"获取用户信息失败"}))}catch(e){return a.index.__f__("error","at store/user/baseInfo/actions.js:91","获取用户信息失败",e),Promise.reject(e)}},async updateUserInfo({commit:r},s){try{const e=await d(s);return e.success?(r("UPDATE_USER_INFO",s),{success:!0}):Promise.reject(e.error||{message:"更新用户信息失败"})}catch(e){return a.index.__f__("error","at store/user/baseInfo/actions.js:115","更新用户信息失败",e),Promise.reject(e)}},async updateUserInfoData({commit:r},s){try{const e=await d({userInfo:s});return e.success?(r("UPDATE_USER_INFO_DATA",s),{success:!0}):Promise.reject(e.error||{message:"更新用户扩展信息失败"})}catch(e){return a.index.__f__("error","at store/user/baseInfo/actions.js:139","更新用户扩展信息失败",e),Promise.reject(e)}},async updateRole({commit:r,state:s},e){a.index.__f__("log","at store/user/baseInfo/actions.js:151","updateRole action开始执行, 角色:",e,"当前role:",s.userInfo.role);try{const n=await S(e);return n.success?(r("updateRole",e),a.index.__f__("log","at store/user/baseInfo/actions.js:160","角色更新成功，新角色:",s.userInfo.role),a.index.setStorageSync("userRole",e),{success:!0,role:e}):Promise.reject(n.error||{message:"更新用户角色失败"})}catch(n){a.index.__f__("error","at store/user/baseInfo/actions.js:170","更新用户角色失败:",n);try{r("updateRole",e),a.index.setStorageSync("userRole",e)}catch(t){a.index.__f__("error","at store/user/baseInfo/actions.js:177","本地更新角色失败",t)}return Promise.reject(n)}},async logout({commit:r}){try{return r("CLEAR_USER_INFO"),a.index.removeStorageSync("userId"),a.index.removeStorageSync("token"),a.index.removeStorageSync("userInfo"),a.index.removeStorageSync("user-token"),a.index.removeStorageSync("userBaseInfo"),a.index.removeStorageSync("userInfoData"),a.index.removeStorageSync("userRole"),{success:!0,message:"退出登录成功"}}catch(s){return a.index.__f__("error","at store/user/baseInfo/actions.js:205","退出登录失败:",s),Promise.reject({message:"退出登录失败"})}},async searchUndergraduateSchools({commit:r,state:s},{keyword:e,loadMore:n=!1}){a.index.__f__("log","at store/user/baseInfo/actions.js:219","搜索本科学校:",e,"加载更多:",n);try{const t=s.undergraduateSchoolSearch;if(n&&!t.hasMore)return a.index.__f__("log","at store/user/baseInfo/actions.js:226","没有更多数据了"),{success:!0,data:{hasMore:!1}};n||(r("SET_UNDERGRADUATE_SCHOOL_SEARCH_KEYWORD",e),r("RESET_UNDERGRADUATE_SCHOOL_SEARCH")),r("SET_UNDERGRADUATE_SCHOOL_LOADING",!0);const _=n?t.currentPage+1:1,o=await f.searchUndergraduateSchools({keyword:e,page:_,pageSize:t.pageSize});if(a.index.__f__("log","at store/user/baseInfo/actions.js:247","本科学校搜索API返回:",o),o.success&&o.data){const c=o.data.items||[],u=o.data.hasMore!==!1&&c.length>=t.pageSize;return r("SET_UNDERGRADUATE_SCHOOL_OPTIONS",{options:c,append:n,hasMore:u,currentPage:_}),a.index.__f__("log","at store/user/baseInfo/actions.js:262",`本科学校搜索完成: 关键词="${e}", 页码=${_}, 结果数=${c.length}, 还有更多=${u}`),{success:!0,data:{options:c,hasMore:u,currentPage:_}}}else return a.index.__f__("error","at store/user/baseInfo/actions.js:273","本科学校搜索失败:",o.error),Promise.reject(o.error||{message:"搜索学校失败"})}catch(t){return a.index.__f__("error","at store/user/baseInfo/actions.js:277","搜索本科学校出错:",t),Promise.reject(t)}finally{r("SET_UNDERGRADUATE_SCHOOL_LOADING",!1)}},async searchUndergraduateMajors({commit:r,state:s},{keyword:e,loadMore:n=!1}){a.index.__f__("log","at store/user/baseInfo/actions.js:291","搜索本科专业:",e,"加载更多:",n);try{const t=s.undergraduateMajorSearch;if(n&&!t.hasMore)return a.index.__f__("log","at store/user/baseInfo/actions.js:298","没有更多数据了"),{success:!0,data:{hasMore:!1}};n||(r("SET_UNDERGRADUATE_MAJOR_SEARCH_KEYWORD",e),r("RESET_UNDERGRADUATE_MAJOR_SEARCH")),r("SET_UNDERGRADUATE_MAJOR_LOADING",!0);const _=n?t.currentPage+1:1,o=await f.searchUndergraduateMajors({keyword:e,page:_,pageSize:t.pageSize});if(a.index.__f__("log","at store/user/baseInfo/actions.js:319","本科专业搜索API返回:",o),o.success&&o.data){const c=o.data.items||[],u=o.data.hasMore!==!1&&c.length>=t.pageSize;return r("SET_UNDERGRADUATE_MAJOR_OPTIONS",{options:c,append:n,hasMore:u,currentPage:_}),a.index.__f__("log","at store/user/baseInfo/actions.js:334",`本科专业搜索完成: 关键词="${e}", 页码=${_}, 结果数=${c.length}, 还有更多=${u}`),{success:!0,data:{options:c,hasMore:u,currentPage:_}}}else return a.index.__f__("error","at store/user/baseInfo/actions.js:345","本科专业搜索失败:",o.error),Promise.reject(o.error||{message:"搜索专业失败"})}catch(t){return a.index.__f__("error","at store/user/baseInfo/actions.js:349","搜索本科专业出错:",t),Promise.reject(t)}finally{r("SET_UNDERGRADUATE_MAJOR_LOADING",!1)}},selectUndergraduateSchool({commit:r},{id:s,name:e}){r("SET_UNDERGRADUATE_SELECTED_SCHOOL",{id:s,name:e})},selectUndergraduateMajor({commit:r},{id:s,name:e}){r("SET_UNDERGRADUATE_SELECTED_MAJOR",{id:s,name:e})},async searchGraduateSchools({commit:r,state:s},{keyword:e,loadMore:n=!1}){const t=s.id,_=n?s.graduateSchoolSearch.currentPage+1:1;r("SET_GRADUATE_SCHOOL_PAGINATION",{isLoading:!0}),n||r("SET_GRADUATE_SCHOOL_SEARCH_KEYWORD",e);const o={userId:t,keyword:e,currentPage:_,pageSize:s.graduateSchoolSearch.pageSize};return new Promise((c,u)=>{f.searchGraduateSchools(o).then(i=>{i&&i.data&&(r("SET_GRADUATE_SCHOOL_OPTIONS",{options:i.data,isLoadMore:n}),r("SET_GRADUATE_SCHOOL_PAGINATION",{currentPage:_,hasMore:i.hasMore||!1,isLoading:!1})),c(i)}).catch(i=>{r("SET_GRADUATE_SCHOOL_PAGINATION",{isLoading:!1}),u(i)})})},async searchGraduateMajors({commit:r,state:s},{keyword:e,loadMore:n=!1}){a.index.__f__("log","at store/user/baseInfo/actions.js:442","搜索研究生专业:",e,"加载更多:",n);try{const t=s.graduateMajorSearch;if(n&&!t.hasMore)return a.index.__f__("log","at store/user/baseInfo/actions.js:449","没有更多数据了"),{success:!0,data:{hasMore:!1}};n||(r("SET_GRADUATE_MAJOR_SEARCH_KEYWORD",e),r("SET_GRADUATE_MAJOR_OPTIONS",{options:[],append:!1,hasMore:!0,currentPage:1})),r("SET_GRADUATE_SCHOOL_PAGINATION",{currentPage:t.currentPage,hasMore:t.hasMore,isLoading:!0});const _=n?t.currentPage+1:1,o=await f.searchGraduateMajors({keyword:e,page:_,pageSize:t.pageSize});if(a.index.__f__("log","at store/user/baseInfo/actions.js:480","研究生专业搜索API返回:",o),o.success&&o.data){const c=o.data.items||[],u=o.data.hasMore!==!1&&c.length>=t.pageSize;return r("SET_GRADUATE_MAJOR_OPTIONS",{options:c,append:n,hasMore:u,currentPage:_}),a.index.__f__("log","at store/user/baseInfo/actions.js:495",`研究生专业搜索完成: 关键词="${e}", 页码=${_}, 结果数=${c.length}, 还有更多=${u}`),{success:!0,data:{options:c,hasMore:u,currentPage:_}}}else return a.index.__f__("error","at store/user/baseInfo/actions.js:506","研究生专业搜索失败:",o.error),Promise.reject(o.error||{message:"搜索专业失败"})}catch(t){return a.index.__f__("error","at store/user/baseInfo/actions.js:510","搜索研究生专业出错:",t),Promise.reject(t)}finally{r("SET_GRADUATE_SCHOOL_PAGINATION",{currentPage:s.graduateMajorSearch.currentPage,hasMore:s.graduateMajorSearch.hasMore,isLoading:!1})}},selectGraduateSchool({commit:r},{id:s,name:e}){r("SET_GRADUATE_SELECTED_SCHOOL",{id:s,name:e}),r("SET_GRADUATE_SELECTED_MAJOR",{id:null,name:""}),r("SET_GRADUATE_MAJOR_OPTIONS",[])},selectGraduateMajor({commit:r},{id:s,name:e}){r("SET_GRADUATE_SELECTED_MAJOR",{id:s,name:e})}};exports.actions=E;
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/store/user/baseInfo/actions.js.map
