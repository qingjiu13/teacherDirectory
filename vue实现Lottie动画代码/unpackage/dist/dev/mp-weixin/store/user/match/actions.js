"use strict";const e=require("../../../common/vendor.js"),T=require("../APIroute/match_api/match_api.js"),y=require("../JWT.js"),R=require("../../global.js"),w=()=>R.useGlobalStore().apiBaseUrl,C=({commit:o,dispatch:s},a)=>(o("SET_SEARCH_KEY",a),s("fetchMatchTeacherList")),b=async({commit:o,rootState:s,state:a},r={})=>{var c,_,n,t,l,h,u,f,d,E,I,S,j,x,P;try{const m=r.loadMore===!0,M=m?a.currentPage+1:1,O={mathId:((_=(c=a.nonProfessionalList)==null?void 0:c.math)==null?void 0:_.selectedId)||null,englishId:((t=(n=a.nonProfessionalList)==null?void 0:n.english)==null?void 0:t.selectedId)||null,politicsId:((h=(l=a.nonProfessionalList)==null?void 0:l.politics)==null?void 0:h.selectedId)||null,otherId:((f=(u=a.nonProfessionalList)==null?void 0:u.other)==null?void 0:f.selectedId)||null},A=(I=(E=(d=s==null?void 0:s.user)==null?void 0:d.schoolMajorRequest)==null?void 0:E.graduateSchoolSearch)==null?void 0:I.selectedSchoolId,L=(x=(j=(S=s==null?void 0:s.user)==null?void 0:S.schoolMajorRequest)==null?void 0:j.graduateMajorSearch)==null?void 0:x.selectedMajorId,D={school:A,professional:L,nonProfessionalList:O,sortMode:((P=a.sortMode)==null?void 0:P.selectedId)||null,pageNum:M,pageSize:r.pageSize||a.pageSize||10,searchKey:a.searchKey||""},i=await y.apiRequest(`${w()}/yanshilu/teacher/match`,"POST",D);if(e.index.__f__("log","at store/user/match/actions.js:64","匹配老师列表响应:",i),i!=null&&i.success&&i.data.code===200){const N=i.data.data,g=N.data||[];o(m?"APPEND_MATCH_LIST":"SET_MATCH_LIST",g),o("SET_PAGINATION",{currentPage:M,hasMore:N.hasMore||!1}),e.index.__f__("log","at store/user/match/actions.js:80","匹配老师列表更新成功:",g)}else e.index.__f__("warn","at store/user/match/actions.js:82","匹配接口返回数据格式异常:",i);return i}catch(m){throw e.index.__f__("error","at store/user/match/actions.js:87","获取匹配老师列表失败:",m),m}},q=({commit:o,rootState:s},{type:a})=>(s.user.baseInfo.id,new Promise((r,c)=>{T.getNonProfessionalOptions().then(_=>{r(_)}).catch(_=>{c(_)})})),H=({commit:o,rootState:s})=>(s.user.baseInfo.id,new Promise((a,r)=>{T.getSortModeOptions().then(c=>{if(c&&c.success&&c.data){const _=c.data;o("SET_SORT_OPTIONS",_.list||_)}a(c)}).catch(c=>{e.index.__f__("error","at store/user/match/actions.js:143","获取排序选项失败:",c),r(c)})})),z=({commit:o},{type:s,id:a,name:r})=>{o("SET_NON_PROFESSIONAL_SELECTION",{type:s,id:a,name:r})},J=({commit:o},{id:s,name:a})=>{o("SET_SELECTED_SORT_MODE",{id:s,name:a})},K=({commit:o,rootState:s},{teacherId:a})=>{e.index.__f__("log","at store/user/match/actions.js:180","=== fetchTeacherDetail 开始执行 ==="),e.index.__f__("log","at store/user/match/actions.js:181","teacherId:",a,"类型:",typeof a);const r=Number(a);if(!r||isNaN(r))return e.index.__f__("error","at store/user/match/actions.js:187","teacherId 无效，退出"),Promise.reject(new Error("老师ID不能为空或无效"));const c={teacherId:r};return e.index.__f__("log","at store/user/match/actions.js:196","构建的请求参数:",c),new Promise((_,n)=>{e.index.__f__("log","at store/user/match/actions.js:199","准备调用 getTeacherDetail API..."),T.getTeacherDetail(c).then(t=>{var l,h,u,f;if(e.index.__f__("log","at store/user/match/actions.js:203","=== API 响应完整数据 ==="),e.index.__f__("log","at store/user/match/actions.js:204","response:",JSON.stringify(t,null,2)),t&&t.success&&t.data&&t.data.code===200)if(e.index.__f__("log","at store/user/match/actions.js:208","response.success 为 true，response.data.code 为 200，请求成功"),t.data.data){e.index.__f__("log","at store/user/match/actions.js:211","response.data.data 存在"),e.index.__f__("log","at store/user/match/actions.js:212","response.data.data:",JSON.stringify(t.data.data,null,2));const d=t.data.data;e.index.__f__("log","at store/user/match/actions.js:216","准备调用 SET_TEACHER_DETAIL mutation..."),e.index.__f__("log","at store/user/match/actions.js:217","teacherId:",r),e.index.__f__("log","at store/user/match/actions.js:218","detail:",JSON.stringify(d,null,2)),e.index.__f__("log","at store/user/match/actions.js:219","服务数量:",((l=d.service)==null?void 0:l.length)||0),o("SET_TEACHER_DETAIL",{teacherId:r,detail:d}),e.index.__f__("log","at store/user/match/actions.js:227","SET_TEACHER_DETAIL mutation 调用完成")}else{e.index.__f__("error","at store/user/match/actions.js:229","response.data.data 不存在"),n(new Error("响应数据中缺少data.data字段"));return}else{e.index.__f__("error","at store/user/match/actions.js:234","请求失败，success:",t==null?void 0:t.success,"code:",(h=t==null?void 0:t.data)==null?void 0:h.code,"msg:",(u=t==null?void 0:t.data)==null?void 0:u.msg),n(new Error(((f=t==null?void 0:t.data)==null?void 0:f.msg)||"获取老师详情失败"));return}e.index.__f__("log","at store/user/match/actions.js:239","=== fetchTeacherDetail 成功完成 ==="),_(t)}).catch(t=>{e.index.__f__("error","at store/user/match/actions.js:243","=== fetchTeacherDetail 发生错误 ==="),e.index.__f__("error","at store/user/match/actions.js:244","错误详情:",t),n(t)})})},v={setSearchKey:C,fetchMatchTeacherList:b,fetchNonProfessionalOptions:q,fetchSortModeOptions:H,selectNonProfessional:z,selectSortMode:J,fetchTeacherDetail:K};exports.actions=v;
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/store/user/match/actions.js.map
