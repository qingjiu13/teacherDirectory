"use strict";const e=require("../../common/vendor.js"),s=require("../../common/assets.js"),a=()=>"../../components/navigationTitleBar/header.js",u=e.defineComponent({components:{Header:a},data(){return{userInfo:new UTSJSONObject({avatar:"",nickname:"",introduction:"",gender:"",phone:"",wechat:"",password:"未设置"}),updating:!1,originalData:null}},computed:Object.assign(Object.assign(Object.assign({},e.mapState("user/baseInfo",new UTSJSONObject({storeId:(n=null)=>n.id,storeAvatar:(n=null)=>n.avatar,storeName:(n=null)=>n.name,storeGender:(n=null)=>n.gender,storeSelfIntroduction:(n=null)=>n.selfIntroduction,storeWechatNumber:(n=null)=>n.wechatNumber,storePhoneNumber:(n=null)=>n.phoneNumber,storePassword:(n=null)=>n.password}))),e.mapGetters("user/baseInfo",["profile","userRole","isTeacher"])),{isDataChanged(){return this.originalData?UTS.JSON.stringify(this.userInfo)!==UTS.JSON.stringify(this.originalData):!1}}),onLoad(){this.initUserInfo()},onShow(){this.initUserInfo()},methods:Object.assign(Object.assign(Object.assign({},e.mapActions("user/baseInfo",["getUserInfo"])),e.mapMutations("user/baseInfo",["UPDATE_USER_PROFILE"])),{initUserInfo(){return e.__awaiter(this,void 0,void 0,function*(){try{e.index.__f__("log","at pagesMine/modify/modify.vue:197","初始化用户信息..."),this.userInfo={avatar:this.storeAvatar||"",nickname:this.storeName||"",introduction:this.storeSelfIntroduction||"",gender:this.storeGender||"",phone:this.storePhoneNumber||"",wechat:this.storeWechatNumber||"",password:this.storePassword||"未设置"},e.index.__f__("log","at pagesMine/modify/modify.vue:210","从store获取的用户信息:",this.userInfo),this.originalData=UTS.JSON.parse(UTS.JSON.stringify(this.userInfo))}catch(n){e.index.__f__("error","at pagesMine/modify/modify.vue:215","获取用户信息失败",n),e.index.showToast({title:"获取用户信息失败"})}})},chooseAvatar(){e.index.chooseImage(new UTSJSONObject({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:n=>{const i=n.tempFilePaths[0];this.userInfo.avatar=i}}))},handleBack(){e.index.navigateBack()},saveProfile(){return e.__awaiter(this,void 0,void 0,function*(){if(!this.userInfo.nickname)return e.index.showToast({title:"昵称不能为空"}),Promise.resolve(null);if(this.userInfo.phone&&!/^1\d{10}$/.test(this.userInfo.phone))return e.index.showToast({title:"手机号格式不正确"}),Promise.resolve(null);if(!this.isDataChanged)return e.index.showToast({title:"未检测到数据变更"}),setTimeout(()=>{e.index.navigateBack()},1500),Promise.resolve(null);try{this.updating=!0,e.index.__f__("log","at pagesMine/modify/modify.vue:275","开始保存用户资料...");const n=new UTSJSONObject({avatar:this.userInfo.avatar,nickname:this.userInfo.nickname,name:this.userInfo.nickname,selfIntroduction:this.userInfo.introduction,introduction:this.userInfo.introduction,gender:this.userInfo.gender,phoneNumber:this.userInfo.phone,phone:this.userInfo.phone,wechatNumber:this.userInfo.wechat,password:this.userInfo.password});e.index.__f__("log","at pagesMine/modify/modify.vue:292","要更新的用户资料:",n),this.UPDATE_USER_PROFILE(n),e.index.showToast({title:"保存成功"}),this.originalData=UTS.JSON.parse(UTS.JSON.stringify(this.userInfo)),setTimeout(()=>{e.index.navigateBack()},1500)}catch(n){e.index.__f__("error","at pagesMine/modify/modify.vue:310","保存失败",n),e.index.showToast({title:n.message||"保存失败"})}finally{this.updating=!1}})}})});Array||e.resolveComponent("Header")();function f(n,i,h,d,t,o){return{a:e.o(o.handleBack),b:e.p({title:"修改资料"}),c:s._imports_0$6,d:s._imports_1$6,e:t.userInfo.avatar||"/static/image/defaultAvatar/teacher-man.png",f:e.o((...r)=>o.chooseAvatar&&o.chooseAvatar(...r)),g:t.userInfo.nickname,h:e.o(r=>t.userInfo.nickname=r.detail.value),i:t.userInfo.gender==="男"?1:"",j:e.o(r=>t.userInfo.gender="男"),k:t.userInfo.gender==="女"?1:"",l:e.o(r=>t.userInfo.gender="女"),m:t.userInfo.phone,n:e.o(r=>t.userInfo.phone=r.detail.value),o:t.userInfo.wechat,p:e.o(r=>t.userInfo.wechat=r.detail.value),q:t.userInfo.password,r:e.o(r=>t.userInfo.password=r.detail.value),s:t.userInfo.introduction,t:e.o(r=>t.userInfo.introduction=r.detail.value),v:e.t(t.userInfo.introduction.length),w:s._imports_2$1,x:e.o((...r)=>o.saveProfile&&o.saveProfile(...r)),y:t.updating}}const c=e._export_sfc(u,[["render",f]]);wx.createPage(c);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/modify/modify.js.map
