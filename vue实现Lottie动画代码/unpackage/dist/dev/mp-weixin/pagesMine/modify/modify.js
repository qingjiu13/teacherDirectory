"use strict";const e=require("../../common/vendor.js"),i=e.defineComponent({data(){return{userInfo:new UTSJSONObject({avatar:"",nickname:"",introduction:"",gender:"",phone:"",wechat:"",password:"未设置"}),updating:!1,originalData:null}},computed:Object.assign(Object.assign(Object.assign({},e.mapState("user/baseInfo",new UTSJSONObject({storeId:(n=null)=>n.id,storeAvatar:(n=null)=>n.avatar,storeName:(n=null)=>n.name,storeGender:(n=null)=>n.gender,storeSelfIntroduction:(n=null)=>n.selfIntroduction,storeWechatNumber:(n=null)=>n.wechatNumber,storePhoneNumber:(n=null)=>n.phoneNumber,storePassword:(n=null)=>n.password}))),e.mapGetters("user/baseInfo",["profile","userRole","isTeacher"])),{isDataChanged(){return this.originalData?UTS.JSON.stringify(this.userInfo)!==UTS.JSON.stringify(this.originalData):!1}}),onLoad(){this.initUserInfo()},onShow(){this.initUserInfo()},methods:Object.assign(Object.assign(Object.assign({},e.mapActions("user/baseInfo",["getUserInfo"])),e.mapMutations("user/baseInfo",["UPDATE_USER_PROFILE"])),{initUserInfo(){return e.__awaiter(this,void 0,void 0,function*(){try{e.index.__f__("log","at pagesMine/modify/modify.vue:169","初始化用户信息..."),this.userInfo={avatar:this.storeAvatar||"",nickname:this.storeName||"",introduction:this.storeSelfIntroduction||"",gender:this.storeGender||"",phone:this.storePhoneNumber||"",wechat:this.storeWechatNumber||"",password:this.storePassword||"未设置"},e.index.__f__("log","at pagesMine/modify/modify.vue:182","从store获取的用户信息:",this.userInfo),this.originalData=UTS.JSON.parse(UTS.JSON.stringify(this.userInfo))}catch(n){e.index.__f__("error","at pagesMine/modify/modify.vue:187","获取用户信息失败",n),e.index.showToast({title:"获取用户信息失败",icon:"none"})}})},chooseAvatar(){e.index.chooseImage(new UTSJSONObject({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:n=>{const r=n.tempFilePaths[0];this.userInfo.avatar=r}}))},saveProfile(){return e.__awaiter(this,void 0,void 0,function*(){if(!this.userInfo.nickname)return e.index.showToast({title:"昵称不能为空",icon:"none"}),Promise.resolve(null);if(this.userInfo.phone&&!/^1\d{10}$/.test(this.userInfo.phone))return e.index.showToast({title:"手机号格式不正确",icon:"none"}),Promise.resolve(null);if(!this.isDataChanged)return e.index.showToast({title:"未检测到数据变更",icon:"none"}),setTimeout(()=>{e.index.navigateBack()},1500),Promise.resolve(null);try{this.updating=!0,e.index.__f__("log","at pagesMine/modify/modify.vue:249","开始保存用户资料...");const n=new UTSJSONObject({avatar:this.userInfo.avatar,nickname:this.userInfo.nickname,name:this.userInfo.nickname,selfIntroduction:this.userInfo.introduction,introduction:this.userInfo.introduction,gender:this.userInfo.gender,phoneNumber:this.userInfo.phone,phone:this.userInfo.phone,wechatNumber:this.userInfo.wechat,password:this.userInfo.password});e.index.__f__("log","at pagesMine/modify/modify.vue:266","要更新的用户资料:",n),this.UPDATE_USER_PROFILE(n),e.index.showToast({title:"保存成功",icon:"success"}),this.originalData=UTS.JSON.parse(UTS.JSON.stringify(this.userInfo)),setTimeout(()=>{e.index.navigateBack()},1500)}catch(n){e.index.__f__("error","at pagesMine/modify/modify.vue:285","保存失败",n),e.index.showToast({title:n.message||"保存失败",icon:"none"})}finally{this.updating=!1}})}})});function a(n,r,f,c,o,t){return{a:o.userInfo.avatar||"/static/image/defaultAvatar/teacher-man.png",b:e.o((...s)=>t.chooseAvatar&&t.chooseAvatar(...s)),c:o.userInfo.nickname,d:e.o(s=>o.userInfo.nickname=s.detail.value),e:o.userInfo.introduction,f:e.o(s=>o.userInfo.introduction=s.detail.value),g:e.t(o.userInfo.introduction.length),h:o.userInfo.gender==="男"?1:"",i:e.o(s=>o.userInfo.gender="男"),j:o.userInfo.gender==="女"?1:"",k:e.o(s=>o.userInfo.gender="女"),l:o.userInfo.phone,m:e.o(s=>o.userInfo.phone=s.detail.value),n:o.userInfo.wechat,o:e.o(s=>o.userInfo.wechat=s.detail.value),p:o.userInfo.password,q:e.o(s=>o.userInfo.password=s.detail.value),r:e.o((...s)=>t.saveProfile&&t.saveProfile(...s)),s:o.updating,t:e.sei(e.gei(n,""),"view")}}const u=e._export_sfc(i,[["render",a]]);wx.createPage(u);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/modify/modify.js.map
