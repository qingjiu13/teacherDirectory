"use strict";const e=require("../../common/vendor.js"),r=()=>"../../pages_AI_Login_Match/components/combobox/combobox.js",u=e.defineComponent({components:{ChoiceSelected:r},data(){return{mode:"add",serviceId:null,coverUrls:[],avatarUrl:"",selectedServiceType:"",selectedServiceTypeIndex:-1,serviceTypes:["一对一课程","一对多课程","学习资料"],coursequantity:"",showServiceTypeDropdown:!1,duration:"",description:"",price:"",files:[],showDuration:!0,showAttachment:!1,originalService:null,serviceName:"",selectedLessonsIndex:-1,lessonOptions:["1","2","3","4","5","6","7","8","9","10","20"],selectedHoursIndex:-1,hourOptions:["1","2","3","4","5","6","8","10"],selectedMinutesIndex:-1,minuteOptions:["0","15","30","45"],selectedMultiHoursIndex:-1,selectedMultiMinutesIndex:-1,multiServiceName:"",selectedPersonCountIndex:-1,personCountOptions:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]}},onLoad(i){if(i.mode==="edit"&&i.id&&(this.mode="edit",this.serviceId=i.id,getApp().globalData&&getApp().globalData.editingService)){const t=getApp().globalData.editingService;this.originalService=UTS.JSON.parse(UTS.JSON.stringify(t)),this.fillFormWithServiceData(t)}e.index.$on("serviceEdited",this.handleServiceEdited)},onUnload(){e.index.$off("serviceEdited",this.handleServiceEdited)},methods:{chooseAvatar(){e.index.chooseImage(new UTSJSONObject({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:i=>{this.avatarUrl=i.tempFilePaths[0]}}))},chooseCover(){const i=9-this.coverUrls.length;if(i<=0)return e.index.showToast({title:"最多只能上传9张图片",icon:"none"}),null;e.index.chooseImage(new UTSJSONObject({count:i,sizeType:["compressed"],sourceType:["album","camera"],success:t=>{this.coverUrls=[...this.coverUrls,...t.tempFilePaths]}}))},deleteCover(i=null){this.coverUrls.splice(i,1)},fillFormWithServiceData(i=null){if(this.coverUrls=i.imageUrls||[],this.selectedServiceType=i.name||"",this.selectedServiceTypeIndex=this.serviceTypes.findIndex(t=>t===i.name),this.price=i.price?i.price.replace("¥",""):"",this.description=i.description||"",this.selectedServiceType==="一对一课程"){if(this.serviceName=i.serviceName||"",i.lessons&&(this.selectedLessonsIndex=this.lessonOptions.findIndex(t=>t===i.lessons.toString())),i.totalDuration){const t=i.totalDuration.match(/(\d+)小时(\d+)分钟/);t&&(this.selectedHoursIndex=this.hourOptions.findIndex(n=>n===t[1]),this.selectedMinutesIndex=this.minuteOptions.findIndex(n=>n===t[2]))}}else if(this.selectedServiceType==="一对多课程"){if(this.multiServiceName=i.serviceName||"",i.lessons&&(this.selectedLessonsIndex=this.lessonOptions.findIndex(t=>t===i.lessons.toString())),i.totalDuration){const t=i.totalDuration.match(/(\d+)小时(\d+)分钟/);t&&(this.selectedMultiHoursIndex=this.hourOptions.findIndex(n=>n===t[1]),this.selectedMultiMinutesIndex=this.minuteOptions.findIndex(n=>n===t[2]))}i.personCount&&(this.selectedPersonCountIndex=this.personCountOptions.findIndex(t=>t===i.personCount.toString()))}else this.coursequantity=i.coursequantity||"";this.updateFormFields()},goBack(){e.index.navigateBack()},handleServiceTypeSelect(i=null){this.selectedServiceTypeIndex=i,this.selectedServiceType=this.serviceTypes[i],this.selectedServiceType==="一对一课程"?(this.selectedLessonsIndex=-1,this.selectedHoursIndex=-1,this.selectedMinutesIndex=-1,this.serviceName=""):this.selectedServiceType==="一对多课程"?(this.selectedLessonsIndex=-1,this.selectedMultiHoursIndex=-1,this.selectedMultiMinutesIndex=-1,this.multiServiceName="",this.selectedPersonCountIndex=-1):this.selectedServiceType==="学习资料"&&(this.coursequantity=""),this.updateFormFields()},handleLessonsSelect(i=null){this.selectedLessonsIndex=i},handleHoursSelect(i=null){this.selectedHoursIndex=i},handleMinutesSelect(i=null){this.selectedMinutesIndex=i},handleMultiHoursSelect(i=null){this.selectedMultiHoursIndex=i},handleMultiMinutesSelect(i=null){this.selectedMultiMinutesIndex=i},handlePersonCountSelect(i=null){this.selectedPersonCountIndex=i},updateFormFields(){this.selectedServiceType==="学习资料"?(this.showDuration=!1,this.showAttachment=!0):(this.showDuration=!0,this.showAttachment=this.selectedServiceType==="学习资料")},chooseFile(){e.index.chooseImage(new UTSJSONObject({count:1,success:i=>{this.files=i.tempFilePaths}}))},submitForm(){if(e.index.showLoading({title:"提交中..."}),this.coverUrls.length===0)return e.index.showToast({title:"请上传封面图片",icon:"none"}),e.index.hideLoading(),null;if(!this.selectedServiceType)return e.index.showToast({title:"请选择服务类型",icon:"none"}),e.index.hideLoading(),null;if(this.selectedServiceType==="一对一课程"){if(this.selectedLessonsIndex===-1)return e.index.showToast({title:"请选择课程节数",icon:"none"}),e.index.hideLoading(),null;if(this.selectedHoursIndex===-1||this.selectedMinutesIndex===-1)return e.index.showToast({title:"请选择课程时长",icon:"none"}),e.index.hideLoading(),null;if(!this.serviceName)return e.index.showToast({title:"请填写服务名称",icon:"none"}),e.index.hideLoading(),null}else if(this.selectedServiceType==="一对多课程"){if(this.selectedLessonsIndex===-1)return e.index.showToast({title:"请选择课程节数",icon:"none"}),e.index.hideLoading(),null;if(this.selectedMultiHoursIndex===-1||this.selectedMultiMinutesIndex===-1)return e.index.showToast({title:"请选择课程时长",icon:"none"}),e.index.hideLoading(),null;if(!this.multiServiceName)return e.index.showToast({title:"请填写服务名称",icon:"none"}),e.index.hideLoading(),null;if(this.selectedPersonCountIndex===-1)return e.index.showToast({title:"请选择课程人数",icon:"none"}),e.index.hideLoading(),null}else if(this.selectedServiceType==="学习资料"&&!this.coursequantity)return e.index.showToast({title:"请填写课程数量",icon:"none"}),e.index.hideLoading(),null;if(!this.price)return e.index.showToast({title:"请填写服务价格",icon:"none"}),e.index.hideLoading(),null;let i=new UTSJSONObject({name:this.selectedServiceType,price:this.price.startsWith("¥")?this.price:"¥"+this.price,description:this.description||`这是一个${this.selectedServiceType}服务`,checked:!1,imageUrls:this.coverUrls,imageUrl:this.coverUrls[0]});this.selectedServiceType==="一对一课程"?(i.serviceName=this.serviceName,i.lessons=this.lessonOptions[this.selectedLessonsIndex],i.totalDuration=`${this.hourOptions[this.selectedHoursIndex]}小时${this.minuteOptions[this.selectedMinutesIndex]}分钟`):this.selectedServiceType==="一对多课程"?(i.serviceName=this.multiServiceName,i.lessons=this.lessonOptions[this.selectedLessonsIndex],i.totalDuration=`${this.hourOptions[this.selectedMultiHoursIndex]}小时${this.minuteOptions[this.selectedMultiMinutesIndex]}分钟`,i.personCount=this.personCountOptions[this.selectedPersonCountIndex]):i.coursequantity=this.coursequantity,this.mode==="edit"&&this.serviceId&&this.originalService?(i.id=this.serviceId,i.checked=this.originalService.checked,this.updateExistingService(i)):(i.id=Date.now(),this.addNewService(i))},addNewService(i=null){try{const t=e.index.getStorageSync("services");let n=[];t&&(n=UTS.JSON.parse(t));const l=n.findIndex(s=>s.id===i.id);l!==-1?n[l]=i:n.push(i),e.index.setStorageSync("services",UTS.JSON.stringify(n)),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.newServiceAdded=!0,getApp().globalData.newService=i,e.index.hideLoading(),e.index.showToast({title:"提交成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack(new UTSJSONObject({delta:1,success:()=>{e.index.$emit("serviceAdded",i)}}))},1500)}catch(t){e.index.__f__("error","at pagesMine/service/service_newbuilt.vue:634","保存服务失败",t),e.index.hideLoading(),e.index.showToast({title:"保存失败，请重试",icon:"none"})}},updateExistingService(i=null){try{const t=e.index.getStorageSync("services");let n=[];t&&(n=UTS.JSON.parse(t));const l=n.findIndex(s=>s.id==this.serviceId);l!==-1?n[l]=i:n.push(i),e.index.setStorageSync("services",UTS.JSON.stringify(n)),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.serviceEdited=!0,getApp().globalData.editedService=i,e.index.hideLoading(),e.index.showToast({title:"更新成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack(new UTSJSONObject({delta:1,success:()=>{e.index.$emit("serviceEdited",i)}}))},1500)}catch(t){e.index.__f__("error","at pagesMine/service/service_newbuilt.vue:688","更新服务失败",t),e.index.hideLoading(),e.index.showToast({title:"更新失败，请重试",icon:"none"})}},handleServiceEdited(i=null){e.index.__f__("log","at pagesMine/service/service_newbuilt.vue:697","Service edited",i)}}});Array||e.resolveComponent("choice-selected")();function h(i,t,n,l,s,c){return e.e({a:e.o(c.handleServiceTypeSelect),b:e.p({choiceIndex:s.selectedServiceTypeIndex,choiceList:s.serviceTypes,defaultText:"请选择服务类型"}),c:s.selectedServiceType==="一对一课程"},s.selectedServiceType==="一对一课程"?{d:e.o(c.handleLessonsSelect),e:e.p({choiceIndex:s.selectedLessonsIndex,choiceList:s.lessonOptions,defaultText:"请选择节数"})}:{},{f:s.selectedServiceType==="一对多课程"},s.selectedServiceType==="一对多课程"?{g:e.o(c.handleLessonsSelect),h:e.p({choiceIndex:s.selectedLessonsIndex,choiceList:s.lessonOptions,defaultText:"请选择节数"})}:{},{i:s.selectedServiceType==="一对一课程"},s.selectedServiceType==="一对一课程"?{j:e.o(c.handleHoursSelect),k:e.p({choiceIndex:s.selectedHoursIndex,choiceList:s.hourOptions,defaultText:"小时"}),l:e.o(c.handleMinutesSelect),m:e.p({choiceIndex:s.selectedMinutesIndex,choiceList:s.minuteOptions,defaultText:"分钟"}),n:s.serviceName,o:e.o(o=>s.serviceName=o.detail.value)}:{},{p:s.selectedServiceType==="一对多课程"},s.selectedServiceType==="一对多课程"?{q:e.o(c.handleMultiHoursSelect),r:e.p({choiceIndex:s.selectedMultiHoursIndex,choiceList:s.hourOptions,defaultText:"小时"}),s:e.o(c.handleMultiMinutesSelect),t:e.p({choiceIndex:s.selectedMultiMinutesIndex,choiceList:s.minuteOptions,defaultText:"分钟"}),v:e.o(c.handlePersonCountSelect),w:e.p({choiceIndex:s.selectedPersonCountIndex,choiceList:s.personCountOptions,defaultText:"请选择课程人数"}),x:s.multiServiceName,y:e.o(o=>s.multiServiceName=o.detail.value)}:{},{z:s.selectedServiceType==="学习资料"},s.selectedServiceType==="学习资料"?{A:s.coursequantity,B:e.o(o=>s.coursequantity=o.detail.value)}:{},{C:s.description,D:e.o(o=>s.description=o.detail.value),E:s.price,F:e.o(o=>s.price=o.detail.value),G:s.showAttachment},s.showAttachment?{H:e.o((...o)=>c.chooseFile&&c.chooseFile(...o))}:{},{I:e.f(s.coverUrls,(o,d,x)=>({a:o,b:e.o(a=>c.deleteCover(d),d),c:d})),J:s.coverUrls.length<9},s.coverUrls.length<9?{K:e.o((...o)=>c.chooseCover&&c.chooseCover(...o))}:{},{L:s.mode==="add"},s.mode==="add"?{}:{},{M:e.o((...o)=>c.submitForm&&c.submitForm(...o)),N:e.sei(e.gei(i,""),"view")})}const p=e._export_sfc(u,[["render",h]]);wx.createPage(p);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/service/service_newbuilt.js.map
