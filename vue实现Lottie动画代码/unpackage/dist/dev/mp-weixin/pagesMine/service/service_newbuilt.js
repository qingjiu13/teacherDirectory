"use strict";const t=require("../../common/vendor.js"),r=require("../../router/Router.js"),d=()=>"../components/combobox/combobox.js",h=()=>"../../components/navigationTitleBar/header.js",a=t.defineComponent({components:{"choice-selected":d,Header:h},data(){return{hasEdited:!1,mode:"add",serviceId:"",coverUrls:[],avatarUrl:"",selectedServiceType:"",selectedServiceTypeIndex:-1,serviceTypes:["一对一课程","一对多课程","学习资料"],coursequantity:"",showServiceTypeDropdown:!1,duration:"",description:"",price:"",files:[],showDuration:!1,showAttachment:!1,originalService:null,serviceName:"",selectedLessonsIndex:-1,lessonOptions:["1","2","3","4","5","6","8","10","12","16","20"],selectedHoursIndex:-1,hourOptions:["1","2","4","6","8","10","12","24","48","60","120"],selectedMinutesIndex:-1,minuteOptions:["0","15","30","45"],selectedMultiHoursIndex:-1,selectedMultiMinutesIndex:-1,multiServiceName:"",selectedPersonCountIndex:-1,personCountOptions:["2","4","6","8","10","15","20","30"],statusBarHeight:0}},onLoad(e){t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:271","==============================="),t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:272","service_newbuilt onLoad:",e),this.setStatusBarHeight(),e&&e.mode?(this.mode=e.mode,t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:280","当前模式:",this.mode),e.mode==="edit"&&e.id&&(this.serviceId=e.id,t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:285","编辑服务ID:",this.serviceId),getApp().globalData&&getApp().globalData.editingService?t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:289","全局状态中存在编辑服务数据:",getApp().globalData.editingService):t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:291","全局状态中不存在编辑服务数据"),this.loadEditingService())):(t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:298","未检测到模式参数，默认为新建模式"),this.mode="add"),this.updateFormFields(),t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:304","===============================")},onUnload(){t.index.$off("serviceEdited",this.handleServiceEdited),getApp().globalData&&(getApp().globalData.editingService=null)},methods:{setStatusBarHeight(){const e=t.index.getSystemInfoSync();this.statusBarHeight=e.statusBarHeight,typeof document<"u"&&document.documentElement&&document.documentElement.style.setProperty("--status-bar-height",`${this.statusBarHeight}px`)},chooseAvatar(){t.index.chooseImage(new UTSJSONObject({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{this.avatarUrl=e.tempFilePaths[0]}}))},chooseCover(){const e=9-this.coverUrls.length;if(e<=0)return t.index.showToast({title:"最多只能上传9张图片",icon:"none"}),null;t.index.chooseImage(new UTSJSONObject({count:e,sizeType:["compressed"],sourceType:["album","camera"],success:s=>{this.coverUrls=[...this.coverUrls,...s.tempFilePaths],this.hasEdited=!0}}))},deleteCover(e=null){this.coverUrls.splice(e,1),this.hasEdited=!0},loadEditingService(){try{if(t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:365","开始加载编辑服务数据..."),t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:366","服务ID:",this.serviceId),getApp().globalData&&getApp().globalData.editingService){const s=getApp().globalData.editingService;if(t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:371","从全局数据获取到编辑服务:",s),s.id.toString()===this.serviceId.toString())return t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:375","ID匹配，使用全局数据"),this.originalService=s,this.fillFormWithServiceData(this.originalService),t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:380","表单填充完成"),null;t.index.__f__("warn","at pagesMine/service/service_newbuilt.vue:383","全局数据中的服务ID不匹配")}else t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:386","全局数据中不存在编辑服务数据");const e=t.index.getStorageSync("services");if(e){const s=UTS.JSON.parse(e);t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:393","从本地存储获取到服务列表，共",s.length,"条记录");const o=s.find((l=null)=>l.id.toString()===this.serviceId.toString());o?(t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:398","在本地存储中找到匹配的服务:",o),this.originalService=o,this.fillFormWithServiceData(o),t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:403","表单填充完成")):(t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:405","在本地存储中找不到匹配的服务"),t.index.showToast({title:"找不到服务数据",icon:"none"}),setTimeout(()=>{t.index.navigateBack()},1500))}else t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:417","本地存储中不存在服务数据"),t.index.showToast({title:"找不到服务数据",icon:"none"}),setTimeout(()=>{t.index.navigateBack()},1500)}catch(e){t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:429","加载服务数据失败:",e),t.index.showToast({title:"加载数据失败",icon:"none"})}},fillFormWithServiceData(e=null){if(this.coverUrls=e.imageUrls||(e.imageUrl?[e.imageUrl]:[]),e.type&&e.type.typename?(this.selectedServiceType=e.type.typename,this.selectedServiceTypeIndex=this.serviceTypes.findIndex(s=>s===e.type.typename)):(this.selectedServiceType=e.name||"",this.selectedServiceTypeIndex=this.serviceTypes.findIndex(s=>s===e.name)),this.price=e.price?e.price.replace(/[¥￥]/g,""):"",this.description=e.description||"",this.selectedServiceType==="一对一课程"){if(this.serviceName=e.serviceName||e.name||"",e.lessons?this.selectedLessonsIndex=this.lessonOptions.findIndex(s=>s===e.lessons.toString()):e.type&&e.type.coursenum&&(this.selectedLessonsIndex=this.lessonOptions.findIndex(s=>parseInt(s)===e.type.coursenum)),e.totalDuration){const s=e.totalDuration.match(/(\d+)小时(\d+)分钟/);s&&(this.selectedHoursIndex=this.hourOptions.findIndex(o=>o===s[1]),this.selectedMinutesIndex=this.minuteOptions.findIndex(o=>o===s[2]))}else if(e.type&&e.type.fulllength){const s=e.type.fulllength.hours||"",o=e.type.fulllength.minutes||"",l=s.match(/(\d+)/),i=o.match(/(\d+)/);l&&(this.selectedHoursIndex=this.hourOptions.findIndex(n=>n===l[1])),i&&(this.selectedMinutesIndex=this.minuteOptions.findIndex(n=>n===i[1]))}}else if(this.selectedServiceType==="一对多课程"){if(this.multiServiceName=e.serviceName||e.name||"",e.lessons?this.selectedLessonsIndex=this.lessonOptions.findIndex(s=>s===e.lessons.toString()):e.type&&e.type.coursenum&&(this.selectedLessonsIndex=this.lessonOptions.findIndex(s=>parseInt(s)===e.type.coursenum)),e.totalDuration){const s=e.totalDuration.match(/(\d+)小时(\d+)分钟/);s&&(this.selectedMultiHoursIndex=this.hourOptions.findIndex(o=>o===s[1]),this.selectedMultiMinutesIndex=this.minuteOptions.findIndex(o=>o===s[2]))}else if(e.type&&e.type.fulllength){const s=e.type.fulllength.hours||"",o=e.type.fulllength.minutes||"",l=s.match(/(\d+)/),i=o.match(/(\d+)/);l&&(this.selectedMultiHoursIndex=this.hourOptions.findIndex(n=>n===l[1])),i&&(this.selectedMultiMinutesIndex=this.minuteOptions.findIndex(n=>n===i[1]))}e.personCount?this.selectedPersonCountIndex=this.personCountOptions.findIndex(s=>s===e.personCount.toString()):e.type&&e.type.studentnum&&(this.selectedPersonCountIndex=this.personCountOptions.findIndex(s=>parseInt(s)===e.type.studentnum))}else this.selectedServiceType==="学习资料"&&(this.coursequantity=e.coursequantity||e.name||"");this.updateFormFields()},goBack(){this.hasEdited?t.index.showModal(new UTSJSONObject({title:"提示",content:"是否保存已编辑的内容？",cancelText:"不保存",confirmText:"保存",success:e=>{e.confirm?this.submitForm():r.Navigator.toService()}})):r.Navigator.toService()},handleServiceTypeSelect(e=null){this.selectedServiceTypeIndex=e,this.selectedServiceType=this.serviceTypes[e],this.selectedServiceType==="一对一课程"?(this.selectedLessonsIndex=-1,this.selectedHoursIndex=-1,this.selectedMinutesIndex=-1,this.serviceName=""):this.selectedServiceType==="一对多课程"?(this.selectedLessonsIndex=-1,this.selectedMultiHoursIndex=-1,this.selectedMultiMinutesIndex=-1,this.multiServiceName="",this.selectedPersonCountIndex=-1):this.selectedServiceType==="学习资料"&&(this.coursequantity=""),this.updateFormFields(),this.hasEdited=!0},handleLessonsSelect(e=null){this.selectedLessonsIndex=e,this.hasEdited=!0},handleHoursSelect(e=null){this.selectedHoursIndex=e,this.hasEdited=!0},handleMinutesSelect(e=null){this.selectedMinutesIndex=e,this.hasEdited=!0},handleMultiHoursSelect(e=null){this.selectedMultiHoursIndex=e,this.hasEdited=!0},handleMultiMinutesSelect(e=null){this.selectedMultiMinutesIndex=e,this.hasEdited=!0},handlePersonCountSelect(e=null){this.selectedPersonCountIndex=e,this.hasEdited=!0},updateFormFields(){this.selectedServiceType==="学习资料"?(this.showDuration=!1,this.showAttachment=!0):(this.showDuration=!0,this.showAttachment=this.selectedServiceType==="学习资料")},chooseFile(){t.index.chooseImage(new UTSJSONObject({count:1,success:e=>{this.files=e.tempFilePaths,this.hasEdited=!0}}))},submitForm(){if(t.index.showLoading({title:"提交中..."}),this.coverUrls.length===0)return t.index.showToast({title:"请上传封面图片",icon:"none"}),t.index.hideLoading(),null;if(!this.selectedServiceType)return t.index.showToast({title:"请选择服务类型",icon:"none"}),t.index.hideLoading(),null;if(this.selectedServiceType==="一对一课程"){if(this.selectedLessonsIndex===-1)return t.index.showToast({title:"请选择课程节数",icon:"none"}),t.index.hideLoading(),null;if(this.selectedHoursIndex===-1||this.selectedMinutesIndex===-1)return t.index.showToast({title:"请选择课程时长",icon:"none"}),t.index.hideLoading(),null;if(!this.serviceName)return t.index.showToast({title:"请填写服务名称",icon:"none"}),t.index.hideLoading(),null}else if(this.selectedServiceType==="一对多课程"){if(this.selectedLessonsIndex===-1)return t.index.showToast({title:"请选择课程节数",icon:"none"}),t.index.hideLoading(),null;if(this.selectedMultiHoursIndex===-1||this.selectedMultiMinutesIndex===-1)return t.index.showToast({title:"请选择课程时长",icon:"none"}),t.index.hideLoading(),null;if(!this.multiServiceName)return t.index.showToast({title:"请填写服务名称",icon:"none"}),t.index.hideLoading(),null;if(this.selectedPersonCountIndex===-1)return t.index.showToast({title:"请选择课程人数",icon:"none"}),t.index.hideLoading(),null}else if(this.selectedServiceType==="学习资料"&&!this.coursequantity)return t.index.showToast({title:"请填写服务名称",icon:"none"}),t.index.hideLoading(),null;if(!this.price)return t.index.showToast({title:"请填写服务价格",icon:"none"}),t.index.hideLoading(),null;let e=new UTSJSONObject({});this.mode==="edit"&&this.originalService?e=new UTSJSONObject(Object.assign(Object.assign({},this.originalService),{name:this.selectedServiceType,price:this.price.startsWith("¥")?this.price:"¥"+this.price,description:this.description||`这是一个${this.selectedServiceType}服务`,imageUrls:this.coverUrls,imageUrl:this.coverUrls[0]||""})):e=new UTSJSONObject({id:Date.now().toString(),name:this.selectedServiceType,price:this.price.startsWith("¥")?this.price:"¥"+this.price,description:this.description||`这是一个${this.selectedServiceType}服务`,checked:!1,imageUrls:this.coverUrls,imageUrl:this.coverUrls[0]||"",createTime:new Date().toISOString().split("T")[0],updateTime:new Date().toISOString().split("T")[0],status:"active"}),this.selectedServiceType==="一对一课程"?(e.serviceName=this.serviceName,e.lessons=this.lessonOptions[this.selectedLessonsIndex],e.totalDuration=`${this.hourOptions[this.selectedHoursIndex]}小时${this.minuteOptions[this.selectedMinutesIndex]}分钟`,e.type=new UTSJSONObject({typename:"一对一课程",coursenum:parseInt(this.lessonOptions[this.selectedLessonsIndex]),fulllength:new UTSJSONObject({hours:`${this.hourOptions[this.selectedHoursIndex]}小时`,minutes:`${this.minuteOptions[this.selectedMinutesIndex]}分钟`})})):this.selectedServiceType==="一对多课程"?(e.serviceName=this.multiServiceName,e.lessons=this.lessonOptions[this.selectedLessonsIndex],e.totalDuration=`${this.hourOptions[this.selectedMultiHoursIndex]}小时${this.minuteOptions[this.selectedMultiMinutesIndex]}分钟`,e.personCount=this.personCountOptions[this.selectedPersonCountIndex],e.type=new UTSJSONObject({typename:"一对多课程",coursenum:parseInt(this.lessonOptions[this.selectedLessonsIndex]),fulllength:new UTSJSONObject({hours:`${this.hourOptions[this.selectedMultiHoursIndex]}小时`,minutes:`${this.minuteOptions[this.selectedMultiMinutesIndex]}分钟`}),studentnum:parseInt(this.personCountOptions[this.selectedPersonCountIndex])})):this.selectedServiceType==="学习资料"&&(e.coursequantity=this.coursequantity,e.serviceName=this.coursequantity,e.type=new UTSJSONObject({typename:"学习资料",fileLink:"https://www.baidu.com"})),e.updateTime=new Date().toISOString().split("T")[0],this.mode==="edit"?this.updateExistingService(e):this.addNewService(e)},addNewService(e=null){try{const s=t.index.getStorageSync("services");let o=[];s&&(o=UTS.JSON.parse(s));const l=o.findIndex(i=>i.id===e.id);l!==-1?o[l]=e:o.push(e),t.index.setStorageSync("services",UTS.JSON.stringify(o)),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.newServiceAdded=!0,getApp().globalData.newService=e,t.index.hideLoading(),t.index.showToast({title:"提交成功",icon:"success"}),this.hasEdited=!1,setTimeout(()=>{r.Navigator.toService()},1500)}catch(s){t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:876","保存服务失败",s),t.index.hideLoading(),t.index.showToast({title:"保存失败，请重试",icon:"none"})}},updateExistingService(e=null){try{const s=t.index.getStorageSync("services");let o=[];s&&(o=UTS.JSON.parse(s));const l=o.findIndex(i=>i.id==this.serviceId);l!==-1?o[l]=e:o.push(e),t.index.setStorageSync("services",UTS.JSON.stringify(o)),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.serviceEdited=!0,getApp().globalData.editedService=e,t.index.hideLoading(),t.index.showToast({title:"更新成功",icon:"success"}),this.hasEdited=!1,setTimeout(()=>{r.Navigator.toService()},1500)}catch(s){t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:928","更新服务失败",s),t.index.hideLoading(),t.index.showToast({title:"更新失败，请重试",icon:"none"})}},handleServiceEdited(e=null){t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:937","Service edited",e)},trackChanges(){this.hasEdited=!0}}});if(!Array){const e=t.resolveComponent("Header"),s=t.resolveComponent("choice-selected");(e+s)()}const p=()=>"../components/combobox/combobox2.js";Math||p();function g(e,s,o,l,i,n){return t.e({a:t.o(n.goBack),b:t.p({title:i.mode==="edit"?"修改信息":"新增服务"}),c:t.o(n.handleServiceTypeSelect),d:t.p({choiceIndex:i.selectedServiceTypeIndex,choiceList:i.serviceTypes,defaultText:"请选择服务类型"}),e:i.selectedServiceType==="一对一课程"},i.selectedServiceType==="一对一课程"?{f:t.o(n.handleLessonsSelect),g:t.p({choiceIndex:i.selectedLessonsIndex,choiceList:i.lessonOptions,defaultText:"请选择节数"})}:{},{h:i.selectedServiceType==="一对多课程"},i.selectedServiceType==="一对多课程"?{i:t.o(n.handleLessonsSelect),j:t.p({choiceIndex:i.selectedLessonsIndex,choiceList:i.lessonOptions,defaultText:"请选择节数"})}:{},{k:i.selectedServiceType==="一对一课程"},i.selectedServiceType==="一对一课程"?{l:t.o(n.handleHoursSelect),m:t.p({choiceIndex:i.selectedHoursIndex,choiceList:i.hourOptions,defaultText:"小时"}),n:t.o(n.handleMinutesSelect),o:t.p({choiceIndex:i.selectedMinutesIndex,choiceList:i.minuteOptions,defaultText:"分钟"}),p:t.o([c=>i.serviceName=c.detail.value,(...c)=>n.trackChanges&&n.trackChanges(...c)]),q:i.serviceName}:{},{r:i.selectedServiceType==="一对多课程"},i.selectedServiceType==="一对多课程"?{s:t.o(n.handleMultiHoursSelect),t:t.p({choiceIndex:i.selectedMultiHoursIndex,choiceList:i.hourOptions,defaultText:"小时"}),v:t.o(n.handleMultiMinutesSelect),w:t.p({choiceIndex:i.selectedMultiMinutesIndex,choiceList:i.minuteOptions,defaultText:"分钟"}),x:t.o(n.handlePersonCountSelect),y:t.p({choiceIndex:i.selectedPersonCountIndex,choiceList:i.personCountOptions,defaultText:"请选择课程人数"}),z:t.o([c=>i.multiServiceName=c.detail.value,(...c)=>n.trackChanges&&n.trackChanges(...c)]),A:i.multiServiceName}:{},{B:i.selectedServiceType==="学习资料"},i.selectedServiceType==="学习资料"?{C:t.o([c=>i.coursequantity=c.detail.value,(...c)=>n.trackChanges&&n.trackChanges(...c)]),D:i.coursequantity}:{},{E:t.o([c=>i.description=c.detail.value,(...c)=>n.trackChanges&&n.trackChanges(...c)]),F:i.description,G:t.o([c=>i.price=c.detail.value,(...c)=>n.trackChanges&&n.trackChanges(...c)]),H:i.price,I:i.showAttachment},i.showAttachment?{J:t.o((...c)=>n.chooseFile&&n.chooseFile(...c))}:{},{K:t.f(i.coverUrls,(c,u,v)=>({a:c,b:t.o(m=>n.deleteCover(u),u),c:u})),L:i.coverUrls.length<9},i.coverUrls.length<9?{M:t.o((...c)=>n.chooseCover&&n.chooseCover(...c))}:{},{N:i.mode==="add"},i.mode==="add"?{}:{},{O:t.o((...c)=>n.submitForm&&n.submitForm(...c)),P:t.sei(t.gei(e,""),"view")})}const x=t._export_sfc(a,[["render",g]]);wx.createPage(x);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/service/service_newbuilt.js.map
