"use strict";const t=require("../../common/vendor.js"),r=()=>"../../components/combobox/combobox.js",d=()=>"../../components/navigationTitleBar/header.js",h=t.defineComponent({components:{ChoiceSelected:r,Header:d},data(){return{mode:"add",serviceId:null,coverUrls:[],avatarUrl:"",selectedServiceType:"",selectedServiceTypeIndex:-1,serviceTypes:["一对一课程","一对多课程","学习资料"],coursequantity:"",showServiceTypeDropdown:!1,duration:"",description:"",price:"",files:[],showDuration:!0,showAttachment:!1,originalService:null,serviceName:"",selectedLessonsIndex:-1,lessonOptions:["1","2","3","4","5","6","7","8","9","10"],selectedHoursIndex:-1,hourOptions:["1","2","3","4","5","6","8","10"],selectedMinutesIndex:-1,minuteOptions:["0","15","30","45"],selectedMultiLessonsIndex:-1,multiLessonOptions:["1","2","3","4","5","6","7","20"],selectedMultiHoursIndex:-1,selectedMultiMinutesIndex:-1,multiServiceName:"",selectedPersonCountIndex:-1,personCountOptions:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"]}},onLoad(e){if(e.mode==="edit"&&e.id)if(this.mode="edit",this.serviceId=e.id,getApp().globalData&&getApp().globalData.editingService)try{const s=getApp().globalData.editingService;this.originalService=UTS.JSON.parse(UTS.JSON.stringify(s)),this.fillFormWithServiceData(s),setTimeout(()=>{getApp().globalData.editingService=null},1e3)}catch(s){t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:276","处理编辑数据出错：",s),t.index.showToast({title:"加载数据失败，请重试",icon:"none"}),setTimeout(()=>{t.index.navigateBack()},1500)}else t.index.showToast({title:"未找到要编辑的数据",icon:"none"}),setTimeout(()=>{t.index.navigateBack()},1500);t.index.$on("serviceEdited",this.handleServiceEdited)},onUnload(){t.index.$off("serviceEdited",this.handleServiceEdited)},methods:{chooseAvatar(){t.index.chooseImage(new UTSJSONObject({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{this.avatarUrl=e.tempFilePaths[0]}}))},chooseCover(){const e=9-this.coverUrls.length;if(e<=0)return t.index.showToast({title:"最多只能上传9张图片",icon:"none"}),null;t.index.chooseImage(new UTSJSONObject({count:e,sizeType:["compressed"],sourceType:["album","camera"],success:s=>{this.coverUrls=[...this.coverUrls,...s.tempFilePaths]}}))},deleteCover(e=null){this.coverUrls.splice(e,1)},fillFormWithServiceData(e=null){if(this.coverUrls=e.imageUrls||[],this.selectedServiceType=e.name||"",this.selectedServiceTypeIndex=this.serviceTypes.findIndex(s=>s===e.name),this.price=e.price?e.price.replace("¥",""):"",this.description=e.description||"",this.selectedServiceType==="一对一课程"){if(this.serviceName=e.serviceName||"",e.lessons&&(this.selectedLessonsIndex=this.lessonOptions.findIndex(s=>s===e.lessons.toString())),e.totalDuration){const s=e.totalDuration.match(/(\d+)小时(\d+)分钟/);s&&(this.selectedHoursIndex=this.hourOptions.findIndex(c=>c===s[1]),this.selectedMinutesIndex=this.minuteOptions.findIndex(c=>c===s[2]))}}else if(this.selectedServiceType==="一对多课程"){if(this.multiServiceName=e.serviceName||"",e.lessons&&(this.selectedMultiLessonsIndex=this.multiLessonOptions.findIndex(s=>s===e.lessons.toString())),e.totalDuration){const s=e.totalDuration.match(/(\d+)小时(\d+)分钟/);s&&(this.selectedMultiHoursIndex=this.hourOptions.findIndex(c=>c===s[1]),this.selectedMultiMinutesIndex=this.minuteOptions.findIndex(c=>c===s[2]))}e.personCount&&(this.selectedPersonCountIndex=this.personCountOptions.findIndex(s=>s===e.personCount.toString()))}else this.coursequantity=e.coursequantity||"";this.updateFormFields()},goBack(){t.index.navigateBack()},handleServiceTypeSelect(e=null){this.selectedServiceTypeIndex=e,this.selectedServiceType=this.serviceTypes[e],this.updateFormFields()},handleLessonsSelect(e=null){this.selectedLessonsIndex=e},handleHoursSelect(e=null){this.selectedHoursIndex=e},handleMinutesSelect(e=null){this.selectedMinutesIndex=e},handleMultiLessonsSelect(e=null){this.selectedMultiLessonsIndex=e},handleMultiHoursSelect(e=null){this.selectedMultiHoursIndex=e},handleMultiMinutesSelect(e=null){this.selectedMultiMinutesIndex=e},handlePersonCountSelect(e=null){this.selectedPersonCountIndex=e},updateFormFields(){this.selectedServiceType==="学习资料"?(this.showDuration=!1,this.showAttachment=!0):(this.showDuration=!0,this.showAttachment=this.selectedServiceType==="学习资料")},chooseFile(){t.index.chooseImage(new UTSJSONObject({count:1,success:e=>{this.files=e.tempFilePaths}}))},submitForm(){if(this.coverUrls.length===0)return t.index.showToast({title:"请上传封面图片",icon:"none"}),null;if(!this.selectedServiceType)return t.index.showToast({title:"请选择服务类型",icon:"none"}),null;if(this.selectedServiceType==="一对一课程"){if(this.selectedLessonsIndex===-1)return t.index.showToast({title:"请选择课程节数",icon:"none"}),null;if(this.selectedHoursIndex===-1||this.selectedMinutesIndex===-1)return t.index.showToast({title:"请选择课程时长",icon:"none"}),null;if(!this.serviceName)return t.index.showToast({title:"请填写服务名称",icon:"none"}),null}else if(this.selectedServiceType==="一对多课程"){if(this.selectedMultiHoursIndex===-1||this.selectedMultiMinutesIndex===-1)return t.index.showToast({title:"请选择课程时长",icon:"none"}),null;if(!this.multiServiceName)return t.index.showToast({title:"请填写服务名称",icon:"none"}),null;if(this.selectedPersonCountIndex===-1)return t.index.showToast({title:"请选择课程人数",icon:"none"}),null}else if(this.selectedServiceType==="学习资料"&&!this.coursequantity)return t.index.showToast({title:"请填写课程数量",icon:"none"}),null;if(!this.price)return t.index.showToast({title:"请填写服务价格",icon:"none"}),null;t.index.showLoading({title:"提交中..."});let e=new UTSJSONObject({name:this.selectedServiceType,price:this.price.startsWith("¥")?this.price:"¥"+this.price,description:this.description||`这是一个${this.selectedServiceType}服务`,checked:!1,imageUrls:this.coverUrls,imageUrl:this.coverUrls[0]});this.selectedServiceType==="一对一课程"?(e.serviceName=this.serviceName,e.lessons=this.lessonOptions[this.selectedLessonsIndex],e.totalDuration=`${this.hourOptions[this.selectedHoursIndex]}小时${this.minuteOptions[this.selectedMinutesIndex]}分钟`):this.selectedServiceType==="一对多课程"?(e.serviceName=this.multiServiceName,e.lessons=this.multiLessonOptions[this.selectedMultiLessonsIndex],e.totalDuration=`${this.hourOptions[this.selectedMultiHoursIndex]}小时${this.minuteOptions[this.selectedMultiMinutesIndex]}分钟`,e.personCount=this.personCountOptions[this.selectedPersonCountIndex]):e.coursequantity=this.coursequantity,this.mode==="edit"&&this.serviceId&&this.originalService?(e.id=this.serviceId,e.checked=this.originalService.checked,this.updateExistingService(e)):(e.id=Date.now(),this.addNewService(e))},addNewService(e=null){try{const s=t.index.getStorageSync("services");let c=[];s&&(c=UTS.JSON.parse(s)),c.push(e),t.index.setStorageSync("services",UTS.JSON.stringify(c)),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.newServiceAdded=!0,getApp().globalData.newService=e,t.index.hideLoading(),t.index.showToast({title:"提交成功",icon:"success"}),setTimeout(()=>{t.index.navigateBack(new UTSJSONObject({delta:1,success:()=>{t.index.$emit("serviceAdded",e)}}))},1500)}catch(s){t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:627","保存服务失败",s),t.index.hideLoading(),t.index.showToast({title:"保存失败，请重试",icon:"none"})}},updateExistingService(e=null){try{const s=t.index.getStorageSync("services");let c=[];s&&(c=UTS.JSON.parse(s));const l=c.findIndex(i=>i.id==this.serviceId);if(l!==-1)c[l]=e;else{const i=getApp().globalData.defaultServices||[],o=i.findIndex((n=null)=>n.id==this.serviceId);o!==-1?i[o]=e:c.push(e)}t.index.setStorageSync("services",UTS.JSON.stringify(c)),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.serviceEdited=!0,getApp().globalData.editedService=e,t.index.hideLoading(),t.index.showToast({title:"更新成功",icon:"success"}),setTimeout(()=>{t.index.navigateBack(new UTSJSONObject({delta:1,success:()=>{t.index.$emit("serviceEdited",e)}}))},1500)}catch(s){t.index.__f__("error","at pagesMine/service/service_newbuilt.vue:689","更新服务失败",s),t.index.hideLoading(),t.index.showToast({title:"更新失败，请重试",icon:"none"})}},handleServiceEdited(e=null){t.index.__f__("log","at pagesMine/service/service_newbuilt.vue:698","Service edited",e)}}});Array||t.resolveComponent("choice-selected")();function a(e,s,c,l,i,o){return t.e({a:i.mode==="add"?"新增服务":"编辑服务",b:t.o((...n)=>o.goBack&&o.goBack(...n)),c:t.o(o.handleServiceTypeSelect),d:t.p({choiceIndex:i.selectedServiceTypeIndex,choiceList:i.serviceTypes,defaultText:"请选择服务类型"}),e:i.selectedServiceType==="一对一课程"},i.selectedServiceType==="一对一课程"?{f:t.o(o.handleLessonsSelect),g:t.p({choiceIndex:i.selectedLessonsIndex,choiceList:i.lessonOptions,defaultText:"请选择节数"})}:{},{h:i.selectedServiceType==="一对多课程"},i.selectedServiceType==="一对多课程"?{i:t.o(o.handleLessonsSelect),j:t.p({choiceIndex:i.selectedLessonsIndex,choiceList:i.lessonOptions,defaultText:"请选择节数"})}:{},{k:i.selectedServiceType==="一对一课程"},i.selectedServiceType==="一对一课程"?{l:t.o(o.handleHoursSelect),m:t.p({choiceIndex:i.selectedHoursIndex,choiceList:i.hourOptions,defaultText:"小时"}),n:t.o(o.handleMinutesSelect),o:t.p({choiceIndex:i.selectedMinutesIndex,choiceList:i.minuteOptions,defaultText:"分钟"}),p:i.serviceName,q:t.o(n=>i.serviceName=n.detail.value)}:{},{r:i.selectedServiceType==="一对多课程"},i.selectedServiceType==="一对多课程"?{s:t.o(o.handleMultiHoursSelect),t:t.p({choiceIndex:i.selectedMultiHoursIndex,choiceList:i.hourOptions,defaultText:"小时"}),v:t.o(o.handleMultiMinutesSelect),w:t.p({choiceIndex:i.selectedMultiMinutesIndex,choiceList:i.minuteOptions,defaultText:"分钟"}),x:t.o(o.handlePersonCountSelect),y:t.p({choiceIndex:i.selectedPersonCountIndex,choiceList:i.personCountOptions,defaultText:"请选择课程人数"}),z:i.multiServiceName,A:t.o(n=>i.multiServiceName=n.detail.value)}:{},{B:i.selectedServiceType==="学习资料"},i.selectedServiceType==="学习资料"?{C:i.coursequantity,D:t.o(n=>i.coursequantity=n.detail.value)}:{},{E:i.description,F:t.o(n=>i.description=n.detail.value),G:i.price,H:t.o(n=>i.price=n.detail.value),I:i.showAttachment},i.showAttachment?{J:t.o((...n)=>o.chooseFile&&o.chooseFile(...n))}:{},{K:t.f(i.coverUrls,(n,u,v)=>({a:n,b:t.o(x=>o.deleteCover(u),u),c:u})),L:i.coverUrls.length<9},i.coverUrls.length<9?{M:t.o((...n)=>o.chooseCover&&o.chooseCover(...n))}:{},{N:i.mode==="add"},i.mode==="add"?{}:{},{O:t.o((...n)=>o.submitForm&&o.submitForm(...n)),P:t.sei(t.gei(e,""),"view")})}const p=t._export_sfc(h,[["render",a]]);wx.createPage(p);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/service/service_newbuilt.js.map
