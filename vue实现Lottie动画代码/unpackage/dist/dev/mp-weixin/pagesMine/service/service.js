"use strict";const e=require("../../common/vendor.js"),v=require("../../router/Router.js"),o=require("../../common/assets.js"),h=()=>"../../components/navigationTitleBar/header.js",g=e.defineComponent({components:{Header:h},data(){return{defaultCoverImage:"/static/image/service/default_cover.jpg",services:[],selectedService:null,isDetailExpanded:!1,overlayVisible:!1}},onShow(){if(getApp().globalData&&getApp().globalData.newServiceAdded)if(getApp().globalData.newServiceAdded=!1,getApp().globalData.newService){const i=getApp().globalData.newService;i.price&&!i.price.startsWith("¥")&&(i.price="¥"+i.price),this.loadServices(),this.services.findIndex(t=>t.id===i.id)===-1&&(this.services.unshift(i),this.saveServices()),this.selectedService=i,e.index.showToast({title:"新服务已添加",icon:"success"}),getApp().globalData.newService=null}else this.loadServices();else this.loadServices()},onLoad(){e.index.$on("serviceAdded",this.handleServiceAdded),e.index.$on("serviceEdited",this.handleServiceEdited),getApp().globalData=getApp().globalData||new UTSJSONObject({})},onUnload(){e.index.$off("serviceAdded",this.handleServiceAdded),e.index.$off("serviceEdited",this.handleServiceEdited)},methods:{goBack(){v.Navigator.toMine()},toggleService(i=null){this.services[i].checked=!this.services[i].checked},editService(i=null){try{e.index.showLoading({title:"加载中..."});const s=this.services[i];e.index.__f__("log","at pagesMine/service/service.vue:164","准备编辑服务:",s),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.editingService=UTS.JSON.parse(UTS.JSON.stringify(s)),setTimeout(()=>{e.index.hideLoading(),e.index.navigateTo({url:"./service_newbuilt?mode=edit&id="+s.id,success:()=>{e.index.__f__("log","at pagesMine/service/service.vue:179","跳转到编辑页面成功")},fail:t=>{e.index.__f__("error","at pagesMine/service/service.vue:182","跳转失败：",t),e.index.showToast({title:"跳转失败，请重试",icon:"none"})}})},500)}catch(s){e.index.hideLoading(),e.index.__f__("error","at pagesMine/service/service.vue:192","编辑服务出错：",s),e.index.showToast({title:"操作失败，请重试",icon:"none"})}},deleteService(i=null){const s=this.services[i].id;e.index.showModal(new UTSJSONObject({title:"确认删除",content:"确定要删除此服务吗？此操作无法撤销。",confirmText:"确认删除",confirmColor:"#ff4d4f",cancelText:"取消",success:t=>{if(t.confirm)try{e.index.showLoading({title:"删除中..."}),setTimeout(()=>{e.index.hideLoading(),this.selectedService&&this.selectedService.id===s&&(this.isDetailExpanded=!1,this.overlayVisible=!1,this.selectedService=null),this.services.splice(i,1),this.saveServices(),e.index.showToast({title:"服务已删除",icon:"success"})},500)}catch(d){e.index.hideLoading(),e.index.__f__("error","at pagesMine/service/service.vue:245","删除服务出错：",d),e.index.showToast({title:"删除失败，请重试",icon:"none"})}}}))},handleAddService(){e.index.showLoading({title:"加载中..."}),getApp().globalData&&(getApp().globalData.editingService=null),setTimeout(()=>{e.index.hideLoading(),e.index.navigateTo({url:"./service_newbuilt",fail:i=>{e.index.__f__("error","at pagesMine/service/service.vue:276","跳转失败：",i),e.index.showToast({title:"跳转失败，请重试",icon:"none"})}})},300)},handleServiceAdded(i=null){i.price&&!i.price.startsWith("¥")&&(i.price="¥"+i.price);const s=this.services.findIndex(t=>t.id===i.id);s!==-1?this.services[s]=i:this.services.unshift(i),this.selectedService=i,this.saveServices(),e.index.showToast({title:"新服务已添加",icon:"success"})},handleServiceEdited(i=null){const s=this.services.findIndex(t=>t.id===i.id);s!==-1&&(this.services[s]=i,this.saveServices(),e.index.showToast({title:"服务已修改",icon:"success"}))},saveServices(){try{e.index.setStorageSync("services",UTS.JSON.stringify(this.services))}catch(i){e.index.__f__("error","at pagesMine/service/service.vue:338","保存服务列表失败",i)}},loadServices(){try{const i=e.index.getStorageSync("services");if(i){const s=UTS.JSON.parse(i);s&&s.length>0&&(this.services=s,this.selectedService=this.services[0])}}catch(i){e.index.__f__("error","at pagesMine/service/service.vue:355","加载服务列表失败",i)}},showServiceDetail(i=null){i>=0&&i<this.services.length&&(this.selectedService=this.services[i],this.overlayVisible=!0,setTimeout(()=>{this.isDetailExpanded=!0},20))},hideServiceDetail(){this.isDetailExpanded=!1,setTimeout(()=>{this.overlayVisible=!1},300)},getServiceCover(i=null){return i.imageUrl||(i.imageUrls&&i.imageUrls.length>0?i.imageUrls[0]:this.defaultCoverImage)},updateExistingService(i=null){try{const s=e.index.getStorageSync("services");let t=[];s&&(t=UTS.JSON.parse(s));const d=t.findIndex(c=>c.id==this.serviceId);d!==-1?t[d]=i:t.push(i),e.index.setStorageSync("services",UTS.JSON.stringify(t)),getApp().globalData=getApp().globalData||new UTSJSONObject({}),getApp().globalData.serviceEdited=!0,getApp().globalData.editedService=i,this.$refs.loadingRef.hide(),e.index.showToast({title:"更新成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack(new UTSJSONObject({delta:1,success:()=>{e.index.$emit("serviceEdited",i)}}))},1500)}catch(s){e.index.__f__("error","at pagesMine/service/service.vue:432","更新服务失败",s),this.$refs.loadingRef.hide(),e.index.showToast({title:"更新失败，请重试",icon:"none"})}}}});Array||e.resolveComponent("Header")();function S(i,s,t,d,c,n){return e.e({a:e.o(n.goBack),b:e.p({title:"我的服务"}),c:c.services.length===0},c.services.length===0?{}:{},{d:e.f(c.services,(r,a,f)=>({a:`url(${n.getServiceCover(r)})`,b:e.t(r.serviceName||r.name),c:e.t(r.price),d:e.o(l=>n.editService(a),r.id),e:e.o(l=>n.deleteService(a),r.id),f:e.o(()=>{},r.id),g:r.id,h:r.checked?1:"",i:e.o(l=>n.showServiceDetail(a),r.id)})),e:o._imports_0$5,f:o._imports_1$4,g:c.selectedService},c.selectedService?{h:e.o((...r)=>n.hideServiceDetail&&n.hideServiceDetail(...r)),i:`url(${n.getServiceCover(c.selectedService)})`,j:e.t(c.selectedService.serviceName||c.selectedService.name),k:e.t(c.selectedService.price),l:e.t(c.selectedService.description),m:c.isDetailExpanded?1:""}:{},{n:e.o((...r)=>n.handleAddService&&n.handleAddService(...r)),o:c.overlayVisible},c.overlayVisible?{p:e.o((...r)=>n.hideServiceDetail&&n.hideServiceDetail(...r))}:{},{q:e.sei(e.gei(i,""),"view")})}const u=e._export_sfc(g,[["render",S]]);wx.createPage(u);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/service/service.js.map
