"use strict";const e=require("../../common/vendor.js"),p=require("../../router/Router.js"),b=()=>"../../components/navigationTitleBar/header.js",_=()=>"../../components/top-navbar/top-navbar.js",g=e.defineComponent({components:{Header:b,topNavbar:_},data(){return{userRole:"student",userName:"",userData:new UTSJSONObject({}),isLoggedIn:!1,currentTab:0,tabs:["待支付","已支付","已完成","已取消"],teacherCurrentTab:0,teacherTabs:["待服务","已完成","已取消"],orders:[new UTSJSONObject({id:"1001",time:"2024-03-20 14:30",status:"待支付",title:"课程A - 一对一辅导",price:"299.00",teacherName:"张老师"}),new UTSJSONObject({id:"1002",time:"2024-03-19 10:15",status:"已完成",title:"课程B - 小组课程",price:"199.00",teacherName:"李老师"}),new UTSJSONObject({id:"1003",time:"2024-03-18 16:45",status:"已取消",title:"课程C - 专项训练",price:"399.00",teacherName:"王老师"})],teacherOrders:[new UTSJSONObject({id:"2001",time:"2024-03-21 15:30",status:"待确认",title:"高数辅导 - 一对一",price:"350.00",studentName:"张三"}),new UTSJSONObject({id:"2002",time:"2024-03-20 09:00",status:"进行中",title:"英语口语 - 一对一",price:"280.00",studentName:"李四"}),new UTSJSONObject({id:"2003",time:"2024-03-15 16:30",status:"已完成",title:"物理辅导 - 一对一",price:"320.00",studentName:"王五"})],showCancelModal:!1,showPayModal:!1,showDetailModal:!1,showDeleteModal:!1,showConfirmOrderModal:!1,currentOrder:null,wxPayUrl:"https://api.mch.weixin.qq.com/pay/unifiedorder",isPaymentDropdownOpen:!1,selectedPayment:0,paymentMethods:[new UTSJSONObject({name:"支付宝支付",icon:"支",type:"alipay"}),new UTSJSONObject({name:"微信支付",icon:"微",type:"wechat"}),new UTSJSONObject({name:"银行卡支付",icon:"卡",type:"bank"})]}},computed:{currentTabs(){return this.userRole==="teacher"?this.teacherTabs:this.tabs}},onLoad(){},onShow(){this.$nextTick(()=>{this.loadUserData();const s=e.index.getStorageSync("userRole");s&&s!==this.userRole&&(this.userRole=s,this.loadOrderData())})},methods:{onTabChange(s=null){e.index.__f__("log","at pagesMine/order/order_common.vue:478","切换到标签:",s),this.userRole==="teacher"?this.teacherCurrentTab=s:this.currentTab=s,this.loadOrderData()},loadUserData(){const s=e.index.getStorageSync("token");if(this.isLoggedIn=!!s,this.isLoggedIn){const i=e.index.getStorageSync("userInfo");if(i)try{this.userData=typeof i=="string"?UTS.JSON.parse(i):i,this.userName=this.userData.nickname||"用户",this.userData.role&&(this.userRole=this.userData.role,e.index.setStorageSync("userRole",this.userData.role))}catch(l){e.index.__f__("error","at pagesMine/order/order_common.vue:511","解析用户信息失败:",l)}}else this.userData=new UTSJSONObject({}),this.userName="",this.userRole="student"},loadOrderData(){e.index.__f__("log","at pagesMine/order/order_common.vue:528",`加载${this.userRole}角色的订单数据`)},switchTab(s=null){this.onTabChange(s)},cancelOrder(s=null){this.currentOrder=s,this.showCancelModal=!0},confirmCancel(){e.index.showToast({title:"订单已取消",icon:"success"}),this.showCancelModal=!1},payOrder(s=null){this.currentOrder=s,this.showPayModal=!0},togglePaymentDropdown(){this.isPaymentDropdownOpen=!this.isPaymentDropdownOpen},selectPayment(s=null){this.selectedPayment=s,setTimeout(()=>{this.isPaymentDropdownOpen=!1},200)},confirmPay(){e.index.showLoading({title:"跳转支付..."}),setTimeout(()=>{e.index.hideLoading(),e.index.__f__("log","at pagesMine/order/order_common.vue:601","调用微信支付接口，支付地址:",this.wxPayUrl),e.index.__f__("log","at pagesMine/order/order_common.vue:602","订单信息:",this.currentOrder),this.paySuccess()},1500)},paySuccess(){this.showPayModal=!1,e.index.showToast({title:"支付成功",icon:"success"}),this.loadOrders()},payFail(s=null){this.showPayModal=!1,e.index.showToast({title:"支付失败",icon:"none"}),e.index.__f__("error","at pagesMine/order/order_common.vue:652","支付失败:",s)},viewDetail(s=null){this.currentOrder=s,this.showDetailModal=!0},closeDetailModal(){this.showDetailModal=!1,this.currentOrder=null},deleteOrder(s=null){this.currentOrder=s,this.showDeleteModal=!0},confirmDelete(){e.index.showToast({title:"删除成功",icon:"success"}),this.showDeleteModal=!1},goToAppraise(s=null){p.Navigator.toAppraise(s.id)},goBack(){p.Navigator.toMine()},confirmOrder(s=null){this.currentOrder=s,this.showConfirmOrderModal=!0},confirmOrderAction(){e.index.showToast({title:"已接受订单",icon:"success"}),this.showConfirmOrderModal=!1}}});if(!Array){const s=e.resolveComponent("Header"),i=e.resolveComponent("top-navbar");(s+i)()}const M=()=>"../../components/top-navbar/top-navbar2.js";Math||M();function T(s,i,l,v,r,o){var u,h,m,d,f,O,w;return e.e({a:e.o(o.goBack),b:e.p({title:"我的订单"}),c:r.userRole==="student"},r.userRole==="student"?{d:e.f(r.orders,(t,n,c)=>({a:e.t(t.time),b:e.t(t.title),c:e.t(t.teacherName||"暂无"),d:e.t(t.price),e:e.o(a=>o.cancelOrder(t),n),f:e.o(a=>o.payOrder(t),n),g:n})),e:r.currentTab===0}:{f:e.f(r.teacherOrders,(t,n,c)=>({a:e.t(t.time),b:e.t(t.title),c:e.t(t.studentName),d:e.t(t.price),e:e.o(a=>o.confirmOrder(t),n),f:n})),g:r.teacherCurrentTab===0},{h:r.userRole==="student"},r.userRole==="student"?{i:e.f(r.orders,(t,n,c)=>({a:e.t(t.time),b:e.t(t.title),c:e.t(t.teacherName||"暂无"),d:e.t(t.price),e:e.o(a=>o.goToAppraise(t),n),f:n})),j:r.currentTab===1}:{k:e.f(r.teacherOrders,(t,n,c)=>({a:e.t(t.time),b:e.t(t.title),c:e.t(t.studentName),d:e.t(t.price),e:e.o(a=>o.viewDetail(t),n),f:n})),l:r.teacherCurrentTab===1},{m:r.userRole==="student"},r.userRole==="student"?{n:e.f(r.orders,(t,n,c)=>({a:e.t(t.time),b:e.t(t.title),c:e.t(t.teacherName||"暂无"),d:e.t(t.price),e:e.o(a=>o.viewDetail(t),n),f:n})),o:r.currentTab===2}:{p:e.f(r.teacherOrders,(t,n,c)=>({a:e.t(t.time),b:e.t(t.title),c:e.t(t.studentName),d:e.t(t.price),e:e.o(a=>o.deleteOrder(t),n),f:n})),q:r.teacherCurrentTab===2},{r:r.userRole==="student"},r.userRole==="student"?{s:e.f(r.orders,(t,n,c)=>({a:e.t(t.time),b:e.t(t.title),c:e.t(t.teacherName||"暂无"),d:e.t(t.price),e:e.o(a=>o.deleteOrder(t),n),f:n})),t:r.currentTab===3}:{},{v:e.o(o.onTabChange),w:e.p({navHeight:60,userRole:r.userRole,customTabs:r.userRole==="student"?r.tabs.map(t=>({name:t})):r.teacherTabs.map(t=>({name:t}))}),x:r.showCancelModal},r.showCancelModal?{y:e.o(t=>r.showCancelModal=!1),z:e.o((...t)=>o.confirmCancel&&o.confirmCancel(...t))}:{},{A:r.showPayModal},r.showPayModal?{B:e.t((u=r.currentOrder)==null?void 0:u.price),C:e.o(t=>r.showPayModal=!1),D:e.o((...t)=>o.confirmPay&&o.confirmPay(...t))}:{},{E:r.showDetailModal},r.showDetailModal?e.e({F:e.t((h=r.currentOrder)==null?void 0:h.time),G:e.t((m=r.currentOrder)==null?void 0:m.title),H:e.t((d=r.currentOrder)==null?void 0:d.price),I:e.t((f=r.currentOrder)==null?void 0:f.status),J:r.userRole==="teacher"&&((O=r.currentOrder)==null?void 0:O.studentName)},r.userRole==="teacher"&&((w=r.currentOrder)!=null&&w.studentName)?{K:e.t(r.currentOrder.studentName)}:{},{L:e.o((...t)=>o.closeDetailModal&&o.closeDetailModal(...t))}):{},{M:r.showDeleteModal},r.showDeleteModal?{N:e.o(t=>r.showDeleteModal=!1),O:e.o((...t)=>o.confirmDelete&&o.confirmDelete(...t))}:{},{P:r.showConfirmOrderModal},r.showConfirmOrderModal?{Q:e.o(t=>r.showConfirmOrderModal=!1),R:e.o((...t)=>o.confirmOrderAction&&o.confirmOrderAction(...t))}:{},{S:e.sei(e.gei(s,""),"view")})}const y=e._export_sfc(g,[["render",T]]);wx.createPage(y);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/order/order_common.js.map
