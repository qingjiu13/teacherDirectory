"use strict";const e=require("../../common/vendor.js"),b=require("../../router/Router.js"),T=e.defineComponent({data(){return{userRole:"student",userName:"",userData:new UTSJSONObject({}),isLoggedIn:!1,currentTab:0,tabs:["待支付","已支付","已完成","已取消"],teacherCurrentTab:0,teacherTabs:["待服务","已完成","已取消"],orders:[new UTSJSONObject({id:"1001",time:"2024-03-20 14:30",status:"待支付",title:"课程A - 一对一辅导",price:"299.00",teacherName:"张老师"}),new UTSJSONObject({id:"1002",time:"2024-03-19 10:15",status:"已完成",title:"课程B - 小组课程",price:"199.00",teacherName:"李老师"}),new UTSJSONObject({id:"1003",time:"2024-03-18 16:45",status:"已取消",title:"课程C - 专项训练",price:"399.00",teacherName:"王老师"})],teacherOrders:[new UTSJSONObject({id:"2001",time:"2024-03-21 15:30",status:"待确认",title:"高数辅导 - 一对一",price:"350.00",studentName:"张三"}),new UTSJSONObject({id:"2002",time:"2024-03-20 09:00",status:"进行中",title:"英语口语 - 一对一",price:"280.00",studentName:"李四"}),new UTSJSONObject({id:"2003",time:"2024-03-15 16:30",status:"已完成",title:"物理辅导 - 一对一",price:"320.00",studentName:"王五"})],showCancelModal:!1,showPayModal:!1,showDetailModal:!1,showDeleteModal:!1,showConfirmOrderModal:!1,currentOrder:null,wxPayUrl:"https://api.mch.weixin.qq.com/pay/unifiedorder",isPaymentDropdownOpen:!1,selectedPayment:0,paymentMethods:[new UTSJSONObject({name:"支付宝支付",icon:"支",type:"alipay"}),new UTSJSONObject({name:"微信支付",icon:"微",type:"wechat"}),new UTSJSONObject({name:"银行卡支付",icon:"卡",type:"bank"})]}},computed:{currentTabs(){return this.userRole==="teacher"?this.teacherTabs:this.tabs}},onLoad(){},onShow(){this.$nextTick(()=>{this.loadUserData();const s=e.index.getStorageSync("userRole");s&&s!==this.userRole&&(this.userRole=s,this.loadOrderData())})},methods:{loadUserData(){const s=e.index.getStorageSync("token");if(this.isLoggedIn=!!s,this.isLoggedIn){const i=e.index.getStorageSync("userInfo");if(i)try{this.userData=typeof i=="string"?UTS.JSON.parse(i):i,this.userName=this.userData.nickname||"用户",this.userData.role&&(this.userRole=this.userData.role,e.index.setStorageSync("userRole",this.userData.role))}catch(a){e.index.__f__("error","at pagesMine/order/order_common.vue:359","解析用户信息失败:",a)}}else this.userData=new UTSJSONObject({}),this.userName="",this.userRole="student"},loadOrderData(){e.index.__f__("log","at pagesMine/order/order_common.vue:376",`加载${this.userRole}角色的订单数据`)},switchTab(s=null){this.userRole==="teacher"?this.teacherCurrentTab=s:this.currentTab=s},cancelOrder(s=null){this.currentOrder=s,this.showCancelModal=!0},confirmCancel(){e.index.showToast({title:"订单已取消",icon:"success"}),this.showCancelModal=!1},payOrder(s=null){this.currentOrder=s,this.showPayModal=!0},togglePaymentDropdown(){this.isPaymentDropdownOpen=!this.isPaymentDropdownOpen},selectPayment(s=null){this.selectedPayment=s,setTimeout(()=>{this.isPaymentDropdownOpen=!1},200)},confirmPay(){e.index.showLoading({title:"跳转支付..."}),setTimeout(()=>{e.index.hideLoading(),e.index.__f__("log","at pagesMine/order/order_common.vue:455","调用微信支付接口，支付地址:",this.wxPayUrl),e.index.__f__("log","at pagesMine/order/order_common.vue:456","订单信息:",this.currentOrder),this.paySuccess()},1500)},paySuccess(){this.showPayModal=!1,e.index.showToast({title:"支付成功",icon:"success"}),this.loadOrders()},payFail(s=null){this.showPayModal=!1,e.index.showToast({title:"支付失败",icon:"none"}),e.index.__f__("error","at pagesMine/order/order_common.vue:506","支付失败:",s)},viewDetail(s=null){this.currentOrder=s,this.showDetailModal=!0},closeDetailModal(){this.showDetailModal=!1,this.currentOrder=null},deleteOrder(s=null){this.currentOrder=s,this.showDeleteModal=!0},confirmDelete(){e.index.showToast({title:"删除成功",icon:"success"}),this.showDeleteModal=!1},goToAppraise(s=null){b.Navigator.toAppraise(s.id)},confirmOrder(s=null){this.currentOrder=s,this.showConfirmOrderModal=!0},confirmOrderAction(){e.index.showToast({title:"已接受订单",icon:"success"}),this.showConfirmOrderModal=!1}}});function M(s,i,a,p,r,n){var u,h,d,m,O,w,f;return e.e({a:r.userRole==="student"},r.userRole==="student"?{b:e.f(r.tabs,(t,o,l)=>({a:e.t(t),b:o,c:r.currentTab===o?1:"",d:e.o(c=>n.switchTab(o),o)}))}:{},{c:r.userRole==="teacher"},r.userRole==="teacher"?{d:e.f(r.teacherTabs,(t,o,l)=>({a:e.t(t),b:o,c:r.teacherCurrentTab===o?1:"",d:e.o(c=>n.switchTab(o),o)}))}:{},{e:r.userRole==="student"},r.userRole==="student"?{f:e.f(r.orders,(t,o,l)=>e.e({a:e.t(t.title),b:e.t(t.teacherName||"暂无"),c:e.t(t.price)},r.currentTab===0?{d:e.o(c=>n.cancelOrder(t),o)}:{},r.currentTab===0?{e:e.o(c=>n.payOrder(t),o)}:{},r.currentTab===1?{f:e.o(c=>n.cancelOrder(t),o)}:{},r.currentTab===2?{g:e.o(c=>s.abnormalAppeal(t),o)}:{},r.currentTab===3?{h:e.o(c=>n.payOrder(t),o)}:{},{i:o})),g:r.currentTab===0,h:r.currentTab===0,i:r.currentTab===1,j:r.currentTab===2,k:r.currentTab===3}:{l:e.f(r.teacherOrders,(t,o,l)=>e.e({a:e.t(t.title),b:e.t(t.studentName),c:e.t(t.price)},r.teacherCurrentTab===0?{d:e.o(c=>n.cancelOrder(t),o)}:{},{e:o})),m:r.teacherCurrentTab===0},{n:r.showCancelModal},r.showCancelModal?{o:e.o(t=>r.showCancelModal=!1),p:e.o((...t)=>n.confirmCancel&&n.confirmCancel(...t))}:{},{q:r.showPayModal},r.showPayModal?{r:e.t((u=r.currentOrder)==null?void 0:u.price),s:e.o(t=>r.showPayModal=!1),t:e.o((...t)=>n.confirmPay&&n.confirmPay(...t))}:{},{v:r.showDetailModal},r.showDetailModal?e.e({w:e.t((h=r.currentOrder)==null?void 0:h.time),x:e.t((d=r.currentOrder)==null?void 0:d.title),y:e.t((m=r.currentOrder)==null?void 0:m.price),z:e.t((O=r.currentOrder)==null?void 0:O.status),A:r.userRole==="teacher"&&((w=r.currentOrder)==null?void 0:w.studentName)},r.userRole==="teacher"&&((f=r.currentOrder)!=null&&f.studentName)?{B:e.t(r.currentOrder.studentName)}:{},{C:e.o((...t)=>n.closeDetailModal&&n.closeDetailModal(...t))}):{},{D:r.showDeleteModal},r.showDeleteModal?{E:e.o(t=>r.showDeleteModal=!1),F:e.o((...t)=>n.confirmDelete&&n.confirmDelete(...t))}:{},{G:r.showConfirmOrderModal},r.showConfirmOrderModal?{H:e.o(t=>r.showConfirmOrderModal=!1),I:e.o((...t)=>n.confirmOrderAction&&n.confirmOrderAction(...t))}:{},{J:e.sei(e.gei(s,""),"view")})}const y=e._export_sfc(T,[["render",M]]);wx.createPage(y);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/order/order_common.js.map
