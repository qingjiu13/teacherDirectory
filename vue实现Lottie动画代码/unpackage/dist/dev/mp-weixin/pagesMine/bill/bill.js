"use strict";const t=require("../../common/vendor.js"),w=t.defineComponent({data(){return{walletInfo:new UTSJSONObject({balance:"100.00"}),recentTransactions:[],showDetailPopup:!1,filterOptions:["全部","本月","上月","今年"],currentFilter:0,incomeList:[],loading:!1,noMore:!1,page:1,pageSize:10,showWithdrawPopup:!1,withdrawAmount:"",amountError:"",currentMethod:0,withdrawMethods:[new UTSJSONObject({type:"wechat",name:"微信",shortName:"微",description:"2小时内到账",fee:"0%"}),new UTSJSONObject({type:"alipay",name:"支付宝",shortName:"支",description:"2小时内到账",fee:"0%"}),new UTSJSONObject({type:"bank",name:"银行卡",shortName:"银",description:"1-3个工作日到账",fee:"0%"})]}},computed:{groupedIncomeList(){const e=new UTSJSONObject({});return this.incomeList.forEach(i=>{const s=i.month;e[s]||(e[s]=[]),e[s].push(i)}),e},canWithdraw(){if(!this.withdrawAmount||this.amountError)return!1;const e=parseFloat(this.withdrawAmount);return e>=10&&e<=parseFloat(this.walletInfo.balance)}},onLoad(){this.getWalletInfo(),this.getRecentTransactions()},methods:{goBack(){t.index.navigateBack()},showIncomeDetail(){this.showDetailPopup=!0,this.loadIncomeData()},hideIncomeDetail(){this.showDetailPopup=!1},withdraw(){if(parseFloat(this.walletInfo.balance)<=0)return t.index.showToast({title:"余额不足",icon:"none"}),null;this.withdrawAmount="",this.amountError="",this.showWithdrawPopup=!0},hideWithdraw(){this.showWithdrawPopup=!1},validateAmount(){const e=parseFloat(this.withdrawAmount),i=parseFloat(this.walletInfo.balance);isNaN(e)?this.amountError="请输入有效金额":e<=0?this.amountError="提现金额必须大于0":e<10?this.amountError="提现金额不能低于10元":e>i?this.amountError="提现金额不能超过可用余额":this.amountError=""},setMaxAmount(){this.withdrawAmount=this.walletInfo.balance,this.validateAmount()},selectMethod(e=null){this.currentMethod=e},confirmWithdraw(){if(!this.canWithdraw)return null;t.index.showLoading({title:"提现申请中..."}),setTimeout(()=>{t.index.hideLoading();const e=parseFloat(this.walletInfo.balance),i=parseFloat(this.withdrawAmount);this.walletInfo.balance=(e-i).toFixed(2),this.recentTransactions.unshift({id:"tx"+Date.now(),type:"expense",title:"提现到"+this.withdrawMethods[this.currentMethod].name,time:this.formatDate(new Date),amount:i.toFixed(2)}),this.hideWithdraw(),t.index.showToast({title:"提现申请成功",icon:"success"})},1500)},formatDate(e=null){const i=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),l=e.getDate().toString().padStart(2,"0");return`${i}-${s}-${l}`},getWalletInfo(){this.walletInfo={balance:"100.00"}},getRecentTransactions(){this.recentTransactions=[{id:"tx001",type:"income",title:"学员购买《数学基础》课程",time:"2024-03-15",amount:"199.00"},{id:"tx002",type:"income",title:"学员打赏",time:"2024-03-10",amount:"50.00"},{id:"tx003",type:"expense",title:"提现",time:"2024-03-05",amount:"149.00"}]},setFilter(e=null){if(this.currentFilter===e)return null;this.currentFilter=e,this.page=1,this.incomeList=[],this.noMore=!1,this.loadIncomeData()},loadMoreIncome(){if(this.loading||this.noMore)return null;this.page++,this.loadIncomeData()},loadIncomeData(){this.loading=!0,setTimeout(()=>{const e=this.generateMockData();this.incomeList=this.page===1?e:[...this.incomeList,...e],this.loading=!1,this.noMore=e.length<this.pageSize},500)},generateMockData(){const e=[],i=this.page===1?this.pageSize:Math.floor(Math.random()*this.pageSize);if(this.page>2)return[];const s=["课程","打赏","退款","其他"],l=["2023年12月","2024年01月","2024年02月","2024年03月"];for(let a=0;a<i;a++){const r=s[Math.floor(Math.random()*s.length)];let o="";switch(r){case"课程":o=`学员购买《${["数学基础","语文进阶","英语口语","物理实验"][Math.floor(Math.random()*4)]}》课程`;break;case"打赏":o="学员打赏";break;case"退款":o="平台退款";break;default:o="其他收入"}let n="";switch(this.currentFilter){case 1:n="2024年03月";break;case 2:n="2024年02月";break;case 3:n=l[Math.floor(Math.random()*2)+2];break;default:n=l[Math.floor(Math.random()*l.length)]}const c=Math.floor(Math.random()*28)+1,h=Math.floor(Math.random()*24),u=Math.floor(Math.random()*60),m=`${c<10?"0"+c:c}日 ${h<10?"0"+h:h}:${u<10?"0"+u:u}`,d=(Math.random()*500+50).toFixed(2);e.push({id:`income_${this.page}_${a}`,title:o,source:r,amount:d,month:n,time:m,status:"已到账"})}return e},calculateMonthTotal(e=null){return e.reduce((i=null,s=null)=>i+parseFloat(s.amount),0).toFixed(2)},getIconClass(e=null){switch(e){case"课程":return"course";case"打赏":return"reward";case"退款":return"refund";default:return"other"}},getIconText(e=null){switch(e){case"课程":return"课";case"打赏":return"赏";case"退款":return"退";default:return"其"}}}});if(!Array){const e=t.resolveComponent("path"),i=t.resolveComponent("svg");(e+i)()}function f(e,i,s,l,a,r){return t.e({a:t.t(a.walletInfo.balance||"0.00"),b:t.o((...o)=>r.showIncomeDetail&&r.showIncomeDetail(...o)),c:t.o((...o)=>r.withdraw&&r.withdraw(...o)),d:a.showDetailPopup},a.showDetailPopup?t.e({e:t.o((...o)=>r.hideIncomeDetail&&r.hideIncomeDetail(...o)),f:t.f(a.filterOptions,(o,n,c)=>({a:t.t(o),b:n,c:a.currentFilter===n?1:"",d:t.o(h=>r.setFilter(n),n)})),g:a.incomeList.length>0},a.incomeList.length>0?t.e({h:t.f(r.groupedIncomeList,(o,n,c)=>({a:t.t(n),b:t.t(r.calculateMonthTotal(o)),c:t.f(o,(h,u,m)=>({a:t.t(r.getIconText(h.source)),b:t.n(r.getIconClass(h.source)),c:t.t(h.title),d:t.t(h.time),e:t.t(h.amount),f:u})),d:n})),i:a.loading},a.loading?{}:a.noMore?{}:{},{j:a.noMore}):{k:t.p({d:"M40 70C56.5685 70 70 56.5685 70 40C70 23.4315 56.5685 10 40 10C23.4315 10 10 23.4315 10 40C10 56.5685 23.4315 70 40 70Z",stroke:"#E0E6F1","stroke-width":"2"}),l:t.p({d:"M30 40H50M40 30V50",stroke:"#E0E6F1","stroke-width":"2","stroke-linecap":"round"}),m:t.p({xmlns:"http://www.w3.org/2000/svg",width:"80",height:"80",viewBox:"0 0 80 80",fill:"none"})},{n:t.o((...o)=>r.loadMoreIncome&&r.loadMoreIncome(...o)),o:t.o((...o)=>r.hideIncomeDetail&&r.hideIncomeDetail(...o))}):{},{p:a.showWithdrawPopup},a.showWithdrawPopup?t.e({q:t.o((...o)=>r.hideWithdraw&&r.hideWithdraw(...o)),r:t.o([o=>a.withdrawAmount=o.detail.value,(...o)=>r.validateAmount&&r.validateAmount(...o)]),s:a.withdrawAmount,t:t.t(a.walletInfo.balance),v:t.o((...o)=>r.setMaxAmount&&r.setMaxAmount(...o)),w:a.amountError},a.amountError?{x:t.t(a.amountError)}:{},{y:t.f(a.withdrawMethods,(o,n,c)=>t.e({a:t.t(o.shortName),b:t.n(o.type),c:t.t(o.name),d:t.t(o.description),e:a.currentMethod===n},a.currentMethod===n?{}:{},{f:n,g:a.currentMethod===n?1:"",h:t.o(h=>r.selectMethod(n),n)})),z:r.canWithdraw?"":1,A:t.o((...o)=>r.confirmWithdraw&&r.confirmWithdraw(...o)),B:t.o((...o)=>r.hideWithdraw&&r.hideWithdraw(...o))}):{},{C:t.sei(t.gei(e,""),"view")})}const p=t._export_sfc(w,[["render",f]]);wx.createPage(p);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/bill/bill.js.map
