"use strict";const t=require("../../common/vendor.js"),m=require("../../router/Router.js"),h=require("../../store/user/money/state.js"),d=require("../../common/assets.js"),g=()=>"../../components/navigationTitleBar/header.js",f=()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js",w=t.defineComponent({components:{Header:g,uniDatetimePicker:f},data(){return{refreshing:!1,localTransactionList:h.moneyState.transactionList,isLoading:!1,hasMore:!1,showDatePicker:!1,currentDate:Date.now(),currentMonth:this.getCurrentMonthLabel(),showMonthPicker:!1,availableMonths:[],currentFilter:"all",filters:[new UTSJSONObject({label:"全部",value:"all"}),new UTSJSONObject({label:"收入",value:"income"}),new UTSJSONObject({label:"支出",value:"expense"})],showDetail:!1,selectedTransaction:null,showTimeIndexPanel:!1,availableYears:[2021,2022,2023,2024,2025],currentYearIndex:new Date().getFullYear(),quickSelectType:"",categoryIcons:new UTSJSONObject({income:new UTSJSONObject({default:"/static/image/bill/income.png",course:"/static/image/bill/course.png",salary:"/static/image/bill/income.png",refund:"/static/image/bill/income.png",interest:"/static/image/bill/income.png"}),expense:new UTSJSONObject({default:"/static/image/bill/expense.png",withdraw:"/static/image/bill/withdraw.png",transfer:"/static/image/bill/expense.png",shopping:"/static/image/bill/expense.png",dining:"/static/image/bill/expense.png"})})}},computed:{transactionList(){return this.localTransactionList},filteredTransactions(){if(!this.transactionList||this.transactionList.length===0)return[];const e=this.parseMonthLabel(this.currentMonth);let r=this.transactionList.filter((i=null)=>{const o=new Date(i.date);return o.getFullYear()===e.year&&o.getMonth()+1===e.month});return this.currentFilter==="income"?r=r.filter((i=null)=>i.amount>0):this.currentFilter==="expense"&&(r=r.filter((i=null)=>i.amount<0)),r.sort((i=null,o=null)=>o.date-i.date)},totalIncome(){return this.filteredTransactions.filter((e=null)=>e.amount>0).reduce((e=null,r=null)=>e+r.amount,0).toFixed(2)},totalExpense(){return this.filteredTransactions.filter((e=null)=>e.amount<0).reduce((e=null,r=null)=>e+Math.abs(r.amount),0).toFixed(2)}},onLoad(){this.generateAvailableMonths(),t.index.__f__("log","at pagesMine/bill/bill.vue:309","加载交易记录:",this.transactionList),this.fetchData()},onReachBottom(){this.loadMore()},methods:{goBack(){try{m.Navigator.toMine()}catch(e){t.index.__f__("error","at pagesMine/bill/bill.vue:322","导航错误:",e),t.index.navigateBack(new UTSJSONObject({delta:1}))}},openDateSelector(){this.showMonthPicker=!0},fetchData(){this.isLoading=!0,setTimeout(()=>{(!this.localTransactionList||this.localTransactionList.length===0)&&(this.localTransactionList=h.moneyState.transactionList||[]),this.localTransactionList.length<10&&this.expandMockData(),this.isLoading=!1,this.hasMore=this.localTransactionList.length>10},500)},expandMockData(){const e=[new UTSJSONObject({id:"tx003",name:"同济超市",date:174312e7,amount:-5.7,channel:"微信支付"}),new UTSJSONObject({id:"tx004",name:"全家",date:17428608e5,amount:-15.8,channel:"微信支付"}),new UTSJSONObject({id:"tx005",name:"扫二维码付款-给曹殷杰",date:17427744e5,amount:-6,channel:"微信支付"}),new UTSJSONObject({id:"tx006",name:"微信红包-来自妈",date:17425152e5,amount:100,channel:"微信红包"}),new UTSJSONObject({id:"tx007",name:"luckin coffee",date:1742256e6,amount:-14.35,channel:"微信支付"}),new UTSJSONObject({id:"tx008",name:"同济大学",date:17420832e5,amount:-30,channel:"微信支付"}),new UTSJSONObject({id:"tx009",name:"嘉众越",date:1741824e6,amount:-19.9,channel:"微信支付"}),new UTSJSONObject({id:"tx010",name:"上海独美科技有限公司",date:17413056e5,amount:-14.9,channel:"微信支付"}),new UTSJSONObject({id:"tx011",name:"好利来",date:17411328e5,amount:-35.5,channel:"微信支付"}),new UTSJSONObject({id:"tx012",name:"中石化加油站",date:17410464e5,amount:-208.56,channel:"微信支付"}),new UTSJSONObject({id:"tx013",name:"春风十里",date:17408736e5,amount:-158,channel:"微信支付"}),new UTSJSONObject({id:"tx014",name:"美团外卖",date:17407872e5,amount:-25.8,channel:"微信支付"}),new UTSJSONObject({id:"tx015",name:"工资",date:1740096e6,amount:6e3,channel:"微信支付"}),new UTSJSONObject({id:"tx016",name:"淘宝退款",date:17398368e5,amount:86.5,channel:"支付宝"}),new UTSJSONObject({id:"tx017",name:"沃尔玛",date:17397504e5,amount:-235.6,channel:"微信支付"}),new UTSJSONObject({id:"tx018",name:"水费",date:17394912e5,amount:-78.25,channel:"微信支付"})];this.localTransactionList=[...e],this.localTransactionList.sort((r=null,i=null)=>i.date-r.date)},loadMore(){if(!this.hasMore||this.isLoading)return null;this.isLoading=!0,setTimeout(()=>{this.isLoading=!1,this.hasMore=!1},500)},refresh(){this.refreshing=!0,setTimeout(()=>{this.fetchData(),this.refreshing=!1},1e3)},onDateConfirm(e=null){const r=new Date(e);this.currentMonth=`${r.getFullYear()}年${r.getMonth()+1}月`,this.showDatePicker=!1},formatGroupDate(e=null){const r=new Date(e);return`${r.getMonth()+1}月${r.getDate()}日`},formatDate(e=null){const r=new Date(e),i=new Date,o=new Date(i);return o.setDate(i.getDate()-1),r.toDateString()===i.toDateString()?"今天":r.toDateString()===o.toDateString()?"昨天":`${r.getMonth()+1}月${r.getDate()}日`},formatTime(e=null){const r=new Date(e);return`${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`},formatDetailDate(e=null){const r=new Date(e),i=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0"),s=String(r.getHours()).padStart(2,"0"),a=String(r.getMinutes()).padStart(2,"0"),l=String(r.getSeconds()).padStart(2,"0");return`${i}-${o}-${n} ${s}:${a}:${l}`},getCurrentMonthLabel(){const e=new Date;return`${e.getFullYear()}年${e.getMonth()+1}月`},parseMonthLabel(e=null){const r=e.match(/(\d+)年(\d+)月/);if(r&&r.length===3)return new UTSJSONObject({year:parseInt(r[1]),month:parseInt(r[2])});const i=new Date;return new UTSJSONObject({year:i.getFullYear(),month:i.getMonth()+1})},generateAvailableMonths(){const e=[],r=new Date,i=r.getFullYear(),o=r.getMonth()+1;for(let n=0;n<12;n++){let s=i,a=o-n;a<=0&&(a+=12,s-=1),e.push(`${s}年${a}月`)}this.availableMonths=e},selectMonth(e=null){this.currentMonth=e,this.showMonthPicker=!1},setFilter(e=null){this.currentFilter=e},showTransactionDetail(e=null){this.selectedTransaction=e,this.showDetail=!0},getTransactionIcon(e=null){return e.amount>0?e.name.includes("课程")?this.categoryIcons.income.course:e.name.includes("工资")?this.categoryIcons.income.salary:e.name.includes("退款")?this.categoryIcons.income.refund:e.name.includes("利息")?this.categoryIcons.income.interest:this.categoryIcons.income.default:e.name.includes("提现")?this.categoryIcons.expense.withdraw:e.name.includes("转账")?this.categoryIcons.expense.transfer:e.name.includes("购物")||e.name.includes("购买")?this.categoryIcons.expense.shopping:e.name.includes("餐饮")||e.name.includes("肯德基")?this.categoryIcons.expense.dining:this.categoryIcons.expense.default},selectRecentMonths(e=null){this.quickSelectType=`recent${e}`;const r=new Date,i=r.getFullYear(),o=r.getMonth()+1;let n=i,s=o-e+1;s<=0&&(s+=12,n-=1),this.currentMonth=`${n}年${s}月`,this.showTimeIndexPanel=!1},selectYear(e=null){this.currentYearIndex=e},isMonthActive(e=null){const r=this.parseMonthLabel(this.currentMonth);return r.year===this.currentYearIndex&&r.month===e},selectMonthByIndex(e=null){const r=this.currentYearIndex;this.currentMonth=`${r}年${e}月`,this.showTimeIndexPanel=!1},selectCurrentYear(){const e=new Date;this.currentYearIndex=e.getFullYear(),this.currentMonth=`${e.getFullYear()}年1月`,this.quickSelectType="currentYear",this.showTimeIndexPanel=!1}}});if(!Array){const e=t.resolveComponent("Header"),r=t.resolveComponent("uni-datetime-picker");(e+r)()}const S=()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js";Math||S();function T(e,r,i,o,n,s){return t.e({a:t.o(s.goBack),b:t.p({title:"账单"}),c:t.t(n.currentMonth),d:t.o((...a)=>s.openDateSelector&&s.openDateSelector(...a)),e:t.f(n.filters,(a,l,c)=>({a:t.t(a.label),b:l,c:n.currentFilter===a.value?1:"",d:t.o(u=>s.setFilter(a.value),l)})),f:t.o(a=>n.showTimeIndexPanel=!0),g:t.t(s.totalExpense),h:t.t(s.totalIncome),i:s.filteredTransactions.length>0},s.filteredTransactions.length>0?t.e({j:t.f(s.filteredTransactions,(a,l,c)=>({a:s.getTransactionIcon(a),b:t.t(a.name),c:t.t(s.formatDate(a.date)),d:t.t(s.formatTime(a.date)),e:t.t(a.amount>0?"+":""),f:t.t(a.amount.toFixed(2)),g:t.n(a.amount>0?"income":"expense"),h:a.id,i:t.o(u=>s.showTransactionDetail(a),a.id)})),k:n.isLoading},n.isLoading?{}:n.hasMore?{}:{},{l:!n.hasMore}):n.isLoading?{}:{n:d._imports_0$5},{m:!n.isLoading,o:t.o((...a)=>s.loadMore&&s.loadMore(...a)),p:n.refreshing,q:t.o((...a)=>s.refresh&&s.refresh(...a)),r:n.showDatePicker},n.showDatePicker?{s:t.o(s.onDateConfirm),t:t.o(a=>n.showDatePicker=!1),v:t.p({type:"date",value:n.currentDate,"return-type":"timestamp",mode:"date"})}:{},{w:n.showTimeIndexPanel},n.showTimeIndexPanel?{x:t.o(a=>n.showTimeIndexPanel=!1)}:{},{y:n.showTimeIndexPanel},n.showTimeIndexPanel?{z:t.o(a=>n.showTimeIndexPanel=!1),A:t.f(n.availableYears,(a,l,c)=>({a:t.t(a),b:a,c:n.currentYearIndex===a?1:"",d:t.o(u=>s.selectYear(a),a)})),B:t.f(12,(a,l,c)=>({a:t.t(a),b:a,c:s.isMonthActive(a)?1:"",d:t.o(u=>s.selectMonthByIndex(a),a)})),C:t.o(a=>s.selectRecentMonths(3)),D:t.o(a=>s.selectRecentMonths(6)),E:t.o(a=>s.selectRecentMonths(12)),F:t.o(a=>s.selectCurrentYear())}:{},{G:n.showMonthPicker},n.showMonthPicker?{H:t.o(a=>n.showMonthPicker=!1)}:{},{I:n.showMonthPicker},n.showMonthPicker?{J:t.o(a=>n.showMonthPicker=!1),K:t.f(n.availableMonths,(a,l,c)=>({a:t.t(a),b:l,c:a===n.currentMonth?1:"",d:t.o(u=>s.selectMonth(a),l)}))}:{},{L:n.showDetail},n.showDetail?{M:t.o(a=>n.showDetail=!1)}:{},{N:n.showDetail&&n.selectedTransaction},n.showDetail&&n.selectedTransaction?{O:t.o(a=>n.showDetail=!1),P:t.t(n.selectedTransaction.amount>0?"+":""),Q:t.t(n.selectedTransaction.amount.toFixed(2)),R:t.t(n.selectedTransaction.amount>0?"收入":"支出"),S:t.n(n.selectedTransaction.amount>0?"income-bg":"expense-bg"),T:t.t(n.selectedTransaction.name),U:t.t(s.formatDetailDate(n.selectedTransaction.date)),V:t.t(n.selectedTransaction.channel||"中国银行APP"),W:t.t(n.selectedTransaction.id)}:{},{X:t.sei(t.gei(e,""),"view")})}const M=t._export_sfc(w,[["render",T]]);wx.createPage(M);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesMine/bill/bill.js.map
