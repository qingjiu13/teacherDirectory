"use strict";const i=require("../../common/vendor.js"),a=require("../../common/assets.js");let r=[];const d=i.defineComponent({name:"ChoiceSelected",components:{},data(){return{isShowChoice:!1,dropdownTop:0,dropdownLeft:0,dropdownWidth:0,displayContent:this.defaultText,searchKeyword:this.defaultSearchValue||"",searchTimer:null,isFocused:!1,lastSelectedValue:null,pageSize:10,currentPage:1,isLoadingMore:!1,hasMoreItems:!0,pageScrollListener:null,isLoading:!1,loadError:null,dataLoaded:!1}},props:{choiceIndex:{type:Number,default:-1},choiceList:{type:Array,default:()=>[]},defaultText:{type:String,default:"请选择"},mode:{type:String,default:"select",validator:(t=null)=>["select","search"].includes(t)},debounce:{type:Number,default:300},searchPlaceholder:{type:String,default:"请输入关键词"},componentType:{type:String,default:"default",validator:(t=null)=>["default","undergraduate","graduateSchool","graduateMajor"].includes(t)},parentValue:{type:[String,Object,Number],default:null},isLinkage:{type:Boolean,default:!1},autoCloseOthers:{type:Boolean,default:!0},enablePagination:{type:Boolean,default:!0},defaultSearchValue:{type:String,default:""},loadingStatus:{type:Object,default:()=>new UTSJSONObject({isLoaded:!0,isLoading:!1,error:null})}},created(){r.push(this),i.index.$on("page-scroll",this.handlePageScroll)},mounted(){this.updateLoadingStatus()},beforeUnmount(){i.index.$off("page-scroll",this.handlePageScroll);const t=r.indexOf(this);t>-1&&r.splice(t,1),this.searchTimer&&clearTimeout(this.searchTimer)},computed:{pagedChoiceList(){if(!this.enablePagination)return this.choiceList;const t=0,e=this.currentPage*this.pageSize;return this.choiceList.slice(t,e)}},watch:{choiceIndex(t=null){if(t>=0&&t<this.choiceList.length){const e=this.choiceList[t];this.displayContent=typeof e=="string"?e:e.choiceItemContent,this.lastSelectedValue=e,this.mode==="search"&&(this.searchKeyword=typeof e=="string"?e:e.choiceItemContent),this.componentType==="graduateSchool"&&this.$emit("linkage-change",e)}else this.displayContent=this.defaultText,this.lastSelectedValue=null,this.mode==="search"&&(this.searchKeyword=this.defaultSearchValue||""),this.componentType==="graduateSchool"&&this.$emit("linkage-change",null)},defaultText(t=null){(this.choiceIndex<0||this.choiceIndex>=this.choiceList.length)&&(this.displayContent=t)},parentValue(t=null){this.isLinkage&&this.componentType==="graduateMajor"&&(this.searchKeyword=this.defaultSearchValue||"",this.displayContent=this.defaultText,this.$emit("reset-selection"))},choiceList(){this.updateDisplayContent()},searchKeyword(){this.resetPagination()},defaultSearchValue(t=null){(this.choiceIndex<0||this.choiceIndex>=this.choiceList.length)&&!this.searchKeyword&&(this.searchKeyword=t||"",t&&this.isShowChoice&&this.onSearchInput(new UTSJSONObject({})))},loadingStatus:{handler(t=null){this.updateLoadingStatus()},deep:!0}},methods:{updateLoadingStatus(){this.loadingStatus&&(this.isLoading=this.loadingStatus.isLoading,this.loadError=this.loadingStatus.error,this.dataLoaded=this.loadingStatus.isLoaded)},handleRetry(){this.$emit("retry-load")},handlePageScroll(){this.isShowChoice&&this.closeDropdown()},resetPagination(){this.currentPage=1,this.isLoadingMore=!1,this.hasMoreItems=this.choiceList.length>this.pageSize},loadMore(){if(!this.hasMoreItems||this.isLoadingMore)return null;this.isLoadingMore=!0,setTimeout(()=>{this.currentPage++,this.isLoadingMore=!1,this.hasMoreItems=this.choiceList.length>this.currentPage*this.pageSize},300)},onScrollToBottom(){this.enablePagination&&this.loadMore()},findOriginalIndex(t=null){return typeof t=="string"?this.choiceList.findIndex((e=null)=>typeof e=="string"&&e===t):t&&t.choiceItemId?this.choiceList.findIndex((e=null)=>e&&e.choiceItemId&&e.choiceItemId===t.choiceItemId):-1},updateDisplayContent(){if(this.choiceIndex>=0&&this.choiceIndex<this.choiceList.length){const t=this.choiceList[this.choiceIndex];this.displayContent=typeof t=="string"?t:t.choiceItemContent}else this.displayContent=this.defaultText},btnChoiceClick:function(t=null){var e=this;e.isShowChoice=!1;const n=e.pagedChoiceList[t];if(e.mode==="search"&&e.searchKeyword){if(typeof n=="string"){const c=e.choiceList.findIndex((o=null)=>typeof o=="string"&&o===n);if(c!==-1)return e.$emit("onChoiceClick",c,n),null}else if(n&&n.choiceItemId){const c=e.choiceList.findIndex((o=null)=>o&&o.choiceItemId&&o.choiceItemId===n.choiceItemId);if(c!==-1)return e.$emit("onChoiceClick",c,n),null}}e.$emit("onChoiceClick",t,n)},btnShowHideClick:function(t=null){t.stopPropagation();var e=this;e.isShowChoice?e.isShowChoice=!1:(this.autoCloseOthers&&this.closeOtherDropdowns(),this.resetPagination(),i.index.createSelectorQuery().in(this).select(".drop-down-box, .drop-down-box-selected").boundingClientRect((c=null)=>{c&&(e.dropdownTop=c.top+c.height,e.dropdownLeft=c.left,e.dropdownWidth=c.width,e.isShowChoice=!0,e.defaultSearchValue&&!e.searchKeyword&&(e.searchKeyword=e.defaultSearchValue,e.onSearchInput(t)),this.$emit("init-data"))}).exec())},closeOtherDropdowns(){r.forEach(t=>{t!==this&&t.isShowChoice&&(t.isShowChoice=!1)})},onSearchInput(t=null){const e=this;e.searchTimer&&clearTimeout(e.searchTimer),e.searchTimer=setTimeout(()=>{i.index.__f__("log","at components/combobox/combobox.vue:489","发送搜索请求:",e.searchKeyword),e.$emit("search-input",e.searchKeyword),e.isShowChoice||e.btnShowHideClick(t)},e.debounce)},onInputFocus(t=null){this.isFocused=!0,t.stopPropagation(),!this.isShowChoice&&this.$refs.keyboardWatcher&&this.$refs.keyboardWatcher.openWhenReady(this)},closeDropdown(){this.isShowChoice&&(this.isShowChoice=!1)},reset(){this.searchKeyword=this.defaultSearchValue||"",this.displayContent=this.defaultText,this.isShowChoice=!1,this.lastSelectedValue=null,this.resetPagination(),this.$emit("reset-selection")},getSelectedValue(){return this.choiceIndex>=0&&this.choiceIndex<this.choiceList.length?this.choiceList[this.choiceIndex]:null},openDropdown(){const t=new UTSJSONObject({stopPropagation:()=>{}});this.btnShowHideClick(t)}}});function u(t,e,n,c,o,h){return i.e({a:n.mode==="select"},n.mode==="select"?{b:i.t(o.displayContent),c:i.n(n.choiceIndex===-1?"input-placeholder":"input-placeholder-selected")}:{d:n.searchPlaceholder,e:i.o([s=>o.searchKeyword=s.detail.value,(...s)=>h.onSearchInput&&h.onSearchInput(...s)]),f:i.o((...s)=>h.onInputFocus&&h.onInputFocus(...s)),g:o.searchKeyword},{h:o.isShowChoice?1:"",i:a._imports_0$8,j:i.sei("r0-4c16e9dc","view","dropdownTrigger"),k:i.n(o.isShowChoice?"drop-down-box-selected":"drop-down-box"),l:i.o((...s)=>h.btnShowHideClick&&h.btnShowHideClick(...s)),m:o.isShowChoice},o.isShowChoice?i.e({n:h.pagedChoiceList.length>0},h.pagedChoiceList.length>0?{o:i.f(h.pagedChoiceList,(s,l,p)=>({a:i.t(typeof s=="string"?s:s.choiceItemContent),b:n.choiceIndex==h.findOriginalIndex(s)?1:"",c:l,d:i.o(g=>h.btnChoiceClick(l),l)}))}:{},{p:o.isLoadingMore},o.isLoadingMore?{}:{},{q:i.sei("r1-4c16e9dc","scroll-view","scrollView"),r:i.o((...s)=>h.onScrollToBottom&&h.onScrollToBottom(...s)),s:o.isShowChoice?1:"",t:o.dropdownTop+"px",v:o.dropdownLeft+"px",w:o.dropdownWidth+"px",x:i.o(()=>{})}):{},{y:i.sei(i.gei(t,""),"view"),z:i.o(()=>{}),A:i.o((...s)=>h.handlePageScroll&&h.handlePageScroll(...s))})}const f=i._export_sfc(d,[["render",u]]);wx.createComponent(f);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/components/combobox/combobox.js.map
