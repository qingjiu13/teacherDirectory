"use strict";const e=require("../../common/vendor.js"),_=require("./useAnimationCache.js");Math||x();const x=()=>"./LoadingAnimation.js",j=e.defineComponent({__name:"GlobalLoading",props:{src:new UTSJSONObject({type:String,default:"https://lottie.host/1f64310d-d1a9-44c9-ac77-3c29ae849559/c3yfKGAzCm.json"}),width:new UTSJSONObject({type:String,default:"200rpx"}),height:new UTSJSONObject({type:String,default:"200rpx"}),fullscreen:new UTSJSONObject({type:Boolean,default:!0}),transparent:new UTSJSONObject({type:Boolean,default:!1}),backgroundColor:new UTSJSONObject({type:String,default:"rgba(255, 255, 255, 0.9)"}),autoPlay:new UTSJSONObject({type:Boolean,default:!0}),preload:new UTSJSONObject({type:Boolean,default:!0}),showText:new UTSJSONObject({type:Boolean,default:!0}),text:new UTSJSONObject({type:String,default:"加载中..."}),zIndex:new UTSJSONObject({type:Number,default:9999})},emits:["mounted","dataReady","error","timeout"],setup(a,f){var g=f.expose,m=f.emit;const c=a,u=m,t=e.ref(null),l=e.ref(!1),i=e.ref(!1),r=_.useGlobalAnimationState(),s=r.getGlobalStats,n=e.computed(()=>new UTSJSONObject({backgroundColor:c.transparent?"transparent":c.backgroundColor,zIndex:c.zIndex})),v=()=>{l.value=!0,t.value&&t.value.show()},b=()=>{l.value=!1,t.value&&t.value.hide()},p=()=>e.__awaiter(this,void 0,void 0,function*(){if(i.value)return!0;try{if(t.value){const o=yield t.value.preload();return o&&(i.value=!0),o}return!1}catch(o){return e.index.__f__("error","at components/loading/GlobalLoading.vue:157","预加载全局动画失败",o),!1}}),h=()=>t.value&&t.value.lottieRef?t.value.lottieRef.value:null,O=()=>s(),w=()=>{i.value=!0,u("dataReady")},S=(o=null)=>{u("error",o)},y=(o=null)=>{u("timeout",o)},d=()=>{c.preload&&p(),u("mounted")};return g(new UTSJSONObject({show:v,hide:b,preload:p,isPreloaded:e.computed(()=>i.value),getLottieRef:h,getAnimationStats:O})),e.provide("globalLoading",new UTSJSONObject({show:v,hide:b,preload:p,isPreloaded:e.computed(()=>i.value),stats:s})),d(),e.onBeforeUnmount(()=>{const o=getApp();o&&o.globalData&&o.globalData.$loading&&(o.globalData.$loading.componentMounted=!1)}),(o=null,A=null)=>({a:e.sr(t,"52456a73-0",{k:"loadingRef"}),b:e.o(w),c:e.o(S),d:e.o(y),e:e.o(d),f:e.p({src:a.src,width:a.width,height:a.height,showText:a.showText,text:a.text,autoPlay:a.autoPlay}),g:e.sei(e.gei(o,""),"view"),h:e.s(n.value),i:l.value?1:"",j:a.fullscreen?1:""})}});Array||e.resolveComponent("c-lottie")();const U=()=>"../../uni_modules/c-lottie/components/c-lottie/c-lottie.js";Math||U();const T=e.defineComponent({__name:"LoadingAnimation",props:{src:new UTSJSONObject({type:String,default:"https://lottie.host/1f64310d-d1a9-44c9-ac77-3c29ae849559/c3yfKGAzCm.json"}),width:new UTSJSONObject({type:String,default:"200rpx"}),height:new UTSJSONObject({type:String,default:"200rpx"}),autoPlay:new UTSJSONObject({type:Boolean,default:!0}),showText:new UTSJSONObject({type:Boolean,default:!0}),text:new UTSJSONObject({type:String,default:"加载中..."})},emits:["mounted","dataReady","error","timeout"],setup(a,f){var g=f.expose,m=f.emit;const c=a,u=m,t=e.ref(null),l=e.ref(!1),i=e.ref(c.src),r=e.ref(!1),s=e.ref(!1),n=e.ref(null),v=_.useAnimationCache(),b=v.isAnimationCached,p=v.loadAnimationData,h=v.getAnimationStats,O=()=>{r.value||S(),l.value=!0,t.value&&r.value&&(t.value.call("play"),s.value=!0)},w=()=>{l.value=!1,t.value&&s.value&&(t.value.call("stop"),s.value=!1)},S=()=>e.__awaiter(this,void 0,void 0,function*(){if(r.value)return!0;try{return n.value&&clearTimeout(n.value),n.value=setTimeout(()=>{e.index.__f__("warn","at components/loading/LoadingAnimation.vue:128","动画加载超时",i.value),u("timeout",i.value)},5e3),(yield p(i.value))?(n.value&&(clearTimeout(n.value),n.value=null),r.value=!0,!0):!1}catch(d){return e.index.__f__("error","at components/loading/LoadingAnimation.vue:147","预加载动画失败",d),u("error",d),n.value&&(clearTimeout(n.value),n.value=null),!1}}),y=()=>{e.index.__f__("log","at components/loading/LoadingAnimation.vue:163","动画数据准备完成"),r.value=!0,n.value&&(clearTimeout(n.value),n.value=null),u("dataReady"),l.value&&!s.value&&(t.value.call("play"),s.value=!0)};return e.watch(()=>c.src,d=>{d!==i.value&&(i.value=d,r.value=!1,l.value&&S())}),g(new UTSJSONObject({show:O,hide:w,preload:S,isLoaded:e.computed(()=>r.value),isPlaying:e.computed(()=>s.value),lottieRef:t,getAnimationStats:h})),e.onMounted(()=>{e.index.__f__("log","at components/loading/LoadingAnimation.vue:210","加载动画组件已挂载"),b(i.value)?(e.index.__f__("log","at components/loading/LoadingAnimation.vue:214","动画已缓存，直接标记为已加载"),r.value=!0):S().then(()=>{e.index.__f__("log","at components/loading/LoadingAnimation.vue:219","动画预加载完成",r.value)}),u("mounted")}),e.onBeforeUnmount(()=>{n.value&&(clearTimeout(n.value),n.value=null),t.value&&s.value&&(t.value.call("stop"),s.value=!1)}),(d=null,o=null)=>e.e(new UTSJSONObject({a:e.sr(t,"f6494e84-0",new UTSJSONObject({k:"lottieRef"})),b:e.o(y),c:e.p(new UTSJSONObject({src:i.value,width:a.width,height:a.height,loop:!0,autoPlay:a.autoPlay})),d:a.showText}),a.showText?new UTSJSONObject({e:e.t(a.text)}):new UTSJSONObject({}),new UTSJSONObject({f:e.sei(e.gei(d,""),"view"),g:l.value?1:""}))}});function N(a,f={}){a.component("GlobalLoading",j),a.component("LottieLoading",T),a.config.globalProperties.$loading={show:()=>{const t=getApp();return t&&t.globalData&&t.globalData.$loading?t.globalData.$loading.show():!1},hide:()=>{const t=getApp();return t&&t.globalData&&t.globalData.$loading?t.globalData.$loading.hide():!1},preload:async()=>{const t=getApp();return t&&t.globalData&&t.globalData.$loading?await t.globalData.$loading.preload():!1}};const{globalState:g,getGlobalStats:m,isAllAnimationsLoaded:c,preloadAnimation:u}=_.useGlobalAnimationState();if(a.provide("animationState",{globalState:g,getStats:m,isAllLoaded:c,preload:u}),a.mixin({beforeCreate(){this.$animationState={globalState:g,getStats:m,isAllLoaded:c,preload:u}}}),f.preload){const{animations:t}=f.preload;t&&Array.isArray(t)&&t.length>0&&setTimeout(()=>{_.preloadAnimations(t,l=>{e.index.__f__("log","at components/loading/index.js:75",`预加载进度: ${l.progress.toFixed(2)}%`)}).then(l=>{e.index.__f__("log","at components/loading/index.js:78",`预加载完成: 成功${l.totalSuccess}个, 失败${l.totalFailed}个`)})},100)}}const J={install:N};exports.LoadingPlugin=J;exports._sfc_main=T;
//# sourceMappingURL=../../../.sourcemap/mp-weixin/components/loading/index.js.map
