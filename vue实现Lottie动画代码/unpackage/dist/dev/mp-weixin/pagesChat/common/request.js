"use strict";const n=require("../../common/vendor.js"),f=require("../env.js");let s=[],d=!1;const c=e=>{const o=e.header||{},r=n.index.getStorageSync("loginInfo");return r&&(o.accessToken=r.accessToken),new Promise(function(a,u){n.index.request({url:f.UNI_APP.BASE_URL+e.url,method:e.method||"GET",header:o,data:e.data||{},async success(t){if(t.data.code==200)return a(t.data.data);if(t.data.code==400)getApp().$vm.exit();else if(t.data.code==401){if(n.index.__f__("log","at pagesChat/common/request.js:26","token失效，尝试重新获取"),d){s.push(()=>{a(c(e))});return}d=!0;const i=await g(r);if(!i||i.data.code!=200){s=[],d=!1,n.index.__f__("log","at pagesChat/common/request.js:40","刷新token失败"),getApp().$vm.exit();return}let h=i.data.data;return n.index.setStorageSync("loginInfo",h),s.forEach(l=>l()),s=[],d=!1,a(c(e))}else return n.index.showToast({icon:"none",title:t.data.message,duration:1500}),u(t.data)},fail(t){return n.index.showToast({title:"网络似乎有点不给力哟",icon:"none",duration:1500}),u(t)}})})},g=e=>new Promise(function(o,r){n.index.request({method:"PUT",url:f.UNI_APP.BASE_URL+"/refreshToken",header:{refreshToken:e.refreshToken},success:a=>{o(a)},fail:a=>{r(a)}})});exports.request=c;
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesChat/common/request.js.map
