"use strict";const o=require("../../../common/vendor.js"),r=require("../../env.js"),i=o.defineComponent({name:"file-upload",data(){return{fileMap:new Map,option:new UTSJSONObject({url:r.UNI_APP.BASE_URL+"/file/upload",name:"file",header:new UTSJSONObject({accessToken:o.index.getStorageSync("loginInfo").accessToken})})}},props:{maxSize:{type:Number,default:10},onBefore:{type:Function,default:null},onSuccess:{type:Function,default:null},onError:{type:Function,default:null}},methods:{show(){this.$refs.lsjUpload.show()},hide(){this.$refs.lsjUpload.hide()},onUploadEnd(e=null){let n=this.fileMap.get(e.path);if(e.type=="fail")return this.onError(n),null;let s=UTS.JSON.parse(e.responseText);s.code==200?this.onOk(n,s):s.code==401?this.refreshToken().then((t=null)=>{let l=t.data.accessToken;this.option.header.accessToken=l,this.$refs.lsjUpload.setData(this.option),this.$refs.lsjUpload.upload(n.name)}).catch(()=>{this.onError(n,s)}):this.onError(n,s)},onChange(e=null){if(!e.size)return null;e.forEach((n=null,s=null)=>{this.fileMap.has(n.path)||(this.onBefore&&this.onBefore(n),this.fileMap.set(n.path,n))})},onOk(e=null,n=null){this.fileMap.delete(e.path),this.$refs.lsjUpload.clear(e.name),this.onSuccess&&this.onSuccess(e,n)},onFailed(e=null,n=null){this.fileMap.delete(e.path),this.$refs.lsjUpload.clear(e.name),this.onError&&this.onError(e,n)},refreshToken(){return new Promise((e,n)=>{let s=o.index.getStorageSync("loginInfo");o.index.request({method:"PUT",url:r.UNI_APP.BASE_URL+"/refreshToken",header:new UTSJSONObject({refreshToken:s.refreshToken}),success:t=>{e(t.data)},fail:t=>{n(t)}})})}}});Array||o.resolveComponent("lsj-upload")();const h=()=>"../../../uni_modules/lsj-upload/components/lsj-upload/lsj-upload.js";Math||h();function p(e,n,s,t,l,a){return{a:o.sr("lsjUpload","2e077055-0"),b:o.o(a.onUploadEnd),c:o.o(a.onChange),d:o.p({height:"100%",option:l.option,size:s.maxSize,instantly:!0}),e:o.sei(o.gei(e,""),"view")}}const u=o._export_sfc(i,[["render",p]]);wx.createComponent(u);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pagesChat/components/file-upload/file-upload.js.map
