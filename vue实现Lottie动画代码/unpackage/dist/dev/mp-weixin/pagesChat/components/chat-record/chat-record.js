"use strict";const e=require("../../../common/vendor.js"),i=e.defineComponent({name:"chat-record",data(){return{recording:!1,moveToCancel:!1,recordBarTop:0,druation:0,rcTimer:null}},methods:{onTouchMove(o=null){const c=o.touches[0].clientY;this.moveToCancel=c<this.recordBarTop-40},onCancel(){this.recording&&(this.moveToCancel=!0,this.onEndRecord())},onStartRecord(){if(this.recording||(e.index.__f__("log","at pagesChat/components/chat-record/chat-record.vue:55","开始录音"),this.moveToCancel=!1,this.initRecordBar(),!this.$rc.checkIsEnable()))return null;this.$rc.start().then(()=>{this.recording=!0,e.index.__f__("log","at pagesChat/components/chat-record/chat-record.vue:63","开始录音成功"),this.startTimer()}).catch((o=null)=>{e.index.__f__("log","at pagesChat/components/chat-record/chat-record.vue:67","录音失败"+UTS.JSON.stringify(o)),e.index.showToast({title:"录音失败",icon:"none"})})},onEndRecord(){if(!this.recording)return null;if(this.recording=!1,this.stopTimer(),this.$rc.close(),this.moveToCancel)return e.index.__f__("log","at pagesChat/components/chat-record/chat-record.vue:85","录音取消"),null;if(this.druation<=1)return e.index.showToast({title:"说话时间太短",icon:"none"}),null;this.$rc.upload().then((o=null)=>{this.$emit("send",o)}).catch((o=null)=>{e.index.showToast({title:o,icon:"none"})})},startTimer(){this.druation=0,this.stopTimer(),this.rcTimer=setInterval(()=>{this.druation++,this.druation>=60&&this.onEndRecord()},1e3)},stopTimer(){this.rcTimer&&clearInterval(this.rcTimer),this.rcTimer=null},initRecordBar(){e.index.createSelectorQuery().in(this).select("#chat-record-bar").boundingClientRect((c=null)=>{this.recordBarTop=c.top}).exec()}},computed:{recordWindowStyle(){return`bottom:${e.index.getSystemInfoSync().windowHeight-this.recordBarTop+12}px;`},recordTip(){return this.druation>50?`${60-this.druation}s后将停止录音`:`录音时长:${this.druation}s`}},unmounted(){this.stopTimer(),this.recording=!1}});Array||e.resolveComponent("uni-icons")();const s=()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||s();function u(o,c,a,h,n,r){return e.e({a:e.t(n.recording?"正在录音":"长按 说话"),b:e.sei("chat-record-bar","view"),c:n.recording?1:"",d:e.o(()=>{}),e:e.o((...t)=>r.onStartRecord&&r.onStartRecord(...t)),f:e.o((...t)=>r.onTouchMove&&r.onTouchMove(...t)),g:e.o((...t)=>r.onEndRecord&&r.onEndRecord(...t)),h:n.recording},n.recording?{i:e.t(r.recordTip),j:e.n(n.moveToCancel?"red":"black"),k:e.p({type:"clear",size:n.moveToCancel?45:40}),l:e.o((...t)=>r.onCancel&&r.onCancel(...t)),m:e.t(n.moveToCancel?"松手取消":"松手发送,上划取消"),n:e.n(n.moveToCancel?"red":"black"),o:e.s(r.recordWindowStyle)}:{},{p:e.sei(e.gei(o,""),"view")})}const d=e._export_sfc(i,[["render",u],["__scopeId","data-v-c703ceeb"]]);wx.createComponent(d);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pagesChat/components/chat-record/chat-record.js.map
