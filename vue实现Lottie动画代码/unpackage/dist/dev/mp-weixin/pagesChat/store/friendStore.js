"use strict";const l=require("../../common/vendor.js"),t=require("../common/request.js"),s=require("../common/enums.js"),d=l.defineStore("friendStore",{state:()=>({friends:[],timer:null}),actions:{setFriends(i){i.forEach(e=>{e.online=!1,e.onlineWeb=!1,e.onlineApp=!1}),this.friends=i},updateFriend(i){let e=this.findFriend(i.id),n=JSON.parse(JSON.stringify(e));Object.assign(e,i),e.online=n.online,e.onlineWeb=n.onlineWeb,e.onlineApp=n.onlineApp},removeFriend(i){this.friends.filter(e=>e.id==i).forEach(e=>e.deleted=!0)},addFriend(i){this.friends.some(e=>e.id==i.id)?this.updateFriend(i):this.friends.unshift(i)},setOnlineStatus(i){this.friends.forEach(e=>{let n=i.find(r=>e.id==r.userId);n?(e.online=!0,e.onlineWeb=n.terminals.indexOf(s.TERMINAL_TYPE.WEB)>=0,e.onlineApp=n.terminals.indexOf(s.TERMINAL_TYPE.APP)>=0):(e.online=!1,e.onlineWeb=!1,e.onlineApp=!1)})},refreshOnlineStatus(){let i=this.friends.filter(e=>!e.deleted).map(e=>e.id);i.length!=0&&(t.request({url:"/user/terminal/online?userIds="+i.join(","),method:"GET"}).then(e=>{this.setOnlineStatus(e)}),clearTimeout(this.timer),this.timer=setTimeout(()=>{this.refreshOnlineStatus()},3e4))},clear(){clearTimeout(this.timer),this.friends=[],this.timer=null},loadFriend(){return new Promise((i,e)=>{t.request({url:"/friend/list",method:"GET"}).then(n=>{this.setFriends(n),this.refreshOnlineStatus(),i()}).catch(n=>{e()})})}},getters:{isFriend:i=>e=>i.friends.filter(n=>!n.deleted).some(n=>n.id==e),findFriend:i=>e=>i.friends.find(n=>n.id==e)}});exports.useFriendStore=d;
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pagesChat/store/friendStore.js.map
