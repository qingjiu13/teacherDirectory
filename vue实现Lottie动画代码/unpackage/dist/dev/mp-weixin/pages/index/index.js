"use strict";const e=require("../../common/vendor.js"),v=require("../../common/assets.js"),C=require("../../router/Router.js");Array||e.resolveComponent("c-lottie")();const R=()=>"../../uni_modules/c-lottie/components/c-lottie/c-lottie.js";Math||(R+M)();const M=()=>"../../components/tab-bar/tab-bar.js",p="https://lottie.host/aa045d36-86ee-46d3-9705-1eeb65b38465/V6aAFX4Fmk.json",j=e.defineComponent({__name:"index",props:{src:new UTSJSONObject({type:String,default:p})},setup(d){const l=new Map,r=e.ref(),u=e.ref(""),s=e.ref(!1),o=e.ref(!1),_=e.ref(!1);let i=null;const m=d,c=(t=null)=>t.split("/").pop().split(".")[0],x=(t=null)=>l.has(t),f=(t=null)=>UTS.mapGet(l,t)||null,h=(t=null,n=null)=>{l.set(t,n);try{const a=`lottie_${c(t)}`;e.index.setStorageSync(a,n),e.index.__f__("log","at pages/index/index.vue:106","动画数据已保存到本地存储",a)}catch(a){e.index.__f__("error","at pages/index/index.vue:108","保存到本地存储失败",a)}},y=(t=null)=>{const n=`lottie_${c(t)}`;try{const a=e.index.getStorageSync(n);if(a)return l.set(t,a),e.index.__f__("log","at pages/index/index.vue:123","已从本地存储恢复动画数据到缓存",n),!0}catch(a){e.index.__f__("error","at pages/index/index.vue:127","从本地存储恢复失败",a)}return!1},T=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){if(o.value)return e.index.__f__("log","at pages/index/index.vue:139","已有加载任务正在进行"),null;if(o.value=!0,x(t))return e.index.__f__("log","at pages/index/index.vue:147","从内存缓存获取动画数据"),o.value=!1,f(t);if(y(t))return e.index.__f__("log","at pages/index/index.vue:154","从本地存储恢复动画数据"),o.value=!1,f(t);e.index.__f__("log","at pages/index/index.vue:160","从网络加载动画数据",t);try{const n=(yield e.index.request({url:t,method:"GET"})).data;return h(t,n),o.value=!1,n}catch(n){return e.index.__f__("error","at pages/index/index.vue:173","网络加载动画数据失败",n),o.value=!1,null}}),g=()=>e.__awaiter(this,void 0,void 0,function*(){i&&clearTimeout(i),_.value=!1;const t=m.src||p;u.value=t,T(t).then((n=null)=>{n&&(e.index.__f__("log","at pages/index/index.vue:198","动画数据加载成功"),s.value=!0)}),i=setTimeout(()=>{e.index.__f__("log","at pages/index/index.vue:205","动画加载超时，强制显示页面"),_.value=!0},3e3),x(t)&&(e.index.__f__("log","at pages/index/index.vue:211","检测到缓存数据，预先设置动画加载状态"),s.value=!0,setTimeout(()=>{_.value=!0},500))}),S=()=>{e.index.__f__("log","at pages/index/index.vue:224","动画数据准备完成，触发dataReady事件"),s.value=!0,i&&(clearTimeout(i),i=null),setTimeout(()=>{e.index.__f__("log","at pages/index/index.vue:235","设置页面为可显示状态"),_.value=!0},100)},b=()=>{if(!s.value)return e.index.__f__("log","at pages/index/index.vue:245","动画尚未加载完成"),null;r.value.call("play"),setTimeout(()=>{r.value.call("stop"),A()},1e3)},A=()=>{C.Navigator.toMatch()},w=()=>{i&&(clearTimeout(i),i=null)};return e.onMounted(()=>{e.index.__f__("log","at pages/index/index.vue:275","组件挂载，初始化动画"),g()}),e.onActivated(()=>{e.index.__f__("log","at pages/index/index.vue:281","页面激活"),u.value?_.value||(e.index.__f__("log","at pages/index/index.vue:287","动画源已存在但页面未准备好，强制显示"),_.value=!0):g()}),e.onBeforeUnmount(()=>{w()}),(t=null,n=null)=>({a:v._imports_0,b:e.sr(r,"74acbeb4-0",{k:"cLottieRef"}),c:e.o(S),d:e.p({src:u.value,width:"600rpx",autoPlay:!1,height:"600rpx",loop:!0}),e:v._imports_1,f:e.o(b),g:e.p({pageName:"index"}),h:e.sei(e.gei(t,""),"view")})}});wx.createPage(j);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/index.js.map
