"use strict";const i=require("../../../common/vendor.js"),a=require("../../../common/assets.js");let c=[];const d=i.defineComponent({name:"ChoiceSelected",components:{},data(){return{isShowChoice:!1,dropdownTop:0,dropdownLeft:0,dropdownWidth:0,displayContent:this.defaultText,searchKeyword:this.defaultSearchValue||"",searchTimer:null,isFocused:!1,lastSelectedValue:null,pageSize:10,currentPage:1,isLoadingMore:!1,hasMoreItems:!0,pageScrollListener:null}},props:{choiceIndex:{type:Number,default:-1},choiceList:{type:Array,default:()=>[]},defaultText:{type:String,default:"请选择"},mode:{type:String,default:"select",validator:(e=null)=>["select","search"].includes(e)},debounce:{type:Number,default:300},searchPlaceholder:{type:String,default:"请输入关键词"},componentType:{type:String,default:"default",validator:(e=null)=>["default","undergraduate","graduateSchool","graduateMajor"].includes(e)},parentValue:{type:[String,Object,Number],default:null},isLinkage:{type:Boolean,default:!1},autoCloseOthers:{type:Boolean,default:!0},enablePagination:{type:Boolean,default:!0},defaultSearchValue:{type:String,default:""},isLoadingMore:{type:Boolean,default:!1},hasMoreData:{type:Boolean,default:!0}},created(){c.push(this),i.index.$on("page-scroll",this.handlePageScroll)},beforeUnmount(){i.index.$off("page-scroll",this.handlePageScroll);const e=c.indexOf(this);e>-1&&c.splice(e,1),this.searchTimer&&clearTimeout(this.searchTimer)},computed:{pagedChoiceList(){if(["undergraduate","graduateSchool","graduateMajor"].includes(this.componentType))return this.choiceList;if(!this.enablePagination)return this.choiceList;const e=0,t=this.currentPage*this.pageSize;return this.choiceList.slice(e,t)},displayText(){if(this.choiceIndex>=0&&this.choiceIndex<this.choiceList.length){const e=this.choiceList[this.choiceIndex];return this.getItemDisplayText(e)}return this.defaultText},shouldShowLoadingMore(){return["undergraduate","graduateSchool","graduateMajor"].includes(this.componentType)?this.isLoadingMore:this.isLoadingMore},shouldShowNoMore(){return["undergraduate","graduateSchool","graduateMajor"].includes(this.componentType)?this.choiceList.length>0&&!this.hasMoreData&&!this.isLoadingMore:this.choiceList.length>0&&!this.hasMoreItems&&!this.isLoadingMore}},watch:{choiceIndex(e=null){if(e>=0&&e<this.choiceList.length){const t=this.choiceList[e];this.displayContent=this.getItemDisplayText(t),this.lastSelectedValue=t,this.mode==="search"&&(this.searchKeyword=this.getItemDisplayText(t)),this.componentType==="graduateSchool"&&this.$emit("linkage-change",t)}else this.displayContent=this.defaultText,this.lastSelectedValue=null,this.mode==="search"&&(this.searchKeyword=this.defaultSearchValue||""),this.componentType==="graduateSchool"&&this.$emit("linkage-change",null)},defaultText(e=null){(this.choiceIndex<0||this.choiceIndex>=this.choiceList.length)&&(this.displayContent=e)},parentValue(e=null){this.isLinkage&&this.componentType==="graduateMajor"&&(this.searchKeyword=this.defaultSearchValue||"",this.displayContent=this.defaultText,this.$emit("reset-selection"))},choiceList(){this.updateDisplayContent()},searchKeyword(){this.resetPagination()},defaultSearchValue(e=null){(this.choiceIndex<0||this.choiceIndex>=this.choiceList.length)&&!this.searchKeyword&&(this.searchKeyword=e||"",e&&this.isShowChoice&&this.onSearchInput(new UTSJSONObject({})))}},methods:{handlePageScroll(){this.isShowChoice&&this.closeDropdown()},resetPagination(){this.currentPage=1,this.isLoadingMore=!1,this.hasMoreItems=this.choiceList.length>this.pageSize},loadMore(){if(!this.hasMoreItems||this.isLoadingMore)return null;this.isLoadingMore=!0,setTimeout(()=>{this.currentPage++,this.isLoadingMore=!1,this.hasMoreItems=this.choiceList.length>this.currentPage*this.pageSize},300)},onScrollToBottom(){if(["undergraduate","graduateSchool","graduateMajor"].includes(this.componentType))return this.$emit("load-more"),null;this.enablePagination&&this.loadMore()},getItemDisplayText(e=null){return typeof e=="string"?e:e&&typeof e=="object"&&(e.choiceItemContent||e.name||e.schoolName||e.professionalName)||""},getItemId(e=null){return typeof e=="string"?e:e&&typeof e=="object"?e.choiceItemId||e.id||e.schoolId||e.professionalId:null},findOriginalIndex(e=null){const t=this.getItemId(e),r=this.getItemDisplayText(e);return this.choiceList.findIndex((h=null)=>{const n=this.getItemId(h),o=this.getItemDisplayText(h);return t&&n&&t===n||r&&o&&r===o})},updateDisplayContent(){if(this.choiceIndex>=0&&this.choiceIndex<this.choiceList.length){const e=this.choiceList[this.choiceIndex];this.displayContent=this.getItemDisplayText(e)}else this.displayContent=this.defaultText},btnChoiceClick:function(e=null){var t=this;t.isShowChoice=!1;const r=t.pagedChoiceList[e],h=t.findOriginalIndex(r);h!==-1?t.$emit("onChoiceClick",h,t.choiceList[h]):t.$emit("onChoiceClick",e,r)},btnShowHideClick:function(e=null){e.stopPropagation();var t=this;t.isShowChoice?t.isShowChoice=!1:(this.autoCloseOthers&&this.closeOtherDropdowns(),this.resetPagination(),i.index.createSelectorQuery().in(this).select(".drop-down-box, .drop-down-box-selected").boundingClientRect((h=null)=>{h&&(t.dropdownTop=h.top+h.height,t.dropdownLeft=h.left,t.dropdownWidth=h.width,t.isShowChoice=!0,t.defaultSearchValue&&!t.searchKeyword&&(t.searchKeyword=t.defaultSearchValue,t.onSearchInput(e)))}).exec())},closeOtherDropdowns(){c.forEach(e=>{e!==this&&e.isShowChoice&&(e.isShowChoice=!1)})},onSearchInput(e=null){const t=this;t.searchTimer&&clearTimeout(t.searchTimer),t.searchTimer=setTimeout(()=>{i.index.__f__("log","at pages_AI_Login_Match/components/combobox/combobox.vue:508","发送搜索请求:",t.searchKeyword),t.$emit("search-input",t.searchKeyword),t.isShowChoice||t.btnShowHideClick(e)},t.debounce)},onInputFocus(e=null){this.isFocused=!0,e.stopPropagation(),!this.isShowChoice&&this.$refs.keyboardWatcher&&this.$refs.keyboardWatcher.openWhenReady(this)},closeDropdown(){this.isShowChoice&&(this.isShowChoice=!1)},reset(){this.searchKeyword=this.defaultSearchValue||"",this.displayContent=this.defaultText,this.isShowChoice=!1,this.lastSelectedValue=null,this.resetPagination(),this.$emit("reset-selection")},getSelectedValue(){return this.choiceIndex>=0&&this.choiceIndex<this.choiceList.length?this.choiceList[this.choiceIndex]:null},openDropdown(){const e=new UTSJSONObject({stopPropagation:()=>{}});this.btnShowHideClick(e)}}});function u(e,t,r,h,n,o){return i.e({a:r.mode==="select"},r.mode==="select"?{b:i.t(o.displayText),c:i.n(r.choiceIndex===-1?"input-placeholder":"input-placeholder-selected")}:{d:r.searchPlaceholder,e:i.o([s=>n.searchKeyword=s.detail.value,(...s)=>o.onSearchInput&&o.onSearchInput(...s)]),f:i.o((...s)=>o.onInputFocus&&o.onInputFocus(...s)),g:n.searchKeyword},{h:n.isShowChoice?1:"",i:a._imports_0$9,j:i.sei("r0-e2fbad48","view","dropdownTrigger"),k:i.n(n.isShowChoice?"drop-down-box-selected":"drop-down-box"),l:i.o((...s)=>o.btnShowHideClick&&o.btnShowHideClick(...s)),m:n.isShowChoice},n.isShowChoice?i.e({n:o.pagedChoiceList.length>0},o.pagedChoiceList.length>0?{o:i.f(o.pagedChoiceList,(s,l,f)=>({a:i.t(o.getItemDisplayText(s)),b:r.choiceIndex==o.findOriginalIndex(s)?1:"",c:l,d:i.o(p=>o.btnChoiceClick(l),l)}))}:{},{p:o.shouldShowLoadingMore},o.shouldShowLoadingMore?{}:{},{q:o.shouldShowNoMore},o.shouldShowNoMore?{}:{},{r:i.sei("r1-e2fbad48","scroll-view","scrollView"),s:i.o((...s)=>o.onScrollToBottom&&o.onScrollToBottom(...s)),t:n.isShowChoice?1:"",v:n.dropdownTop+"px",w:n.dropdownLeft+"px",x:n.dropdownWidth+"px",y:i.o(()=>{})}):{},{z:i.sei(i.gei(e,""),"view"),A:i.o(()=>{}),B:i.o((...s)=>o.handlePageScroll&&o.handlePageScroll(...s))})}const g=i._export_sfc(d,[["render",u]]);wx.createComponent(g);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages_AI_Login_Match/components/combobox/combobox.js.map
