"use strict";const a=require("../../common/vendor.js"),j=require("../../common/assets.js"),F=require("../../router/Router.js"),i=require("../components/combobox/graduate_school_major.js");Math||a.unref(ge)();const ge=()=>"../../components/navigationTitleBar/header.js",je=a.defineComponent({__name:"match",setup(Ie){const l=a.useStore(),G=a.ref(""),C=[new UTSJSONObject({key:"school",label:"学校"}),new UTSJSONObject({key:"professional",label:"专业课"}),new UTSJSONObject({key:"nonProfessional",label:"非专业课"}),new UTSJSONObject({key:"sort",label:"排序方式"})],c=a.ref(""),v=a.ref(!1),m=a.ref(!1),f=a.ref(""),K=[new UTSJSONObject({key:"math",label:"数学"}),new UTSJSONObject({key:"english",label:"英语"}),new UTSJSONObject({key:"politics",label:"政治"}),new UTSJSONObject({key:"other",label:"其他"})],$=new UTSJSONObject({math:"考研数学",english:"考研英语",politics:"考研政治",other:"其他科目"}),p=a.computed(()=>l.state.user.match.matchList||[]),R=a.computed(()=>l.state.user.match.currentPage),H=a.computed(()=>l.state.user.match.hasMore),e=a.reactive(new UTSJSONObject({targetSchoolIndex:-1,targetMajorIndex:-1,targetSchool:"",targetMajor:"",mathIndex:-1,englishIndex:-1,politicsIndex:-1,otherIndex:-1,sortIndex:-1})),E=a.ref([]),N=a.ref([]),s=a.ref(null),b=a.ref(["数学一","数学二","数学三"]),x=a.ref(["英语一","英语二"]),M=a.ref(["政治必修","政治选修"]),_=a.ref(["经济学","管理学","教育学","历史学"]),J=a.ref(["综合评分从高到低","价格从低到高","价格从高到低","最新发布"]),g=a.ref(""),S=a.ref(""),U=a.ref([]),d=a.ref([]),L=(t=null)=>{const o=new UTSJSONObject({});return!t||!Array.isArray(t)||t.forEach((r=null)=>{var n;const u=(n=r.service)===null||n===void 0?null:n.find((O=null)=>{var h;return((h=O.type)===null||h===void 0?null:h.typename)==="一对一课程"});if(u){const O=parseFloat(u.price.replace(/[^0-9.]/g,"")),h=parseFloat(u.type.fulllength.hours.replace(/[^0-9.]/g,"")),me=parseFloat(u.type.fulllength.minutes.replace(/[^0-9.]/g,"")),A=h+me/60;A>0&&(o[r.id]=new UTSJSONObject({name:r.name,hourlyPrice:(O/A).toFixed(2)}))}}),o},P=(t=null)=>{if(t==="school")return!!l.state.user.match.schoolList;if(t==="professional")return!!l.state.user.match.professionalList;if(t==="nonProfessional"){const o=l.state.user.match.nonProfessionalList;return!!(o.math||o.english||o.politics||o.other)}return t==="sort"?!!l.state.user.match.sortMode:c.value===t},V=(t=null)=>{if(c.value===t&&v.value)return v.value=!1,c.value="",null;c.value=t,v.value=!0,q(t)},q=(t=null)=>{if(t==="school"){const o=l.state.user.match.schoolList;if(g.value=o||"",o){e.targetSchool=o;const r=U.value.findIndex(n=>n===o);r>=0&&(e.targetSchoolIndex=r)}T()}if(t==="professional"){const o=l.state.user.match.professionalList;if(S.value=o||"",o){e.targetMajor=o;const r=d.value.findIndex(n=>n===o);r>=0&&(e.targetMajorIndex=r)}I()}if(t==="nonProfessional"){const o=l.state.user.match.nonProfessionalList;if(o.math){const r=b.value.findIndex(n=>n===o.math);r>=0&&(e.mathIndex=r,f.value="math")}else if(o.english){const r=x.value.findIndex(n=>n===o.english);r>=0&&(e.englishIndex=r,f.value="english")}else if(o.politics){const r=M.value.findIndex(n=>n===o.politics);r>=0&&(e.politicsIndex=r,f.value="politics")}else if(o.other){const r=_.value.findIndex(n=>n===o.other);r>=0&&(e.otherIndex=r,f.value="other")}}if(t==="sort"){const o=l.state.user.match.sortMode;if(o){const r=J.value.findIndex(n=>n===o);r>=0&&(e.sortIndex=r)}}},D=()=>{v.value=!1,c.value=""},z=(t=null)=>a.__awaiter(this,void 0,void 0,function*(){if(!t)return y(),Promise.resolve(null);if(i.GraduateStore.actions.selectSchool(new UTSJSONObject({commit:(o=null,r=null)=>{i.GraduateStore.mutations[o](s.value,r)}}),t),s.value.schools[t]){if(s.value.schools[t].length,N.value=s.value.schools[t].slice(0,100),l.state.user.match.professionalList){const o=l.state.user.match.professionalList,r=N.value.findIndex(n=>n===o);r>=0?(e.targetMajorIndex=r,e.targetMajor=o):(y(),l.dispatch("user/match/updateProfessionalList",""))}}else y()}),B=()=>a.__awaiter(this,void 0,void 0,function*(){try{s.value=UTS.JSON.parse(UTS.JSON.stringify(i.GraduateStore.state)),i.GraduateStore.mutations.initSchoolFuse(s.value);const t=Object.keys(s.value.schools).slice(0,50);E.value=t}catch{E.value=["北京大学","清华大学","复旦大学"]}}),Q=(t=null)=>{const o=t.detail.value||g.value;i.GraduateStore.mutations.setSchoolKeyword(s.value,o),o||(e.targetSchoolIndex=-1,e.targetSchool="",S.value="",e.targetMajorIndex=-1,e.targetMajor=""),T()},W=(t=null)=>{if(!e.targetSchool)return null;const o=t.detail.value||S.value;i.GraduateStore.mutations.setMajorKeyword(s.value,o),o||(e.targetMajorIndex=-1,e.targetMajor=""),I(o)},T=()=>{U.value=i.GraduateStore.getters.filteredSchoolList(s.value)},I=(t=null)=>{var o;if(!e.targetSchool)return d.value=[],null;i.GraduateStore.mutations.setSelectedSchool(s.value,e.targetSchool);const r=t!==void 0?t:s.value.majorKeyword||"";t&&t!==s.value.majorKeyword&&i.GraduateStore.mutations.setMajorKeyword(s.value,t);let n=[];if(r){const u=s.value.majorKeyword;i.GraduateStore.mutations.setMajorKeyword(s.value,r),n=i.GraduateStore.getters.filteredMajorList(s.value),u!==r&&i.GraduateStore.mutations.setMajorKeyword(s.value,u)}else n=((o=s.value.schools[e.targetSchool])===null||o===void 0?null:o.slice(0,100))||[];d.value=n,r?X():Y()},X=()=>{if(!e.targetMajor||!d.value.length)return null;const t=d.value.findIndex(o=>o===e.targetMajor);if(t===-1)d.value.unshift(e.targetMajor);else if(t>0){const o=d.value.splice(t,1)[0];d.value.unshift(o)}},Y=()=>{if(!d.value||d.value.length===0)return null;d.value.sort((t,o)=>{if(t===e.targetMajor)return-1;if(o===e.targetMajor)return 1;if(e.targetSchool==="同济大学"){const r=t.includes("计算")||t.includes("软件")||t.includes("信息")||t.includes("通信"),n=o.includes("计算")||o.includes("软件")||o.includes("信息")||o.includes("通信");if(r&&!n)return-1;if(!r&&n)return 1}return t.localeCompare(o,"zh-CN")})},Z=(t=null,o=null)=>{e.targetSchoolIndex=t,e.targetSchool=o,g.value=o},ee=()=>{l.commit("user/match/SET_SCHOOL_LIST",e.targetSchool),e.targetSchool?z(e.targetSchool):(S.value="",e.targetMajorIndex=-1,e.targetMajor="",I()),w(),v.value=!1,c.value=""},te=(t=null,o=null)=>{e.targetMajorIndex=t,e.targetMajor=o,S.value=o},oe=()=>{if(!e.targetMajor&&S.value&&d.value.length>0){const t=S.value;let o=[];if(t){const r=s.value.majorKeyword;i.GraduateStore.mutations.setMajorKeyword(s.value,t),o=i.GraduateStore.getters.filteredMajorList(s.value),i.GraduateStore.mutations.setMajorKeyword(s.value,r)}o.length>0?e.targetMajor=o[0]:e.targetMajor=d.value[0],e.targetMajorIndex=0,S.value=e.targetMajor}return e.targetMajor},ae=()=>{const t=oe();t&&(e.mathIndex=-1,e.englishIndex=-1,e.politicsIndex=-1,e.otherIndex=-1,l.commit("user/match/SET_NON_PROFESSIONAL_LIST",new UTSJSONObject({math:"",english:"",politics:"",other:""}))),l.commit("user/match/SET_PROFESSIONAL_LIST",t),s.value&&i.GraduateStore.mutations.setMajorKeyword(s.value,""),w(),v.value=!1,c.value=""},ne=(t=null)=>{switch(t){case"math":return e.mathIndex;case"english":return e.englishIndex;case"politics":return e.politicsIndex;case"other":return e.otherIndex;default:return-1}},re=(t=null,o=null)=>{if(t==="math"&&e.mathIndex===o||t==="english"&&e.englishIndex===o||t==="politics"&&e.politicsIndex===o||t==="other"&&e.otherIndex===o)return e.mathIndex=-1,e.englishIndex=-1,e.politicsIndex=-1,e.otherIndex=-1,null;switch(e.mathIndex=-1,e.englishIndex=-1,e.politicsIndex=-1,e.otherIndex=-1,t){case"math":e.mathIndex=o;break;case"english":e.englishIndex=o;break;case"politics":e.politicsIndex=o;break;case"other":e.otherIndex=o;break}},le=()=>{const t=new UTSJSONObject({math:e.mathIndex>=0?b.value[e.mathIndex]:"",english:e.englishIndex>=0?x.value[e.englishIndex]:"",politics:e.politicsIndex>=0?M.value[e.politicsIndex]:"",other:e.otherIndex>=0?_.value[e.otherIndex]:""});l.commit("user/match/SET_NON_PROFESSIONAL_LIST",t),(e.mathIndex>=0||e.englishIndex>=0||e.politicsIndex>=0||e.otherIndex>=0)&&(e.targetMajorIndex=-1,e.targetMajor="",l.commit("user/match/SET_PROFESSIONAL_LIST","")),w(),v.value=!1,c.value=""},se=(t=null)=>{e.sortIndex===t?e.sortIndex=-1:e.sortIndex=t},ue=()=>{const t=e.sortIndex>=0?J.value[e.sortIndex]:"";l.commit("user/match/SET_SORT_MODE",t),w(),v.value=!1,c.value=""},ce=(t=null)=>{F.Navigator.toTeacher(t)},ie=(t=null)=>{F.Navigator.toChat(t)},Se=()=>{if(m.value||!H.value)return null;m.value=!0;const t=new UTSJSONObject({loadMore:!0,schoolList:l.state.user.match.schoolList,professionalList:l.state.user.match.professionalList,nonProfessionalList:l.state.user.match.nonProfessionalList,sortMode:l.state.user.match.sortMode,currentPage:R.value+1,pageSize:l.state.user.match.pageSize});setTimeout(()=>{l.commit("user/match/SET_PAGINATION",new UTSJSONObject({currentPage:t.currentPage,hasMore:!0})),m.value=!1},1e3)},y=()=>{e.targetMajorIndex=-1,e.targetMajor=""},de=(t=null)=>{f.value=t},he=(t=null)=>{switch(t){case"math":return b.value;case"english":return x.value;case"politics":return M.value;case"other":return _.value;default:return[]}},w=()=>{m.value=!0;const t=new UTSJSONObject({schoolList:l.state.user.match.schoolList,professionalList:l.state.user.match.professionalList,nonProfessionalList:l.state.user.match.nonProfessionalList,sortMode:l.state.user.match.sortMode,currentPage:1});l.commit("user/match/SET_PAGINATION",new UTSJSONObject({currentPage:t.currentPage,hasMore:!0})),setTimeout(()=>{m.value=!1},1e3)},k=a.computed(()=>{const t=new UTSJSONObject({});t.school=l.state.user.match.schoolList||"",t.professional=l.state.user.match.professionalList||"";const o=l.state.user.match.nonProfessionalList,r=[];return o.math&&r.push(o.math),o.english&&r.push(o.english),o.politics&&r.push(o.politics),o.other&&r.push(o.other),t.nonProfessional=r.join(", "),t.sort=l.state.user.match.sortMode||"",t}),ve=()=>{g.value="",e.targetSchoolIndex=-1,e.targetSchool="",S.value="",e.targetMajorIndex=-1,e.targetMajor="",T()},fe=()=>{S.value="",e.targetMajorIndex=-1,e.targetMajor="",l.commit("user/match/SET_PROFESSIONAL_LIST",""),e.targetSchool&&s.value&&i.GraduateStore.mutations.setMajorKeyword(s.value,""),I()},Oe=()=>{F.Navigator.toIndex()};return a.onMounted(()=>{B().then(()=>{var t;T(),I();const o=l.state.user.match.schoolList;if(o&&(!((t=s.value)===null||t===void 0)&&t.schools[o])){const r=s.value.schools[o].slice(0,100);N.value=r}}),m.value=!0,setTimeout(()=>{l.commit("user/match/SET_PAGINATION",new UTSJSONObject({currentPage:1,hasMore:!0})),m.value=!1},1e3)}),(t=null,o=null)=>a.e(new UTSJSONObject({a:j._imports_0$2,b:j._imports_1$2,c:a.o(Oe),d:a.p(new UTSJSONObject({title:"精准匹配"})),e:G.value,f:a.o((n=null)=>G.value=n.detail.value),g:a.f(C,(n=null,u=null,O=null)=>a.e(new UTSJSONObject({a:a.t(n.label),b:P(n.key)?1:"",c:k.value[n.key]}),k.value[n.key]?new UTSJSONObject({d:a.t(k.value[n.key])}):new UTSJSONObject({}),new UTSJSONObject({e:P(n.key)?1:"",f:c.value===n.key?1:"",g:n.key,h:P(n.key)?1:"",i:a.o((h=null)=>V(n.key),n.key)}))),h:v.value}),v.value?a.e(new UTSJSONObject({i:c.value==="school"}),c.value==="school"?a.e(new UTSJSONObject({j:a.o([(n=null)=>g.value=n.detail.value,Q]),k:a.o(()=>{}),l:g.value,m:g.value}),g.value?new UTSJSONObject({n:a.o(ve)}):new UTSJSONObject({}),new UTSJSONObject({o:a.f(U.value,(n=null,u=null,O=null)=>new UTSJSONObject({a:a.t(n),b:n,c:u===e.targetSchoolIndex?1:"",d:a.o((h=null)=>Z(u,n),n)})),p:j._imports_2,q:a.o(ee),r:a.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({s:c.value==="professional"}),c.value==="professional"?a.e(new UTSJSONObject({t:e.targetSchool?"请输入专业名称":"请先选择学校",v:!e.targetSchool,w:a.o([(n=null)=>S.value=n.detail.value,W]),x:a.o(()=>{}),y:S.value,z:S.value}),S.value?new UTSJSONObject({A:a.o(fe)}):new UTSJSONObject({}),new UTSJSONObject({B:a.f(d.value,(n=null,u=null,O=null)=>new UTSJSONObject({a:a.t(n),b:n,c:u===e.targetMajorIndex?1:"",d:a.o((h=null)=>te(u,n),n)})),C:j._imports_2,D:a.o(ae),E:a.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({F:c.value==="nonProfessional"}),c.value==="nonProfessional"?new UTSJSONObject({G:a.f(K,(n=null,u=null,O=null)=>new UTSJSONObject({a:a.t(n.label),b:n.key,c:a.n(f.value===n.key?"active":""),d:a.o((h=null)=>de(n.key),n.key)})),H:a.t($[f.value]),I:a.f(he(f.value),(n=null,u=null,O=null)=>new UTSJSONObject({a:a.t(n),b:u,c:u===ne(f.value)?1:"",d:a.o((h=null)=>re(f.value,u),u)})),J:j._imports_2,K:a.o(le),L:a.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({M:c.value==="sort"}),c.value==="sort"?new UTSJSONObject({N:a.f(J.value,(n=null,u=null,O=null)=>new UTSJSONObject({a:a.t(n),b:u,c:u===e.sortIndex?1:"",d:a.o((h=null)=>se(u),u)})),O:j._imports_2,P:a.o(ue),Q:a.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({R:a.o(D)})):new UTSJSONObject({}),new UTSJSONObject({S:a.f(p.value,(n=null,u=null,O=null)=>a.e(new UTSJSONObject({a:n.avatar||"/static/image/defaultAvatar/teacher-man.png",b:a.o((h=null)=>ce(n.id),n.id||u),c:a.t(n.name),d:n.certificate?"/static/image/certify/certified.png":"/static/image/certify/uncertified.png",e:n.certificate?"已认证":"未认证",f:a.t(n.school),g:a.t(n.major),h:L(p.value)[n.id]}),L(p.value)[n.id]?new UTSJSONObject({i:a.t(L(p.value)[n.id].hourlyPrice)}):new UTSJSONObject({}),new UTSJSONObject({j:a.o((h=null)=>ie(n.id),n.id||u),k:n.id||u}))),T:j._imports_3,U:p.value.length===0&&!m.value}),p.value.length===0&&!m.value?new UTSJSONObject({}):new UTSJSONObject({}),new UTSJSONObject({V:a.sei("step2","scroll-view"),W:a.o(Se)}))}}),pe=a._export_sfc(je,[["__scopeId","data-v-dd318616"]]);wx.createPage(pe);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_AI_Login_Match/match/match.js.map
