"use strict";const e=require("../../common/vendor.js"),g=require("../../common/assets.js"),A=require("../../router/Router.js");Math||e.unref(_e)();const _e=()=>"../../components/navigationTitleBar/header.js",ve=e.defineComponent({__name:"match",setup(me){const l=e.useStore(),I=e.computed({get:()=>l.getters["user/match/searchKey"],set:(t=null)=>{d&&clearTimeout(d),d=setTimeout(()=>{l.dispatch("user/match/setSearchKey",t)},500)}}),E=[new UTSJSONObject({key:"school",label:"学校"}),new UTSJSONObject({key:"professional",label:"专业课"}),new UTSJSONObject({key:"nonProfessional",label:"非专业课"}),new UTSJSONObject({key:"sort",label:"排序方式"})],n=e.ref(""),r=e.ref(!1),c=e.ref(!1),T=e.ref("math"),Z=[new UTSJSONObject({key:"math",label:"数学"}),new UTSJSONObject({key:"english",label:"英语"}),new UTSJSONObject({key:"politics",label:"政治"}),new UTSJSONObject({key:"other",label:"其他"})],D=new UTSJSONObject({math:"考研数学",english:"考研英语",politics:"考研政治",other:"其他科目"}),v=e.computed(()=>l.getters["user/match/matchTeachers"]);e.computed(()=>l.state.user.match.currentPage);const F=e.computed(()=>l.state.user.match.hasMore),u=e.ref(""),R=e.computed(()=>l.getters["user/schoolMajorRequest/graduateSchoolOptions"]),q=e.computed(()=>l.getters["user/schoolMajorRequest/graduateSchoolSearchStatus"].isLoading);e.computed(()=>l.getters["user/schoolMajorRequest/graduateSchoolSearchStatus"].hasMore);const p=e.ref(null),N=e.ref(""),i=e.ref(""),k=e.computed(()=>l.getters["user/schoolMajorRequest/graduateMajorOptions"]),G=e.computed(()=>l.getters["user/schoolMajorRequest/graduateMajorSearchStatus"].isLoading),j=e.ref(null),b=e.ref(""),y=e.ref([]),h=e.ref(null),S=e.ref(""),m=e.ref(""),$=e.computed(()=>l.state.user.match.sortMode.options),f=e.ref(null),M=e.ref("");let d=null;const L=(t=null)=>{if(t==="school")return!!l.getters["user/schoolMajorRequest/selectedGraduateSchool"].name;if(t==="professional")return!!l.getters["user/schoolMajorRequest/selectedGraduateMajor"].name;if(t==="nonProfessional"){const o=l.state.user.match.nonProfessionalList;return!!(o.math.selected||o.english.selected||o.politics.selected||o.other.selected)}return t==="sort"?!!l.state.user.match.sortMode.selected:n.value===t},Y=(t=null)=>{if(n.value===t&&r.value)return r.value=!1,n.value="",null;n.value=t,r.value=!0,z(t)},z=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){if(t==="school"){const o=l.getters["user/schoolMajorRequest/selectedGraduateSchool"],s=l.getters["user/schoolMajorRequest/graduateSchoolSearchStatus"];p.value=o.id,N.value=o.name,u.value=s.keyword||"",R.value.length===0&&J("")}if(t==="professional"){const o=l.getters["user/schoolMajorRequest/selectedGraduateMajor"],s=l.getters["user/schoolMajorRequest/graduateMajorSearchStatus"];if(j.value=o.id,b.value=o.name,i.value=s.keyword||"",!l.getters["user/schoolMajorRequest/selectedGraduateSchool"].id)return i.value="",Promise.resolve(null);k.value.length===0&&P("")}if(t==="nonProfessional"){yield C(T.value);const o=l.state.user.match.nonProfessionalList,s=T.value;o[s]&&o[s].selected&&(h.value=o[s].selectedId,S.value=o[s].selected,m.value=s)}if(t==="sort"){yield l.dispatch("user/match/fetchSortModeOptions");const o=l.state.user.match.sortMode;f.value=o.selectedId,M.value=o.selected}}),W=()=>{r.value=!1,n.value=""},H=(t=null)=>{const o=t.detail.value||u.value;d&&clearTimeout(d),d=setTimeout(()=>{J(o)},500)},K=(t=null)=>{const o=t.detail.value||i.value;if(!l.getters["user/schoolMajorRequest/selectedGraduateSchool"].id)return null;d&&clearTimeout(d),d=setTimeout(()=>{P(o)},500)},J=(t=null,o=!1)=>e.__awaiter(this,void 0,void 0,function*(){try{yield l.dispatch("user/schoolMajorRequest/searchGraduateSchools",new UTSJSONObject({keyword:t,loadMore:o}))}catch(s){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:559","搜索学校失败:",s),e.index.showToast({title:"搜索学校失败",icon:"none"})}}),P=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){try{yield l.dispatch("user/schoolMajorRequest/searchGraduateMajors",new UTSJSONObject({keyword:t}))}catch(o){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:575","搜索专业失败:",o),e.index.showToast({title:"搜索专业失败",icon:"none"})}}),V=()=>{const t=l.getters["user/schoolMajorRequest/graduateSchoolSearchStatus"];!t.isLoading&&t.hasMore&&J(u.value,!0)},C=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){try{const o=yield l.dispatch("user/match/fetchNonProfessionalOptions",new UTSJSONObject({type:t}));o&&o.data&&(y.value=o.data)}catch(o){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:604","加载非专业课选项失败:",o),y.value=[]}}),B=(t=null)=>{p.value=t.id,N.value=t.name,u.value=t.name},Q=(t=null)=>{j.value=t.id,b.value=t.name,i.value=t.name},X=(t=null)=>{h.value===t.id?(h.value=null,S.value="",m.value=""):(h.value=t.id,S.value=t.name,m.value=T.value)},ee=(t=null)=>{f.value===t.id?(f.value=null,M.value=""):(f.value=t.id,M.value=t.name)},te=()=>e.__awaiter(this,void 0,void 0,function*(){p.value&&N.value?yield l.dispatch("user/schoolMajorRequest/selectGraduateSchool",new UTSJSONObject({id:p.value,name:N.value})):yield l.dispatch("user/schoolMajorRequest/selectGraduateSchool",new UTSJSONObject({id:null,name:""})),U(),r.value=!1,n.value=""}),ae=()=>e.__awaiter(this,void 0,void 0,function*(){j.value&&b.value?yield l.dispatch("user/schoolMajorRequest/selectGraduateMajor",new UTSJSONObject({id:j.value,name:b.value})):yield l.dispatch("user/schoolMajorRequest/selectGraduateMajor",new UTSJSONObject({id:null,name:""})),U(),r.value=!1,n.value=""}),oe=()=>e.__awaiter(this,void 0,void 0,function*(){h.value&&S.value&&m.value?yield l.dispatch("user/match/selectNonProfessional",new UTSJSONObject({type:m.value,id:h.value,name:S.value})):l.commit("user/match/CLEAR_NON_PROFESSIONAL_SELECTION"),U(),r.value=!1,n.value=""}),le=()=>e.__awaiter(this,void 0,void 0,function*(){f.value&&M.value?yield l.dispatch("user/match/selectSortMode",new UTSJSONObject({id:f.value,name:M.value})):yield l.dispatch("user/match/selectSortMode",new UTSJSONObject({id:null,name:""})),U(),r.value=!1,n.value=""}),se=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:752","=== viewTeacherDetail 被调用 ==="),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:753","传入的 teacherId:",t,"类型:",typeof t);const o=Number(t);if(!o||isNaN(o))return e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:759","teacherId 无效:",t),e.index.showToast({title:"老师ID无效",icon:"none"}),Promise.resolve(null);e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:767","标准化后的 teacherId:",o);try{e.index.showLoading({title:"加载中..."}),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:775","准备调用 store.dispatch..."),e.index.hideLoading(),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:785","准备跳转到老师详情页面..."),A.Navigator.toTeacher(o)}catch(s){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:790","=== viewTeacherDetail 发生错误 ==="),e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:791","错误详情:",s),e.index.hideLoading(),e.index.showToast({title:"获取老师详情失败",icon:"none"})}}),ne=(t=null)=>{A.Navigator.toChat(t)},ce=()=>{if(c.value||!F.value)return null;c.value=!0,l.dispatch("user/match/fetchMatchTeacherList",new UTSJSONObject({loadMore:!0})).then(()=>{c.value=!1}).catch((t=null)=>{e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:820","加载更多老师失败:",t),c.value=!1})},re=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){T.value=t,yield C(t);const o=l.state.user.match.nonProfessionalList;o[t]&&o[t].selected?(h.value=o[t].selectedId,S.value=o[t].selected,m.value=t):(h.value=null,S.value="",m.value="")}),U=()=>{c.value=!0,l.dispatch("user/match/fetchMatchTeacherList").then(()=>{c.value=!1}).catch((t=null)=>{e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:856","应用筛选失败:",t),c.value=!1})},x=e.computed(()=>{const t=new UTSJSONObject({});t.school=l.getters["user/schoolMajorRequest/selectedGraduateSchool"].name||"",t.professional=l.getters["user/schoolMajorRequest/selectedGraduateMajor"].name||"";const o=l.state.user.match.nonProfessionalList,s=[];return o.math.selected&&s.push(o.math.selected),o.english.selected&&s.push(o.english.selected),o.politics.selected&&s.push(o.politics.selected),o.other.selected&&s.push(o.other.selected),t.nonProfessional=s.join(", "),t.sort=l.state.user.match.sortMode.selected||"",t}),ue=()=>{u.value="",p.value=null,N.value="",J("")},ie=()=>{i.value="",j.value=null,b.value="",P("")},he=()=>{A.Navigator.toIndex()};e.onMounted(()=>e.__awaiter(this,void 0,void 0,function*(){e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:907","=== match.vue onMounted 开始 ==="),l.state.user.baseInfo.jwtToken||(l.commit("user/baseInfo/SET_JWT_TOKEN","eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXJpZCI6MSwibG9naW5fdXNlcl9rZXkiOiI0YjMwYmQ1Yy04ZDUwLTQ0OGEtYTA4Mi1kZWUxOGMwNmIyMzEifQ.sDcrRbV52iDBs2AHVI5t7_ZfqWZaZm9la861HZyRjZvsbVz2ucI-e3RsYOSkUHSACPG3SGD0_5m-pcKyYCUofg"),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:913","已设置JWT Token到store中")),l.commit("user/match/SET_SEARCH_KEY","");try{yield l.dispatch("user/match/fetchSortModeOptions")}catch(t){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:923","初始化排序选项失败:",t)}c.value=!0;try{yield l.dispatch("user/match/fetchMatchTeacherList"),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:932","=== 初始化后的状态检查 ==="),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:933","matchTeachers computed:",v.value),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:934","matchTeachers 长度:",v.value.length),e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:935","store.state.user.match.matchList:",l.state.user.match.matchList),v.value.length>0?e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:938","第一个老师的数据结构:",UTS.JSON.stringify(v.value[0],null,2)):e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:940","matchTeachers 为空"),c.value=!1}catch(t){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:945","初始化匹配列表失败:",t),c.value=!1}e.index.__f__("log","at pages_AI_Login_Match/match/match.vue:949","=== match.vue onMounted 完成 ===")}));const de=(t=null)=>{const o=t.detail.value;I.value=o};return(t=null,o=null)=>e.e(new UTSJSONObject({a:g._imports_0$2,b:g._imports_1$2,c:e.o(he),d:e.p(new UTSJSONObject({title:"精准匹配"})),e:e.o([(a=null)=>I.value=a.detail.value,de]),f:I.value,g:e.f(E,(a=null,_=null,w=null)=>e.e(new UTSJSONObject({a:e.t(a.label),b:L(a.key)?1:"",c:x.value[a.key]}),x.value[a.key]?new UTSJSONObject({d:e.t(x.value[a.key])}):new UTSJSONObject({}),new UTSJSONObject({e:L(a.key)?1:"",f:n.value===a.key?1:"",g:a.key,h:L(a.key)?1:"",i:e.o((O=null)=>Y(a.key),a.key)}))),h:r.value}),r.value?e.e(new UTSJSONObject({i:n.value==="school"}),n.value==="school"?e.e(new UTSJSONObject({j:e.o([(a=null)=>u.value=a.detail.value,H]),k:e.o(()=>{}),l:u.value,m:u.value}),u.value?new UTSJSONObject({n:e.o(ue)}):new UTSJSONObject({}),new UTSJSONObject({o:e.f(R.value,(a=null,_=null,w=null)=>new UTSJSONObject({a:e.t(a.name),b:a.id,c:a.id===p.value?1:"",d:e.o((O=null)=>B(a),a.id)})),p:q.value}),q.value?new UTSJSONObject({}):new UTSJSONObject({}),new UTSJSONObject({q:e.o(V),r:g._imports_2,s:e.o(te),t:e.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({v:n.value==="professional"}),n.value==="professional"?e.e(new UTSJSONObject({w:e.unref(l).getters["user/schoolMajorRequest/selectedGraduateSchool"].id?"请输入专业名称":"请先选择学校",x:!e.unref(l).getters["user/schoolMajorRequest/selectedGraduateSchool"].id,y:e.o([(a=null)=>i.value=a.detail.value,K]),z:e.o(()=>{}),A:i.value,B:i.value}),i.value?new UTSJSONObject({C:e.o(ie)}):new UTSJSONObject({}),new UTSJSONObject({D:e.f(k.value,(a=null,_=null,w=null)=>new UTSJSONObject({a:e.t(a.name),b:a.id,c:a.id===j.value?1:"",d:e.o((O=null)=>Q(a),a.id)})),E:G.value}),G.value?new UTSJSONObject({}):new UTSJSONObject({}),new UTSJSONObject({F:g._imports_2,G:e.o(ae),H:e.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({I:n.value==="nonProfessional"}),n.value==="nonProfessional"?new UTSJSONObject({J:e.f(Z,(a=null,_=null,w=null)=>new UTSJSONObject({a:e.t(a.label),b:a.key,c:e.n(T.value===a.key?"active":""),d:e.o((O=null)=>re(a.key),a.key)})),K:e.t(D[T.value]),L:e.f(y.value,(a=null,_=null,w=null)=>new UTSJSONObject({a:e.t(a.name),b:a.id,c:a.id===h.value?1:"",d:e.o((O=null)=>X(a),a.id)})),M:g._imports_2,N:e.o(oe),O:e.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({P:n.value==="sort"}),n.value==="sort"?new UTSJSONObject({Q:e.f($.value,(a=null,_=null,w=null)=>new UTSJSONObject({a:e.t(a.name),b:a.id,c:a.id===f.value?1:"",d:e.o((O=null)=>ee(a),a.id)})),R:g._imports_2,S:e.o(le),T:e.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({U:e.o(W)})):new UTSJSONObject({}),new UTSJSONObject({V:e.f(v.value,(a=null,_=null,w=null)=>e.e(new UTSJSONObject({a:a.avatar||"/static/image/defaultAvatar/teacher-man.png",b:e.o((O=null)=>se(a.id),a.id||_),c:e.t(a.name),d:a.certificate?"/static/image/certify/certified.png":"/static/image/certify/uncertified.png",e:a.certificate?"已认证":"未认证",f:e.t(a.school),g:e.t(a.major),h:a.hourPrice}),a.hourPrice?new UTSJSONObject({i:e.t(a.hourPrice)}):new UTSJSONObject({}),new UTSJSONObject({j:e.o((O=null)=>ne(a.id),a.id||_),k:a.id||_}))),W:g._imports_3,X:v.value.length===0&&!c.value}),v.value.length===0&&!c.value?new UTSJSONObject({}):new UTSJSONObject({}),new UTSJSONObject({Y:e.sei("step2","scroll-view"),Z:e.o(ce)}))}}),Se=e._export_sfc(ve,[["__scopeId","data-v-dd318616"]]);wx.createPage(Se);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_AI_Login_Match/match/match.js.map
