"use strict";const e=require("../../common/vendor.js"),_=require("../../common/assets.js"),k=require("../../router/Router.js");Math||e.unref(ve)();const ve=()=>"../../components/navigationTitleBar/header.js",he=e.defineComponent({__name:"match",setup(fe){const n=e.useStore(),A=e.ref(""),E=[new UTSJSONObject({key:"school",label:"学校"}),new UTSJSONObject({key:"professional",label:"专业课"}),new UTSJSONObject({key:"nonProfessional",label:"非专业课"}),new UTSJSONObject({key:"sort",label:"排序方式"})],o=e.ref(""),r=e.ref(!1),c=e.ref(!1),p=e.ref("math"),q=[new UTSJSONObject({key:"math",label:"数学"}),new UTSJSONObject({key:"english",label:"英语"}),new UTSJSONObject({key:"politics",label:"政治"}),new UTSJSONObject({key:"other",label:"其他"})],R=new UTSJSONObject({math:"考研数学",english:"考研英语",politics:"考研政治",other:"其他科目"}),M=e.computed(()=>n.state.user.match.matchList||[]);e.computed(()=>n.state.user.match.currentPage);const B=e.computed(()=>n.state.user.match.hasMore),u=e.ref(""),F=e.computed(()=>n.state.user.match.schoolList.options),P=e.computed(()=>n.state.user.match.schoolList.isLoading),D=e.computed(()=>n.state.user.match.schoolList.hasMore),i=e.ref(null),b=e.ref(""),d=e.ref(""),$=e.computed(()=>n.state.user.match.professionalList.options),T=e.ref(null),j=e.ref(""),y=e.ref([]),v=e.ref(null),S=e.ref(""),f=e.ref(""),H=e.computed(()=>n.state.user.match.sortMode.options),O=e.ref(null),J=e.ref("");let N=null;const L=(t=null)=>{if(t==="school")return!!n.state.user.match.schoolList.selectedSchool;if(t==="professional")return!!n.state.user.match.professionalList.selectedMajor;if(t==="nonProfessional"){const a=n.state.user.match.nonProfessionalList;return!!(a.math.selected||a.english.selected||a.politics.selected||a.other.selected)}return t==="sort"?!!n.state.user.match.sortMode.selected:o.value===t},K=(t=null)=>{if(o.value===t&&r.value)return r.value=!1,o.value="",null;o.value=t,r.value=!0,z(t)},z=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){if(t==="school"){const a=n.state.user.match.schoolList;i.value=a.selectedSchoolId,b.value=a.selectedSchool,u.value=a.searchKeyword||"",F.value.length===0&&U("")}if(t==="professional"){const a=n.state.user.match.professionalList;if(T.value=a.selectedMajorId,j.value=a.selectedMajor,d.value=a.searchKeyword||"",!n.state.user.match.schoolList.selectedSchoolId)return d.value="",Promise.resolve(null);$.value.length===0&&I("")}if(t==="nonProfessional"){yield C(p.value);const a=n.state.user.match.nonProfessionalList,s=p.value;a[s]&&a[s].selected&&(v.value=a[s].selectedId,S.value=a[s].selected,f.value=s)}if(t==="sort"){yield n.dispatch("user/match/fetchSortModeOptions");const a=n.state.user.match.sortMode;O.value=a.selectedId,J.value=a.selected}}),G=()=>{r.value=!1,o.value=""},Q=(t=null)=>{const a=t.detail.value||u.value;N&&clearTimeout(N),N=setTimeout(()=>{U(a)},500)},V=(t=null)=>{const a=t.detail.value||d.value;if(!i.value)return null;N&&clearTimeout(N),N=setTimeout(()=>{I(a)},500)},U=(t=null,a=!1)=>e.__awaiter(this,void 0,void 0,function*(){try{yield n.dispatch("user/match/searchSchools",new UTSJSONObject({keyword:t,loadMore:a}))}catch(s){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:532","搜索学校失败:",s),e.index.showToast({title:"搜索学校失败",icon:"none"})}}),I=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){try{yield n.dispatch("user/match/searchMajors",new UTSJSONObject({keyword:t}))}catch(a){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:548","搜索专业失败:",a),e.index.showToast({title:"搜索专业失败",icon:"none"})}}),W=()=>{!P.value&&D.value&&U(u.value,!0)},C=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){try{const a=yield n.dispatch("user/match/fetchNonProfessionalOptions",new UTSJSONObject({type:t}));a&&a.data&&(y.value=a.data)}catch(a){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:576","加载非专业课选项失败:",a),y.value=[]}}),X=(t=null)=>{i.value=t.id,b.value=t.name,u.value=t.name},Y=(t=null)=>{T.value=t.id,j.value=t.name,d.value=t.name},Z=(t=null)=>{v.value===t.id?(v.value=null,S.value="",f.value=""):(v.value=t.id,S.value=t.name,f.value=p.value)},ee=(t=null)=>{O.value===t.id?(O.value=null,J.value=""):(O.value=t.id,J.value=t.name)},te=()=>e.__awaiter(this,void 0,void 0,function*(){i.value&&b.value?yield n.dispatch("user/match/selectSchool",new UTSJSONObject({id:i.value,name:b.value})):yield n.dispatch("user/match/selectSchool",new UTSJSONObject({id:null,name:""})),g(),r.value=!1,o.value=""}),le=()=>e.__awaiter(this,void 0,void 0,function*(){T.value&&j.value?yield n.dispatch("user/match/selectMajor",new UTSJSONObject({id:T.value,name:j.value})):yield n.dispatch("user/match/selectMajor",new UTSJSONObject({id:null,name:""})),g(),r.value=!1,o.value=""}),ae=()=>e.__awaiter(this,void 0,void 0,function*(){v.value&&S.value&&f.value?yield n.dispatch("user/match/selectNonProfessional",new UTSJSONObject({type:f.value,id:v.value,name:S.value})):n.commit("user/match/CLEAR_NON_PROFESSIONAL_SELECTION"),g(),r.value=!1,o.value=""}),ne=()=>e.__awaiter(this,void 0,void 0,function*(){O.value&&J.value?yield n.dispatch("user/match/selectSortMode",new UTSJSONObject({id:O.value,name:J.value})):yield n.dispatch("user/match/selectSortMode",new UTSJSONObject({id:null,name:""})),g(),r.value=!1,o.value=""}),oe=(t=null)=>{k.Navigator.toTeacher(t)},se=(t=null)=>{k.Navigator.toChat(t)},ce=()=>{if(c.value||!B.value)return null;c.value=!0,n.dispatch("user/match/fetchMatchTeacherList",new UTSJSONObject({loadMore:!0})).then(()=>{c.value=!1}).catch((t=null)=>{e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:746","加载更多老师失败:",t),c.value=!1})},re=(t=null)=>e.__awaiter(this,void 0,void 0,function*(){p.value=t,yield C(t);const a=n.state.user.match.nonProfessionalList;a[t]&&a[t].selected?(v.value=a[t].selectedId,S.value=a[t].selected,f.value=t):(v.value=null,S.value="",f.value="")}),g=()=>{c.value=!0,n.dispatch("user/match/fetchMatchTeacherList").then(()=>{c.value=!1}).catch((t=null)=>{e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:782","应用筛选失败:",t),c.value=!1})},x=e.computed(()=>{const t=new UTSJSONObject({});t.school=n.state.user.match.schoolList.selectedSchool||"",t.professional=n.state.user.match.professionalList.selectedMajor||"";const a=n.state.user.match.nonProfessionalList,s=[];return a.math.selected&&s.push(a.math.selected),a.english.selected&&s.push(a.english.selected),a.politics.selected&&s.push(a.politics.selected),a.other.selected&&s.push(a.other.selected),t.nonProfessional=s.join(", "),t.sort=n.state.user.match.sortMode.selected||"",t}),ue=()=>{u.value="",i.value=null,b.value="",U("")},ie=()=>{d.value="",T.value=null,j.value="",I("")},de=()=>{k.Navigator.toIndex()};return e.onMounted(()=>e.__awaiter(this,void 0,void 0,function*(){try{yield n.dispatch("user/match/fetchSortModeOptions")}catch(t){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:837","初始化排序选项失败:",t)}c.value=!0;try{yield n.dispatch("user/match/fetchMatchTeacherList"),c.value=!1}catch(t){e.index.__f__("error","at pages_AI_Login_Match/match/match.vue:846","初始化匹配列表失败:",t),c.value=!1}})),(t=null,a=null)=>e.e(new UTSJSONObject({a:_._imports_0$2,b:_._imports_1$2,c:e.o(de),d:e.p(new UTSJSONObject({title:"精准匹配"})),e:A.value,f:e.o((l=null)=>A.value=l.detail.value),g:e.f(E,(l=null,h=null,w=null)=>e.e(new UTSJSONObject({a:e.t(l.label),b:L(l.key)?1:"",c:x.value[l.key]}),x.value[l.key]?new UTSJSONObject({d:e.t(x.value[l.key])}):new UTSJSONObject({}),new UTSJSONObject({e:L(l.key)?1:"",f:o.value===l.key?1:"",g:l.key,h:L(l.key)?1:"",i:e.o((m=null)=>K(l.key),l.key)}))),h:r.value}),r.value?e.e(new UTSJSONObject({i:o.value==="school"}),o.value==="school"?e.e(new UTSJSONObject({j:e.o([(l=null)=>u.value=l.detail.value,Q]),k:e.o(()=>{}),l:u.value,m:u.value}),u.value?new UTSJSONObject({n:e.o(ue)}):new UTSJSONObject({}),new UTSJSONObject({o:e.f(F.value,(l=null,h=null,w=null)=>new UTSJSONObject({a:e.t(l.name),b:l.id,c:l.id===i.value?1:"",d:e.o((m=null)=>X(l),l.id)})),p:P.value}),P.value?new UTSJSONObject({}):new UTSJSONObject({}),new UTSJSONObject({q:e.o(W),r:_._imports_2,s:e.o(te),t:e.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({v:o.value==="professional"}),o.value==="professional"?e.e(new UTSJSONObject({w:i.value?"请输入专业名称":"请先选择学校",x:!i.value,y:e.o([(l=null)=>d.value=l.detail.value,V]),z:e.o(()=>{}),A:d.value,B:d.value}),d.value?new UTSJSONObject({C:e.o(ie)}):new UTSJSONObject({}),new UTSJSONObject({D:e.f($.value,(l=null,h=null,w=null)=>new UTSJSONObject({a:e.t(l.name),b:l.id,c:l.id===T.value?1:"",d:e.o((m=null)=>Y(l),l.id)})),E:_._imports_2,F:e.o(le),G:e.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({H:o.value==="nonProfessional"}),o.value==="nonProfessional"?new UTSJSONObject({I:e.f(q,(l=null,h=null,w=null)=>new UTSJSONObject({a:e.t(l.label),b:l.key,c:e.n(p.value===l.key?"active":""),d:e.o((m=null)=>re(l.key),l.key)})),J:e.t(R[p.value]),K:e.f(y.value,(l=null,h=null,w=null)=>new UTSJSONObject({a:e.t(l.name),b:l.id,c:l.id===v.value?1:"",d:e.o((m=null)=>Z(l),l.id)})),L:_._imports_2,M:e.o(ae),N:e.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({O:o.value==="sort"}),o.value==="sort"?new UTSJSONObject({P:e.f(H.value,(l=null,h=null,w=null)=>new UTSJSONObject({a:e.t(l.name),b:l.id,c:l.id===O.value?1:"",d:e.o((m=null)=>ee(l),l.id)})),Q:_._imports_2,R:e.o(ne),S:e.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({T:e.o(G)})):new UTSJSONObject({}),new UTSJSONObject({U:e.f(M.value,(l=null,h=null,w=null)=>e.e(new UTSJSONObject({a:l.avatar||"/static/image/defaultAvatar/teacher-man.png",b:e.o((m=null)=>oe(l.id),l.id||h),c:e.t(l.name),d:l.certificate?"/static/image/certify/certified.png":"/static/image/certify/uncertified.png",e:l.certificate?"已认证":"未认证",f:e.t(l.school),g:e.t(l.major),h:l.hourPrice}),l.hourPrice?new UTSJSONObject({i:e.t(l.hourPrice)}):new UTSJSONObject({}),new UTSJSONObject({j:e.o((m=null)=>se(l.id),l.id||h),k:l.id||h}))),V:_._imports_3,W:M.value.length===0&&!c.value}),M.value.length===0&&!c.value?new UTSJSONObject({}):new UTSJSONObject({}),new UTSJSONObject({X:e.sei("step2","scroll-view"),Y:e.o(ce)}))}}),Se=e._export_sfc(he,[["__scopeId","data-v-dd318616"]]);wx.createPage(Se);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_AI_Login_Match/match/match.js.map
