"use strict";const a=require("../../common/vendor.js"),K=require("../../common/assets.js"),k=require("../../router/Router.js"),c=require("../components/combobox/graduate_school_major.js");Math||a.unref(ge)();const ge=()=>"../../components/navigationTitleBar/header.js",Oe=a.defineComponent({__name:"match",setup(je){const u=a.useStore(),G=a.ref(""),$=[new UTSJSONObject({key:"school",label:"学校"}),new UTSJSONObject({key:"professional",label:"专业课"}),new UTSJSONObject({key:"nonProfessional",label:"非专业课"}),new UTSJSONObject({key:"sort",label:"排序方式"})],i=a.ref(""),S=a.ref(!1),p=a.ref(!1),f=a.ref(""),A=[new UTSJSONObject({key:"math",label:"数学"}),new UTSJSONObject({key:"english",label:"英语"}),new UTSJSONObject({key:"politics",label:"政治"}),new UTSJSONObject({key:"other",label:"其他"})],q=new UTSJSONObject({math:"考研数学",english:"考研英语",politics:"考研政治",other:"其他科目"}),j=a.computed(()=>u.state.user.match.matchList||[]),e=a.reactive(new UTSJSONObject({targetSchoolIndex:-1,targetMajorIndex:-1,targetSchool:"",targetMajor:"",mathIndex:-1,englishIndex:-1,politicsIndex:-1,otherIndex:-1,sortIndex:-1})),F=a.ref([]),x=a.ref([]),r=a.ref(null),b=a.ref(["数学一","数学二","数学三"]),M=a.ref(["英语一","英语二"]),T=a.ref(["政治必修","政治选修"]),N=a.ref(["经济学","管理学","教育学","历史学"]),J=a.ref(["综合评分从高到低","价格从低到高","价格从高到低","最新发布"]),O=a.ref(""),d=a.ref(""),U=a.ref([]),h=a.ref([]),y=(t=null)=>{const o=new UTSJSONObject({});return!t||!Array.isArray(t)||t.forEach((l=null)=>{var n;const s=(n=l.service)===null||n===void 0?null:n.find((g=null)=>{var v;return((v=g.type)===null||v===void 0?null:v.typename)==="一对一课程"});if(s){const g=parseFloat(s.price.replace(/[^0-9.]/g,"")),v=parseFloat(s.type.fulllength.hours.replace(/[^0-9.]/g,"")),fe=parseFloat(s.type.fulllength.minutes.replace(/[^0-9.]/g,"")),C=v+fe/60;C>0&&(o[l.id]=new UTSJSONObject({name:l.name,hourlyPrice:(g/C).toFixed(2)}))}}),o},_=(t=null)=>{if(t==="school")return!!u.state.user.match.schoolList;if(t==="professional")return!!u.state.user.match.professionalList;if(t==="nonProfessional"){const o=u.state.user.match.nonProfessionalList;return!!(o.math||o.english||o.politics||o.other)}return t==="sort"?!!u.state.user.match.sortMode:i.value===t},H=(t=null)=>{if(i.value===t&&S.value)return S.value=!1,i.value="",null;i.value=t,S.value=!0,V(t)},V=(t=null)=>{if(t==="school"){const o=u.state.user.match.schoolList;if(O.value=o||"",o){e.targetSchool=o;const l=U.value.findIndex(n=>n===o);l>=0&&(e.targetSchoolIndex=l)}I()}if(t==="professional"){const o=u.state.user.match.professionalList;if(d.value=o||"",o){e.targetMajor=o;const l=h.value.findIndex(n=>n===o);l>=0&&(e.targetMajorIndex=l)}m()}if(t==="nonProfessional"){const o=u.state.user.match.nonProfessionalList;if(o.math){const l=b.value.findIndex(n=>n===o.math);l>=0&&(e.mathIndex=l,f.value="math")}else if(o.english){const l=M.value.findIndex(n=>n===o.english);l>=0&&(e.englishIndex=l,f.value="english")}else if(o.politics){const l=T.value.findIndex(n=>n===o.politics);l>=0&&(e.politicsIndex=l,f.value="politics")}else if(o.other){const l=N.value.findIndex(n=>n===o.other);l>=0&&(e.otherIndex=l,f.value="other")}}if(t==="sort"){const o=u.state.user.match.sortMode;if(o){const l=J.value.findIndex(n=>n===o);l>=0&&(e.sortIndex=l)}}},D=()=>{S.value=!1,i.value=""},B=(t=null)=>a.__awaiter(this,void 0,void 0,function*(){if(!t)return L(),Promise.resolve(null);if(c.GraduateStore.actions.selectSchool(new UTSJSONObject({commit:(o=null,l=null)=>{c.GraduateStore.mutations[o](r.value,l)}}),t),r.value.schools[t]){if(r.value.schools[t].length,x.value=r.value.schools[t].slice(0,100),u.state.user.match.professionalList){const o=u.state.user.match.professionalList,l=x.value.findIndex(n=>n===o);l>=0?(e.targetMajorIndex=l,e.targetMajor=o):(L(),u.dispatch("user/match/updateProfessionalList",""))}}else L()}),R=()=>a.__awaiter(this,void 0,void 0,function*(){try{r.value=UTS.JSON.parse(UTS.JSON.stringify(c.GraduateStore.state)),c.GraduateStore.mutations.initSchoolFuse(r.value);const t=Object.keys(r.value.schools).slice(0,50);F.value=t}catch{F.value=["北京大学","清华大学","复旦大学"]}}),z=(t=null)=>{const o=t.detail.value||O.value;c.GraduateStore.mutations.setSchoolKeyword(r.value,o),o||(e.targetSchoolIndex=-1,e.targetSchool="",d.value="",e.targetMajorIndex=-1,e.targetMajor=""),I()},E=(t=null)=>{if(!e.targetSchool)return null;const o=t.detail.value||d.value;c.GraduateStore.mutations.setMajorKeyword(r.value,o),o||(e.targetMajorIndex=-1,e.targetMajor=""),m(o)},I=()=>{U.value=c.GraduateStore.getters.filteredSchoolList(r.value)},m=(t=null)=>{var o;if(!e.targetSchool)return h.value=[],null;c.GraduateStore.mutations.setSelectedSchool(r.value,e.targetSchool);const l=t!==void 0?t:r.value.majorKeyword||"";t&&t!==r.value.majorKeyword&&c.GraduateStore.mutations.setMajorKeyword(r.value,t);let n=[];if(l){const s=r.value.majorKeyword;c.GraduateStore.mutations.setMajorKeyword(r.value,l),n=c.GraduateStore.getters.filteredMajorList(r.value),s!==l&&c.GraduateStore.mutations.setMajorKeyword(r.value,s)}else n=((o=r.value.schools[e.targetSchool])===null||o===void 0?null:o.slice(0,100))||[];h.value=n,l?Q():W()},Q=()=>{if(!e.targetMajor||!h.value.length)return null;const t=h.value.findIndex(o=>o===e.targetMajor);if(t===-1)h.value.unshift(e.targetMajor);else if(t>0){const o=h.value.splice(t,1)[0];h.value.unshift(o)}},W=()=>{if(!h.value||h.value.length===0)return null;h.value.sort((t,o)=>{if(t===e.targetMajor)return-1;if(o===e.targetMajor)return 1;if(e.targetSchool==="同济大学"){const l=t.includes("计算")||t.includes("软件")||t.includes("信息")||t.includes("通信"),n=o.includes("计算")||o.includes("软件")||o.includes("信息")||o.includes("通信");if(l&&!n)return-1;if(!l&&n)return 1}return t.localeCompare(o,"zh-CN")})},X=(t=null,o=null)=>{e.targetSchoolIndex=t,e.targetSchool=o,O.value=o},Y=()=>{u.dispatch("user/match/updateSchoolList",e.targetSchool),e.targetSchool?B(e.targetSchool):(d.value="",e.targetMajorIndex=-1,e.targetMajor="",m()),w(),S.value=!1,i.value=""},Z=(t=null,o=null)=>{e.targetMajorIndex=t,e.targetMajor=o,d.value=o},ee=()=>{if(!e.targetMajor&&d.value&&h.value.length>0){const t=d.value;let o=[];if(t){const l=r.value.majorKeyword;c.GraduateStore.mutations.setMajorKeyword(r.value,t),o=c.GraduateStore.getters.filteredMajorList(r.value),c.GraduateStore.mutations.setMajorKeyword(r.value,l)}o.length>0?e.targetMajor=o[0]:e.targetMajor=h.value[0],e.targetMajorIndex=0,d.value=e.targetMajor}return e.targetMajor},te=()=>{const t=ee();t&&(e.mathIndex=-1,e.englishIndex=-1,e.politicsIndex=-1,e.otherIndex=-1,u.dispatch("user/match/updateNonProfessionalList",new UTSJSONObject({math:"",english:"",politics:"",other:""}))),u.dispatch("user/match/updateProfessionalList",t),r.value&&c.GraduateStore.mutations.setMajorKeyword(r.value,""),w(),S.value=!1,i.value=""},oe=(t=null)=>{switch(t){case"math":return e.mathIndex;case"english":return e.englishIndex;case"politics":return e.politicsIndex;case"other":return e.otherIndex;default:return-1}},ae=(t=null,o=null)=>{if(t==="math"&&e.mathIndex===o||t==="english"&&e.englishIndex===o||t==="politics"&&e.politicsIndex===o||t==="other"&&e.otherIndex===o)return e.mathIndex=-1,e.englishIndex=-1,e.politicsIndex=-1,e.otherIndex=-1,null;switch(e.mathIndex=-1,e.englishIndex=-1,e.politicsIndex=-1,e.otherIndex=-1,t){case"math":e.mathIndex=o;break;case"english":e.englishIndex=o;break;case"politics":e.politicsIndex=o;break;case"other":e.otherIndex=o;break}},ne=()=>{const t=new UTSJSONObject({math:e.mathIndex>=0?b.value[e.mathIndex]:"",english:e.englishIndex>=0?M.value[e.englishIndex]:"",politics:e.politicsIndex>=0?T.value[e.politicsIndex]:"",other:e.otherIndex>=0?N.value[e.otherIndex]:""});u.dispatch("user/match/updateNonProfessionalList",t),(e.mathIndex>=0||e.englishIndex>=0||e.politicsIndex>=0||e.otherIndex>=0)&&(e.targetMajorIndex=-1,e.targetMajor="",u.dispatch("user/match/updateProfessionalList","")),w(),S.value=!1,i.value=""},le=(t=null)=>{e.sortIndex===t?e.sortIndex=-1:e.sortIndex=t},re=()=>{const t=e.sortIndex>=0?J.value[e.sortIndex]:"";u.dispatch("user/match/updateSortMode",t),w(),S.value=!1,i.value=""},se=(t=null)=>{k.Navigator.toTeacher(t)},ue=(t=null)=>{k.Navigator.toChat(t)},ie=()=>{if(p.value)return null;p.value=!0,u.dispatch("user/match/loadMoreTeachers").finally(()=>{p.value=!1})},L=()=>{e.targetMajorIndex=-1,e.targetMajor=""},ce=(t=null)=>{f.value=t},de=(t=null)=>{switch(t){case"math":return b.value;case"english":return M.value;case"politics":return T.value;case"other":return N.value;default:return[]}},w=()=>{p.value=!0,u.dispatch("user/match/fetchMatchTeachers").finally(()=>{p.value=!1})},P=a.computed(()=>{const t=new UTSJSONObject({});t.school=u.state.user.match.schoolList||"",t.professional=u.state.user.match.professionalList||"";const o=u.state.user.match.nonProfessionalList,l=[];return o.math&&l.push(o.math),o.english&&l.push(o.english),o.politics&&l.push(o.politics),o.other&&l.push(o.other),t.nonProfessional=l.join(", "),t.sort=u.state.user.match.sortMode||"",t}),he=()=>{O.value="",e.targetSchoolIndex=-1,e.targetSchool="",d.value="",e.targetMajorIndex=-1,e.targetMajor="",I()},ve=()=>{d.value="",e.targetMajorIndex=-1,e.targetMajor="",u.dispatch("user/match/updateProfessionalList",""),e.targetSchool&&r.value&&c.GraduateStore.mutations.setMajorKeyword(r.value,""),m()},Se=()=>{k.Navigator.toIndex()};return a.onMounted(()=>{R().then(()=>{var t;I(),m();const o=u.state.user.match.schoolList;if(o&&(!((t=r.value)===null||t===void 0)&&t.schools[o])){const l=r.value.schools[o].slice(0,100);x.value=l}}),u.dispatch("user/match/fetchMatchTeachers")}),(t=null,o=null)=>a.e(new UTSJSONObject({a:K._imports_0$2,b:K._imports_1$2,c:a.o(Se),d:a.p(new UTSJSONObject({title:"精准匹配"})),e:G.value,f:a.o((n=null)=>G.value=n.detail.value),g:a.f($,(n=null,s=null,g=null)=>a.e(new UTSJSONObject({a:a.t(n.label),b:_(n.key)?1:"",c:P.value[n.key]}),P.value[n.key]?new UTSJSONObject({d:a.t(P.value[n.key])}):new UTSJSONObject({}),new UTSJSONObject({e:_(n.key)?1:"",f:i.value===n.key?1:"",g:n.key,h:_(n.key)?1:"",i:a.o((v=null)=>H(n.key),n.key)}))),h:S.value}),S.value?a.e(new UTSJSONObject({i:i.value==="school"}),i.value==="school"?a.e(new UTSJSONObject({j:a.o([(n=null)=>O.value=n.detail.value,z]),k:a.o(()=>{}),l:O.value,m:O.value}),O.value?new UTSJSONObject({n:a.o(he)}):new UTSJSONObject({}),new UTSJSONObject({o:a.f(U.value,(n=null,s=null,g=null)=>new UTSJSONObject({a:a.t(n),b:n,c:s===e.targetSchoolIndex?1:"",d:a.o((v=null)=>X(s,n),n)})),p:a.o(Y),q:a.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({r:i.value==="professional"}),i.value==="professional"?a.e(new UTSJSONObject({s:e.targetSchool?"请输入专业名称":"请先选择学校",t:!e.targetSchool,v:a.o([(n=null)=>d.value=n.detail.value,E]),w:a.o(()=>{}),x:d.value,y:d.value}),d.value?new UTSJSONObject({z:a.o(ve)}):new UTSJSONObject({}),new UTSJSONObject({A:a.f(h.value,(n=null,s=null,g=null)=>new UTSJSONObject({a:a.t(n),b:n,c:s===e.targetMajorIndex?1:"",d:a.o((v=null)=>Z(s,n),n)})),B:a.o(te),C:a.o(()=>{})})):new UTSJSONObject({}),new UTSJSONObject({D:i.value==="nonProfessional"}),i.value==="nonProfessional"?new UTSJSONObject({E:a.f(A,(n=null,s=null,g=null)=>new UTSJSONObject({a:a.t(n.label),b:n.key,c:a.n(f.value===n.key?"active":""),d:a.o((v=null)=>ce(n.key),n.key)})),F:a.t(q[f.value]),G:a.f(de(f.value),(n=null,s=null,g=null)=>new UTSJSONObject({a:a.t(n),b:s,c:s===oe(f.value)?1:"",d:a.o((v=null)=>ae(f.value,s),s)})),H:a.o(ne),I:a.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({J:i.value==="sort"}),i.value==="sort"?new UTSJSONObject({K:a.f(J.value,(n=null,s=null,g=null)=>new UTSJSONObject({a:a.t(n),b:s,c:s===e.sortIndex?1:"",d:a.o((v=null)=>le(s),s)})),L:a.o(re),M:a.o(()=>{})}):new UTSJSONObject({}),new UTSJSONObject({N:a.o(D)})):new UTSJSONObject({}),new UTSJSONObject({O:a.f(j.value,(n=null,s=null,g=null)=>a.e(new UTSJSONObject({a:n.avatar||"/static/image/defaultAvatar/teacher-man.png",b:a.o((v=null)=>se(n.id),n.id||s),c:a.t(n.name),d:n.certificate?"/static/image/certify/certified.png":"/static/image/certify/uncertified.png",e:n.certificate?"已认证":"未认证",f:a.t(n.school),g:a.t(n.major),h:a.t(n.teacherScore),i:a.o((v=null)=>ue(n.id),n.id||s),j:y(j.value)[n.id]}),y(j.value)[n.id]?new UTSJSONObject({k:a.t(y(j.value)[n.id].hourlyPrice)}):new UTSJSONObject({}),new UTSJSONObject({l:n.id||s}))),P:j.value.length===0&&!p.value}),j.value.length===0&&!p.value?new UTSJSONObject({}):new UTSJSONObject({}),new UTSJSONObject({Q:a.sei("step2","scroll-view"),R:a.o(ie)}))}}),pe=a._export_sfc(Oe,[["__scopeId","data-v-dd318616"]]);wx.createPage(pe);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_AI_Login_Match/match/match.js.map
