"use strict";const t=require("../../common/vendor.js"),i=require("../../router/Router.js"),m=require("../../store/global.js"),S=require("../../store/user/JWT.js"),u=require("../../common/assets.js"),j=()=>m.useGlobalStore().apiBaseUrl,d=async({userRole:e,userInfo:o,isSkip:s=!1})=>{try{const a=j();let n="",r={};if(e==="老师")n="/yanshilu/teacher/save",s?r={schoolId:null,professionalId:null,gradeType:null}:r={schoolId:o.targetSchoolId||null,professionalId:o.targetMajorId||null,gradeType:o.gradeType||null};else if(e==="学生")n="/yanshilu/student/save",s?r={targetSchoolId:null,targetProfessionalId:null,currentSchoolId:null,currentProfessionalId:null,gradeType:null}:r={targetSchoolId:o.targetSchoolId||null,targetProfessionalId:o.targetMajorId||null,currentSchoolId:o.schoolId||null,currentProfessionalId:o.majorId||null,gradeType:o.gradeType||null};else throw new Error("无效的用户角色");const l=await S.apiRequest(`${a}${n}`,"POST",r);return l.data.code===200?{success:!0,message:l.data.msg,data:l.data}:{success:!1,message:l.data.msg||"提交失败",data:l.data}}catch(a){return t.index.__f__("error","at pages_AI_Login_Match/login/login_detail.js:92","提交用户信息失败:",a),{success:!1,message:a.message||"网络请求失败",error:a}}},f=()=>"../components/combobox/combobox.js",p=()=>"../../components/navigationTitleBar/header.js",M=t.defineComponent({onPageScroll(){t.index.$emit("page-scroll")},components:{ChoiceSelected:f,Header:p},onLoad(){this.initUserInfo()},onUnload(){Object.values(this.searchTimers).forEach((e=null)=>{e&&clearTimeout(e)})},data(){return{formData:new UTSJSONObject({nickname:"",avatar:"/static/image/defaultAvatar/teacher-man.png",schoolIndex:-1,majorIndex:-1,targetSchoolIndex:-1,targetMajorIndex:-1,gradeIndex:-1,targetSchool:"",targetMajor:""}),allGradeList:["大一","大二","大三","大四","研一","研二","研三"],showAgreementModal:!1,pendingUserInfo:null,searchTimers:new UTSJSONObject({school:null,major:null,targetSchool:null,targetMajor:null}),token:"",userId:""}},computed:Object.assign(Object.assign({},t.mapState("user/baseInfo",new UTSJSONObject({userRole:(e=null)=>e.userInfo.role,userSchoolId:(e=null)=>e.userInfo.schoolId,userMajorId:(e=null)=>e.userInfo.majorId,userTargetSchoolId:(e=null)=>e.userInfo.targetSchoolId,userTargetMajorId:(e=null)=>e.userInfo.targetMajorId,userStudentGrade:(e=null)=>e.userInfo.studentGrade,userTeacherGrade:(e=null)=>e.userInfo.teacherGrade}))),{gradeList(){return this.userRole==="老师"?this.allGradeList.filter(e=>e.includes("研")):this.allGradeList.filter(e=>e.includes("大"))},schoolOptions(){return this.$store.getters["user/schoolMajorRequest/undergraduateSchoolOptions"].map((e=null)=>e.name)},majorOptions(){return this.$store.getters["user/schoolMajorRequest/undergraduateMajorOptions"].map((e=null)=>e.name)},targetSchoolOptions(){return this.$store.getters["user/schoolMajorRequest/graduateSchoolOptions"].map((e=null)=>e.name)},targetMajorOptions(){return this.$store.getters["user/schoolMajorRequest/graduateMajorOptions"].map((e=null)=>e.name)},undergraduateSchoolSearchData(){return this.$store.getters["user/schoolMajorRequest/undergraduateSchoolSearchStatus"]},undergraduateMajorSearchData(){return this.$store.getters["user/schoolMajorRequest/undergraduateMajorSearchStatus"]},graduateSchoolSearchData(){return this.$store.getters["user/schoolMajorRequest/graduateSchoolSearchStatus"]},graduateMajorSearchData(){return this.$store.getters["user/schoolMajorRequest/graduateMajorSearchStatus"]}}),watch:{schoolOptions:{handler(e=null){this.updateSchoolIndex(e)},immediate:!0},majorOptions:{handler(e=null){this.updateMajorIndex(e)},immediate:!0},targetSchoolOptions:{handler(e=null){this.updateTargetSchoolIndex(e)},immediate:!0},targetMajorOptions:{handler(e=null){this.updateTargetMajorIndex(e)},immediate:!0}},methods:Object.assign(Object.assign({},t.mapMutations("user/baseInfo",["UPDATE_USER_INFO","SET_USER_INFO"])),{handleBack(){i.Navigator.toLogin()},initUserInfo(){if(this.token=t.index.getStorageSync("token")||"",this.userId=t.index.getStorageSync("userId")||"",!this.token)return t.index.showToast({title:"请先登录",icon:"none"}),null;const e=t.index.getStorageSync("nickname")||"",o=t.index.getStorageSync("avatar")||"";e&&(this.formData.nickname=e),o&&(this.formData.avatar=o)},updateSchoolIndex(e=null){const o=this.$store.getters["user/schoolMajorRequest/selectedUndergraduateSchool"];if(o.name&&e.length>0){const s=e.indexOf(o.name);this.formData.schoolIndex=s!==-1?s:-1}else this.formData.schoolIndex=-1},updateMajorIndex(e=null){const o=this.$store.getters["user/schoolMajorRequest/selectedUndergraduateMajor"];if(o.name&&e.length>0){const s=e.indexOf(o.name);this.formData.majorIndex=s!==-1?s:-1}else this.formData.majorIndex=-1},updateTargetSchoolIndex(e=null){const o=this.$store.getters["user/schoolMajorRequest/selectedGraduateSchool"];if(o.name&&e.length>0){const s=e.indexOf(o.name);this.formData.targetSchoolIndex=s!==-1?s:-1,this.formData.targetSchool=o.name}else this.formData.targetSchoolIndex=-1,this.formData.targetSchool=""},updateTargetMajorIndex(e=null){const o=this.$store.getters["user/schoolMajorRequest/selectedGraduateMajor"];if(o.name&&e.length>0){const s=e.indexOf(o.name);this.formData.targetMajorIndex=s!==-1?s:-1,this.formData.targetMajor=o.name}else this.formData.targetMajorIndex=-1,this.formData.targetMajor=""},handleSchoolSelect(e=null,o=null){this.formData.schoolIndex=e;const a=this.$store.getters["user/schoolMajorRequest/undergraduateSchoolOptions"].find((n=null)=>n.name===o);a&&this.$store.dispatch("user/schoolMajorRequest/selectUndergraduateSchool",new UTSJSONObject({id:a.id,name:a.name}))},handleMajorSelect(e=null,o=null){this.formData.majorIndex=e;const a=this.$store.getters["user/schoolMajorRequest/undergraduateMajorOptions"].find((n=null)=>n.name===o);a&&this.$store.dispatch("user/schoolMajorRequest/selectUndergraduateMajor",new UTSJSONObject({id:a.id,name:a.name}))},handleTargetSchoolSelect(e=null,o=null){this.formData.targetSchoolIndex=e,this.formData.targetSchool=o;const a=this.$store.getters["user/schoolMajorRequest/graduateSchoolOptions"].find((n=null)=>n.name===o);a&&this.$store.dispatch("user/schoolMajorRequest/selectGraduateSchool",new UTSJSONObject({id:a.id,name:a.name}))},handleTargetMajorSelect(e=null,o=null){this.formData.targetMajorIndex=e,this.formData.targetMajor=o;const a=this.$store.getters["user/schoolMajorRequest/graduateMajorOptions"].find((n=null)=>n.name===o);a&&this.$store.dispatch("user/schoolMajorRequest/selectGraduateMajor",new UTSJSONObject({id:a.id,name:a.name}))},handleGradeSelect(e=null,o=null){this.formData.gradeIndex=e},handleSchoolSearch(e=null){this.searchTimers.school&&clearTimeout(this.searchTimers.school),this.searchTimers.school=setTimeout(()=>{this.performSchoolSearch(e)},500)},performSchoolSearch(e=null){return t.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/schoolMajorRequest/searchUndergraduateSchools",new UTSJSONObject({keyword:e}))}catch(o){t.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:608","学校搜索失败:",o),t.index.showToast({title:"学校搜索失败",icon:"none"})}})},handleMajorSearch(e=null){this.searchTimers.major&&clearTimeout(this.searchTimers.major),this.searchTimers.major=setTimeout(()=>{this.performMajorSearch(e)},500)},performMajorSearch(e=null){return t.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/schoolMajorRequest/searchUndergraduateMajors",new UTSJSONObject({keyword:e}))}catch(o){t.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:642","专业搜索失败:",o),t.index.showToast({title:"专业搜索失败",icon:"none"})}})},handleTargetSchoolSearch(e=null){this.searchTimers.targetSchool&&clearTimeout(this.searchTimers.targetSchool),this.searchTimers.targetSchool=setTimeout(()=>{this.performTargetSchoolSearch(e)},500)},performTargetSchoolSearch(e=null){return t.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/schoolMajorRequest/searchGraduateSchools",new UTSJSONObject({keyword:e}))}catch(o){t.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:676","目标学校搜索失败:",o),t.index.showToast({title:"目标学校搜索失败",icon:"none"})}})},handleTargetMajorSearch(e=null){this.searchTimers.targetMajor&&clearTimeout(this.searchTimers.targetMajor),this.searchTimers.targetMajor=setTimeout(()=>{this.performTargetMajorSearch(e)},500)},performTargetMajorSearch(e=null){return t.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/schoolMajorRequest/searchGraduateMajors",new UTSJSONObject({keyword:e}))}catch(o){t.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:710","目标专业搜索失败:",o),t.index.showToast({title:"目标专业搜索失败",icon:"none"})}})},handleSchoolChange(e=null){this.formData.targetMajorIndex=-1,this.formData.targetMajor="",this.$store.commit("user/schoolMajorRequest/CLEAR_GRADUATE_MAJOR_SELECTION")},resetMajorSelection(){this.formData.targetMajorIndex=-1,this.formData.targetMajor=""},skipForm(){return t.__awaiter(this,void 0,void 0,function*(){try{t.index.showLoading({title:"跳过中..."});const e=yield d(new UTSJSONObject({userRole:this.userRole,userInfo:new UTSJSONObject({}),isSkip:!0}));t.index.hideLoading(),e.success?(t.index.showToast({title:"跳过成功",icon:"success"}),setTimeout(()=>{i.Navigator.toIndex()},1500)):t.index.showToast({title:e.message||"跳过失败",icon:"none"})}catch(e){t.index.hideLoading(),t.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:775","跳过失败:",e),t.index.showToast({title:"跳过失败",icon:"none"})}})},submitForm(){const e=this.$store.getters["user/schoolMajorRequest/undergraduateSchoolOptions"],o=this.$store.getters["user/schoolMajorRequest/undergraduateMajorOptions"],s=this.$store.getters["user/schoolMajorRequest/graduateSchoolOptions"],a=this.$store.getters["user/schoolMajorRequest/graduateMajorOptions"],n=e[this.formData.schoolIndex],r=o[this.formData.majorIndex],l=s[this.formData.targetSchoolIndex],c=a[this.formData.targetMajorIndex],g=this.gradeList[this.formData.gradeIndex],h=new UTSJSONObject({nickname:this.formData.nickname||"",avatar:this.formData.avatar||"",schoolId:n?n.id:null,majorId:r?r.id:null,targetSchoolId:l?l.id:null,targetMajorId:c?c.id:null,grade:g||""});this.userRole==="老师"?(this.pendingUserInfo=h,this.showAgreementModal=!0):this.doSubmit(h)},doSubmit(e=null){return t.__awaiter(this,void 0,void 0,function*(){try{t.index.showLoading({title:"提交中..."});const o=new UTSJSONObject({大一:1,大二:2,大三:3,大四:4,研一:5,研二:6,研三:7}),s=new UTSJSONObject(Object.assign(Object.assign({},e),{gradeType:e.grade?o[e.grade]:null})),a=yield d(new UTSJSONObject({userRole:this.userRole,userInfo:s,isSkip:!1}));t.index.hideLoading(),a.success?(this.UPDATE_USER_INFO(e),t.index.showToast({title:a.message||"提交成功",icon:"success"}),setTimeout(()=>{i.Navigator.toIndex()},1500)):t.index.showToast({title:a.message||"提交失败",icon:"none"})}catch(o){t.index.hideLoading(),t.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:878","提交失败:",o),t.index.showToast({title:"提交失败",icon:"none"})}})},confirmAgreement(){this.showAgreementModal=!1,this.pendingUserInfo&&(this.doSubmit(this.pendingUserInfo),this.pendingUserInfo=null)},closeModal(){this.showAgreementModal=!1,this.pendingUserInfo=null}})});if(!Array){const e=t.resolveComponent("Header"),o=t.resolveComponent("ChoiceSelected"),s=t.resolveComponent("template");(e+o+s)()}function I(e,o,s,a,n,r){return t.e({a:t.o(r.handleBack),b:t.p({title:"登录详情"}),c:u._imports_0$2,d:u._imports_1$2,e:e.userRole==="学生"},e.userRole==="学生"?{f:t.sr("schoolDropdown","221f0539-1"),g:t.o(r.handleSchoolSelect),h:t.o(r.handleSchoolSearch),i:t.p({componentType:"undergraduate",choiceIndex:n.formData.schoolIndex,choiceList:r.schoolOptions,defaultText:"请选择学校",mode:"search",searchPlaceholder:"输入学校名称",enablePagination:!0,pageSize:10,loading:r.undergraduateSchoolSearchData.isLoading}),j:t.sr("majorDropdown","221f0539-2"),k:t.o(r.handleMajorSelect),l:t.o(r.handleMajorSearch),m:t.p({componentType:"undergraduate",choiceIndex:n.formData.majorIndex,choiceList:r.majorOptions,defaultText:"请选择专业",mode:"search",searchPlaceholder:"输入专业名称",enablePagination:!0,pageSize:10,loading:r.undergraduateMajorSearchData.isLoading})}:{},{n:t.o(r.handleGradeSelect),o:t.p({choiceIndex:n.formData.gradeIndex,choiceList:r.gradeList,defaultText:"请选择年级",mode:"select"}),p:t.t(e.userRole==="学生"?"目标学校":"就读学校"),q:t.sr("targetSchoolDropdown","221f0539-4"),r:t.o(r.handleTargetSchoolSelect),s:t.o(r.handleTargetSchoolSearch),t:t.o(r.handleSchoolChange),v:t.p({componentType:"graduateSchool",choiceIndex:n.formData.targetSchoolIndex,choiceList:r.targetSchoolOptions,defaultText:e.userRole==="学生"?"请选择目标学校":"请选择学校",mode:"search",searchPlaceholder:e.userRole==="学生"?"输入目标学校名称":"输入学校名称",enablePagination:!0,pageSize:10,loading:r.graduateSchoolSearchData.isLoading}),w:t.t(e.userRole==="学生"?"目标专业":"就读专业"),x:t.sr("targetMajorDropdown","221f0539-5"),y:t.o(r.handleTargetMajorSelect),z:t.o(r.handleTargetMajorSearch),A:t.o(r.resetMajorSelection),B:t.p({componentType:"graduateMajor",choiceIndex:n.formData.targetMajorIndex,choiceList:r.targetMajorOptions,parentValue:n.formData.targetSchool,isLinkage:!0,defaultText:n.formData.targetSchool?"请选择专业":"请先选择学校",mode:"search",searchPlaceholder:n.formData.targetSchool?e.userRole==="学生"?"请选择目标专业":"请选择专业":"请先选择学校",enablePagination:!0,pageSize:10}),C:u._imports_2$1,D:t.o((...l)=>r.skipForm&&r.skipForm(...l)),E:u._imports_3$3,F:t.o((...l)=>r.submitForm&&r.submitForm(...l)),G:n.showAgreementModal},n.showAgreementModal?{H:t.o((...l)=>r.confirmAgreement&&r.confirmAgreement(...l)),I:t.o(()=>{}),J:t.o((...l)=>r.closeModal&&r.closeModal(...l))}:{})}const _=t._export_sfc(M,[["render",I],["__scopeId","data-v-221f0539"]]);wx.createPage(_);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_AI_Login_Match/login/login_detail.js.map
