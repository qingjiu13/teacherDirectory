"use strict";const a=require("../../common/vendor.js"),u=require("../../router/Router.js"),l=require("../../common/assets.js"),h=()=>"../components/combobox/combobox.js",c=()=>"../../components/navigationTitleBar/header.js",d=a.defineComponent({onPageScroll(){a.index.$emit("page-scroll")},components:{ChoiceSelected:h,Header:c},onLoad(){this.initUserInfo()},onUnload(){Object.values(this.searchTimers).forEach((e=null)=>{e&&clearTimeout(e)})},data(){return{formData:new UTSJSONObject({nickname:"",avatar:"/static/image/defaultAvatar/teacher-man.png",schoolIndex:-1,majorIndex:-1,targetSchoolIndex:-1,targetMajorIndex:-1,gradeIndex:-1,targetSchool:"",targetMajor:""}),allGradeList:["大一","大二","大三","大四","研一","研二","研三"],showAgreementModal:!1,pendingUserInfo:null,searchTimers:new UTSJSONObject({school:null,major:null,targetSchool:null,targetMajor:null}),token:"",userId:""}},computed:Object.assign(Object.assign({},a.mapState("user/baseInfo",new UTSJSONObject({userRole:(e=null)=>e.userInfo.role,userSchoolId:(e=null)=>e.userInfo.schoolId,userMajorId:(e=null)=>e.userInfo.majorId,userTargetSchoolId:(e=null)=>e.userInfo.targetSchoolId,userTargetMajorId:(e=null)=>e.userInfo.targetMajorId,userStudentGrade:(e=null)=>e.userInfo.studentGrade,userTeacherGrade:(e=null)=>e.userInfo.teacherGrade,undergraduateSchoolSearchData:(e=null)=>e.undergraduateSchoolSearch,undergraduateMajorSearchData:(e=null)=>e.undergraduateMajorSearch,graduateSchoolSearchData:(e=null)=>e.graduateSchoolSearch,graduateMajorSearchData:(e=null)=>e.graduateMajorSearch}))),{gradeList(){return this.userRole==="老师"?this.allGradeList.filter(e=>e.includes("研")):this.allGradeList.filter(e=>e.includes("大"))},schoolOptions(){return this.undergraduateSchoolSearchData.options.map((e=null)=>e.name)},majorOptions(){return this.undergraduateMajorSearchData.options.map((e=null)=>e.name)},targetSchoolOptions(){return this.graduateSchoolSearchData.options.map((e=null)=>e.name)},targetMajorOptions(){return this.graduateMajorSearchData.options.map((e=null)=>e.name)}}),watch:{schoolOptions:{handler(e=null){this.updateSchoolIndex(e)},immediate:!0},majorOptions:{handler(e=null){this.updateMajorIndex(e)},immediate:!0},targetSchoolOptions:{handler(e=null){this.updateTargetSchoolIndex(e)},immediate:!0},targetMajorOptions:{handler(e=null){this.updateTargetMajorIndex(e)},immediate:!0}},methods:Object.assign(Object.assign({},a.mapMutations("user/baseInfo",["UPDATE_USER_INFO","SET_USER_INFO"])),{handleBack(){u.Navigator.toLogin()},initUserInfo(){if(this.token=a.index.getStorageSync("token")||"",this.userId=a.index.getStorageSync("userId")||"",!this.token)return a.index.showToast({title:"请先登录",icon:"none"}),null;const e=a.index.getStorageSync("nickname")||"",t=a.index.getStorageSync("avatar")||"";e&&(this.formData.nickname=e),t&&(this.formData.avatar=t),this.fetchUserProfile()},fetchUserProfile(){if(!this.token||!this.userId)return null;a.index.request({url:`http://localhost:8080/users/profile/${this.userId}`,method:"GET",header:new UTSJSONObject({Authorization:`Bearer ${this.token}`}),success:e=>{if(e.statusCode===200&&e.data){const t=e.data;t.nickname&&(this.formData.nickname=t.nickname,a.index.setStorageSync("nickname",t.nickname)),t.avatar&&(this.formData.avatar=t.avatar,a.index.setStorageSync("avatar",t.avatar)),this.SET_USER_INFO(new UTSJSONObject({id:t.id||this.userId,name:t.nickname||this.formData.nickname,avatar:t.avatar||this.formData.avatar,isRegistered:1})),a.index.__f__("log","at pages_AI_Login_Match/login/login_detail.vue:397","用户信息已更新")}},fail:e=>{a.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:401","获取用户信息失败",e)}})},updateSchoolIndex(e=null){if(this.undergraduateSchoolSearchData.selectedSchool&&e.length>0){const t=e.indexOf(this.undergraduateSchoolSearchData.selectedSchool);this.formData.schoolIndex=t!==-1?t:-1}else this.formData.schoolIndex=-1},updateMajorIndex(e=null){if(this.undergraduateMajorSearchData.selectedMajor&&e.length>0){const t=e.indexOf(this.undergraduateMajorSearchData.selectedMajor);this.formData.majorIndex=t!==-1?t:-1}else this.formData.majorIndex=-1},updateTargetSchoolIndex(e=null){if(this.graduateSchoolSearchData.selectedSchool&&e.length>0){const t=e.indexOf(this.graduateSchoolSearchData.selectedSchool);this.formData.targetSchoolIndex=t!==-1?t:-1,this.formData.targetSchool=this.graduateSchoolSearchData.selectedSchool}else this.formData.targetSchoolIndex=-1,this.formData.targetSchool=""},updateTargetMajorIndex(e=null){if(this.graduateMajorSearchData.selectedMajor&&e.length>0){const t=e.indexOf(this.graduateMajorSearchData.selectedMajor);this.formData.targetMajorIndex=t!==-1?t:-1,this.formData.targetMajor=this.graduateMajorSearchData.selectedMajor}else this.formData.targetMajorIndex=-1,this.formData.targetMajor=""},handleSchoolSelect(e=null,t=null){this.formData.schoolIndex=e;const o=this.undergraduateSchoolSearchData.options.find((s=null)=>s.name===t);o&&this.$store.dispatch("user/baseInfo/selectUndergraduateSchool",new UTSJSONObject({id:o.id,name:o.name}))},handleMajorSelect(e=null,t=null){this.formData.majorIndex=e;const o=this.undergraduateMajorSearchData.options.find((s=null)=>s.name===t);o&&this.$store.dispatch("user/baseInfo/selectUndergraduateMajor",new UTSJSONObject({id:o.id,name:o.name}))},handleTargetSchoolSelect(e=null,t=null){this.formData.targetSchoolIndex=e,this.formData.targetSchool=t;const o=this.graduateSchoolSearchData.options.find((s=null)=>s.name===t);o&&this.$store.dispatch("user/baseInfo/selectGraduateSchool",new UTSJSONObject({id:o.id,name:o.name}))},handleTargetMajorSelect(e=null,t=null){this.formData.targetMajorIndex=e,this.formData.targetMajor=t;const o=this.graduateMajorSearchData.options.find((s=null)=>s.name===t);o&&this.$store.dispatch("user/baseInfo/selectGraduateMajor",new UTSJSONObject({id:o.id,name:o.name}))},handleGradeSelect(e=null,t=null){this.formData.gradeIndex=e},handleSchoolSearch(e=null){this.searchTimers.school&&clearTimeout(this.searchTimers.school),this.searchTimers.school=setTimeout(()=>{this.performSchoolSearch(e)},500)},performSchoolSearch(e=null){return a.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/baseInfo/searchUndergraduateSchools",new UTSJSONObject({keyword:e}))}catch(t){a.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:571","学校搜索失败:",t),a.index.showToast({title:"学校搜索失败",icon:"none"})}})},handleMajorSearch(e=null){this.searchTimers.major&&clearTimeout(this.searchTimers.major),this.searchTimers.major=setTimeout(()=>{this.performMajorSearch(e)},500)},performMajorSearch(e=null){return a.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/baseInfo/searchUndergraduateMajors",new UTSJSONObject({keyword:e}))}catch(t){a.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:605","专业搜索失败:",t),a.index.showToast({title:"专业搜索失败",icon:"none"})}})},handleTargetSchoolSearch(e=null){this.searchTimers.targetSchool&&clearTimeout(this.searchTimers.targetSchool),this.searchTimers.targetSchool=setTimeout(()=>{this.performTargetSchoolSearch(e)},500)},performTargetSchoolSearch(e=null){return a.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/baseInfo/searchGraduateSchools",new UTSJSONObject({keyword:e}))}catch(t){a.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:639","目标学校搜索失败:",t),a.index.showToast({title:"目标学校搜索失败",icon:"none"})}})},handleTargetMajorSearch(e=null){this.searchTimers.targetMajor&&clearTimeout(this.searchTimers.targetMajor),this.searchTimers.targetMajor=setTimeout(()=>{this.performTargetMajorSearch(e)},500)},performTargetMajorSearch(e=null){return a.__awaiter(this,void 0,void 0,function*(){try{yield this.$store.dispatch("user/baseInfo/searchGraduateMajors",new UTSJSONObject({keyword:e}))}catch(t){a.index.__f__("error","at pages_AI_Login_Match/login/login_detail.vue:673","目标专业搜索失败:",t),a.index.showToast({title:"目标专业搜索失败",icon:"none"})}})},handleSchoolChange(e=null){this.formData.targetMajorIndex=-1,this.formData.targetMajor="",this.$store.commit("user/baseInfo/SET_GRADUATE_MAJOR_OPTIONS",[])},resetMajorSelection(){this.formData.targetMajorIndex=-1,this.formData.targetMajor=""},skipForm(){u.Navigator.toIndex()},submitForm(){const e=this.undergraduateSchoolSearchData.options[this.formData.schoolIndex],t=this.undergraduateMajorSearchData.options[this.formData.majorIndex],o=this.graduateSchoolSearchData.options[this.formData.targetSchoolIndex],s=this.graduateMajorSearchData.options[this.formData.targetMajorIndex],n=this.gradeList[this.formData.gradeIndex],r=new UTSJSONObject({nickname:this.formData.nickname||"",avatar:this.formData.avatar||"",schoolId:e?e.id:null,majorId:t?t.id:null,targetSchoolId:o?o.id:null,targetMajorId:s?s.id:null,grade:n||""});this.userRole==="老师"?(this.pendingUserInfo=r,this.showAgreementModal=!0):this.doSubmit(r)},doSubmit(e=null){a.index.showLoading({title:"提交中..."}),this.UPDATE_USER_INFO(e),setTimeout(()=>{a.index.hideLoading(),a.index.showToast({title:"提交成功",icon:"success"}),setTimeout(()=>{u.Navigator.toIndex()},1500)},1e3)},confirmAgreement(){this.showAgreementModal=!1,this.pendingUserInfo&&(this.doSubmit(this.pendingUserInfo),this.pendingUserInfo=null)},closeModal(){this.showAgreementModal=!1,this.pendingUserInfo=null}})});if(!Array){const e=a.resolveComponent("Header"),t=a.resolveComponent("ChoiceSelected"),o=a.resolveComponent("template");(e+t+o)()}function g(e,t,o,s,n,r){return a.e({a:a.o(r.handleBack),b:a.p({title:"登录详情"}),c:l._imports_0$2,d:l._imports_1$2,e:e.userRole==="学生"},e.userRole==="学生"?{f:a.sr("schoolDropdown","221f0539-1"),g:a.o(r.handleSchoolSelect),h:a.o(r.handleSchoolSearch),i:a.p({componentType:"undergraduate",choiceIndex:n.formData.schoolIndex,choiceList:r.schoolOptions,defaultText:"请选择学校",mode:"search",searchPlaceholder:"输入学校名称",enablePagination:!0,pageSize:10,loading:e.undergraduateSchoolSearchData.isLoading}),j:a.sr("majorDropdown","221f0539-2"),k:a.o(r.handleMajorSelect),l:a.o(r.handleMajorSearch),m:a.p({componentType:"undergraduate",choiceIndex:n.formData.majorIndex,choiceList:r.majorOptions,defaultText:"请选择专业",mode:"search",searchPlaceholder:"输入专业名称",enablePagination:!0,pageSize:10,loading:e.undergraduateMajorSearchData.isLoading})}:{},{n:a.o(r.handleGradeSelect),o:a.p({choiceIndex:n.formData.gradeIndex,choiceList:r.gradeList,defaultText:"请选择年级",mode:"select"}),p:a.t(e.userRole==="学生"?"目标学校":"就读学校"),q:a.sr("targetSchoolDropdown","221f0539-4"),r:a.o(r.handleTargetSchoolSelect),s:a.o(r.handleTargetSchoolSearch),t:a.o(r.handleSchoolChange),v:a.p({componentType:"graduateSchool",choiceIndex:n.formData.targetSchoolIndex,choiceList:r.targetSchoolOptions,defaultText:e.userRole==="学生"?"请选择目标学校":"请选择学校",mode:"search",searchPlaceholder:e.userRole==="学生"?"输入目标学校名称":"输入学校名称",enablePagination:!0,pageSize:10,loading:e.graduateSchoolSearchData.isLoading}),w:a.t(e.userRole==="学生"?"目标专业":"就读专业"),x:a.sr("targetMajorDropdown","221f0539-5"),y:a.o(r.handleTargetMajorSelect),z:a.o(r.handleTargetMajorSearch),A:a.o(r.resetMajorSelection),B:a.p({componentType:"graduateMajor",choiceIndex:n.formData.targetMajorIndex,choiceList:r.targetMajorOptions,parentValue:n.formData.targetSchool,isLinkage:!0,defaultText:n.formData.targetSchool?"请选择专业":"请先选择学校",mode:"search",searchPlaceholder:n.formData.targetSchool?e.userRole==="学生"?"请选择目标专业":"请选择专业":"请先选择学校",enablePagination:!0,pageSize:10}),C:l._imports_2$1,D:a.o((...i)=>r.skipForm&&r.skipForm(...i)),E:l._imports_3$3,F:a.o((...i)=>r.submitForm&&r.submitForm(...i)),G:n.showAgreementModal},n.showAgreementModal?{H:a.o((...i)=>r.confirmAgreement&&r.confirmAgreement(...i)),I:a.o(()=>{}),J:a.o((...i)=>r.closeModal&&r.closeModal(...i))}:{})}const m=a._export_sfc(d,[["render",g],["__scopeId","data-v-221f0539"]]);wx.createPage(m);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_AI_Login_Match/login/login_detail.js.map
