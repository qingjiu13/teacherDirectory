"use strict";const t=require("../../../../common/vendor.js"),d=require("./LsjFile.js"),p=t.defineComponent({name:"Lsj-upload",props:{debug:{type:Boolean,default:!1},distinct:{type:Boolean,default:!1},instantly:{type:Boolean,default:!1},option:{type:Object,default:()=>{}},size:{type:Number,default:10},count:{type:Number,default:9},multiple:{type:Boolean,default:!0},formats:{type:String,default:""},accept:{type:String,default:""},wxFileType:{type:String,default:"all"},childId:{type:String,default:"lsjUpload"},width:{type:String,default:"100%"},height:{type:String,default:"80rpx"},top:{type:[String,Number],default:""},left:{type:[String,Number],default:""},bottom:{type:[String,Number],default:""},right:{type:[String,Number],default:""},position:{type:String,default:"static"}},data(){return{}},computed:{getStyles(){let e=new UTSJSONObject({width:this.width,height:this.height});return this.position=="absolute"&&(e.top=this.top,e.bottom=this.bottom,e.left=this.left,e.right=this.right,e.position="fixed"),e}},watch:{option(e=null){}},updated(){},created(){t.index.$on("$upload-show",this.emitShow),t.index.$on("$upload-hide",this.hide)},beforeDestroy(){t.index.$off("$upload-show",this.emitShow),t.index.$off("$upload-hide",this.hide)},mounted(){let e=getCurrentPages();this.myRoute=e[e.length-1].route,this._size=0;let i="lsj_"+this.childId+new Date().getTime();this.lsjFile=new d.LsjFile(new UTSJSONObject({id:i,debug:this.debug,width:this.width,height:this.height,option:this.option,instantly:this.instantly,prohibited:new UTSJSONObject({distinct:this.distinct,size:this.size,formats:this.formats,accept:this.accept,count:this.count,multiple:this.multiple}),onchange:this.onchange,onprogress:this.onprogress})),this.create()},methods:{setFiles(e=null){var i,h;if(UTS.isInstanceOf(e,Map))try{for(var s=t.__values(e),n=s.next();!n.done;n=s.next()){var l=t.__read(n.value,2),u=l[0],r=l[1];r.progress=100,r.type="success",this.lsjFile.files.set(u,r)}}catch(o){i={error:o}}finally{try{n&&!n.done&&(h=s.return)&&h.call(s)}finally{if(i)throw i.error}}else Array.isArray(e)&&e.forEach((o=null)=>{o.name&&(o.progress=100,o.type="success",this.lsjFile.files.set(o.name,o))});this.onchange(this.lsjFile.files)},setData(){this.lsjFile&&this.lsjFile.setData(...arguments)},getDomStyles(e=null){t.index.createSelectorQuery().in(this).select(".lsj-file").fields(new UTSJSONObject({size:!0,rect:!0}),h=>{var s=h??null,n=s.height,l=s.width,u=s.top,r=s.left;s.right,s.bottom,t.index.createSelectorQuery().selectViewport().scrollOffset(o=>{var a=(o??null).scrollTop;return e(new UTSJSONObject({top:parseInt(u)+parseInt(a)+"px",left:parseInt(r)+"px",width:parseInt(l)+"px",height:parseInt(n)+"px"}))}).exec()}).exec()},emitShow(){let e=getCurrentPages();if(e[e.length-1].route===this.myRoute)return this.show()},show(){if(this.debug&&t.index.__f__("log","at uni_modules/lsj-upload/components/lsj-upload/lsj-upload.vue:211","触发show函数"),this._size&&this._size>=this.count)return null;this.isShow=!0},hide(){this.debug&&t.index.__f__("log","at uni_modules/lsj-upload/components/lsj-upload/lsj-upload.vue:226","触发hide函数"),this.isShow=!1},upload(e=null){this.lsjFile&&this.lsjFile.upload(e)},onchange(e=null){return this.$emit("change",e),this._size=e.size,e.size>=this.count?this.hide():this.show()},onprogress(e=null,i=!1){this.$emit("progress",e),i&&setTimeout(()=>{this.$emit("uploadEnd",e)},0)},clear(e=null){this.lsjFile.clear(e)},create(){this.lsjFile.create("/uni_modules/lsj-upload/hybrid/html/uploadFile.html"),this.show()},onClick(){if(this._size>=this.count)return this.toast(`只允许上传${this.count}个文件`),null;if(!this.isShow)return null;let e=this.count-this._size;this.lsjFile.chooseMessageFile(this.wxFileType,e)},toast(e=null){t.index.showToast({title:e,icon:"none"})}}});function c(e,i,h,s,n,l){return{a:t.s(l.getStyles),b:t.sei("r0-27a611eb","view","lsj"),c:t.s(l.getStyles),d:t.o((...u)=>l.onClick&&l.onClick(...u)),e:t.sei(t.gei(e,""),"view"),f:t.s(l.getStyles)}}const f=t._export_sfc(p,[["render",c],["__scopeId","data-v-27a611eb"]]);wx.createComponent(f);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/lsj-upload/components/lsj-upload/lsj-upload.js.map
