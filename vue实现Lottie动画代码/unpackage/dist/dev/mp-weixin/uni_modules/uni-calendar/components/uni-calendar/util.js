"use strict";const f=require("./calendar.js");class m{constructor({date:e,selected:t,startDate:s,endDate:a,range:r}={}){this.date=this.getDate(new Date),this.selected=t||[],this.startDate=s,this.endDate=a,this.range=r,this.cleanMultipleStatus(),this.weeks={}}setDate(e){this.selectDate=this.getDate(e),this._getWeek(this.selectDate.fullDate)}cleanMultipleStatus(){this.multipleStatus={before:"",after:"",data:[]}}resetSatrtDate(e){this.startDate=e}resetEndDate(e){this.endDate=e}getDate(e,t=0,s="day"){e||(e=new Date),typeof e!="object"&&(e=e.replace(/-/g,"/"));const a=new Date(e);switch(s){case"day":a.setDate(a.getDate()+t);break;case"month":if(a.getDate()===31&&t>0)a.setDate(a.getDate()+t);else{const u=a.getMonth();a.setMonth(u+t);const l=a.getMonth();t<0&&u!==0&&l-u>t&&a.setMonth(l+(l-u+t)),t>0&&l-u>t&&a.setMonth(l-(l-u-t))}break;case"year":a.setFullYear(a.getFullYear()+t);break}const r=a.getFullYear(),i=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,h=a.getDate()<10?"0"+a.getDate():a.getDate();return{fullDate:r+"-"+i+"-"+h,year:r,month:i,date:h,day:a.getDay()}}_getLastMonthDays(e,t){let s=[];for(let a=e;a>0;a--){const r=new Date(t.year,t.month-1,-a+1).getDate();s.push({date:r,month:t.month-1,lunar:this.getlunar(t.year,t.month-1,r),disable:!0})}return s}_currentMonthDys(e,t){let s=[],a=this.date.fullDate;for(let r=1;r<=e;r++){let i=t.year+"-"+(t.month<10,t.month)+"-"+(r<10?"0"+r:r),h=a===i,u=this.selected&&this.selected.find(o=>{if(this.dateEqual(i,o.date))return o}),l=!0,n=!0;this.startDate&&(l=this.dateCompare(this.startDate,i)),this.endDate&&(n=this.dateCompare(i,this.endDate));let D=this.multipleStatus.data,c=!1,g=-1;this.range&&(D&&(g=D.findIndex(o=>this.dateEqual(o,i))),g!==-1&&(c=!0));let p={fullDate:i,year:t.year,date:r,multiple:this.range?c:!1,beforeMultiple:this.dateEqual(this.multipleStatus.before,i),afterMultiple:this.dateEqual(this.multipleStatus.after,i),month:t.month,lunar:this.getlunar(t.year,t.month,r),disable:!(l&&n),isDay:h};u&&(p.extraInfo=u),s.push(p)}return s}_getNextMonthDays(e,t){let s=[];for(let a=1;a<e+1;a++)s.push({date:a,month:Number(t.month)+1,lunar:this.getlunar(t.year,Number(t.month)+1,a),disable:!0});return s}getInfo(e){return e||(e=new Date),this.canlender.find(s=>s.fullDate===this.getDate(e).fullDate)}dateCompare(e,t){return e=new Date(e.replace("-","/").replace("-","/")),t=new Date(t.replace("-","/").replace("-","/")),e<=t}dateEqual(e,t){return e=new Date(e.replace("-","/").replace("-","/")),t=new Date(t.replace("-","/").replace("-","/")),e.getTime()-t.getTime()===0}geDateAll(e,t){var s=[],a=e.split("-"),r=t.split("-"),i=new Date;i.setFullYear(a[0],a[1]-1,a[2]);var h=new Date;h.setFullYear(r[0],r[1]-1,r[2]);for(var u=i.getTime()-24*60*60*1e3,l=h.getTime()-24*60*60*1e3,n=u;n<=l;)n=n+24*60*60*1e3,s.push(this.getDate(new Date(parseInt(n))).fullDate);return s}getlunar(e,t,s){return f.calendar.solar2lunar(e,t,s)}setSelectInfo(e,t){this.selected=t,this._getWeek(e)}setMultiple(e){let{before:t,after:s}=this.multipleStatus;this.range&&(t&&s?(this.multipleStatus.before=e,this.multipleStatus.after="",this.multipleStatus.data=[]):t?(this.multipleStatus.after=e,this.dateCompare(this.multipleStatus.before,this.multipleStatus.after)?this.multipleStatus.data=this.geDateAll(this.multipleStatus.before,this.multipleStatus.after):this.multipleStatus.data=this.geDateAll(this.multipleStatus.after,this.multipleStatus.before)):this.multipleStatus.before=e,this._getWeek(e))}_getWeek(e){const{year:t,month:s}=this.getDate(e);let a=new Date(t,s-1,1).getDay(),r=new Date(t,s,0).getDate(),i={lastMonthDays:this._getLastMonthDays(a,this.getDate(e)),currentMonthDys:this._currentMonthDys(r,this.getDate(e)),nextMonthDays:[],weeks:[]},h=[];const u=42-(i.lastMonthDays.length+i.currentMonthDys.length);i.nextMonthDays=this._getNextMonthDays(u,this.getDate(e)),h=h.concat(i.lastMonthDays,i.currentMonthDys,i.nextMonthDays);let l={};for(let n=0;n<h.length;n++)n%7===0&&(l[parseInt(n/7)]=new Array(7)),l[parseInt(n/7)][n%7]=h[n];this.canlender=h,this.weeks=l}}exports.Calendar=m;
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/uni-calendar/components/uni-calendar/util.js.map
