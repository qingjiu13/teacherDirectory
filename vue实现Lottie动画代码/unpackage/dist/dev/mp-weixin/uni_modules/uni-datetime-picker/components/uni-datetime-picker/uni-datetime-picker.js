"use strict";const i=require("../../../../common/vendor.js"),y=require("./i18n/index.js"),r=require("./util.js"),k=()=>"./calendar.js",C=()=>"./time-picker.js",_=i.defineComponent({name:"UniDatetimePicker",options:{virtualHost:!0},components:{Calendar:k,TimePicker:C},data(){return{isRange:!1,hasTime:!1,displayValue:"",inputDate:"",calendarDate:"",pickerTime:"",calendarRange:new UTSJSONObject({startDate:"",startTime:"",endDate:"",endTime:""}),displayRangeValue:new UTSJSONObject({startDate:"",endDate:""}),tempRange:new UTSJSONObject({startDate:"",startTime:"",endDate:"",endTime:""}),startMultipleStatus:new UTSJSONObject({before:"",after:"",data:[],fulldate:""}),endMultipleStatus:new UTSJSONObject({before:"",after:"",data:[],fulldate:""}),pickerVisible:!1,pickerPositionStyle:null,isEmitValue:!1,isPhone:!1,isFirstShow:!0,i18nT:()=>{}}},props:{type:{type:String,default:"datetime"},value:{type:[String,Number,Array,Date],default:""},modelValue:{type:[String,Number,Array,Date],default:""},start:{type:[Number,String],default:""},end:{type:[Number,String],default:""},returnType:{type:String,default:"string"},placeholder:{type:String,default:""},startPlaceholder:{type:String,default:""},endPlaceholder:{type:String,default:""},rangeSeparator:{type:String,default:"-"},border:{type:[Boolean],default:!0},disabled:{type:[Boolean],default:!1},clearIcon:{type:[Boolean],default:!0},hideSecond:{type:[Boolean],default:!1},defaultValue:{type:[String,Object,Array],default:""}},watch:{type:{immediate:!0,handler(e=null){this.hasTime=e.indexOf("time")!==-1,this.isRange=e.indexOf("range")!==-1}},modelValue:{immediate:!0,handler(e=null){if(this.isEmitValue)return this.isEmitValue=!1,null;this.initPicker(e)}},start:{immediate:!0,handler(e=null){if(!e)return null;this.calendarRange.startDate=r.getDate(e),this.hasTime&&(this.calendarRange.startTime=r.getTime(e))}},end:{immediate:!0,handler(e=null){if(!e)return null;this.calendarRange.endDate=r.getDate(e),this.hasTime&&(this.calendarRange.endTime=r.getTime(e,this.hideSecond))}}},computed:{timepickerStartTime(){return(this.isRange?this.tempRange.startDate:this.inputDate)===this.calendarRange.startDate?this.calendarRange.startTime:""},timepickerEndTime(){return(this.isRange?this.tempRange.endDate:this.inputDate)===this.calendarRange.endDate?this.calendarRange.endTime:""},mobileCalendarTime(){const e=new UTSJSONObject({start:this.tempRange.startTime,end:this.tempRange.endTime});return this.isRange?e:this.pickerTime},mobSelectableTime(){return new UTSJSONObject({start:this.calendarRange.startTime,end:this.calendarRange.endTime})},datePopupWidth(){return this.isRange?653:301},singlePlaceholderText(){return this.placeholder||(this.type==="date"?this.selectDateText:this.selectDateTimeText)},startPlaceholderText(){return this.startPlaceholder||this.startDateText},endPlaceholderText(){return this.endPlaceholder||this.endDateText},selectDateText(){return this.i18nT("uni-datetime-picker.selectDate")},selectDateTimeText(){return this.i18nT("uni-datetime-picker.selectDateTime")},selectTimeText(){return this.i18nT("uni-datetime-picker.selectTime")},startDateText(){return this.startPlaceholder||this.i18nT("uni-datetime-picker.startDate")},startTimeText(){return this.i18nT("uni-datetime-picker.startTime")},endDateText(){return this.endPlaceholder||this.i18nT("uni-datetime-picker.endDate")},endTimeText(){return this.i18nT("uni-datetime-picker.endTime")},okText(){return this.i18nT("uni-datetime-picker.ok")},clearText(){return this.i18nT("uni-datetime-picker.clear")},showClearIcon(){return this.clearIcon&&!this.disabled&&(this.displayValue||this.displayRangeValue.startDate&&this.displayRangeValue.endDate)}},created(){this.initI18nT(),this.platform()},methods:{initI18nT(){const e=i.initVueI18n(y.i18nMessages);this.i18nT=e.t},initPicker(e=null){if(!e&&!this.defaultValue||Array.isArray(e)&&!e.length)return this.$nextTick(()=>{this.clear(!1)}),null;if(!Array.isArray(e)&&!this.isRange)e?(this.displayValue=this.inputDate=this.calendarDate=r.getDate(e),this.hasTime&&(this.pickerTime=r.getTime(e,this.hideSecond),this.displayValue=`${this.displayValue} ${this.pickerTime}`)):this.defaultValue&&(this.inputDate=this.calendarDate=r.getDate(this.defaultValue),this.hasTime&&(this.pickerTime=r.getTime(this.defaultValue,this.hideSecond)));else{const s=i.__read(e,2),l=s[0],h=s[1];if(!l&&!h)return null;const t=r.getDate(l),a=r.getTime(l,this.hideSecond),n=r.getDate(h),c=r.getTime(h,this.hideSecond),m=t,u=n;this.displayRangeValue.startDate=this.tempRange.startDate=m,this.displayRangeValue.endDate=this.tempRange.endDate=u,this.hasTime&&(this.displayRangeValue.startDate=`${t} ${a}`,this.displayRangeValue.endDate=`${n} ${c}`,this.tempRange.startTime=a,this.tempRange.endTime=c);const d=new UTSJSONObject({before:t,after:n});this.startMultipleStatus=Object.assign(new UTSJSONObject({}),this.startMultipleStatus,d,new UTSJSONObject({which:"right"})),this.endMultipleStatus=Object.assign(new UTSJSONObject({}),this.endMultipleStatus,d,new UTSJSONObject({which:"left"}))}},updateLeftCale(e=null){const s=this.$refs.left;s.cale.setHoverMultiple(e.after),s.setDate(this.$refs.left.nowDate.fullDate)},updateRightCale(e=null){const s=this.$refs.right;s.cale.setHoverMultiple(e.after),s.setDate(this.$refs.right.nowDate.fullDate)},platform(){if(typeof navigator<"u")return this.isPhone=navigator.userAgent.toLowerCase().indexOf("mobile")!==-1,null;const e=i.index.getWindowInfo().windowWidth;this.isPhone=e<=500,this.windowWidth=e},show(){if(this.$emit("show"),this.disabled)return null;if(this.platform(),this.isPhone)return setTimeout(()=>{this.$refs.mobile.open()},0),null;this.pickerPositionStyle={top:"10px"},i.index.createSelectorQuery().in(this).select(".uni-date-editor").boundingClientRect((s=null)=>{this.windowWidth-s.left<this.datePopupWidth&&(this.pickerPositionStyle.right=0)}).exec(),setTimeout(()=>{if(this.pickerVisible=!this.pickerVisible,!this.isPhone&&this.isRange&&this.isFirstShow){this.isFirstShow=!1;const s=this.calendarRange,l=s.startDate,h=s.endDate;l&&h?this.diffDate(l,h)<30&&this.$refs.right.changeMonth("pre"):this.isPhone&&(this.$refs.right.cale.lastHover=!1)}},50)},close(){setTimeout(()=>{this.pickerVisible=!1,this.$emit("maskClick",this.value),this.$refs.mobile&&this.$refs.mobile.close()},20)},setEmit(e=null){(this.returnType==="timestamp"||this.returnType==="date")&&(Array.isArray(e)?(this.hasTime||(e[0]=e[0]+" 00:00:00",e[1]=e[1]+" 00:00:00"),e[0]=this.createTimestamp(e[0]),e[1]=this.createTimestamp(e[1]),this.returnType==="date"&&(e[0]=new Date(e[0]),e[1]=new Date(e[1]))):(this.hasTime||(e=e+" 00:00:00"),e=this.createTimestamp(e),this.returnType==="date"&&(e=new Date(e)))),this.$emit("update:modelValue",e),this.$emit("input",e),this.$emit("change",e),this.isEmitValue=!0},createTimestamp(e=null){return e=r.fixIosDateFormat(e),Date.parse(new Date(e))},singleChange(e=null){if(this.calendarDate=this.inputDate=e.fulldate,this.hasTime)return null;this.confirmSingleChange()},confirmSingleChange(){var e,s,l,h;if(!r.checkDate(this.inputDate)){const d=new Date;this.calendarDate=this.inputDate=r.getDate(d),this.pickerTime=r.getTime(d,this.hideSecond)}let t=!1,a=null,n=null;if(this.start){let d=this.start;typeof this.start=="number"&&(d=r.getDateTime(this.start,this.hideSecond)),e=d.split(" "),s=i.__read(e,2),a=s[0],n=s[1],this.start&&!r.dateCompare(a,this.inputDate)&&(t=!0,this.inputDate=a)}let c=!1,m=null,u=null;if(this.end){let d=this.end;typeof this.end=="number"&&(d=r.getDateTime(this.end,this.hideSecond)),l=d.split(" "),h=i.__read(l,2),m=h[0],u=h[1],this.end&&!r.dateCompare(this.inputDate,m)&&(c=!0,this.inputDate=m)}this.hasTime?(t&&(this.pickerTime=n||r.getDefaultSecond(this.hideSecond)),c&&(this.pickerTime=u||r.getDefaultSecond(this.hideSecond)),this.pickerTime||(this.pickerTime=r.getTime(Date.now(),this.hideSecond)),this.displayValue=`${this.inputDate} ${this.pickerTime}`):this.displayValue=this.inputDate,this.setEmit(this.displayValue),this.pickerVisible=!1},leftChange(e=null){const s=e.range,l=s.before,h=s.after;this.rangeChange(l,h);const t=new UTSJSONObject({before:e.range.before,after:e.range.after,data:e.range.data,fulldate:e.fulldate});this.startMultipleStatus=Object.assign(new UTSJSONObject({}),this.startMultipleStatus,t),this.$emit("calendarClick",e)},rightChange(e=null){const s=e.range,l=s.before,h=s.after;this.rangeChange(l,h);const t=new UTSJSONObject({before:e.range.before,after:e.range.after,data:e.range.data,fulldate:e.fulldate});this.endMultipleStatus=Object.assign(new UTSJSONObject({}),this.endMultipleStatus,t),this.$emit("calendarClick",e)},mobileChange(e=null){if(this.isRange){const s=e.range,l=s.before,h=s.after;if(!l)return null;if(this.handleStartAndEnd(l,h,!0),this.hasTime){const t=e.timeRange,a=t.startTime,n=t.endTime;this.tempRange.startTime=a,this.tempRange.endTime=n}this.confirmRangeChange()}else this.hasTime?this.displayValue=e.fulldate+" "+e.time:this.displayValue=e.fulldate,this.setEmit(this.displayValue),this.calendarDate=this.displayValue;this.$refs.mobile.close()},rangeChange(e=null,s=null){if(!(e&&s)||(this.handleStartAndEnd(e,s,!0),this.hasTime))return null;this.confirmRangeChange()},confirmRangeChange(){var e,s,l,h,t,a;if(!this.tempRange.startDate||!this.tempRange.endDate)return this.pickerVisible=!1,null;r.checkDate(this.tempRange.startDate)||(this.tempRange.startDate=r.getDate(Date.now())),r.checkDate(this.tempRange.endDate)||(this.tempRange.endDate=r.getDate(Date.now()));let n=null,c=null,m=!1,u=!1,d=null,o=null,p=this.tempRange.startDate,f=this.tempRange.endDate;if(this.hasTime&&(p=`${this.tempRange.startDate} ${this.tempRange.startTime}`,f=`${this.tempRange.endDate} ${this.tempRange.endTime}`),this.start){let g=this.start;typeof this.start=="number"&&(g=r.getDateTime(this.start,this.hideSecond)),e=g.split(" "),s=i.__read(e,2),d=s[0],o=s[1],this.start&&!r.dateCompare(this.start,p)&&(m=!0,this.tempRange.startDate=d),this.start&&!r.dateCompare(this.start,f)&&(u=!0,this.tempRange.endDate=d)}let R=!1,S=!1,T=null,D=null;if(this.end){let g=this.end;typeof this.end=="number"&&(g=r.getDateTime(this.end,this.hideSecond)),l=g.split(" "),h=i.__read(l,2),T=h[0],D=h[1],this.end&&!r.dateCompare(p,this.end)&&(R=!0,this.tempRange.startDate=T),this.end&&!r.dateCompare(f,this.end)&&(S=!0,this.tempRange.endDate=T)}this.hasTime?(m?this.tempRange.startTime=o||r.getDefaultSecond(this.hideSecond):R&&(this.tempRange.startTime=D||r.getDefaultSecond(this.hideSecond)),this.tempRange.startTime||(this.tempRange.startTime=r.getTime(Date.now(),this.hideSecond)),u?this.tempRange.endTime=o||r.getDefaultSecond(this.hideSecond):S&&(this.tempRange.endTime=D||r.getDefaultSecond(this.hideSecond)),this.tempRange.endTime||(this.tempRange.endTime=r.getTime(Date.now(),this.hideSecond)),n=this.displayRangeValue.startDate=`${this.tempRange.startDate} ${this.tempRange.startTime}`,c=this.displayRangeValue.endDate=`${this.tempRange.endDate} ${this.tempRange.endTime}`):(n=this.displayRangeValue.startDate=this.tempRange.startDate,c=this.displayRangeValue.endDate=this.tempRange.endDate),r.dateCompare(n,c)||(t=[c,n],a=i.__read(t,2),n=a[0],c=a[1]),this.displayRangeValue.startDate=n,this.displayRangeValue.endDate=c;const b=[n,c];this.setEmit(b),this.pickerVisible=!1},handleStartAndEnd(e=null,s=null,l=!1){if(!e)return null;s||(s=e);const h=l?"tempRange":"range",t=r.dateCompare(e,s);this[h].startDate=t?e:s,this[h].endDate=t?s:e},dateCompare(e=null,s=null){return e=new Date(e.replace("-","/").replace("-","/")),s=new Date(s.replace("-","/").replace("-","/")),e<=s},diffDate(e=null,s=null){e=new Date(e.replace("-","/").replace("-","/")),s=new Date(s.replace("-","/").replace("-","/"));const l=(s-e)/(24*60*60*1e3);return Math.abs(l)},clear(e=!0){this.isRange?(this.displayRangeValue.startDate="",this.displayRangeValue.endDate="",this.tempRange.startDate="",this.tempRange.startTime="",this.tempRange.endDate="",this.tempRange.endTime="",this.isPhone?this.$refs.mobile&&this.$refs.mobile.clearCalender():(this.$refs.left&&this.$refs.left.clearCalender(),this.$refs.right&&this.$refs.right.clearCalender(),this.$refs.right&&this.$refs.right.changeMonth("next")),e&&(this.$emit("change",[]),this.$emit("input",[]),this.$emit("update:modelValue",[]))):(this.displayValue="",this.inputDate="",this.pickerTime="",this.isPhone?this.$refs.mobile&&this.$refs.mobile.clearCalender():this.$refs.pcSingle&&this.$refs.pcSingle.clearCalender(),e&&(this.$emit("change",""),this.$emit("input",""),this.$emit("update:modelValue","")))},calendarClick(e=null){this.$emit("calendarClick",e)}}});if(!Array){const e=i.resolveComponent("uni-icons"),s=i.resolveComponent("time-picker"),l=i.resolveComponent("Calendar");(e+s+l)()}const w=()=>"../../../uni-icons/components/uni-icons/uni-icons.js";Math||w();function V(e,s,l,h,t,a){return i.e({a:!t.isRange},t.isRange?{d:i.p({type:"calendar",color:"#c0c4cc",size:"22"}),e:i.t(t.displayRangeValue.startDate||a.startPlaceholderText),f:i.t(l.rangeSeparator),g:i.t(t.displayRangeValue.endDate||a.endPlaceholderText)}:{b:i.p({type:"calendar",color:"#c0c4cc",size:"22"}),c:i.t(t.displayValue||a.singlePlaceholderText)},{h:a.showClearIcon},a.showClearIcon?{i:i.p({type:"clear",color:"#c0c4cc",size:"22"}),j:i.o((...n)=>a.clear&&a.clear(...n))}:{},{k:l.disabled?1:"",l:l.border?1:"",m:i.o((...n)=>a.show&&a.show(...n)),n:t.pickerVisible,o:i.o((...n)=>a.close&&a.close(...n)),p:!t.isPhone},t.isPhone?{}:i.e({q:!t.isRange},t.isRange?i.e({J:t.hasTime},t.hasTime?{K:a.startDateText,L:t.tempRange.startDate,M:i.o(n=>t.tempRange.startDate=n.detail.value),N:a.startTimeText,O:!t.tempRange.startDate,P:t.tempRange.startTime,Q:i.o(n=>t.tempRange.startTime=n.detail.value),R:i.o(n=>t.tempRange.startTime=n),S:i.p({type:"time",start:a.timepickerStartTime,border:!1,disabled:!t.tempRange.startDate,hideSecond:l.hideSecond,modelValue:t.tempRange.startTime}),T:i.p({type:"arrowthinright",color:"#999"}),U:a.endDateText,V:t.tempRange.endDate,W:i.o(n=>t.tempRange.endDate=n.detail.value),X:a.endTimeText,Y:!t.tempRange.endDate,Z:t.tempRange.endTime,aa:i.o(n=>t.tempRange.endTime=n.detail.value),ab:i.o(n=>t.tempRange.endTime=n),ac:i.p({type:"time",end:a.timepickerEndTime,border:!1,disabled:!t.tempRange.endDate,hideSecond:l.hideSecond,modelValue:t.tempRange.endTime})}:{},{ad:i.sr("left","c730e572-8"),ae:i.o(a.leftChange),af:i.o(a.updateRightCale),ag:i.p({showMonth:!1,"start-date":t.calendarRange.startDate,"end-date":t.calendarRange.endDate,range:!0,pleStatus:t.endMultipleStatus}),ah:i.sr("right","c730e572-9"),ai:i.o(a.rightChange),aj:i.o(a.updateLeftCale),ak:i.p({showMonth:!1,"start-date":t.calendarRange.startDate,"end-date":t.calendarRange.endDate,range:!0,pleStatus:t.startMultipleStatus}),al:t.hasTime},t.hasTime?{am:i.t(a.clearText),an:i.o((...n)=>a.clear&&a.clear(...n)),ao:i.t(a.okText),ap:i.o((...n)=>a.confirmRangeChange&&a.confirmRangeChange(...n))}:{},{aq:i.s(t.pickerPositionStyle)}):i.e({r:t.hasTime},t.hasTime?{s:a.selectDateText,t:t.inputDate,v:i.o(n=>t.inputDate=n.detail.value),w:a.selectTimeText,x:!t.inputDate,y:t.pickerTime,z:i.o(n=>t.pickerTime=n.detail.value),A:i.o(n=>t.pickerTime=n),B:i.p({type:"time",border:!1,disabled:!t.inputDate,start:a.timepickerStartTime,end:a.timepickerEndTime,hideSecond:l.hideSecond,modelValue:t.pickerTime})}:{},{C:i.sr("pcSingle","c730e572-4"),D:i.o(a.singleChange),E:i.p({showMonth:!1,"start-date":t.calendarRange.startDate,"end-date":t.calendarRange.endDate,date:t.calendarDate,"default-value":l.defaultValue}),F:t.hasTime},t.hasTime?{G:i.t(a.okText),H:i.o((...n)=>a.confirmSingleChange&&a.confirmSingleChange(...n))}:{},{I:i.s(t.pickerPositionStyle)}),{ar:i.sei("r0-c730e572","view","datePicker"),as:t.pickerVisible}),{at:t.isPhone},t.isPhone?{av:i.sr("mobile","c730e572-10"),aw:i.o(a.mobileChange),ax:i.o(a.close),ay:i.o(a.calendarClick),az:i.p({clearDate:!1,date:t.calendarDate,defTime:a.mobileCalendarTime,"start-date":t.calendarRange.startDate,"end-date":t.calendarRange.endDate,selectableTimes:a.mobSelectableTime,startPlaceholder:l.startPlaceholder,endPlaceholder:l.endPlaceholder,"default-value":l.defaultValue,pleStatus:t.endMultipleStatus,showMonth:!1,range:t.isRange,hasTime:t.hasTime,insert:!1,hideSecond:l.hideSecond})}:{},{aA:i.sei(i.gei(e,""),"view")})}const P=i._export_sfc(_,[["render",V]]);wx.createComponent(P);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js.map
