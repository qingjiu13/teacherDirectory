{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * c-lottie Lottie组件\n * @property {String} canvasId 画布id\n * @property {String} width 图像宽度 默认750rpx 单位rpx/px\n * @property {String} height 图像高度 默认750rpx 单位rpx/px\n * @property {String} src Lottie文件地址 小程序只支持网络地址\n * @property {String} data Lottie文件data\n * @property {Boolean} autoPlay 是否自动播放 默认true\n * @property {Boolean} loop 是否循环播放 默认值为 true\n * @property {String} renderer 渲染模式 默认值为canvas 可选值 svg|canvas 小程序不支持\n * @property {Boolean} isOnChange 是否开启播放进度监听 默认false false时不触发EnterFrame\n * @event {Function()} Complete 监听动画播放完成\n * @event {Function()} LoopComplete 监听当前循环播放完成\n * @event {Function()} EnterFrame 监听动画播放进度\n * @event {Function()} SegmentStart 监听开始播放一个动画片段\n * @event {Function()} dataReady 当动画的所有部分都已加载时触发\n * @event {Function()} dataFailed 当部分动画无法加载时触发\n * 组件内方法统一使用 call(funName, args) 调用player实例方法 详见文档\n * */\nimport uuid from './js/uuid.js';\nimport lottie from 'lottie-miniprogram';\nexport default defineComponent({\n    props: {\n        canvasId: {\n            type: String\n        },\n        width: {\n            type: String,\n            default: '750rpx'\n        },\n        height: {\n            type: String,\n            default: '750rpx'\n        },\n        src: {\n            type: String,\n        },\n        data: {\n            type: String,\n        },\n        autoPlay: {\n            type: Boolean,\n            default: true\n        },\n        loop: {\n            type: Boolean,\n            default: true\n        },\n        renderer: {\n            type: String,\n            default: 'canvas',\n        },\n        isOnChange: {\n            type: Boolean,\n            default: false\n        }\n    },\n    emits: ['Complete', 'LoopComplete', 'EnterFrame', 'SegmentStart', 'dataReady', 'dataFailed'],\n    data() {\n        return {\n            fun: new UTSJSONObject({})\n        };\n    },\n    computed: {\n        myCanvasId() {\n            if (!this.canvasId) {\n                return 'c' + uuid(18);\n            }\n            else {\n                return this.canvasId;\n            }\n        },\n        lottieData() {\n            return new UTSJSONObject({\n                myCanvasId: this.myCanvasId,\n                width: this.width,\n                height: this.height,\n                src: this.src,\n                data: this.data,\n                autoPlay: this.autoPlay,\n                loop: this.loop,\n                renderer: this.renderer,\n                isOnChange: this.isOnChange\n            });\n        }\n    },\n    watch: {\n        lottieData() {\n            this.render();\n        }\n    },\n    methods: {\n        call(name = null, args = null) {\n            this.fun = new UTSJSONObject({ name, args });\n            this.callPlayer(this.fun);\n        },\n        getContext() {\n            return new Promise((resolve) => {\n                const pixelRatio = uni.getWindowInfo().pixelRatio;\n                uni.createSelectorQuery()\n                    .in(this)\n                    .select(`#${this.myCanvasId}`)\n                    .fields(new UTSJSONObject({\n                    node: true,\n                    size: true\n                }))\n                    .exec(res => {\n                    const _a = res[0], width = _a.width, height = _a.height;\n                    const canvas = res[0].node;\n                    resolve({\n                        canvas,\n                        width,\n                        height,\n                        pixelRatio\n                    });\n                });\n            });\n        },\n        render() {\n            return __awaiter(this, void 0, void 0, function* () {\n                if (this.player) {\n                    // uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:149',player);\n                    // call('stop')\n                    this.call('destroy', this.player);\n                }\n                let _a = yield this.getContext(), canvas = _a.canvas, width = _a.width, height = _a.height, pixelRatio = _a.pixelRatio;\n                this.myCanvas = canvas;\n                this.context = canvas.getContext('2d');\n                //避免出现锯齿问题\n                this.context.scale(pixelRatio, pixelRatio);\n                canvas.width = width * pixelRatio;\n                canvas.height = height * pixelRatio;\n                lottie.setup(this.myCanvas);\n                this.player = lottie.loadAnimation({\n                    loop: this.loop,\n                    autoplay: this.autoPlay,\n                    // 动画json的本地数据\n                    animationData: this.data,\n                    //远程动画。一定要把json格式的文件放到服务器中，并且注意域名是合法的\n                    path: this.src,\n                    rendererSettings: {\n                        context: this.context,\n                    },\n                });\n                this.player.addEventListener('data_ready', (val = null) => {\n                    this.$emit('dataReady', val);\n                });\n                this.player.addEventListener('data_failed', (val = null) => {\n                    this.$emit('dataFailed', val);\n                });\n                this.player.onComplete = (val = null) => {\n                    // uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:184','动画播放完成触发',val);\n                    this.$emit('Complete', val);\n                };\n                this.player.onLoopComplete = (val = null) => {\n                    // uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:188','当前循环播放完成触发',val);\n                    this.$emit('LoopComplete', val);\n                };\n                if (this.isOnChange) {\n                    this.player.onEnterFrame = (val = null) => {\n                        // uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:193','播放动画的时候触发',val);\n                        this.$emit('EnterFrame', val);\n                    };\n                }\n                this.player.onSegmentStart = (val = null) => {\n                    // uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:198','开始播放一个动画片段的时候触发',val);\n                    this.$emit('SegmentStart', val);\n                };\n            });\n        },\n        callPlayer(val = null) {\n            if (!val.name)\n                return null;\n            let name = val.name, args = val.args;\n            // uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:206',name, args);\n            if (Array.isArray(args)) {\n                this.player[name](...args);\n            }\n            else {\n                this.player[name](args);\n            }\n        },\n    },\n    mounted() {\n        this.render();\n    },\n    beforeDestroy() {\n        // 组件卸载销毁实例\n        this.call('destroy');\n    }\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/uni_modules/c-lottie/components/c-lottie/c-lottie.vue?vue&type=script&lang.uts.js.map","references":["E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/uni_modules/c-lottie/components/c-lottie/js/uuid.js","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/uni_modules/c-lottie/node_modules/lottie-miniprogram/miniprogram_dist/index.d.ts"],"uniExtApis":["uni.getWindowInfo","uni.createSelectorQuery"],"map":"{\"version\":3,\"file\":\"c-lottie.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"c-lottie.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\";;AACC;;;;;;;;;;;;;;;;;;KAkBK;AACL,OAAO,IAAI,MAAM,cAAc,CAAA;AAE/B,OAAO,MAAM,MAAM,oBAAoB,CAAA;AAKvC,+BAAe;IACd,KAAK,EAAE;QACN,QAAQ,EAAE;YACT,IAAI,EAAE,MAAM;SACZ;QACD,KAAK,EAAE;YACN,IAAI,EAAE,MAAM;YACZ,OAAO,EAAE,QAAQ;SACjB;QACD,MAAM,EAAE;YACP,IAAI,EAAE,MAAM;YACZ,OAAO,EAAE,QAAQ;SACjB;QACD,GAAG,EAAE;YACJ,IAAI,EAAE,MAAM;SACZ;QACD,IAAI,EAAE;YACL,IAAI,EAAE,MAAM;SACZ;QACD,QAAQ,EAAE;YACT,IAAI,EAAE,OAAO;YACb,OAAO,EAAE,IAAI;SACb;QACD,IAAI,EAAE;YACL,IAAI,EAAE,OAAO;YACb,OAAO,EAAE,IAAI;SACb;QACD,QAAQ,EAAE;YACT,IAAI,EAAE,MAAM;YACZ,OAAO,EAAE,QAAQ;SACjB;QACD,UAAU,EAAE;YACX,IAAI,EAAE,OAAO;YACb,OAAO,EAAE,KAAK;SACd;KACD;IACD,KAAK,EAAE,CAAC,UAAU,EAAE,cAAc,EAAE,YAAY,EAAE,cAAc,EAAC,WAAW,EAAC,YAAY,CAAC;IAC1F,IAAI;QACH,OAAO;YACN,GAAG,oBAAE,EAAE,CAAA;SACP,CAAA;IACF,CAAC;IACD,QAAQ,EAAE;QACT,UAAU;YACT,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;gBACnB,OAAO,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC,CAAA;aACrB;iBAAM;gBACN,OAAO,IAAI,CAAC,QAAQ,CAAA;aACpB;QACF,CAAC;QACD,UAAU;YACT,yBAAO;gBACN,UAAU,EAAE,IAAI,CAAC,UAAU;gBAC3B,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,MAAM,EAAE,IAAI,CAAC,MAAM;gBACnB,GAAG,EAAE,IAAI,CAAC,GAAG;gBACb,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,UAAU,EAAE,IAAI,CAAC,UAAU;aAC3B,EAAA;QACF,CAAC;KACD;IACD,KAAK,EAAE;QACN,UAAU;YAET,IAAI,CAAC,MAAM,EAAE,CAAA;QAEd,CAAC;KACD;IACD,OAAO,EAAE;QACR,IAAI,CAAC,IAAI,OAAA,EAAE,IAAI,OAAA;YACd,IAAI,CAAC,GAAG,qBAAG,EAAC,IAAI,EAAC,IAAI,EAAC,CAAA,CAAA;YAEtB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAE1B,CAAC;QAED,UAAU;YACT,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO;gBAEzB,MAAA,UAAU,GACP,GAAG,CAAC,aAAa,EAAE,WADZ,CACY;gBACvB,GAAG,CAAC,mBAAmB,EAAE;qBACvB,EAAE,CAAC,IAAI,CAAC;qBACR,MAAM,CAAC,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;qBAC7B,MAAM,mBAAC;oBACP,IAAI,EAAE,IAAI;oBACV,IAAI,EAAE,IAAI;iBACV,EAAC;qBACD,IAAI,CAAC,GAAG;oBACF,MAAA,KAGF,GAAG,CAAC,CAAC,CAAC,EAFT,KAAK,WAAA,EACL,MAAM,YACG,CAAA;oBACV,MAAM,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAA;oBAC1B,OAAO,CAAC;wBACP,MAAM;wBACN,KAAK;wBACL,MAAM;wBACN,UAAU;qBACV,CAAC,CAAA;gBACH,CAAC,CAAC,CAAA;YACJ,CAAC,CAAC,CAAA;QACH,CAAC;QACK,MAAM;;gBACX,IAAI,IAAI,CAAC,MAAM,EAAE;oBAChB,0FAA0F;oBAC1F,eAAe;oBACf,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;iBACjC;gBACG,IAAA,KAKA,MAAM,IAAI,CAAC,UAAU,EAAE,EAJ1B,MAAM,YAAA,EACN,KAAK,WAAA,EACL,MAAM,YAAA,EACN,UAAU,gBACgB,CAAA;gBAC3B,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAA;gBACtB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAA;gBACtC,UAAU;gBACV,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,UAAU,CAAC,CAAA;gBAC1C,MAAM,CAAC,KAAK,GAAG,KAAK,GAAG,UAAU,CAAA;gBACjC,MAAM,CAAC,MAAM,GAAG,MAAM,GAAG,UAAU,CAAA;gBACnC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;gBAC3B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,aAAa,CAAC;oBAClC,IAAI,EAAE,IAAI,CAAC,IAAI;oBACf,QAAQ,EAAE,IAAI,CAAC,QAAQ;oBACvB,cAAc;oBACd,aAAa,EAAE,IAAI,CAAC,IAAI;oBACxB,qCAAqC;oBACrC,IAAI,EAAE,IAAI,CAAC,GAAG;oBACd,gBAAgB,EAAE;wBACjB,OAAO,EAAC,IAAI,CAAC,OAAO;qBACpB;iBACD,CAAC,CAAA;gBACF,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,YAAY,EAAC,CAAC,GAAG,OAAA;oBAC7C,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,GAAG,CAAC,CAAA;gBAC7B,CAAC,CAAC,CAAA;gBACF,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,aAAa,EAAC,CAAC,GAAG,OAAA;oBAC9C,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,GAAG,CAAC,CAAA;gBAC9B,CAAC,CAAC,CAAA;gBACF,IAAI,CAAC,MAAM,CAAC,UAAU,GAAG,CAAC,GAAG,OAAA;oBAC5B,kGAAkG;oBAClG,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,GAAG,CAAC,CAAA;gBAC5B,CAAC,CAAA;gBACD,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,CAAC,GAAG,OAAA;oBAChC,oGAAoG;oBACpG,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE,GAAG,CAAC,CAAA;gBAChC,CAAC,CAAA;gBACD,IAAI,IAAI,CAAC,UAAU,EAAE;oBACpB,IAAI,CAAC,MAAM,CAAC,YAAY,GAAG,CAAC,GAAG,OAAA;wBAC9B,mGAAmG;wBACnG,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,GAAG,CAAC,CAAA;oBAC9B,CAAC,CAAA;iBACD;gBACD,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,CAAC,GAAG,OAAA;oBAChC,yGAAyG;oBACzG,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE,GAAG,CAAC,CAAA;gBAChC,CAAC,CAAA;YAEF,CAAC;SAAA;QACD,UAAU,CAAC,GAAG,OAAA;YACb,IAAI,CAAC,GAAG,CAAC,IAAI;gBAAE,YAAO;YACjB,IAAA,IAAI,GAAS,GAAG,KAAZ,EAAC,IAAI,GAAI,GAAG,KAAP,CAAO;YACrB,8FAA8F;YAC9F,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;gBACxB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAA;aAC1B;iBAAM;gBACN,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAA;aACvB;QACF,CAAC;KAQD;IACD,OAAO;QAEN,IAAI,CAAC,MAAM,EAAE,CAAA;IAEd,CAAC;IACD,aAAa;QACZ,WAAW;QACX,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;IACrB,CAAC;CAED,EAAA\"}"}
