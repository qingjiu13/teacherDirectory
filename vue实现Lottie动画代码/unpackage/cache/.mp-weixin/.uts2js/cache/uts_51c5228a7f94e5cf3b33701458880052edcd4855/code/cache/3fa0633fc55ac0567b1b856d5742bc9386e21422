{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    name: \"chat-record\",\n    data() {\n        return {\n            recording: false,\n            moveToCancel: false,\n            recordBarTop: 0,\n            druation: 0,\n            rcTimer: null\n        };\n    },\n    methods: {\n        onTouchMove(e = null) {\n            const moveY = e.touches[0].clientY;\n            this.moveToCancel = moveY < this.recordBarTop - 40;\n        },\n        onCancel() {\n            if (this.recording) {\n                this.moveToCancel = true;\n                this.onEndRecord();\n            }\n        },\n        onStartRecord() {\n            /* 用户第一次使用语音会唤醒录音权限请求，此时会导致@touchend失效，\n                一直处于录音状态，这里允许用户再次点击发送语音并结束录音 */\n            if (this.recording) {\n                return null;\n            }\n            uni.__f__('log', 'at pagesChat/components/chat-record/chat-record.vue:55', \"开始录音\");\n            this.moveToCancel = false;\n            this.initRecordBar();\n            if (!this.$rc.checkIsEnable()) {\n                return null;\n            }\n            this.$rc.start().then(() => {\n                this.recording = true;\n                uni.__f__('log', 'at pagesChat/components/chat-record/chat-record.vue:63', \"开始录音成功\");\n                // 开始计时\n                this.startTimer();\n            }).catch((e = null) => {\n                uni.__f__('log', 'at pagesChat/components/chat-record/chat-record.vue:67', \"录音失败\" + UTS.JSON.stringify(e));\n                uni.showToast({\n                    title: \"录音失败\",\n                    icon: \"none\"\n                });\n            });\n        },\n        onEndRecord() {\n            if (!this.recording) {\n                return null;\n            }\n            this.recording = false;\n            // 停止计时\n            this.stopTimer();\n            // 停止录音\n            this.$rc.close();\n            // 触屏位置是否移动到了取消区域\n            if (this.moveToCancel) {\n                uni.__f__('log', 'at pagesChat/components/chat-record/chat-record.vue:85', \"录音取消\");\n                return null;\n            }\n            // 大于1秒才发送\n            if (this.druation <= 1) {\n                uni.showToast({\n                    title: \"说话时间太短\",\n                    icon: 'none'\n                });\n                return null;\n            }\n            this.$rc.upload().then((data = null) => {\n                this.$emit(\"send\", data);\n            }).catch((e = null) => {\n                uni.showToast({\n                    title: e,\n                    icon: 'none'\n                });\n            });\n        },\n        startTimer() {\n            this.druation = 0;\n            this.stopTimer();\n            this.rcTimer = setInterval(() => {\n                this.druation++;\n                // 大于60s,直接结束\n                if (this.druation >= 60) {\n                    this.onEndRecord();\n                }\n            }, 1000);\n        },\n        stopTimer() {\n            this.rcTimer && clearInterval(this.rcTimer);\n            this.rcTimer = null;\n        },\n        initRecordBar() {\n            const query = uni.createSelectorQuery().in(this);\n            query.select('#chat-record-bar').boundingClientRect((rect = null) => {\n                // 顶部高度位置\n                this.recordBarTop = rect.top;\n            }).exec();\n        }\n    },\n    computed: {\n        recordWindowStyle() {\n            const windowHeight = uni.getSystemInfoSync().windowHeight;\n            const bottom = windowHeight - this.recordBarTop + 12;\n            return `bottom:${bottom}px;`;\n        },\n        recordTip() {\n            if (this.druation > 50) {\n                return `${60 - this.druation}s后将停止录音`;\n            }\n            return `录音时长:${this.druation}s`;\n        }\n    },\n    unmounted() {\n        this.stopTimer();\n        this.recording = false;\n    }\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pagesChat/components/chat-record/chat-record.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.__f__","uni.showToast","uni.createSelectorQuery","uni.getSystemInfoSync"],"map":"{\"version\":3,\"file\":\"chat-record.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"chat-record.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\";AACA,+BAAe;IACd,IAAI,EAAE,aAAa;IACnB,IAAI;QACH,OAAO;YACN,SAAS,EAAE,KAAK;YAChB,YAAY,EAAE,KAAK;YACnB,YAAY,EAAE,CAAC;YACf,QAAQ,EAAE,CAAC;YACX,OAAO,EAAE,IAAI;SACb,CAAA;IACF,CAAC;IACD,OAAO,EAAE;QACR,WAAW,CAAC,CAAC,OAAA;YACZ,MAAM,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;YACnC,IAAI,CAAC,YAAY,GAAG,KAAK,GAAG,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACpD,CAAC;QACD,QAAQ;YACP,IAAI,IAAI,CAAC,SAAS,EAAE;gBACnB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBACzB,IAAI,CAAC,WAAW,EAAE,CAAC;aACnB;QACF,CAAC;QACD,aAAa;YACZ;+CACgC;YAChC,IAAI,IAAI,CAAC,SAAS,EAAE;gBACnB,YAAO;aACP;YACD,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,wDAAwD,EAAC,MAAM,CAAC,CAAA;YAChF,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC1B,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAG,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,EAAC;gBAC5B,YAAO;aACP;YACD,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC;gBACrB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;gBACtB,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,wDAAwD,EAAC,QAAQ,CAAC,CAAA;gBAClF,OAAO;gBACP,IAAI,CAAC,UAAU,EAAE,CAAC;YACnB,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAA;gBACV,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,wDAAwD,EAAC,MAAM,GAAG,SAAK,SAAS,CAAC,CAAC,CAAC,CAAC,CAAA;gBACpG,GAAG,CAAC,SAAS,CAAC;oBACb,KAAK,EAAE,MAAM;oBACb,IAAI,EAAE,MAAM;iBACZ,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC;QACJ,CAAC;QACD,WAAW;YACV,IAAG,CAAC,IAAI,CAAC,SAAS,EAAC;gBAClB,YAAO;aACP;YACD,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;YACvB,OAAO;YACP,IAAI,CAAC,SAAS,EAAE,CAAC;YACjB,OAAO;YACP,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;YACjB,iBAAiB;YACjB,IAAI,IAAI,CAAC,YAAY,EAAE;gBACtB,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,wDAAwD,EAAC,MAAM,CAAC,CAAA;gBAChF,YAAO;aACP;YACD,UAAU;YACV,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,EAAE;gBACvB,GAAG,CAAC,SAAS,CAAC;oBACb,KAAK,EAAE,QAAQ;oBACf,IAAI,EAAE,MAAM;iBACZ,CAAC,CAAA;gBACF,YAAO;aACP;YACD,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,CAAC,IAAI,OAAA;gBAC3B,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC1B,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAA;gBACV,GAAG,CAAC,SAAS,CAAC;oBACb,KAAK,EAAE,CAAC;oBACR,IAAI,EAAE,MAAM;iBACZ,CAAC,CAAA;YACH,CAAC,CAAC,CAAA;QACH,CAAC;QACD,UAAU;YACT,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;YAClB,IAAI,CAAC,SAAS,EAAE,CAAC;YACjB,IAAI,CAAC,OAAO,GAAG,WAAW,CAAC;gBAC1B,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAChB,aAAa;gBACb,IAAI,IAAI,CAAC,QAAQ,IAAI,EAAE,EAAE;oBACxB,IAAI,CAAC,WAAW,EAAE,CAAC;iBACnB;YACF,CAAC,EAAE,IAAI,CAAC,CAAA;QACT,CAAC;QACD,SAAS;YACR,IAAI,CAAC,OAAO,IAAI,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC5C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACrB,CAAC;QACD,aAAa;YACZ,MAAM,KAAK,GAAG,GAAG,CAAC,mBAAmB,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;YACjD,KAAK,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC,kBAAkB,CAAC,CAAC,IAAI,OAAA;gBACxD,SAAS;gBACT,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC;YAC9B,CAAC,CAAC,CAAC,IAAI,EAAE,CAAA;QACV,CAAC;KACD;IACD,QAAQ,EAAE;QACT,iBAAiB;YAChB,MAAM,YAAY,GAAG,GAAG,CAAC,iBAAiB,EAAE,CAAC,YAAY,CAAC;YAC1D,MAAM,MAAM,GAAG,YAAY,GAAG,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YACrD,OAAO,UAAU,MAAM,KAAK,CAAA;QAC7B,CAAC;QACD,SAAS;YACR,IAAI,IAAI,CAAC,QAAQ,GAAG,EAAE,EAAE;gBACvB,OAAO,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,SAAS,CAAC;aACtC;YACD,OAAO,QAAQ,IAAI,CAAC,QAAQ,GAAG,CAAC;QACjC,CAAC;KACD;IACD,SAAS;QACR,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;IACxB,CAAC;CAED,EAAA\"}"}
