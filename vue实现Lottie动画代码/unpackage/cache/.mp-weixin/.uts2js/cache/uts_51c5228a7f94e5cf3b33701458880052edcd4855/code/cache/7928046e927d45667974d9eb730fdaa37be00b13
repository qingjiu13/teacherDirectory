{"code":"import { defineComponent } from \"vue\";\nimport { mapState, mapActions } from 'vuex';\n// 导入时间戳格式化函数\nimport { formatTimestamp } from '../../../components/timeStamp.js';\n/**\n * @description 历史记录侧边栏组件，按时间分组显示\n * @property {Boolean} visible - 侧边栏是否可见\n * @property {Object} groupedHistory - 按时间分组的历史记录\n * @property {String} currentChatId - 当前选中的聊天ID\n * @event {Function} loadChat - 加载聊天历史记录\n * @event {Function} deleteChat - 删除聊天历史记录\n */\nexport default defineComponent({\n    name: \"HistorySidebar\",\n    props: {\n        visible: {\n            type: Boolean,\n            default: false\n        },\n        groupedHistory: {\n            type: Object,\n            default: () => { return (new UTSJSONObject({ today: [], week: [], month: [] })); }\n        },\n        currentChatId: {\n            type: String,\n            default: ''\n        }\n    },\n    computed: Object.assign(Object.assign({}, mapState(new UTSJSONObject({\n        conversations: (state = null) => {\n            try {\n                return state.user && state.user.aiChat && state.user.aiChat.aiChat\n                    ? (state.user.aiChat.aiChat.conversations || [])\n                    : [];\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:145', '获取 conversations 状态出错:', e);\n                return [];\n            }\n        },\n        activeConversation: (state = null) => {\n            try {\n                return state.user && state.user.aiChat && state.user.aiChat.aiChat\n                    ? state.user.aiChat.aiChat.activeConversation\n                    : null;\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:155', '获取 activeConversation 状态出错:', e);\n                return null;\n            }\n        }\n    }))), { \n        /**\n         * @description 按日期分类的历史记录\n         * @returns {Object} 分类后的历史记录\n         */\n        groupedConversationsByDate() {\n            // 获取当前日期、一周前日期和一个月前日期的时间戳\n            const now = new Date();\n            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();\n            const weekAgo = today - 7 * 24 * 60 * 60 * 1000;\n            const monthAgo = today - 30 * 24 * 60 * 60 * 1000;\n            // 分类存储\n            const result = new UTSJSONObject({\n                today: [],\n                week: [],\n                month: []\n            });\n            // 遍历所有对话记录进行分类\n            this.conversations.forEach((conv = null) => {\n                // 使用更新时间作为分类依据\n                const timestamp = conv.updatedAt || conv.createdAt;\n                // 格式化时间戳用于调试\n                const formattedDate = formatTimestamp(timestamp);\n                uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:186', `对话 ${conv.id} 的时间: ${formattedDate}, 时间戳: ${timestamp}`);\n                if (timestamp >= today) {\n                    result.today.push(conv);\n                }\n                else if (timestamp >= weekAgo) {\n                    result.week.push(conv);\n                }\n                else if (timestamp >= monthAgo) {\n                    result.month.push(conv);\n                }\n            });\n            // 按时间戳倒序排序（最新的在前面）\n            ['today', 'week', 'month'].forEach(key => {\n                result[key].sort((a = null, b = null) => {\n                    const timeA = a.updatedAt || a.createdAt;\n                    const timeB = b.updatedAt || b.createdAt;\n                    return timeB - timeA;\n                });\n            });\n            return result;\n        }, \n        /**\n         * @description 是否有任何历史记录\n         * @returns {Boolean}\n         */\n        hasAnyHistory() {\n            const g = this.groupedHistory;\n            return (g.today && g.today.length) || (g.week && g.week.length) || (g.month && g.month.length);\n        } }),\n    created() {\n        // 添加调试信息\n        uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:220', '=================== 调试信息开始 ===================');\n        uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:221', '完整的 Vuex store:', this.$store);\n        uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:222', 'Vuex store状态:', this.$store.state);\n        if (this.$store.state.user) {\n            uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:225', 'user模块状态:', this.$store.state.user);\n            if (this.$store.state.user.aiChat) {\n                uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:228', 'aiChat模块状态:', this.$store.state.user.aiChat);\n                if (this.$store.state.user.aiChat.aiChat) {\n                    uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:231', '内层 aiChat:', this.$store.state.user.aiChat.aiChat);\n                    uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:232', '内层 aiChat conversations:', this.$store.state.user.aiChat.aiChat.conversations);\n                }\n                else {\n                    uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:234', '无法访问内层 aiChat!');\n                    uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:235', 'aiChat 模块完整内容:', UTS.JSON.stringify(this.$store.state.user.aiChat));\n                }\n            }\n            else {\n                uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:238', '无法访问 aiChat 模块!');\n            }\n        }\n        else {\n            uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:241', '无法访问 user 模块!');\n        }\n        uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:244', '组件计算的 conversations:', this.conversations);\n        uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:245', '组件计算的 historySummaries:', this.historySummaries);\n        uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:246', '组件计算的 currentChatId:', this.currentChatId);\n        uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:247', '=================== 调试信息结束 ===================');\n    },\n    mounted() {\n        // 在组件挂载时初始化对话分类\n        this.initConversationGroups();\n    },\n    methods: Object.assign(Object.assign({}, mapActions(new UTSJSONObject({\n        setActiveConversation: 'user/aiChat/setCurrentChat',\n        deleteConversation: 'user/aiChat/deleteChat'\n    }))), { \n        /**\n         * @description 初始化对话分组\n         */\n        initConversationGroups() {\n            // 初始化对话分组，将分组结果通过事件发送给父组件\n            const groupedConversations = this.groupedConversationsByDate;\n            this.$emit('updateGroups', groupedConversations);\n        },\n        /**\n         * @description 格式化时间戳为人类可读格式\n         * @param {Number} timestamp - 时间戳\n         * @param {String} format - 日期格式\n         * @returns {String} 格式化后的日期字符串\n         */\n        formatDate(timestamp = null, format = 'YYYY-MM-DD') {\n            return formatTimestamp(timestamp, format);\n        }, \n        /**\n         * @description 获取对话模式的中文标签\n         * @param {String} mode - 对话模式\n         * @returns {String} 对话模式的中文标签\n         */\n        getModeLabel(mode = null) {\n            const modeLabels = new UTSJSONObject({\n                'general': '通用',\n                'school': '择校',\n                'career': '职业规划'\n            });\n            return modeLabels[mode] || '通用';\n        }, \n        /**\n         * @description 加载聊天历史\n         * @param {String} chatId - 聊天ID\n         */\n        loadChatHistory(chatId = null) {\n            // 通过 Vuex action 设置当前活跃的对话\n            this.setActiveConversation(chatId);\n            // 如果需要加载完整对话内容，还可以添加这个 action 调用\n            // this.$store.dispatch('user/aiChat/loadChat', chatId);\n            // 通知父组件\n            this.$emit('loadChat', chatId);\n        },\n        /**\n         * @description 删除历史记录\n         * @param {String} chatId - 聊天ID\n         * @param {Event} e - 事件对象，用于阻止冒泡\n         */\n        deleteChatHistory(chatId = null, e = null) {\n            // 确保阻止事件冒泡，避免触发点击加载历史记录\n            if (e) {\n                e.stopPropagation();\n                e.preventDefault();\n            }\n            uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue:319', '删除历史记录:', chatId);\n            // 通过 Vuex action 删除对话\n            this.deleteConversation(chatId);\n            // 通知父组件\n            this.$emit('deleteChat', chatId);\n        } })\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pages_AI_Login_Match/AI/ai-chat/HistorySidebar.vue?vue&type=script&lang.uts.js.map","references":["E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/vuex/types/index.d.ts","E:/研师录与其他人共享文件/teacherDirectory/vue实现Lottie动画代码/components/timeStamp.js"],"uniExtApis":["uni.__f__"],"map":"{\"version\":3,\"file\":\"HistorySidebar.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"HistorySidebar.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
