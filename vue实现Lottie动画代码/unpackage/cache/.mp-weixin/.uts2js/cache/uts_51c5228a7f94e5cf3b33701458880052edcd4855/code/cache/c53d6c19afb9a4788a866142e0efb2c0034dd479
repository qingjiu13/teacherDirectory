{"code":"import { defineComponent } from \"vue\";\n// 直接引入store获取函数\nimport { getChatStore } from '/pagesChat/main.js';\nimport HeadImage from '/pagesChat/components/head-image/head-image';\nimport VirtualScroller from '/pagesChat/components/virtual-scroller/virtual-scroller';\nexport default defineComponent({\n    name: \"chat-group-readed\",\n    components: {\n        HeadImage,\n        VirtualScroller\n    },\n    data() {\n        return {\n            items: ['已读', '未读'],\n            current: 0,\n            readedMembers: [],\n            unreadMembers: [],\n            chatStore: null\n        };\n    },\n    props: {\n        msgInfo: {\n            type: Object,\n            required: true\n        },\n        groupMembers: {\n            type: Array\n        }\n    },\n    created() {\n        // 获取chatStore\n        try {\n            this.chatStore = getChatStore();\n            // 如果仍然无法获取，则尝试从globalProperties中获取\n            if (!this.chatStore && this.$) {\n                this.chatStore = this.$chatStore;\n            }\n            // 如果仍然无法获取，创建一个模拟对象\n            if (!this.chatStore) {\n                this.chatStore = {\n                    updateMessage: (msgInfo = null, chatInfo = null) => {\n                        uni.__f__('log', 'at pagesChat/components/chat-group-readed/chat-group-readed.vue:80', '使用模拟updateMessage:', msgInfo, chatInfo);\n                    }\n                };\n            }\n        }\n        catch (error) {\n            uni.__f__('error', 'at pagesChat/components/chat-group-readed/chat-group-readed.vue:85', '获取chatStore失败:', error);\n            // 创建一个模拟对象\n            this.chatStore = {\n                updateMessage: (msgInfo = null, chatInfo = null) => {\n                    uni.__f__('log', 'at pagesChat/components/chat-group-readed/chat-group-readed.vue:89', '使用模拟updateMessage:', msgInfo, chatInfo);\n                }\n            };\n        }\n    },\n    methods: {\n        open() {\n            this.$refs.popup.open();\n            this.loadReadedUser();\n        },\n        loadReadedUser() {\n            this.readedMembers = [];\n            this.unreadMembers = [];\n            this.$http(new UTSJSONObject({\n                url: `/message/group/findReadedUsers?groupId=${this.msgInfo.groupId}&messageId=${this.msgInfo.id}`,\n                method: 'Get'\n            })).then((userIds = null) => {\n                this.groupMembers.forEach((member = null) => {\n                    // 发送者和已退群的不显示\n                    if (member.userId == this.msgInfo.sendId || member.quit) {\n                        return null;\n                    }\n                    // 区分已读还是未读\n                    if (userIds.find((userId = null) => { return member.userId == userId; })) {\n                        this.readedMembers.push(member);\n                    }\n                    else {\n                        this.unreadMembers.push(member);\n                    }\n                });\n                this.items[0] = `已读(${this.readedMembers.length})`;\n                this.items[1] = `未读(${this.unreadMembers.length})`;\n                let chatInfo = new UTSJSONObject({\n                    type: 'GROUP',\n                    targetId: this.msgInfo.groupId\n                });\n                let msgInfo = new UTSJSONObject({\n                    id: this.msgInfo.id,\n                    groupId: this.msgInfo.groupId,\n                    readedCount: this.readedMembers.length\n                }\n                // 更新已读人数\n                );\n                // 更新已读人数\n                this.chatStore.updateMessage(msgInfo, chatInfo);\n            });\n        },\n        onClickItem(e = null) {\n            this.current = e.currentIndex;\n        }\n    }\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pagesChat/components/chat-group-readed/chat-group-readed.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.__f__"],"map":"{\"version\":3,\"file\":\"chat-group-readed.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"chat-group-readed.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
