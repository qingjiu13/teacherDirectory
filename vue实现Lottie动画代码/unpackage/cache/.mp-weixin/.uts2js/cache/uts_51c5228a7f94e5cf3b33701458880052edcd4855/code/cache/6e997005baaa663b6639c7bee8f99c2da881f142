{"code":"import { defineComponent } from \"vue\";\nimport UNI_APP from '/pagesChat/env.js';\nexport default defineComponent({\n    name: \"file-upload\",\n    data() {\n        return {\n            fileMap: new Map(),\n            option: new UTSJSONObject({\n                url: UNI_APP.BASE_URL + '/file/upload',\n                name: 'file',\n                header: new UTSJSONObject({\n                    accessToken: uni.getStorageSync('loginInfo').accessToken\n                })\n            })\n        };\n    },\n    props: {\n        maxSize: {\n            type: Number,\n            default: 10\n        },\n        onBefore: {\n            type: Function,\n            default: null\n        },\n        onSuccess: {\n            type: Function,\n            default: null\n        },\n        onError: {\n            type: Function,\n            default: null\n        }\n    },\n    methods: {\n        show() {\n            this.$refs.lsjUpload.show();\n        },\n        hide() {\n            this.$refs.lsjUpload.hide();\n        },\n        onUploadEnd(item = null) {\n            let file = this.fileMap.get(item.path);\n            if (item.type == 'fail') {\n                this.onError(file);\n                return null;\n            }\n            let res = UTS.JSON.parse(item.responseText);\n            if (res.code == 200) {\n                // 上传成功\n                this.onOk(file, res);\n            }\n            else if (res.code == 401) {\n                // token已过期，重新获取token\n                this.refreshToken().then((res = null) => {\n                    let newToken = res.data.accessToken;\n                    this.option.header.accessToken = newToken;\n                    this.$refs.lsjUpload.setData(this.option);\n                    // 重新上传\n                    this.$refs.lsjUpload.upload(file.name);\n                }).catch(() => {\n                    this.onError(file, res);\n                });\n            }\n            else {\n                // 上传失败\n                this.onError(file, res);\n            }\n        },\n        onChange(files = null) {\n            if (!files.size) {\n                return null;\n            }\n            files.forEach((file = null, name = null) => {\n                if (!this.fileMap.has(file.path)) {\n                    this.onBefore && this.onBefore(file);\n                    this.fileMap.set(file.path, file);\n                }\n            });\n        },\n        onOk(file = null, res = null) {\n            this.fileMap.delete(file.path);\n            this.$refs.lsjUpload.clear(file.name);\n            this.onSuccess && this.onSuccess(file, res);\n        },\n        onFailed(file = null, res = null) {\n            this.fileMap.delete(file.path);\n            this.$refs.lsjUpload.clear(file.name);\n            this.onError && this.onError(file, res);\n        },\n        refreshToken() {\n            return new Promise((resolve, reject) => {\n                let loginInfo = uni.getStorageSync('loginInfo');\n                uni.request({\n                    method: 'PUT',\n                    url: UNI_APP.BASE_URL + '/refreshToken',\n                    header: new UTSJSONObject({\n                        refreshToken: loginInfo.refreshToken\n                    }),\n                    success: (res) => {\n                        resolve(res.data);\n                    },\n                    fail: (res) => {\n                        reject(res);\n                    }\n                });\n            });\n        }\n    }\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pagesChat/components/file-upload/file-upload.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uni.request"],"map":"{\"version\":3,\"file\":\"file-upload.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"file-upload.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
