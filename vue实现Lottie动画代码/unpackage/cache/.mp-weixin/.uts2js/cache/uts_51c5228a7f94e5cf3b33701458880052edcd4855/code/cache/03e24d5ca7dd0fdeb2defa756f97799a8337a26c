{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description 输入区域组件，支持流式传输\n * @property {Boolean} isProcessing - 是否正在处理消息\n * @property {String} chatMode - 聊天模式，用于设置topic\n * @event {Function} processing-start - 开始处理消息\n * @event {Function} processing-end - 结束处理消息\n * @event {Function} message-sent - 消息发送完成事件\n * @event {Function} stream-message - 流式消息片段事件\n * @event {Function} stream-complete - 流式传输完成事件\n * @event {Function} stream-error - 流式传输错误事件\n */\nexport default defineComponent({\n    name: \"InputSection\",\n    props: {\n        isProcessing: {\n            type: Boolean,\n            default: false\n        }\n    },\n    data() {\n        return {\n            inputValue: ''\n        };\n    },\n    methods: {\n        /**\n         * @description 发送消息并处理流式回复\n         */\n        sendMessage() {\n            return __awaiter(this, void 0, void 0, function* () {\n                if (!this.inputValue.trim())\n                    return Promise.resolve(null);\n                // 通知父组件开始处理\n                this.$emit('processing-start');\n                try {\n                    const result = yield this.$store.dispatch('user/aiChat/sendQuestion', new UTSJSONObject({\n                        content: this.inputValue.trim(),\n                        // 流式消息回调 - 接收每个消息片段\n                        onMessage: (messageInfo = null) => {\n                            // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:54','🔄 收到流式消息片段:', messageInfo);\n                            // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:55',`   - 片段内容: \"${messageInfo.content}\"`);\n                            // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:56',`   - 累积内容长度: ${messageInfo.fullContent ? messageInfo.fullContent.length : 0}`);\n                            // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:57',`   - 消息序号: ${messageInfo.messageCount || 0}`);\n                            // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:58',`   - 是否完成: ${messageInfo.isComplete}`);\n                            // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:59',`   - 会话ID: ${messageInfo.conversationId}`);\n                            // 通知父组件有新的流式消息片段\n                            this.$emit('stream-message', new UTSJSONObject({\n                                content: messageInfo.content,\n                                fullContent: messageInfo.fullContent,\n                                isComplete: messageInfo.isComplete,\n                                conversationId: messageInfo.conversationId,\n                                messageCount: messageInfo.messageCount,\n                                isTimeout: messageInfo.isTimeout\n                            }));\n                        },\n                        // 流式传输完成回调\n                        onComplete: (finalMessage = null) => {\n                            uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:73', '✅ 流式传输完成:', finalMessage);\n                            uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:74', `   - 最终内容长度: ${finalMessage.content ? finalMessage.content.length : 0}`);\n                            uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:75', `   - 总消息片段数: ${finalMessage.messageCount || 0}`);\n                            uni.__f__('log', 'at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:76', `   - 会话ID: ${finalMessage.conversationId}`);\n                            // 通知父组件流式传输完成\n                            this.$emit('stream-complete', new UTSJSONObject({\n                                content: finalMessage.content,\n                                conversationId: finalMessage.conversationId,\n                                messageCount: finalMessage.messageCount,\n                                isTimeout: finalMessage.isTimeout\n                            }));\n                        },\n                        // 错误处理回调\n                        onError: (error = null) => {\n                            uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:88', '❌ 流式传输错误:', error);\n                            // 通知父组件发生错误\n                            this.$emit('stream-error', error);\n                            // 显示错误提示\n                            uni.showToast({\n                                title: error.message || '发送失败',\n                                icon: 'none'\n                            });\n                        }\n                    }));\n                    if (result.success) {\n                        // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:102','🎉 消息发送流程完成:', result);\n                        // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:103',`   - 最终数据: \"${result.data}\"`);\n                        // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:104',`   - 消息片段总数: ${result.messageCount || 0}`);\n                        // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:105',`   - 流式完成状态: ${result.isStreamComplete ? '✅' : '❌'}`);\n                        // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:106',`   - 是否超时: ${result.isTimeout ? '⚠️' : '✅'}`);\n                        // uni.__f__('log','at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:107',`   - 会话ID: ${result.conversationId}`);\n                        // 清空输入框\n                        this.inputValue = '';\n                        // 通知父组件消息发送成功\n                        this.$emit('message-sent', new UTSJSONObject(Object.assign(Object.assign({}, result), { controller: result.controller // 传递控制器供外部使用\n                         })));\n                    }\n                    else {\n                        uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:117', '❌ 消息发送失败:', result);\n                        // 显示错误信息\n                        uni.showToast({\n                            title: result.message || '发送失败',\n                            icon: 'none'\n                        });\n                    }\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages_AI_Login_Match/AI/ai-chat/InputSection.vue:125', '发送消息出错:', error);\n                    uni.showToast({\n                        title: '发送失败，请重试',\n                        icon: 'none'\n                    });\n                    // 通知父组件发生错误\n                    this.$emit('stream-error', new UTSJSONObject({\n                        message: '发送失败，请重试'\n                    }));\n                }\n                finally {\n                    // 通知父组件处理结束\n                    this.$emit('processing-end');\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/vue%E5%AE%9E%E7%8E%B0Lottie%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81/pages_AI_Login_Match/AI/ai-chat/InputSection.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.__f__","uni.showToast"],"map":"{\"version\":3,\"file\":\"InputSection.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"InputSection.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
