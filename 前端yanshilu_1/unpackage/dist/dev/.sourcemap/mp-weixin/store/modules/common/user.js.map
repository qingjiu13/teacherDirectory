{"version":3,"file":"user.js","sources":["store/modules/common/user.js"],"sourcesContent":["/**\r\n * @description 用户模块 - 处理用户基本信息（老师和学生共用）\r\n */\r\nimport { services } from '../../services';\r\n\r\n// 初始状态\r\nconst state = {\r\n  profile: null,\r\n  loading: false,\r\n  error: null,\r\n  updateLoading: false,\r\n  updateError: null\r\n};\r\n\r\n// Getters\r\nconst getters = {\r\n  profile: state => state.profile,\r\n  isProfileLoaded: state => !!state.profile,\r\n  loading: state => state.loading,\r\n  error: state => state.error,\r\n  updateLoading: state => state.updateLoading,\r\n  updateError: state => state.updateError,\r\n  displayName: state => state.profile?.name || '',\r\n  avatar: state => state.profile?.avatar || '',\r\n  email: state => state.profile?.email || ''\r\n};\r\n\r\n// 引入常量类型\r\nconst FETCH_PROFILE_REQUEST = 'FETCH_PROFILE_REQUEST';\r\nconst FETCH_PROFILE_SUCCESS = 'FETCH_PROFILE_SUCCESS';\r\nconst FETCH_PROFILE_FAILURE = 'FETCH_PROFILE_FAILURE';\r\nconst UPDATE_PROFILE_REQUEST = 'UPDATE_PROFILE_REQUEST';\r\nconst UPDATE_PROFILE_SUCCESS = 'UPDATE_PROFILE_SUCCESS';\r\nconst UPDATE_PROFILE_FAILURE = 'UPDATE_PROFILE_FAILURE';\r\nconst CLEAR_PROFILE = 'CLEAR_PROFILE';\r\n\r\n// Mutations\r\nconst mutations = {\r\n  [FETCH_PROFILE_REQUEST](state) {\r\n    state.loading = true;\r\n    state.error = null;\r\n  },\r\n  [FETCH_PROFILE_SUCCESS](state, profile) {\r\n    state.profile = profile;\r\n    state.loading = false;\r\n    state.error = null;\r\n  },\r\n  [FETCH_PROFILE_FAILURE](state, error) {\r\n    state.loading = false;\r\n    state.error = error;\r\n  },\r\n  [UPDATE_PROFILE_REQUEST](state) {\r\n    state.updateLoading = true;\r\n    state.updateError = null;\r\n  },\r\n  [UPDATE_PROFILE_SUCCESS](state, profile) {\r\n    state.profile = { ...state.profile, ...profile };\r\n    state.updateLoading = false;\r\n    state.updateError = null;\r\n  },\r\n  [UPDATE_PROFILE_FAILURE](state, error) {\r\n    state.updateLoading = false;\r\n    state.updateError = error;\r\n  },\r\n  [CLEAR_PROFILE](state) {\r\n    state.profile = null;\r\n  }\r\n};\r\n\r\n// Actions\r\nconst actions = {\r\n  /**\r\n   * @description 获取用户个人资料\r\n   * @param {Object} context - Vuex上下文\r\n   * @returns {Promise<Object>} 个人资料\r\n   */\r\n  async fetchProfile({ commit, rootState }) {\r\n    commit(FETCH_PROFILE_REQUEST);\r\n    \r\n    try {\r\n      // 根据用户角色调用不同的API\r\n      let response;\r\n      const { role } = rootState.auth;\r\n      \r\n      if (role === 'teacher') {\r\n        response = await services.teacher.getTeacherProfile();\r\n      } else if (role === 'student') {\r\n        response = await services.student.getStudentProfile();\r\n      } else {\r\n        throw new Error('未知的用户角色');\r\n      }\r\n      \r\n      commit(FETCH_PROFILE_SUCCESS, response.data);\r\n      return response.data;\r\n    } catch (error) {\r\n      commit(FETCH_PROFILE_FAILURE, error.response?.data?.message || '获取个人资料失败');\r\n      return Promise.reject(error);\r\n    }\r\n  },\r\n  \r\n  /**\r\n   * @description 更新用户个人资料\r\n   * @param {Object} context - Vuex上下文\r\n   * @param {Object} profileData - 个人资料数据\r\n   * @returns {Promise<Object>} 更新结果\r\n   */\r\n  async updateProfile({ commit, rootState }, profileData) {\r\n    commit(UPDATE_PROFILE_REQUEST);\r\n    \r\n    try {\r\n      // 根据用户角色调用不同的API\r\n      let response;\r\n      const { role } = rootState.auth;\r\n      \r\n      if (role === 'teacher') {\r\n        response = await services.teacher.updateTeacherProfile(profileData);\r\n      } else {\r\n        response = await services.student.updateStudentProfile(profileData);\r\n      } \r\n      \r\n      commit(UPDATE_PROFILE_SUCCESS, response.data);\r\n      return response.data;\r\n    } catch (error) {\r\n      commit(UPDATE_PROFILE_FAILURE, error.response?.data?.message || '更新个人资料失败');\r\n      return Promise.reject(error);\r\n    }\r\n  },\r\n  \r\n  /**\r\n   * @description 清除用户个人资料（通常在登出时调用）\r\n   * @param {Object} context - Vuex上下文\r\n   */\r\n  clearProfile({ commit }) {\r\n    commit(CLEAR_PROFILE);\r\n  }\r\n};\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  getters,\r\n  actions,\r\n  mutations\r\n}; "],"names":["state","services"],"mappings":";;AAMA,MAAM,QAAQ;AAAA,EACZ,SAAS;AAAA,EACT,SAAS;AAAA,EACT,OAAO;AAAA,EACP,eAAe;AAAA,EACf,aAAa;AACf;AAGA,MAAM,UAAU;AAAA,EACd,SAAS,CAAAA,WAASA,OAAM;AAAA,EACxB,iBAAiB,CAAAA,WAAS,CAAC,CAACA,OAAM;AAAA,EAClC,SAAS,CAAAA,WAASA,OAAM;AAAA,EACxB,OAAO,CAAAA,WAASA,OAAM;AAAA,EACtB,eAAe,CAAAA,WAASA,OAAM;AAAA,EAC9B,aAAa,CAAAA,WAASA,OAAM;AAAA,EAC5B,aAAa,CAAAA,WAAS;;AAAA,kBAAAA,OAAM,YAAN,mBAAe,SAAQ;AAAA;AAAA,EAC7C,QAAQ,CAAAA,WAAS;;AAAA,kBAAAA,OAAM,YAAN,mBAAe,WAAU;AAAA;AAAA,EAC1C,OAAO,CAAAA,WAAS;;AAAA,kBAAAA,OAAM,YAAN,mBAAe,UAAS;AAAA;AAC1C;AAGA,MAAM,wBAAwB;AAC9B,MAAM,wBAAwB;AAC9B,MAAM,wBAAwB;AAC9B,MAAM,yBAAyB;AAC/B,MAAM,yBAAyB;AAC/B,MAAM,yBAAyB;AAC/B,MAAM,gBAAgB;AAGtB,MAAM,YAAY;AAAA,EAChB,CAAC,qBAAqB,EAAEA,QAAO;AAC7B,IAAAA,OAAM,UAAU;AAChB,IAAAA,OAAM,QAAQ;AAAA,EACf;AAAA,EACD,CAAC,qBAAqB,EAAEA,QAAO,SAAS;AACtC,IAAAA,OAAM,UAAU;AAChB,IAAAA,OAAM,UAAU;AAChB,IAAAA,OAAM,QAAQ;AAAA,EACf;AAAA,EACD,CAAC,qBAAqB,EAAEA,QAAO,OAAO;AACpC,IAAAA,OAAM,UAAU;AAChB,IAAAA,OAAM,QAAQ;AAAA,EACf;AAAA,EACD,CAAC,sBAAsB,EAAEA,QAAO;AAC9B,IAAAA,OAAM,gBAAgB;AACtB,IAAAA,OAAM,cAAc;AAAA,EACrB;AAAA,EACD,CAAC,sBAAsB,EAAEA,QAAO,SAAS;AACvC,IAAAA,OAAM,UAAU,EAAE,GAAGA,OAAM,SAAS,GAAG;AACvC,IAAAA,OAAM,gBAAgB;AACtB,IAAAA,OAAM,cAAc;AAAA,EACrB;AAAA,EACD,CAAC,sBAAsB,EAAEA,QAAO,OAAO;AACrC,IAAAA,OAAM,gBAAgB;AACtB,IAAAA,OAAM,cAAc;AAAA,EACrB;AAAA,EACD,CAAC,aAAa,EAAEA,QAAO;AACrB,IAAAA,OAAM,UAAU;AAAA,EACjB;AACH;AAGA,MAAM,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMd,MAAM,aAAa,EAAE,QAAQ,aAAa;;AACxC,WAAO,qBAAqB;AAE5B,QAAI;AAEF,UAAI;AACJ,YAAM,EAAE,KAAI,IAAK,UAAU;AAE3B,UAAI,SAAS,WAAW;AACtB,mBAAW,MAAMC,qBAAAA,SAAS,QAAQ,kBAAiB;AAAA,MAC3D,WAAiB,SAAS,WAAW;AAC7B,mBAAW,MAAMA,qBAAAA,SAAS,QAAQ,kBAAiB;AAAA,MAC3D,OAAa;AACL,cAAM,IAAI,MAAM,SAAS;AAAA,MAC1B;AAED,aAAO,uBAAuB,SAAS,IAAI;AAC3C,aAAO,SAAS;AAAA,IACjB,SAAQ,OAAO;AACd,aAAO,yBAAuB,iBAAM,aAAN,mBAAgB,SAAhB,mBAAsB,YAAW,UAAU;AACzE,aAAO,QAAQ,OAAO,KAAK;AAAA,IAC5B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQD,MAAM,cAAc,EAAE,QAAQ,UAAS,GAAI,aAAa;;AACtD,WAAO,sBAAsB;AAE7B,QAAI;AAEF,UAAI;AACJ,YAAM,EAAE,KAAI,IAAK,UAAU;AAE3B,UAAI,SAAS,WAAW;AACtB,mBAAW,MAAMA,qBAAQ,SAAC,QAAQ,qBAAqB,WAAW;AAAA,MAC1E,OAAa;AACL,mBAAW,MAAMA,qBAAQ,SAAC,QAAQ,qBAAqB,WAAW;AAAA,MACnE;AAED,aAAO,wBAAwB,SAAS,IAAI;AAC5C,aAAO,SAAS;AAAA,IACjB,SAAQ,OAAO;AACd,aAAO,0BAAwB,iBAAM,aAAN,mBAAgB,SAAhB,mBAAsB,YAAW,UAAU;AAC1E,aAAO,QAAQ,OAAO,KAAK;AAAA,IAC5B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,aAAa,EAAE,UAAU;AACvB,WAAO,aAAa;AAAA,EACrB;AACH;AAEA,MAAe,OAAA;AAAA,EACb,YAAY;AAAA,EACZ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;;"}