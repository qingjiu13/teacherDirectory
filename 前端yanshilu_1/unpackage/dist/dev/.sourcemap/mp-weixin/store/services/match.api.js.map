{"version":3,"file":"match.api.js","sources":["store/services/match.api.js"],"sourcesContent":["/**\r\n * @description 匹配功能API服务\r\n * 提供老师匹配和筛选相关功能\r\n */\r\nimport { API_BASE_URL } from '../../config';\r\nimport { mockDelay, mockTeachers, mockServices, getMockTeacherDetailWithServices } from './mock-data';\r\n\r\nconst API_PREFIX = `${API_BASE_URL}/api/match`;\r\n\r\n// 是否使用模拟数据\r\nconst USE_MOCK_DATA = process.env.NODE_ENV === 'development';\r\n\r\n/**\r\n * @description 使用uni.request封装网络请求\r\n * @param {Object} options - 请求选项\r\n * @returns {Promise<Object>} 请求结果\r\n */\r\nconst request = (options) => {\r\n  return new Promise((resolve, reject) => {\r\n    // 在开发环境中，检查是否设置了直接使用模拟数据\r\n    if (USE_MOCK_DATA && options.useMockOnDev) {\r\n      // 延迟返回模拟数据，模拟网络请求\r\n      setTimeout(() => {\r\n        resolve(options.mockData || {});\r\n      }, 300);\r\n      return;\r\n    }\r\n    \r\n    // 否则发起真实网络请求\r\n    uni.request({\r\n      url: options.url,\r\n      data: options.data,\r\n      method: options.method || 'GET',\r\n      header: options.headers || {},\r\n      success: (res) => {\r\n        resolve(res);\r\n      },\r\n      fail: (err) => {\r\n        // 如果请求失败且在开发环境并指定了失败时使用模拟数据\r\n        if (USE_MOCK_DATA && options.useMockOnFail) {\r\n          console.warn('API请求失败，使用模拟数据替代', err);\r\n          setTimeout(() => {\r\n            resolve(options.mockData || {});\r\n          }, 300);\r\n          return;\r\n        }\r\n        reject(err);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * @description 获取推荐老师列表\r\n * @param {Object} params - 查询参数\r\n * @param {Number} params.page - 页码\r\n * @param {Number} params.limit - 每页数量\r\n * @returns {Promise<Object>} 返回老师列表和分页信息\r\n */\r\nexport const getRecommendedTeachers = async (params = {}) => {\r\n  try {\r\n    const mockData = {\r\n      data: {\r\n        list: mockTeachers,\r\n        pagination: {\r\n          page: params.page || 1,\r\n          limit: params.limit || 10,\r\n          total: mockTeachers.length\r\n        }\r\n      }\r\n    };\r\n    \r\n    const response = await request({\r\n      url: `${API_PREFIX}/teachers/recommended`,\r\n      method: 'GET',\r\n      data: params,\r\n      useMockOnDev: true,\r\n      useMockOnFail: true,\r\n      mockData: mockData\r\n    });\r\n    \r\n    return { success: true, data: response.data };\r\n  } catch (error) {\r\n    console.error('获取推荐老师列表失败:', error);\r\n    return { success: false, error };\r\n  }\r\n};\r\n\r\n/**\r\n * @description 搜索老师\r\n * @param {Object} params - 搜索参数\r\n * @param {String} params.keyword - 搜索关键词\r\n * @param {String} params.school - 学校筛选\r\n * @param {String} params.major - 专业筛选\r\n * @param {Number} params.page - 页码\r\n * @param {Number} params.limit - 每页数量\r\n * @returns {Promise<Object>} 返回老师列表和分页信息\r\n */\r\nexport const searchTeachers = async (params = {}) => {\r\n  try {\r\n    // 过滤模拟数据，模拟搜索功能\r\n    let filteredTeachers = [...mockTeachers];\r\n    \r\n    if (params.keyword) {\r\n      const keyword = params.keyword.toLowerCase();\r\n      filteredTeachers = filteredTeachers.filter(t => \r\n        t.nickname.toLowerCase().includes(keyword) || \r\n        t.school.toLowerCase().includes(keyword) || \r\n        t.major.toLowerCase().includes(keyword)\r\n      );\r\n    }\r\n    \r\n    if (params.school) {\r\n      filteredTeachers = filteredTeachers.filter(t => \r\n        t.school.includes(params.school)\r\n      );\r\n    }\r\n    \r\n    if (params.major) {\r\n      filteredTeachers = filteredTeachers.filter(t => \r\n        t.major.includes(params.major)\r\n      );\r\n    }\r\n    \r\n    const mockData = {\r\n      data: {\r\n        list: filteredTeachers,\r\n        pagination: {\r\n          page: params.page || 1,\r\n          limit: params.limit || 10,\r\n          total: filteredTeachers.length\r\n        }\r\n      }\r\n    };\r\n    \r\n    const response = await request({\r\n      url: `${API_PREFIX}/teachers/search`,\r\n      method: 'GET',\r\n      data: params,\r\n      useMockOnDev: true,\r\n      useMockOnFail: true,\r\n      mockData: mockData\r\n    });\r\n    \r\n    return { success: true, data: response.data };\r\n  } catch (error) {\r\n    console.error('搜索老师失败:', error);\r\n    return { success: false, error };\r\n  }\r\n};\r\n\r\n/**\r\n * @description 获取老师详细信息（包含服务列表）\r\n * @param {Number} teacherId - 老师ID\r\n * @returns {Promise<Object>} 返回老师详细信息和服务列表\r\n */\r\nexport const getTeacherDetail = async (teacherId) => {\r\n  try {\r\n    // 使用之前添加的合并数据函数获取模拟数据\r\n    const mockDataResponse = getMockTeacherDetailWithServices(teacherId);\r\n    \r\n    const response = await request({\r\n      url: `${API_PREFIX}/teachers/${teacherId}`,\r\n      method: 'GET',\r\n      useMockOnDev: true,\r\n      useMockOnFail: true,\r\n      mockData: { data: mockDataResponse.data }\r\n    });\r\n    \r\n    return { success: true, data: response.data };\r\n  } catch (error) {\r\n    console.error('获取老师详细信息失败:', error);\r\n    return { success: false, error };\r\n  }\r\n}; "],"names":["API_BASE_URL","uni","mockTeachers","getMockTeacherDetailWithServices"],"mappings":"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"}