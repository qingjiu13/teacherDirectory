{"version":3,"file":"AI.js","sources":["pages/AI/AI.uvue","../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQUkvQUkudXZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"page-container\" @click=\"onPageClick\">\r\n\t\t<!-- 新增导航栏和侧边栏 -->\r\n\t\t<view class=\"nav-sidebar-container\">\r\n\t\t\t<!-- 侧边栏遮罩层 -->\r\n\t\t\t<view class=\"sidebar-mask\" v-if=\"sidebarVisible\" @click=\"closeSidebar\" :style=\"{opacity: sidebarVisible ? 0.5 : 0}\"></view>\r\n\t\t\t\r\n\t\t\t<!-- 历史记录侧边栏 -->\r\n\t\t\t<history-sidebar\r\n\t\t\t\t:visible=\"sidebarVisible\"\r\n\t\t\t\t:history-summaries=\"historySummaries\"\r\n\t\t\t\t:current-chat-id=\"currentChatId\"\r\n\t\t\t\t@load-chat=\"loadChatHistory\"\r\n\t\t\t\t@delete-chat=\"deleteChatHistory\">\r\n\t\t\t</history-sidebar>\r\n\t\t\t\r\n\t\t\t<!-- 主内容包装器（包含导航栏和主内容） -->\r\n\t\t\t<view class=\"main-wrapper\" :class=\"{shifted: sidebarVisible}\">\r\n\t\t\t\t<!-- 顶部导航栏 -->\r\n\t\t\t\t<view class=\"nav-bar\">\r\n\t\t\t\t\t<view class=\"nav-left\">\r\n\t\t\t\t\t\t<view class=\"history-btn\" @click.stop=\"toggleSidebar\">\r\n\t\t\t\t\t\t\t<text class=\"iconfont\">&#xe67c;</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"nav-title\">\r\n\t\t\t\t\t\t<text>研师录AI</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"nav-right\">\r\n\t\t\t\t\t\t<view class=\"new-chat-btn\" @click.stop=\"startNewChat\">\r\n\t\t\t\t\t\t\t<text>新对话</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<!-- 主内容区域 -->\r\n\t\t\t\t<view class=\"main-content\">\r\n\t\t\t\t\t<!-- 筛选区域 -->\r\n\t\t\t\t\t<filter-section\r\n\t\t\t\t\t\t:school-index=\"schoolIndex\"\r\n\t\t\t\t\t\t:school-list=\"schoolList\"\r\n\t\t\t\t\t\t:major-index=\"majorIndex\"\r\n\t\t\t\t\t\t:major-list=\"majorList\"\r\n\t\t\t\t\t\t@school-change=\"onSchoolClick\"\r\n\t\t\t\t\t\t@major-change=\"onMajorClick\"\r\n\t\t\t\t\t\t@school-search=\"onSchoolSearch\"\r\n\t\t\t\t\t\tref=\"filterSection\">\r\n\t\t\t\t\t</filter-section>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<!-- 消息区域 -->\r\n\t\t\t\t\t<message-list\r\n\t\t\t\t\t\t:messages=\"messages\"\r\n\t\t\t\t\t\t:auto-scroll-id=\"autoScrollId\"\r\n\t\t\t\t\t\t@scroll-to-upper=\"onScrollToUpper\"\r\n\t\t\t\t\t\t@scroll=\"onScroll\"\r\n\t\t\t\t\t\t@retry-message=\"retryMessage\"\r\n\t\t\t\t\t\t@update-auto-scroll-id=\"autoScrollId = $event\"\r\n\t\t\t\t\t\tref=\"messageList\">\r\n\t\t\t\t\t</message-list>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<!-- 功能模式区域 -->\r\n\t\t\t\t\t<mode-selector\r\n\t\t\t\t\t\t:current-mode=\"currentMode\"\r\n\t\t\t\t\t\t@mode-change=\"switchMode\">\r\n\t\t\t\t\t</mode-selector>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<!-- 输入区域 -->\r\n\t\t\t\t\t<input-section\r\n\t\t\t\t\t\t:is-processing=\"isProcessing\"\r\n\t\t\t\t\t\t@send=\"sendMessage\">\r\n\t\t\t\t\t</input-section>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 加载提示 -->\r\n\t\t<view class=\"loading-mask\" v-if=\"isFullLoading\">\r\n\t\t\t<view class=\"loading-content\">\r\n\t\t\t\t<text>{{loadingText}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n\timport choiceSelected from '../../components/combobox/combobox'\r\n\timport HistorySidebar from '../../components/ai-chat/HistorySidebar'\r\n\timport MessageList from '../../components/ai-chat/MessageList'\r\n\timport FilterSection from '../../components/ai-chat/FilterSection'\r\n\timport ModeSelector from '../../components/ai-chat/ModeSelector'\r\n\timport InputSection from '../../components/ai-chat/InputSection'\r\n\timport { services } from '../../store'\r\n\timport store from '../../store'\r\n\t\r\n\t// 消息类型常量\r\n\tconst MESSAGE_TYPE = {\r\n\t\tUSER: 'user',\r\n\t\tAI: 'ai',\r\n\t\tSYSTEM: 'system'\r\n\t}\r\n\t\r\n\t// 消息状态常量\r\n\tconst MESSAGE_STATUS = {\r\n\t\tSENDING: 'sending',\r\n\t\tSENT: 'sent',\r\n\t\tERROR: 'error'\r\n\t}\r\n\t\r\n\t// 对话模式常量\r\n\tconst CHAT_MODE = {\r\n\t\tGENERAL: 'general',\r\n\t\tSCHOOL: 'school',\r\n\t\tCAREER: 'career'\r\n\t}\r\n\t\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tchoiceSelected,\r\n\t\t\tHistorySidebar,\r\n\t\t\tMessageList,\r\n\t\t\tFilterSection,\r\n\t\t\tModeSelector,\r\n\t\t\tInputSection\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t// 从Vuex中获取状态\r\n\t\t\ttestResult() {\r\n\t\t\t\treturn store.getters['aiChat/testResult'];\r\n\t\t\t},\r\n\t\t\tisTesting() {\r\n\t\t\t\treturn store.getters['aiChat/isTesting'];\r\n\t\t\t},\r\n\t\t\tisLoading() {\r\n\t\t\t\treturn store.getters['aiChat/isLoading'];\r\n\t\t\t},\r\n\t\t\t// 历史会话摘要\r\n\t\t\thistorySummaries() {\r\n\t\t\t\treturn store.getters['aiChat/historySummaries'] || [];\r\n\t\t\t},\r\n\t\t\t// 历史会话\r\n\t\t\thistoryChats() {\r\n\t\t\t\treturn store.getters['aiChat/historyChats'] || [];\r\n\t\t\t},\r\n\t\t\t// 当前选择的学校名称\r\n\t\t\tcurrentSchool() {\r\n\t\t\t\treturn this.schoolIndex >= 0 ? this.schoolList[this.schoolIndex].choiceItemContent : '';\r\n\t\t\t},\r\n\t\t\t// 当前选择的专业名称\r\n\t\t\tcurrentMajor() {\r\n\t\t\t\treturn this.majorIndex >= 0 ? this.majorList[this.majorIndex].choiceItemContent : '';\r\n\t\t\t},\r\n\t\t\t// 获取当前模式名称\r\n\t\t\tcurrentModeName() {\r\n\t\t\t\tconst modeNames = {\r\n\t\t\t\t\t[CHAT_MODE.GENERAL]: '通用',\r\n\t\t\t\t\t[CHAT_MODE.SCHOOL]: '择校',\r\n\t\t\t\t\t[CHAT_MODE.CAREER]: '职业规划'\r\n\t\t\t\t};\r\n\t\t\t\treturn modeNames[this.currentMode] || '通用';\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// 用户基本信息\r\n\t\t\t\tuserInfo: {\r\n\t\t\t\t\tschool: '',\r\n\t\t\t\t\tmajor: ''\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\t// 消息相关\r\n\t\t\t\tmessages: [],\r\n\t\t\t\tisProcessing: false, // 是否正在处理消息\r\n\t\t\t\tisFullLoading: false, // 是否显示全屏加载\r\n\t\t\t\tloadingText: '正在加载...',\r\n\t\t\t\tautoScrollId: '', // 用于自动滚动的ID\r\n\t\t\t\t\r\n\t\t\t\t// 对话模式\r\n\t\t\t\tcurrentMode: CHAT_MODE.GENERAL,\r\n\t\t\t\t\r\n\t\t\t\t// 学校和专业选择相关\r\n\t\t\t\tschoolIndex: -1,\r\n\t\t\t\tmajorIndex: -1,\r\n\t\t\t\tschoolList: [\r\n\t\t\t\t\t{ choiceItemId: \"bjdx\", choiceItemContent: \"北京大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"qhdx\", choiceItemContent: \"清华大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"fddx\", choiceItemContent: \"复旦大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"zjdx\", choiceItemContent: \"浙江大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"njdx\", choiceItemContent: \"南京大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"scdx\", choiceItemContent: \"四川大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"whdx\", choiceItemContent: \"武汉大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"zsdx\", choiceItemContent: \"中山大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"xjtu\", choiceItemContent: \"西安交通大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"hust\", choiceItemContent: \"华中科技大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"hit\", choiceItemContent: \"哈尔滨工业大学\" },\r\n\t\t\t\t\t{ choiceItemId: \"sjtu\", choiceItemContent: \"上海交通大学\" }\r\n\t\t\t\t],\r\n\t\t\t\tmajorList: [\r\n\t\t\t\t\t{ choiceItemId: \"jsjkx\", choiceItemContent: \"计算机科学\" },\r\n\t\t\t\t\t{ choiceItemId: \"rjgc\", choiceItemContent: \"软件工程\" },\r\n\t\t\t\t\t{ choiceItemId: \"sx\", choiceItemContent: \"数学\" },\r\n\t\t\t\t\t{ choiceItemId: \"wl\", choiceItemContent: \"物理\" },\r\n\t\t\t\t\t{ choiceItemId: \"hx\", choiceItemContent: \"化学\" },\r\n\t\t\t\t\t{ choiceItemId: \"sw\", choiceItemContent: \"生物\" },\r\n\t\t\t\t\t{ choiceItemId: \"jdxy\", choiceItemContent: \"机电工程\" },\r\n\t\t\t\t\t{ choiceItemId: \"dqxy\", choiceItemContent: \"电气工程\" },\r\n\t\t\t\t\t{ choiceItemId: \"jzxy\", choiceItemContent: \"建筑学\" },\r\n\t\t\t\t\t{ choiceItemId: \"lyxy\", choiceItemContent: \"临床医学\" },\r\n\t\t\t\t\t{ choiceItemId: \"yyxy\", choiceItemContent: \"药学\" },\r\n\t\t\t\t\t{ choiceItemId: \"glxy\", choiceItemContent: \"管理学\" },\r\n\t\t\t\t\t{ choiceItemId: \"jjxy\", choiceItemContent: \"经济学\" },\r\n\t\t\t\t\t{ choiceItemId: \"flxy\", choiceItemContent: \"法学\" }\r\n\t\t\t\t],\r\n\t\t\t\t\r\n\t\t\t\t// 滚动相关\r\n\t\t\t\tisAutoScrollEnabled: true,\r\n\t\t\t\t\r\n\t\t\t\t// 当前会话的请求控制器\r\n\t\t\t\tcurrentController: null,\r\n\t\t\t\t\r\n\t\t\t\t// 自定义的上下文信息\r\n\t\t\t\tcontextInfo: {},\r\n\t\t\t\t\r\n\t\t\t\t// 导航栏和侧边栏相关\r\n\t\t\t\tsidebarVisible: false,\r\n\t\t\t\tcurrentChatId: null // 当前会话ID\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\t// 监听historyChats变化\r\n\t\t\thistoryChats: {\r\n\t\t\t\thandler(newVal) {\r\n\t\t\t\t\tif (newVal && newVal.length) {\r\n\t\t\t\t\t\t// 历史会话在Store中维护，这里不需要额外逻辑\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\timmediate: true\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t/**\r\n\t\t\t * @description 页面加载时的处理逻辑\r\n\t\t\t */\r\n\t\t\t// 尝试获取用户信息并初始化\r\n\t\t\tthis.getUserInfo();\r\n\t\t\t\r\n\t\t\t// 添加欢迎消息\r\n\t\t\tthis.addSystemMessage('欢迎使用研师录AI助手，请选择您的所在学校和专业，然后开始提问');\r\n\t\t\t\r\n\t\t\t// 加载历史会话\r\n\t\t\tthis.loadChatHistoryFromStorage();\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\t// 页面显示时刷新历史记录\r\n\t\t\tthis.loadChatHistoryFromStorage();\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t// 页面卸载时中断所有未完成的请求\r\n\t\t\tthis.abortCurrentRequest();\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\t// 页面渲染完成后更新布局\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.updateLayout();\r\n\t\t\t}, 300);\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * @description 处理页面点击事件，用于关闭所有打开的下拉框\r\n\t\t\t */\r\n\t\t\tonPageClick() {\r\n\t\t\t\t// 关闭筛选区域的下拉框\r\n\t\t\t\tif (this.$refs && this.$refs.filterSection) {\r\n\t\t\t\t\tthis.$refs.filterSection.closeAllDropdowns();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 更新布局，解决可能的定位问题\r\n\t\t\t */\r\n\t\t\tupdateLayout() {\r\n\t\t\t\t// 微信小程序环境下特殊处理\r\n\r\n\t\t\t\t// 这里可以添加特定于微信小程序的布局调整\r\n\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 获取用户信息\r\n\t\t\t */\r\n\t\t\tgetUserInfo() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo');\r\n\t\t\t\t\tif (userInfo) {\r\n\t\t\t\t\t\tconst parsedInfo = JSON.parse(userInfo);\r\n\t\t\t\t\t\tthis.userInfo = parsedInfo;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 根据保存的用户信息设置选择框的索引\r\n\t\t\t\t\t\tthis.setUserSelectionIndexes();\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.__f__('error','at pages/AI/AI.uvue:301','获取用户信息失败:', e);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 根据用户信息设置学校和专业的索引\r\n\t\t\t */\r\n\t\t\tsetUserSelectionIndexes() {\r\n\t\t\t\tif (this.userInfo.school) {\r\n\t\t\t\t\tconst schoolIndex = this.schoolList.findIndex(\r\n\t\t\t\t\t\titem => item.choiceItemContent === this.userInfo.school\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (schoolIndex !== -1) {\r\n\t\t\t\t\t\tthis.schoolIndex = schoolIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this.userInfo.major) {\r\n\t\t\t\t\tconst majorIndex = this.majorList.findIndex(\r\n\t\t\t\t\t\titem => item.choiceItemContent === this.userInfo.major\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (majorIndex !== -1) {\r\n\t\t\t\t\t\tthis.majorIndex = majorIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 保存用户信息\r\n\t\t\t */\r\n\t\t\tsaveUserInfo() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tuni.setStorageSync('userInfo', JSON.stringify(this.userInfo));\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.__f__('error','at pages/AI/AI.uvue:335','保存用户信息失败:', e);\r\n\t\t\t\t\tthis.showToast('保存用户信息失败，可能影响后续对话');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 学校选择事件处理\r\n\t\t\t * @param {Number} position - 选择的索引位置\r\n\t\t\t */\r\n\t\t\tonSchoolClick(position) {\r\n\t\t\t\tthis.schoolIndex = position;\r\n\t\t\t\tthis.userInfo.school = this.currentSchool;\r\n\t\t\t\tthis.saveUserInfo();\r\n\t\t\t\tthis.updateContextInfo();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 专业选择事件处理\r\n\t\t\t * @param {Number} position - 选择的索引位置\r\n\t\t\t */\r\n\t\t\tonMajorClick(position) {\r\n\t\t\t\tthis.majorIndex = position;\r\n\t\t\t\tthis.userInfo.major = this.currentMajor;\r\n\t\t\t\tthis.saveUserInfo();\r\n\t\t\t\tthis.updateContextInfo();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理学校搜索输入\r\n\t\t\t * @param {String} keyword - 搜索关键词\r\n\t\t\t */\r\n\t\t\tonSchoolSearch(keyword) {\r\n\t\t\t\t// 这里可以实现动态学校搜索逻辑，例如从服务器获取匹配的学校\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 切换对话模式\r\n\t\t\t * @param {String} mode - 对话模式\r\n\t\t\t */\r\n\t\t\tswitchMode(mode) {\r\n\t\t\t\tif (this.currentMode === mode) return;\r\n\t\t\t\t\r\n\t\t\t\tthis.currentMode = mode;\r\n\t\t\t\tthis.updateContextInfo();\r\n\t\t\t\tthis.addSystemMessage(`已切换到${this.currentModeName}模式`);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 更新对话上下文信息\r\n\t\t\t */\r\n\t\t\tupdateContextInfo() {\r\n\t\t\t\tthis.contextInfo = {\r\n\t\t\t\t\tmode: this.currentMode,\r\n\t\t\t\t\tuserSchool: this.currentSchool,\r\n\t\t\t\t\tuserMajor: this.currentMajor\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 添加系统消息\r\n\t\t\t * @param {String} content - 消息内容\r\n\t\t\t */\r\n\t\t\taddSystemMessage(content) {\r\n\t\t\t\tthis.messages.push({\r\n\t\t\t\t\ttype: MESSAGE_TYPE.SYSTEM,\r\n\t\t\t\t\tcontent: content,\r\n\t\t\t\t\tstatus: MESSAGE_STATUS.SENT\r\n\t\t\t\t});\r\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 开始新对话\r\n\t\t\t */\r\n\t\t\tstartNewChat() {\r\n\t\t\t\tthis.messages = [];\r\n\t\t\t\tthis.currentChatId = 'chat_' + Date.now();\r\n\t\t\t\tstore.dispatch('aiChat/setCurrentChat', this.currentChatId);\r\n\t\t\t\tthis.addSystemMessage('开始新对话，请输入您的问题');\r\n\t\t\t\tthis.closeSidebar();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理消息发送和重试的统一方法\r\n\t\t\t * @param {String} messageContent - 消息内容\r\n\t\t\t * @param {Number} [retryIndex] - 重试消息的索引，如果是新消息则为null\r\n\t\t\t */\r\n\t\t\tasync handleMessage(messageContent, retryIndex = null) {\r\n\t\t\t\tif (!messageContent || this.isProcessing) return;\r\n\t\t\t\t\r\n\t\t\t\tlet userMessageIndex, aiMessageIndex;\r\n\t\t\t\t\r\n\t\t\t\t// 处理新消息或重试\r\n\t\t\t\tif (retryIndex === null) {\r\n\t\t\t\t\t// 新消息\r\n\t\t\t\t\tuserMessageIndex = this.messages.length;\r\n\t\t\t\t\tthis.messages.push({\r\n\t\t\t\t\t\ttype: MESSAGE_TYPE.USER,\r\n\t\t\t\t\t\tcontent: messageContent,\r\n\t\t\t\t\t\tstatus: MESSAGE_STATUS.SENT\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\taiMessageIndex = this.messages.length;\r\n\t\t\t\t\tthis.messages.push({\r\n\t\t\t\t\t\ttype: MESSAGE_TYPE.AI,\r\n\t\t\t\t\t\tcontent: '',\r\n\t\t\t\t\t\tstatus: MESSAGE_STATUS.SENDING,\r\n\t\t\t\t\t\tstreaming: false\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 重试消息\r\n\t\t\t\t\tuserMessageIndex = retryIndex - 1;\r\n\t\t\t\t\taiMessageIndex = retryIndex;\r\n\t\t\t\t\tthis.messages[aiMessageIndex].content = '';\r\n\t\t\t\t\tthis.messages[aiMessageIndex].status = MESSAGE_STATUS.SENDING;\r\n\t\t\t\t\tthis.messages[aiMessageIndex].streaming = false;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\tthis.isProcessing = true;\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.updateContextInfo();\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 确保有当前会话ID\r\n\t\t\t\t\tif (!this.currentChatId) {\r\n\t\t\t\t\t\tthis.currentChatId = 'chat_' + Date.now();\r\n\t\t\t\t\t\tstore.dispatch('aiChat/setCurrentChat', this.currentChatId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 直接通过Vuex调用后端API\r\n\t\t\t\t\tconst response = await store.dispatch('aiChat/testAIQA', {\r\n\t\t\t\t\t\tquestion: messageContent,\r\n\t\t\t\t\t\tcontextInfo: this.contextInfo,\r\n\t\t\t\t\t\tchatId: this.currentChatId\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (response.success) {\r\n\t\t\t\t\t\tthis.messages[aiMessageIndex].content = response.data;\r\n\t\t\t\t\t\tthis.messages[aiMessageIndex].status = MESSAGE_STATUS.SENT;\r\n\t\t\t\t\t\tthis.saveChatHistory();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 直接使用后端返回的错误信息\r\n\t\t\t\t\t\tthis.messages[aiMessageIndex].content = response.error?.message || response.message || '获取回复失败';\r\n\t\t\t\t\t\tthis.messages[aiMessageIndex].status = MESSAGE_STATUS.ERROR;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\t// 错误信息由后端提供\r\n\t\t\t\t\tthis.messages[aiMessageIndex].content = '与服务器通信异常';\r\n\t\t\t\t\tthis.messages[aiMessageIndex].status = MESSAGE_STATUS.ERROR;\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.isProcessing = false;\r\n\t\t\t\t\tthis.messages[aiMessageIndex].streaming = false;\r\n\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 发送消息\r\n\t\t\t * @param {String} messageContent - 消息内容\r\n\t\t\t */\r\n\t\t\tsendMessage(messageContent) {\r\n\t\t\t\tthis.handleMessage(messageContent);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 重试发送失败的消息\r\n\t\t\t * @param {Number} index - 消息索引\r\n\t\t\t */\r\n\t\t\tretryMessage(index) {\r\n\t\t\t\t// 只能重试AI消息\r\n\t\t\t\tif (index < 1 || this.messages[index].type !== MESSAGE_TYPE.AI) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 获取对应的用户消息\r\n\t\t\t\tconst userMessage = this.messages[index - 1];\r\n\t\t\t\tif (userMessage.type !== MESSAGE_TYPE.USER) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.handleMessage(userMessage.content, index);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 中断当前请求\r\n\t\t\t */\r\n\t\t\tabortCurrentRequest() {\r\n\t\t\t\tif (this.currentController) {\r\n\r\n\r\n\r\n\t\t\t\t\tthis.currentController = null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 滚动到底部\r\n\t\t\t */\r\n\t\t\tscrollToBottom() {\r\n\t\t\t\tif (!this.isAutoScrollEnabled) return;\r\n\t\t\t\t\r\n\t\t\t\tif (this.messages.length > 0) {\r\n\t\t\t\t\tthis.autoScrollId = 'msg-' + (this.messages.length - 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理滚动到顶部事件\r\n\t\t\t */\r\n\t\t\tonScrollToUpper(e) {\r\n\t\t\t\t// 滚动到顶部的处理逻辑\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 处理滚动事件\r\n\t\t\t */\r\n\t\t\tonScroll(e) {\r\n\t\t\t\t// 滚动事件处理逻辑\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 显示提示\r\n\t\t\t * @param {String} message - 提示信息\r\n\t\t\t * @param {String} [icon='none'] - 提示图标\r\n\t\t\t * @param {Number} [duration=2000] - 提示持续时间\r\n\t\t\t */\r\n\t\t\tshowToast(message, icon = 'none', duration = 2000) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: message,\r\n\t\t\t\t\ticon: icon,\r\n\t\t\t\t\tduration: duration\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 显示/隐藏加载提示\r\n\t\t\t * @param {String|Boolean} text - 加载提示文本，如果为false则隐藏\r\n\t\t\t */\r\n\t\t\ttoggleLoading(text = '正在加载...') {\r\n\t\t\t\tif (text === false) {\r\n\t\t\t\t\tthis.isFullLoading = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.loadingText = text;\r\n\t\t\t\t\tthis.isFullLoading = true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 侧边栏相关方法\r\n\t\t\ttoggleSidebar() {\r\n\t\t\t\tthis.sidebarVisible = !this.sidebarVisible;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tcloseSidebar() {\r\n\t\t\t\tthis.sidebarVisible = false;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 加载指定的聊天历史\r\n\t\t\t * @param {String} chatId - 聊天历史ID\r\n\t\t\t */\r\n\t\t\tloadChatHistory(chatId) {\r\n\t\t\t\tif (!chatId) return;\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.toggleLoading('正在加载对话内容...');\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 通过Vuex从后端加载完整对话内容\r\n\t\t\t\t\tstore.dispatch('aiChat/loadChat', chatId).then(response => {\r\n\t\t\t\t\t\tif (response.success) {\r\n\t\t\t\t\t\t\t// 设置当前会话ID（这个在action中已经设置了）\r\n\t\t\t\t\t\t\tthis.currentChatId = chatId;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 替换当前消息列表为从后端获取的完整消息\r\n\t\t\t\t\t\t\tthis.messages = response.data.messages || [];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 关闭侧边栏\r\n\t\t\t\t\t\t\tthis.closeSidebar();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 滚动到底部\r\n\t\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.showToast('加载对话内容失败');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tthis.toggleLoading(false);\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tthis.showToast('加载对话内容失败');\r\n\t\t\t\t\tthis.toggleLoading(false);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 从Vuex加载历史会话摘要\r\n\t\t\t */\r\n\t\t\tloadChatHistoryFromStorage() {\r\n\t\t\t\t// 从Vuex获取历史会话摘要列表\r\n\t\t\t\tstore.dispatch('aiChat/getHistoryChats');\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 保存聊天历史摘要到Vuex\r\n\t\t\t */\r\n\t\t\tsaveChatHistory() {\r\n\t\t\t\tif (!this.currentChatId || this.messages.length === 0) return;\r\n\t\t\t\t\r\n\t\t\t\t// 寻找第一条用户消息作为标题\r\n\t\t\t\tconst firstUserMessage = this.messages.find(msg => msg.type === MESSAGE_TYPE.USER);\r\n\t\t\t\tconst title = firstUserMessage ? firstUserMessage.content.substring(0, 20) : '新对话';\r\n\t\t\t\t\r\n\t\t\t\t// 创建聊天摘要对象\r\n\t\t\t\tconst chatData = {\r\n\t\t\t\t\tid: this.currentChatId,\r\n\t\t\t\t\ttitle: title + (title.length >= 20 ? '...' : ''),\r\n\t\t\t\t\t// 完整消息内容由后端存储，客户端只保存摘要信息\r\n\t\t\t\t\tcreatedAt: new Date(),\r\n\t\t\t\t\tupdatedAt: new Date()\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\t// 保存到Vuex\r\n\t\t\t\tstore.dispatch('aiChat/saveChat', chatData);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 删除历史记录\r\n\t\t\t * @param {String} chatId - 历史记录ID\r\n\t\t\t */\r\n\t\t\tdeleteChatHistory(chatId) {\r\n\t\t\t\tif (!chatId) {\r\n\t\t\t\t\tuni.__f__('error','at pages/AI/AI.uvue:667','删除历史记录失败: 无效的chatId');\r\n\t\t\t\t\tthis.showToast('删除失败: 无效的记录ID');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.__f__('log','at pages/AI/AI.uvue:672','请求删除历史记录:', chatId);\r\n\t\t\t\t\r\n\t\t\t\t// 弹窗确认是否删除\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '确认删除',\r\n\t\t\t\t\tcontent: '确定要删除这条对话记录吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t// 使用Vuex删除历史记录\r\n\t\t\t\t\t\t\tstore.dispatch('aiChat/deleteChat', chatId).then(response => {\r\n\t\t\t\t\t\t\t\tif (response.success) {\r\n\t\t\t\t\t\t\t\t\t// 如果删除的是当前会话，则清空当前会话\r\n\t\t\t\t\t\t\t\t\tif (this.currentChatId === chatId) {\r\n\t\t\t\t\t\t\t\t\t\tthis.startNewChat();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tthis.showToast('删除成功');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tuni.__f__('error','at pages/AI/AI.uvue:689','删除失败:', response.message || '未知错误');\r\n\t\t\t\t\t\t\t\t\tthis.showToast(response.message || '删除失败');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).catch(error => {\r\n\t\t\t\t\t\t\t\tuni.__f__('error','at pages/AI/AI.uvue:693','删除过程发生异常:', error);\r\n\t\t\t\t\t\t\t\tthis.showToast('删除失败: ' + (error.message || '系统错误'));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 格式化时间\r\n\t\t\t * @param {Date|String} time - 时间对象或时间字符串\r\n\t\t\t * @returns {String} 格式化后的时间字符串\r\n\t\t\t */\r\n\t\t\tformatTime(time) {\r\n\t\t\t\tif (!time) return '';\r\n\t\t\t\t\r\n\t\t\t\tconst date = new Date(time);\r\n\t\t\t\tconst year = date.getFullYear();\r\n\t\t\t\tconst month = String(date.getMonth() + 1).padStart(2, '0');\r\n\t\t\t\tconst day = String(date.getDate()).padStart(2, '0');\r\n\t\t\t\tconst hours = String(date.getHours()).padStart(2, '0');\r\n\t\t\t\tconst minutes = String(date.getMinutes()).padStart(2, '0');\r\n\t\t\t\t\r\n\t\t\t\treturn `${year}-${month}-${day} ${hours}:${minutes}`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.page-container {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\theight: 100vh;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tpadding: 0; /* 移除页面容器的内边距 */\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\toverflow: hidden; /* 防止内容溢出 */\r\n\t}\r\n\t\r\n\t/* 加载遮罩 */\r\n\t.loading-mask {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tz-index: 999;\r\n\t}\r\n\t\r\n\t.loading-content {\r\n\t\tbackground-color: #ffffff;\r\n\t\tpadding: 30rpx 60rpx;\r\n\t\tborder-radius: 20rpx;\r\n\t\tbox-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.15);\r\n\t}\r\n\t\r\n\t.loading-content text {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t}\r\n\t\r\n\t/* 侧边栏容器样式 */\r\n\t.nav-sidebar-container {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\theight: 100vh;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t\r\n\t.sidebar-mask {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\t\tz-index: 998;\r\n\t\ttransition: opacity 0.3s ease;\r\n\t}\r\n\t\r\n\t.main-wrapper {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\ttransition: transform 0.3s ease, opacity 0.3s ease;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tpadding-bottom: 20rpx; /* 底部增加内边距 */\r\n\t}\r\n\t\r\n\t.main-wrapper.shifted {\r\n\t\ttransform: translateX(66vw);\r\n\t\topacity: 0.85;\r\n\t}\r\n\t\r\n\t.main-content {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tpadding: 0 20rpx; /* 仅添加左右内边距 */\r\n\t}\r\n\t\r\n\t/* 导航栏样式 */\r\n\t.nav-bar {\r\n\t\theight: 90rpx;\r\n\t\tbackground-color: #ffffff;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tpadding: 0 20rpx;\r\n\t\tborder-bottom: none; /* 移除底部边框 */\r\n\t\tposition: relative;\r\n\t\tz-index: 11; /* 提高z-index，确保显示在筛选区域上方 */\r\n\t}\r\n\t\r\n\t.nav-left {\r\n\t\twidth: 33%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.history-btn {\r\n\t\twidth: 80rpx;\r\n\t\theight: 80rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.history-btn .iconfont {\r\n\t\tfont-size: 48rpx;\r\n\t\tcolor: #333;\r\n\t}\r\n\t\r\n\t/* 使用图标替代文字，如果没有图标字体可以使用以下替代样式 */\r\n\t.history-btn .iconfont:before {\r\n\t\tcontent: \"≡\"; /* 使用三横线作为菜单图标 */\r\n\t}\r\n\t\r\n\t.nav-title {\r\n\t\twidth: 34%;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.nav-title text {\r\n\t\tfont-size: 36rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\t\r\n\t.nav-right {\r\n\t\twidth: 33%;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: flex-end;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.new-chat-btn {\r\n\t\tpadding: 14rpx 28rpx;\r\n\t\tbackground-color: #1E90FF;\r\n\t\tborder-radius: 40rpx;\r\n\t\tbox-shadow: 0 2rpx 8rpx rgba(30, 144, 255, 0.3);\r\n\t\ttransition: all 0.3s;\r\n\t}\r\n\t\r\n\t.new-chat-btn:active {\r\n\t\topacity: 0.8;\r\n\t\ttransform: scale(0.98);\r\n\t}\r\n\t\r\n\t.new-chat-btn text {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #fff;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'E:/yanshilu重新来过/前端yanshilu_1/pages/AI/AI.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","store","uni"],"mappings":"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"}