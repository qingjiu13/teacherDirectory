{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description 我的页面（通用）\n */\nimport { Navigator, MineRoutes } from '@/router/Router.js';\nimport TabBar from '../../../components/tab-bar/tab-bar.uvue';\nimport store, { loadTeacherData, loadStudentData } from '@/store/index.js';\nexport default defineComponent({\n    components: {\n        TabBar\n    },\n    data() {\n        return {\n            userRole: 'student',\n            userName: '',\n            userData: new UTSJSONObject({}),\n            isLoggedIn: true,\n            MineRoutes,\n            isLoading: false,\n            // 模拟数据\n            mockTeacherData: new UTSJSONObject({\n                id: 'teacher123',\n                nickname: '王教授',\n                avatarUrl: '/static/image/tab-bar/default_avatar.png',\n                tag: '已认证',\n                role: 'teacher',\n                school: '北京大学',\n                major: '计算机科学',\n                score: 4.9,\n                wallet: new UTSJSONObject({\n                    balance: 2580.50,\n                    income: 5000.00\n                }),\n                qualifications: new UTSJSONObject({\n                    isVerified: true,\n                    certificates: ['教师资格证', '心理咨询师证']\n                }),\n                services: [\n                    new UTSJSONObject({ id: 1, title: '高数一对一', price: 300 }),\n                    new UTSJSONObject({ id: 2, title: '编程辅导', price: 250 })\n                ]\n            }),\n            mockStudentData: new UTSJSONObject({\n                id: 'student456',\n                nickname: '小明同学',\n                avatarUrl: '/static/image/tab-bar/default_avatar.png',\n                tag: '学生',\n                role: 'student',\n                school: '清华大学',\n                major: '机械工程',\n                grade: '大二',\n                courses: [\n                    new UTSJSONObject({ id: 101, title: '高等数学', progress: 60 }),\n                    new UTSJSONObject({ id: 102, title: 'C++编程基础', progress: 85 })\n                ]\n            })\n        };\n    },\n    onLoad() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // 设置加载状态\n            this.isLoading = true;\n            try {\n                // 获取用户角色信息或使用默认值\n                const storedUserRole = uni.getStorageSync('userRole') || 'student';\n                this.userRole = storedUserRole;\n                // 根据角色加载数据\n                if (this.userRole === 'teacher') {\n                    // 加载教师特有数据\n                    yield loadTeacherData();\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:180', '教师数据已加载');\n                }\n                else {\n                    // 加载学生特有数据\n                    yield loadStudentData();\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:184', '学生数据已加载');\n                }\n                // 加载测试数据\n                this.loadMockData();\n                uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:189', \"当前用户角色:\", this.userRole);\n            }\n            catch (error) {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.uvue:191', '加载用户数据失败:', error);\n            }\n            finally {\n                this.isLoading = false;\n            }\n        });\n    },\n    onShow() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // 每次显示页面时检查角色状态\n            const storedUserRole = uni.getStorageSync('userRole');\n            if (storedUserRole && storedUserRole !== this.userRole) {\n                this.isLoading = true;\n                try {\n                    this.userRole = storedUserRole;\n                    // 角色变更时重新加载相应数据\n                    if (this.userRole === 'teacher') {\n                        yield loadTeacherData();\n                        uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:209', '教师数据已重新加载');\n                    }\n                    else {\n                        yield loadStudentData();\n                        uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:212', '学生数据已重新加载');\n                    }\n                    // 重新加载对应的测试数据\n                    this.loadMockData();\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:217', \"onShow 更新用户角色:\", this.userRole);\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/mine/mine_common.uvue:219', '角色切换时加载数据失败:', error);\n                }\n                finally {\n                    this.isLoading = false;\n                }\n            }\n        });\n    },\n    methods: {\n        /**\n         * @description 加载模拟数据\n         */\n        loadMockData() {\n            // 根据当前角色加载对应的模拟数据\n            if (this.userRole === 'teacher') {\n                this.userData = this.mockTeacherData;\n            }\n            else {\n                this.userData = this.mockStudentData;\n            }\n            this.userName = this.userData.nickname;\n            // 保存当前角色到storage\n            uni.setStorageSync('userRole', this.userRole);\n            uni.setStorageSync('userInfo', UTS.JSON.stringify(this.userData));\n            uni.setStorageSync('token', 'mock_token_for_testing'); // 模拟token\n            this.isLoggedIn = true; // 测试模式下始终为登录状态\n            uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:245', \"加载模拟数据:\", this.userData);\n        },\n        /**\n         * @description 切换用户角色（用于调试）\n         * @param {String} role - 目标角色\n         */\n        switchRole(role = null) {\n            if (this.userRole !== role) {\n                this.userRole = role;\n                this.loadMockData();\n                uni.showToast({\n                    title: role === 'teacher' ? '已切换为老师模式' : '已切换为学生模式',\n                    icon: 'none'\n                });\n            }\n        },\n        /**\n         * @description 加载用户数据（保留原方法，但在调试模式不使用）\n         */\n        loadUserData() {\n            // 在测试模式下，使用模拟数据而不是从storage加载\n            if (uni.getStorageSync('debug_mode') === 'true') {\n                this.loadMockData();\n                return null;\n            }\n            // 检查登录状态\n            const token = uni.getStorageSync('token');\n            this.isLoggedIn = !!token;\n            if (this.isLoggedIn) {\n                // 获取用户信息\n                const userInfo = uni.getStorageSync('userInfo');\n                if (userInfo) {\n                    try {\n                        this.userData = typeof userInfo === 'string' ? UTS.JSON.parse(userInfo) : userInfo;\n                        this.userName = this.userData.nickname || '用户';\n                        // 如果存储中有用户角色，使用存储的角色\n                        if (this.userData.role) {\n                            this.userRole = this.userData.role;\n                            // 同步更新到storage\n                            uni.setStorageSync('userRole', this.userData.role);\n                        }\n                    }\n                    catch (e) {\n                        uni.__f__('error', 'at pages/mine/mine/mine_common.uvue:292', '解析用户信息失败:', e);\n                    }\n                }\n            }\n            else {\n                this.userData = new UTSJSONObject({});\n                this.userName = '';\n                // 未登录时默认显示学生界面\n                this.userRole = 'student';\n            }\n            uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:302', \"加载用户数据后的角色:\", this.userRole); // 调试输出\n        },\n        /**\n         * @description 处理头像点击\n         */\n        handleAvatarClick() {\n            // 简化处理，不检查登录状态\n            this.handleEditProfile();\n        },\n        /**\n         * @description 处理登录文本点击\n         */\n        handleLoginClick() {\n            // 简化处理，不检查登录状态\n            this.handleEditProfile();\n        },\n        /**\n         * @description 跳转到修改个人信息页面\n         */\n        handleEditProfile() {\n            // 简化处理，不检查登录状态\n            Navigator.toModify();\n        },\n        /**\n         * @description 页面跳转方法\n         * @param {string} url - 目标页面路径\n         */\n        navigateTo(url = null) {\n            // 简化处理，不检查登录状态\n            Navigator.navigateTo(url);\n        },\n        /**\n         * @description 处理退出登录\n         */\n        handleLogout() {\n            uni.showModal({\n                title: '提示',\n                content: '确定要退出登录吗？',\n                success: (res) => {\n                    if (res.confirm) {\n                        // 清除登录信息\n                        uni.removeStorageSync('token');\n                        uni.removeStorageSync('userInfo');\n                        uni.removeStorageSync('userRole');\n                        // 更新页面显示\n                        this.isLoggedIn = false;\n                        this.userData = new UTSJSONObject({});\n                        this.userName = '';\n                        this.userRole = 'student'; // 退出后默认显示学生界面\n                        uni.showToast({\n                            title: '已退出登录',\n                            icon: 'success'\n                        });\n                    }\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=E:/yanshilu%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87/%E5%89%8D%E7%AB%AFyanshilu_1/pages/mine/mine/mine_common.uvue?vue&type=script&lang.uts.js.map","references":["E:/yanshilu重新来过/前端yanshilu_1/router/Router.js","E:/yanshilu重新来过/前端yanshilu_1/components/tab-bar/tab-bar.uvue.ts","E:/yanshilu重新来过/前端yanshilu_1/store/index.js"],"uniExtApis":["uni.getStorageSync","uni.__f__","uni.setStorageSync","uni.showToast","uni.showModal","uni.removeStorageSync"],"map":"{\"version\":3,\"file\":\"mine_common.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"mine_common.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
