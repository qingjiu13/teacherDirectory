{"code":"import { defineComponent } from \"vue\";\nlet dropdownInstances = [];\nexport default defineComponent({\n    name: \"ChoiceSelected\",\n    data() {\n        return {\n            isShowChoice: false,\n            dropdownTop: 0,\n            dropdownLeft: 0,\n            dropdownWidth: 0,\n            displayContent: this.defaultText,\n            searchKeyword: '',\n            searchTimer: null,\n            filteredList: [],\n            isFocused: false // 是否处于聚焦状态\n        };\n    },\n    props: {\n        choiceIndex: {\n            type: Number,\n            default: -1 // 默认-1表示未选择\n        },\n        choiceList: {\n            type: Array,\n            default: () => { return []; }\n        },\n        defaultText: {\n            type: String,\n            default: '请选择'\n        },\n        mode: {\n            type: String,\n            default: 'select',\n            validator: (value = null) => { return ['select', 'search'].includes(value); }\n        },\n        debounce: {\n            type: Number,\n            default: 300\n        },\n        searchPlaceholder: {\n            type: String,\n            default: '请输入关键词'\n        }\n    },\n    created() {\n        // 将当前实例添加到实例数组，便于全局管理\n        dropdownInstances.push(this);\n    },\n    beforeDestroy() {\n        // 移除当前实例\n        const index = dropdownInstances.indexOf(this);\n        if (index > -1) {\n            dropdownInstances.splice(index, 1);\n        }\n        // 清除防抖定时器\n        if (this.searchTimer) {\n            clearTimeout(this.searchTimer);\n        }\n    },\n    computed: {\n        /**\n         * @description 根据搜索关键词过滤选项列表\n         * @returns {Array} 过滤后的选项列表\n         */\n        filteredChoiceList() {\n            if (!this.searchKeyword || this.mode === 'select') {\n                return this.choiceList;\n            }\n            // 根据关键词过滤选项\n            return this.choiceList.filter((item = null) => {\n                return item.choiceItemContent.toLowerCase().includes(this.searchKeyword.toLowerCase());\n            });\n        }\n    },\n    watch: {\n        choiceIndex(newVal = null) {\n            // 当choiceIndex变化时更新显示内容\n            if (newVal >= 0 && newVal < this.choiceList.length) {\n                const selectedItem = this.choiceList[newVal];\n                this.displayContent = selectedItem.choiceItemContent;\n                // 在搜索模式下，设置搜索关键词为选中项\n                if (this.mode === 'search') {\n                    this.searchKeyword = selectedItem.choiceItemContent;\n                }\n            }\n            else {\n                this.displayContent = this.defaultText;\n                if (this.mode === 'search') {\n                    this.searchKeyword = '';\n                }\n            }\n        },\n        defaultText(newVal = null) {\n            // 如果当前没有选择任何选项，更新默认文本\n            if (this.choiceIndex < 0 || this.choiceIndex >= this.choiceList.length) {\n                this.displayContent = newVal;\n            }\n        }\n    },\n    methods: {\n        /**\n         * @description 处理选项点击事件，关闭下拉框并触发选择事件\n         * @param {Number} position - 选中项的索引位置\n         */\n        btnChoiceClick: function (position = null) {\n            var _this = this;\n            _this.isShowChoice = false;\n            // 在搜索模式下，我们需要找出在原始列表中的实际位置\n            if (_this.mode === 'search' && _this.searchKeyword) {\n                const selectedItem = _this.filteredChoiceList[position];\n                const originalIndex = _this.choiceList.findIndex((item = null) => { return item.choiceItemId === selectedItem.choiceItemId; });\n                if (originalIndex !== -1) {\n                    _this.$emit(\"onChoiceClick\", originalIndex);\n                    return null;\n                }\n            }\n            // 对于普通模式或未找到匹配项\n            _this.$emit(\"onChoiceClick\", position);\n        },\n        /**\n         * @description 切换下拉框的显示与隐藏状态\n         * @param {Event} event - 点击事件对象\n         */\n        btnShowHideClick: function (event = null) {\n            // 阻止事件冒泡\n            event.stopPropagation();\n            var _this = this;\n            if (_this.isShowChoice) {\n                _this.isShowChoice = false;\n            }\n            else {\n                // 关闭其他所有下拉框\n                this.closeOtherDropdowns();\n                // 使用uni.createSelectorQuery获取触发按钮的位置和尺寸\n                const query = uni.createSelectorQuery().in(this);\n                query.select('.drop-down-box, .drop-down-box-selected').boundingClientRect((data = null) => {\n                    if (data) {\n                        _this.dropdownTop = data.top + data.height;\n                        _this.dropdownLeft = data.left;\n                        _this.dropdownWidth = data.width;\n                        _this.isShowChoice = true;\n                    }\n                }).exec();\n            }\n        },\n        /**\n         * @description 关闭其他下拉框，只保留当前实例的下拉框\n         */\n        closeOtherDropdowns() {\n            dropdownInstances.forEach(instance => {\n                if (instance !== this && instance.isShowChoice) {\n                    instance.isShowChoice = false;\n                }\n            });\n        },\n        /**\n         * @description 处理搜索输入事件，带防抖\n         * @param {Event} event - 输入事件对象\n         */\n        onSearchInput(event = null) {\n            const _this = this;\n            // 清除之前的定时器\n            if (_this.searchTimer) {\n                clearTimeout(_this.searchTimer);\n            }\n            // 设置防抖定时器\n            _this.searchTimer = setTimeout(() => {\n                // 触发搜索输入事件\n                _this.$emit('search-input', _this.searchKeyword);\n                // 确保下拉框处于打开状态\n                if (!_this.isShowChoice) {\n                    _this.btnShowHideClick(event);\n                }\n            }, _this.debounce);\n        },\n        /**\n         * @description 处理输入框聚焦事件\n         * @param {Event} event - 聚焦事件对象\n         */\n        onInputFocus(event = null) {\n            this.isFocused = true;\n            // 如果下拉框未显示，阻止下拉框被关闭\n            event.stopPropagation();\n            // 如果下拉框未显示，则显示\n            if (!this.isShowChoice) {\n                this.btnShowHideClick(event);\n            }\n        },\n        /**\n         * @description 关闭当前下拉框\n         * @public 供外部调用\n         */\n        closeDropdown() {\n            if (this.isShowChoice) {\n                this.isShowChoice = false;\n            }\n        }\n    }\n});\n//# sourceMappingURL=E:/yanshilu%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87/%E5%89%8D%E7%AB%AFyanshilu_1/components/combobox/combobox.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.createSelectorQuery"],"map":"{\"version\":3,\"file\":\"combobox.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"combobox.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
