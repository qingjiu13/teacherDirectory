{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description 我的页面（通用）\n */\nimport { Navigator, MineRoutes } from '@/router/Router.js';\nimport TabBar from '../../../components/tab-bar/tab-bar.uvue';\nimport store, { loadTeacherData, loadStudentData } from '@/store/index.js';\nimport { services } from '@/store/services';\nexport default defineComponent({\n    components: {\n        TabBar\n    },\n    data() {\n        return {\n            userRole: 'student',\n            userName: '',\n            userData: new UTSJSONObject({}),\n            isLoggedIn: true,\n            MineRoutes,\n            isLoading: false // 加载状态\n        };\n    },\n    onLoad() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // 设置加载状态\n            this.isLoading = true;\n            try {\n                // 获取用户角色信息或使用默认值\n                const storedUserRole = uni.getStorageSync('userRole') || 'student';\n                this.userRole = storedUserRole;\n                // 根据角色加载数据\n                if (this.userRole === 'teacher') {\n                    // 加载教师特有数据\n                    yield loadTeacherData();\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:124', '教师数据已加载');\n                }\n                else {\n                    // 加载学生特有数据\n                    yield loadStudentData();\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:128', '学生数据已加载');\n                }\n                // 加载测试数据\n                this.loadMockData();\n                uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:133', \"当前用户角色:\", this.userRole);\n            }\n            catch (error) {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.uvue:135', '加载用户数据失败:', error);\n            }\n            finally {\n                this.isLoading = false;\n            }\n        });\n    },\n    onShow() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // 每次显示页面时检查登录状态\n            const token = uni.getStorageSync('token');\n            const isCurrentlyLoggedIn = !!token;\n            // 更新登录状态并处理相应的UI\n            this.isLoggedIn = isCurrentlyLoggedIn;\n            if (!this.isLoggedIn) {\n                // 用户未登录，清除显示数据\n                this.userData = new UTSJSONObject({});\n                this.userName = '';\n                uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:151', 'onShow: 用户未登录，清除用户数据显示');\n                return Promise.resolve(null); // 未登录则不继续加载数据\n            }\n            const storedUserRole = uni.getStorageSync('userRole');\n            // 检查并获取模拟数据设置\n            const useMockData = uni.getStorageSync('use_mock_api') === 'true';\n            uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:159', 'onShow: 模拟数据状态:', useMockData ? '启用' : '禁用');\n            if (storedUserRole && storedUserRole !== this.userRole) {\n                this.isLoading = true;\n                try {\n                    this.userRole = storedUserRole;\n                    // 角色变更时重新加载相应数据\n                    if (this.userRole === 'teacher') {\n                        yield loadTeacherData();\n                        uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:170', '教师数据已重新加载');\n                    }\n                    else {\n                        yield loadStudentData();\n                        uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:173', '学生数据已重新加载');\n                    }\n                    // 确保无论是否角色变更，都重新加载对应的测试数据\n                    this.loadMockData();\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:178', \"onShow 更新用户角色:\", this.userRole);\n                }\n                catch (error) {\n                    uni.__f__('error', 'at pages/mine/mine/mine_common.uvue:180', '角色切换时加载数据失败:', error);\n                }\n                finally {\n                    this.isLoading = false;\n                }\n            }\n            else {\n                // 即使角色没变，也要检查是否需要重新加载模拟数据\n                // 避免因为设置变更而数据未更新的情况\n                if (useMockData) {\n                    this.loadMockData();\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:189', 'onShow: 重新加载模拟数据');\n                }\n            }\n        });\n    },\n    methods: {\n        /**\n         * @description 加载模拟数据\n         */\n        loadMockData() {\n            // 检查是否使用模拟数据 - 增强检测逻辑\n            const storageSetting = uni.getStorageSync('use_mock_api');\n            const useMockData = storageSetting === 'true' || process.env.NODE_ENV === 'development';\n            uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:202', '加载用户数据，模拟数据状态:', useMockData ? '启用' : '禁用', 'Storage值:', storageSetting);\n            // 如果明确设置了使用模拟数据，确保设置保持一致\n            if (useMockData && storageSetting !== 'true') {\n                uni.setStorageSync('use_mock_api', 'true');\n                uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:207', '已更新storage中的模拟数据设置为: true');\n            }\n            // 首先检查登录状态\n            const token = uni.getStorageSync('token');\n            this.isLoggedIn = !!token;\n            // 如果未登录，清除用户数据并返回\n            if (!this.isLoggedIn) {\n                this.userData = new UTSJSONObject({});\n                this.userName = '';\n                uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:218', '用户未登录，不加载用户资料');\n                return null;\n            }\n            // 使用services.user.getUserProfile获取用户资料\n            // 这将调用user.api.js中的getUserProfile方法\n            this.isLoading = true;\n            services.user.getUserProfile(this.userRole)\n                .then((response = null) => {\n                if (response && response.data) {\n                    this.userData = response.data;\n                    this.userName = this.userData.nickname || '用户';\n                    // 同步更新到storage，但不重设token\n                    uni.setStorageSync('userRole', this.userRole);\n                    uni.setStorageSync('userInfo', UTS.JSON.stringify(this.userData));\n                    // 不再设置模拟token：uni.setStorageSync('token', 'mock_token_for_testing');\n                    uni.__f__('log', 'at pages/mine/mine/mine_common.uvue:237', \"加载用户资料成功:\", this.userData);\n                }\n                else {\n                    uni.__f__('error', 'at pages/mine/mine/mine_common.uvue:239', '获取用户资料失败: 响应数据无效');\n                }\n            })\n                .catch((error = null) => {\n                uni.__f__('error', 'at pages/mine/mine/mine_common.uvue:243', '获取用户资料失败:', error);\n            })\n                .finally(() => {\n                this.isLoading = false;\n            });\n        },\n        /**\n         * @description 处理头像点击\n         */\n        handleAvatarClick() {\n            // 简化处理，不检查登录状态\n            this.handleEditProfile();\n        },\n        /**\n         * @description 处理登录文本点击\n         */\n        handleLoginClick() {\n            // 简化处理，不检查登录状态\n            this.handleEditProfile();\n        },\n        /**\n         * @description 跳转到修改个人信息页面\n         */\n        handleEditProfile() {\n            // 简化处理，不检查登录状态\n            Navigator.toModify();\n        },\n        /**\n         * @description 页面跳转方法\n         * @param {string} url - 目标页面路径\n         */\n        navigateTo(url = null) {\n            // 简化处理，不检查登录状态\n            Navigator.navigateTo(url);\n        }\n    }\n});\n//# sourceMappingURL=E:/yanshilu%E9%87%8D%E6%96%B0%E6%9D%A5%E8%BF%87/%E5%89%8D%E7%AB%AFyanshilu_1/pages/mine/mine/mine_common.uvue?vue&type=script&lang.uts.js.map","references":["E:/yanshilu重新来过/前端yanshilu_1/router/Router.js","E:/yanshilu重新来过/前端yanshilu_1/components/tab-bar/tab-bar.uvue.ts","E:/yanshilu重新来过/前端yanshilu_1/store/index.js","E:/yanshilu重新来过/前端yanshilu_1/store/services/index.js"],"uniExtApis":["uni.getStorageSync","uni.__f__","uni.setStorageSync"],"map":"{\"version\":3,\"file\":\"mine_common.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"mine_common.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
