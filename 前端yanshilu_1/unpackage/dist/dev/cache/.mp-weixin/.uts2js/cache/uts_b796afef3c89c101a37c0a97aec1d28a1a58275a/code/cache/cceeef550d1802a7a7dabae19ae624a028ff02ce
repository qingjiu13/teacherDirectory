{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description 我的页面（通用）\n */\nimport { Navigator, MineRoutes } from '@/router/Router.js';\nimport TabBar from '../../../components/tab-bar/tab-bar.uvue';\nimport store, { loadTeacherData, loadStudentData } from '@/store/index.js';\nimport { services } from '@/store/services';\nimport { mapGetters } from 'vuex';\nexport default defineComponent({\n    components: {\n        TabBar\n    },\n    data() {\n        return {\n            userRole: 'student',\n            userName: '',\n            userData: new UTSJSONObject({}),\n            isLoggedIn: false,\n            MineRoutes,\n            isLoading: false\n        };\n    },\n    computed: Object.assign({}, mapGetters('user', [\n        'teacherCertTag',\n        'teacherOtherTags',\n        'studentTags'\n    ])),\n    onLoad() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.loadUserData();\n        });\n    },\n    onShow() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const storedUserRole = uni.getStorageSync('userRole');\n            if (storedUserRole && storedUserRole !== this.userRole) {\n                this.userRole = storedUserRole;\n                yield this.loadUserData();\n            }\n            else {\n                // 检查Vuex store是否有数据\n                const userProfile = this.$store.getters['user/profile'];\n                if (!userProfile || !userProfile.nickname) {\n                    yield this.loadUserData();\n                }\n            }\n        });\n    },\n    methods: {\n        /**\n         * @description 加载用户数据\n         */\n        loadUserData() {\n            return __awaiter(this, void 0, void 0, function* () {\n                this.isLoading = true;\n                try {\n                    // 检查模拟数据环境\n                    const useMockData = uni.getStorageSync('use_mock_api') === 'true' || process.env.NODE_ENV === 'development';\n                    if (useMockData && !uni.getStorageSync('token')) {\n                        uni.setStorageSync('token', 'mock_token_for_testing');\n                    }\n                    // 获取用户角色\n                    const storedUserRole = uni.getStorageSync('userRole') || 'student';\n                    this.userRole = storedUserRole;\n                    // 根据角色加载数据\n                    if (this.userRole === 'teacher') {\n                        yield loadTeacherData();\n                    }\n                    else {\n                        yield loadStudentData();\n                    }\n                    // 从Vuex获取用户资料\n                    yield this.syncUserDataFromVuex();\n                }\n                catch (error) {\n                    // 出错时直接通过API获取数据\n                    this.loadUserDataFromApi();\n                }\n                finally {\n                    this.isLoading = false;\n                }\n            });\n        },\n        /**\n         * @description 从Vuex同步用户数据\n         */\n        syncUserDataFromVuex() {\n            return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    yield this.$store.dispatch('user/fetchProfile');\n                    const userProfile = this.$store.getters['user/profile'];\n                    if (userProfile && userProfile.nickname) {\n                        this.userData = new UTSJSONObject(Object.assign({}, userProfile));\n                        this.userName = userProfile.nickname || '用户';\n                        // 同步更新到storage\n                        uni.setStorageSync('userRole', this.userRole);\n                        uni.setStorageSync('userInfo', UTS.JSON.stringify(this.userData));\n                    }\n                    else {\n                        // 如果Vuex没有数据，则使用API直接获取\n                        this.loadUserDataFromApi();\n                    }\n                }\n                catch (error) {\n                    this.loadUserDataFromApi();\n                }\n            });\n        },\n        /**\n         * @description 从API直接获取用户资料\n         */\n        loadUserDataFromApi() {\n            services.user.getUserProfile(this.userRole)\n                .then((response = null) => {\n                if (response && response.data) {\n                    this.userData = response.data;\n                    this.userName = this.userData.nickname || '用户';\n                    // 同步更新到storage\n                    uni.setStorageSync('userRole', this.userRole);\n                    uni.setStorageSync('userInfo', UTS.JSON.stringify(this.userData));\n                }\n            })\n                .catch((error = null) => { })\n                .finally(() => {\n                this.isLoading = false;\n            });\n        },\n        /**\n         * @description 处理头像点击\n         */\n        handleAvatarClick() {\n            this.handleEditProfile();\n        },\n        /**\n         * @description 处理登录文本点击\n         */\n        handleLoginClick() {\n            this.handleEditProfile();\n        },\n        /**\n         * @description 跳转到修改个人信息页面\n         */\n        handleEditProfile() {\n            Navigator.toModify();\n        },\n        /**\n         * @description 页面跳转方法\n         * @param {string} url - 目标页面路径\n         */\n        navigateTo(url = null) {\n            Navigator.navigateTo(url);\n        }\n    }\n});\n//# sourceMappingURL=E:/%E7%A0%94%E5%B8%88%E5%BD%95%E4%B8%8E%E5%85%B6%E4%BB%96%E4%BA%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/teacherDirectory/%E5%89%8D%E7%AB%AFyanshilu_1/pages/mine/mine/mine_common.uvue?vue&type=script&lang.uts.js.map","references":["E:/研师录与其他人共享文件/teacherDirectory/前端yanshilu_1/router/Router.js","E:/研师录与其他人共享文件/teacherDirectory/前端yanshilu_1/components/tab-bar/tab-bar.uvue.ts","E:/研师录与其他人共享文件/teacherDirectory/前端yanshilu_1/store/index.js","E:/研师录与其他人共享文件/teacherDirectory/前端yanshilu_1/store/services/index.js","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/node_modules/vuex/types/index.d.ts"],"uniExtApis":["uni.getStorageSync","uni.setStorageSync"],"map":"{\"version\":3,\"file\":\"mine_common.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"mine_common.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
