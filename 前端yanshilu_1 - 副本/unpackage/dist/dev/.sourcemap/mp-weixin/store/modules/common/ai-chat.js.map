{"version":3,"file":"ai-chat.js","sources":["store/modules/common/ai-chat.js"],"sourcesContent":["/**\n * @description AI聊天模块 - 处理AI对话功能（共享模块）\n */\nimport { services } from '../../services';\n\n// 初始状态\nconst state = {\n  isLoading: false,\n  isTesting: false,\n  error: null,\n  messages: [],\n  conversationId: null,\n  lastResponse: null,\n  testResult: null,\n  // 新增历史会话管理\n  historyChats: [],\n  historySummaries: [], // 新增：历史会话摘要列表（只包含ID和标题等基本信息）\n  currentChatId: null\n};\n\n// Getters\nconst getters = {\n  isLoading: state => state.isLoading,\n  isTesting: state => state.isTesting,\n  error: state => state.error,\n  messages: state => state.messages,\n  lastResponse: state => state.lastResponse,\n  conversationId: state => state.conversationId,\n  testResult: state => state.testResult,\n  // 新增历史会话相关getters\n  historyChats: state => state.historyChats,\n  historySummaries: state => state.historySummaries, // 新增：历史会话摘要列表getter\n  currentChatId: state => state.currentChatId\n};\n\n// 引入常量类型\nconst SET_LOADING = 'SET_LOADING';\nconst SET_TESTING = 'SET_TESTING';\nconst SET_ERROR = 'SET_ERROR';\nconst SET_MESSAGES = 'SET_MESSAGES';\nconst ADD_MESSAGE = 'ADD_MESSAGE';\nconst SET_CONVERSATION_ID = 'SET_CONVERSATION_ID';\nconst SET_LAST_RESPONSE = 'SET_LAST_RESPONSE';\nconst CLEAR_CONVERSATION = 'CLEAR_CONVERSATION';\nconst SET_TEST_RESULT = 'SET_TEST_RESULT';\n// 新增历史会话相关常量\nconst SET_HISTORY_CHATS = 'SET_HISTORY_CHATS';\nconst SET_HISTORY_SUMMARIES = 'SET_HISTORY_SUMMARIES'; // 新增：设置历史摘要常量\nconst ADD_HISTORY_CHAT = 'ADD_HISTORY_CHAT';\nconst UPDATE_HISTORY_CHAT = 'UPDATE_HISTORY_CHAT';\nconst REMOVE_HISTORY_CHAT = 'REMOVE_HISTORY_CHAT';\nconst SET_CURRENT_CHAT_ID = 'SET_CURRENT_CHAT_ID';\n\n// Mutations\nconst mutations = {\n  [SET_LOADING](state, status) {\n    state.isLoading = status;\n  },\n  [SET_TESTING](state, status) {\n    state.isTesting = status;\n  },\n  [SET_ERROR](state, error) {\n    state.error = error;\n  },\n  [SET_MESSAGES](state, messages) {\n    state.messages = messages;\n  },\n  [ADD_MESSAGE](state, message) {\n    state.messages.push(message);\n  },\n  [SET_CONVERSATION_ID](state, id) {\n    state.conversationId = id;\n  },\n  [SET_LAST_RESPONSE](state, response) {\n    state.lastResponse = response;\n  },\n  [CLEAR_CONVERSATION](state) {\n    state.messages = [];\n    state.conversationId = null;\n    state.lastResponse = null;\n  },\n  [SET_TEST_RESULT](state, result) {\n    state.testResult = result;\n  },\n  // 新增历史会话相关mutations\n  [SET_HISTORY_CHATS](state, chats) {\n    state.historyChats = chats;\n  },\n  [SET_HISTORY_SUMMARIES](state, summaries) { // 新增：设置历史摘要的mutation\n    state.historySummaries = summaries;\n  },\n  [ADD_HISTORY_CHAT](state, chat) {\n    // 添加到列表前端，最新的对话在最前面\n    state.historyChats.unshift(chat);\n  },\n  [UPDATE_HISTORY_CHAT](state, updatedChat) {\n    const index = state.historyChats.findIndex(chat => chat.id === updatedChat.id);\n    if (index !== -1) {\n      state.historyChats.splice(index, 1, updatedChat);\n    }\n  },\n  [REMOVE_HISTORY_CHAT](state, chatId) {\n    state.historyChats = state.historyChats.filter(chat => chat.id !== chatId);\n    state.historySummaries = state.historySummaries.filter(chat => chat.id !== chatId);\n  },\n  [SET_CURRENT_CHAT_ID](state, chatId) {\n    state.currentChatId = chatId;\n  }\n};\n\n// Actions\nconst actions = {\n  /**\n   * @description 发送聊天消息\n   * @param {Object} context - Vuex上下文\n   * @param {Object} payload - 请求参数\n   * @param {string} payload.message - 消息内容\n   * @param {Object} [payload.context] - 上下文信息\n   * @returns {Promise<Object>} 发送结果\n   */\n  async sendChatMessage({ commit, state }, { message, context = {} }) {\n    try {\n      commit(SET_LOADING, true);\n      commit(SET_ERROR, null);\n      \n      // 添加用户消息到列表\n      const userMessage = {\n        id: Date.now().toString(),\n        content: message,\n        role: 'user',\n        timestamp: new Date().toISOString()\n      };\n      commit(ADD_MESSAGE, userMessage);\n      \n      // 准备请求参数\n      const requestParams = {\n        message,\n        conversationId: state.conversationId,\n        context\n      };\n      \n      // 发送请求\n      const response = await services.aiChat.sendMessage(requestParams);\n      \n      if (!response.success) {\n        // 使用后端返回的错误信息\n        const errorMsg = response.error?.message || response.message || '发送消息失败';\n        throw new Error(errorMsg);\n      }\n      \n      // 保存会话ID（如果是新会话）\n      if (response.data.conversationId && !state.conversationId) {\n        commit(SET_CONVERSATION_ID, response.data.conversationId);\n      }\n      \n      // 添加AI回复到消息列表\n      const aiMessage = {\n        id: response.data.messageId || `ai-${Date.now()}`,\n        content: response.data.content,\n        role: 'assistant',\n        timestamp: new Date().toISOString()\n      };\n      commit(ADD_MESSAGE, aiMessage);\n      commit(SET_LAST_RESPONSE, response.data);\n      \n      return response.data;\n    } catch (error) {\n      console.error('发送聊天消息失败:', error);\n      \n      // 保存错误信息\n      commit(SET_ERROR, {\n        message: error.message || '系统错误',\n        timestamp: new Date().toISOString(),\n        details: error\n      });\n      \n      // 添加错误消息\n      const errorMessage = {\n        id: `error-${Date.now()}`,\n        content: error.message || '系统错误，请稍后再试',\n        role: 'assistant',\n        isError: true,\n        timestamp: new Date().toISOString()\n      };\n      commit(ADD_MESSAGE, errorMessage);\n      \n      return { \n        success: false, \n        error: error, \n        message: error.message || '系统错误' \n      };\n    } finally {\n      commit(SET_LOADING, false);\n    }\n  },\n  \n  /**\n   * @description 获取历史消息\n   * @param {Object} context - Vuex上下文\n   * @param {string} conversationId - 会话ID\n   * @returns {Promise<Object>} 历史消息\n   */\n  async getConversationHistory({ commit }, conversationId) {\n    try {\n      commit(SET_LOADING, true);\n      commit(SET_ERROR, null);\n      \n      const response = await services.aiChat.getMessages(conversationId);\n      \n      if (response.success) {\n        commit(SET_MESSAGES, response.data.messages || []);\n        commit(SET_CONVERSATION_ID, conversationId);\n      } else {\n        throw response.error || { message: response.message || '获取历史消息失败' };\n      }\n      \n      return response;\n    } catch (error) {\n      console.error('获取历史消息失败:', error);\n      commit(SET_ERROR, error);\n      return { success: false, error, message: error.message };\n    } finally {\n      commit(SET_LOADING, false);\n    }\n  },\n  \n  /**\n   * @description 创建新会话\n   * @param {Object} context - Vuex上下文\n   * @returns {Promise<Object>} 创建结果\n   */\n  async createNewConversation({ commit }) {\n    try {\n      commit(SET_LOADING, true);\n      commit(SET_ERROR, null);\n      commit(CLEAR_CONVERSATION);\n      \n      const response = await services.aiChat.createConversation();\n      \n      if (response.success) {\n        commit(SET_CONVERSATION_ID, response.data.conversationId);\n      } else {\n        throw response.error || { message: response.message || '创建会话失败' };\n      }\n      \n      return response;\n    } catch (error) {\n      console.error('创建会话失败:', error);\n      commit(SET_ERROR, error);\n      return { success: false, error, message: error.message };\n    } finally {\n      commit(SET_LOADING, false);\n    }\n  },\n  \n  /**\n   * @description 清除当前会话\n   * @param {Object} context - Vuex上下文\n   */\n  clearConversation({ commit }) {\n    commit(CLEAR_CONVERSATION);\n  },\n  \n  /**\n   * @description 测试AIQA接口\n   * @param {Object} context - Vuex上下文\n   * @param {Object} payload - 请求参数\n   * @param {string} payload.question - 用户提问\n   * @param {Object} payload.contextInfo - 用户上下文信息\n   * @param {string} [payload.chatId] - 聊天会话ID\n   * @returns {Promise<Object>} 测试结果\n   */\n  async testAIQA({ commit, dispatch }, { question, contextInfo = {}, chatId = null }) {\n    try {\n      commit(SET_LOADING, true);\n      commit(SET_TESTING, true);\n      commit(SET_ERROR, null);\n      \n      // 如果有会话ID，设置当前会话ID\n      if (chatId) {\n        commit(SET_CURRENT_CHAT_ID, chatId);\n      }\n      \n      // 调用服务，传递问题和上下文信息\n      const result = await services.aiChat.testAIQA(question, contextInfo);\n      \n      if (result.success) {\n        commit(SET_TEST_RESULT, result.data);\n        return result;\n      } else {\n        // 使用后端返回的错误信息\n        const errorMsg = result.error?.message || result.message || '测试AIQA失败';\n        commit(SET_ERROR, {\n          message: errorMsg,\n          timestamp: new Date().toISOString(),\n          details: result.error || result\n        });\n        return { success: false, message: errorMsg, error: result.error };\n      }\n    } catch (error) {\n      console.error('测试AIQA失败:', error);\n      commit(SET_ERROR, {\n        message: error.message || '系统错误',\n        timestamp: new Date().toISOString(),\n        details: error\n      });\n      return { success: false, error, message: error.message || '测试AIQA时发生错误' };\n    } finally {\n      commit(SET_LOADING, false);\n      commit(SET_TESTING, false);\n    }\n  },\n  \n  /**\n   * @description 清除测试结果\n   * @param {Object} context - Vuex上下文\n   */\n  clearTestResult({ commit }) {\n    commit(SET_TEST_RESULT, null);\n  },\n  \n  /**\n   * @description 获取历史会话列表\n   * @param {Object} context - Vuex上下文\n   * @returns {Promise<Object>} 历史会话\n   */\n  async getHistoryChats({ commit }) {\n    try {\n      commit(SET_LOADING, true);\n      \n      // 尝试从后端获取历史会话摘要\n      const response = await services.aiChat.getConversationSummaries();\n      \n      if (response.success) {\n        // 如果成功，则更新历史摘要状态\n        commit(SET_HISTORY_SUMMARIES, response.data.summaries || []);\n        return { success: true, data: response.data.summaries };\n      } else {\n        // 如果后端API不可用，从本地存储中获取\n        const localChats = uni.getStorageSync('chat_history') || '[]';\n        const chats = JSON.parse(localChats);\n        \n        // 从完整历史记录中提取摘要信息\n        const summaries = chats.map(chat => ({\n          id: chat.id,\n          title: chat.title || '新对话',\n          createdAt: chat.createdAt,\n          updatedAt: chat.updatedAt\n        }));\n        \n        commit(SET_HISTORY_SUMMARIES, summaries);\n        return { success: true, data: summaries };\n      }\n    } catch (error) {\n      console.error('获取历史会话失败:', error);\n      return { success: false, error, message: error.message };\n    } finally {\n      commit(SET_LOADING, false);\n    }\n  },\n  \n  /**\n   * @description 保存或更新聊天记录摘要\n   * @param {Object} context - Vuex上下文\n   * @param {Object} chatData - 聊天数据\n   * @returns {Promise<Object>} 保存结果\n   */\n  async saveChat({ commit, state }, chatData) {\n    try {\n      // 尝试调用后端API保存完整对话内容\n      try {\n        // 如果后端API可用，则调用API保存完整对话\n        await services.aiChat.saveConversation({\n          id: chatData.id,\n          title: chatData.title || '新对话',\n          messages: state.messages, // 保存完整的消息内容到后端\n          createdAt: chatData.createdAt || new Date(),\n          updatedAt: new Date()\n        });\n      } catch (apiError) {\n        console.error('保存对话到后端失败，将使用本地存储', apiError);\n      }\n      \n      // 从本地获取所有历史摘要\n      const localSummaries = uni.getStorageSync('chat_summaries') || '[]';\n      let summaries = JSON.parse(localSummaries);\n      \n      // 查找当前聊天是否存在\n      const existingIndex = summaries.findIndex(chat => chat.id === chatData.id);\n      \n      if (existingIndex !== -1) {\n        // 存在则更新摘要\n        summaries[existingIndex] = {\n          id: chatData.id,\n          title: chatData.title || '新对话',\n          createdAt: chatData.createdAt || new Date(),\n          updatedAt: new Date()\n        };\n        commit(UPDATE_HISTORY_CHAT, summaries[existingIndex]);\n      } else {\n        // 不存在则添加摘要\n        summaries.unshift({\n          id: chatData.id,\n          title: chatData.title || '新对话',\n          createdAt: chatData.createdAt || new Date(),\n          updatedAt: new Date()\n        });\n        commit(ADD_HISTORY_CHAT, {\n          id: chatData.id,\n          title: chatData.title || '新对话',\n          createdAt: chatData.createdAt || new Date(),\n          updatedAt: new Date()\n        });\n      }\n      \n      // 限制最大保存数量\n      if (summaries.length > 50) {\n        summaries = summaries.slice(0, 50);\n      }\n      \n      // 保存摘要到本地\n      uni.setStorageSync('chat_summaries', JSON.stringify(summaries));\n      \n      // 同时更新Vuex中的历史摘要\n      commit(SET_HISTORY_SUMMARIES, summaries);\n      \n      return { success: true };\n    } catch (error) {\n      console.error('保存聊天摘要失败:', error);\n      return { success: false, error, message: error.message };\n    }\n  },\n  \n  /**\n   * @description 删除聊天记录\n   * @param {Object} context - Vuex上下文\n   * @param {string} chatId - 聊天ID\n   * @returns {Promise<Object>} 删除结果\n   */\n  async deleteChat({ commit, state }, chatId) {\n    try {\n      if (!chatId) {\n        console.error('删除聊天记录失败: 缺少chatId参数');\n        return { success: false, message: '删除失败：没有指定要删除的聊天ID' };\n      }\n      \n      console.log('正在删除聊天记录:', chatId);\n      \n      // 尝试调用后端API删除对话\n      try {\n        // 如果后端API可用，则调用删除API\n        await services.aiChat.deleteConversation(chatId);\n      } catch (apiError) {\n        console.error('从后端删除对话失败，将仅删除本地记录', apiError);\n      }\n      \n      // 从本地获取所有历史摘要\n      const localSummaries = uni.getStorageSync('chat_summaries') || '[]';\n      let summaries = JSON.parse(localSummaries);\n      \n      // 过滤掉要删除的记录\n      const originalLength = summaries.length;\n      summaries = summaries.filter(chat => chat.id !== chatId);\n      \n      // 检查是否真的删除了记录\n      if (summaries.length === originalLength) {\n        console.warn('未找到要删除的记录ID:', chatId);\n      } else {\n        console.log(`成功从${originalLength}条记录中删除1条记录，剩余${summaries.length}条`);\n      }\n      \n      // 更新本地存储\n      uni.setStorageSync('chat_summaries', JSON.stringify(summaries));\n      \n      // 更新Vuex状态\n      commit(REMOVE_HISTORY_CHAT, chatId);\n      \n      // 如果删除的是当前会话，清空当前会话\n      if (state.currentChatId === chatId) {\n        commit(SET_CURRENT_CHAT_ID, null);\n        commit(CLEAR_CONVERSATION);\n      }\n      \n      return { success: true };\n    } catch (error) {\n      console.error('删除聊天记录失败:', error);\n      return { success: false, error, message: error.message };\n    }\n  },\n  \n  /**\n   * @description 设置当前会话\n   * @param {Object} context - Vuex上下文\n   * @param {string} chatId - 聊天ID\n   */\n  setCurrentChat({ commit }, chatId) {\n    commit(SET_CURRENT_CHAT_ID, chatId);\n  },\n  \n  /**\n   * @description 加载指定会话\n   * @param {Object} context - Vuex上下文\n   * @param {string} chatId - 聊天ID\n   * @returns {Promise<Object>} 会话数据\n   */\n  async loadChat({ commit, state, dispatch }, chatId) {\n    try {\n      commit(SET_LOADING, true);\n      commit(SET_ERROR, null);\n      \n      // 设置当前会话ID\n      commit(SET_CURRENT_CHAT_ID, chatId);\n      \n      // 从后端获取完整会话内容\n      const response = await services.aiChat.getMessages(chatId);\n      \n      if (response.success) {\n        // 设置会话消息\n        commit(SET_MESSAGES, response.data.messages || []);\n        commit(SET_CONVERSATION_ID, chatId);\n        return { success: true, data: response.data };\n      } else {\n        // 如果后端API失败，尝试从本地获取\n        const localChats = uni.getStorageSync('chat_history') || '[]';\n        const chats = JSON.parse(localChats);\n        \n        const chat = chats.find(c => c.id === chatId);\n        if (!chat) {\n          throw new Error('找不到指定的会话记录');\n        }\n        \n        // 设置会话消息\n        commit(SET_MESSAGES, chat.messages || []);\n        \n        return { success: true, data: chat };\n      }\n    } catch (error) {\n      console.error('加载会话记录失败:', error);\n      commit(SET_ERROR, error);\n      return { success: false, error, message: error.message };\n    } finally {\n      commit(SET_LOADING, false);\n    }\n  }\n};\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n}; "],"names":["state","services","uni"],"mappings":"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"}