{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description AI择校分析结果页面\n */\nimport { aiSelectionApis } from '../../../config.js';\nimport callCloudFunction from '../../../utils/cloudFunction.js';\nexport default defineComponent({\n    name: 'AISelectionResult',\n    data() {\n        return {\n            analysisId: '',\n            currentIndex: 0,\n            loading: true,\n            analysisResult: null,\n            displaySchools: [],\n        };\n    },\n    onLoad(options) {\n        uni.__f__('log', 'at pages/AI/selection/result.uvue:138', '结果页面加载，参数:', options);\n        this.analysisId = options.id || '';\n        this.loading = true;\n        // 直接加载云端数据，不使用本地存储\n        this.loadAnalysisResult();\n    },\n    methods: {\n        /**\n         * @description 从云端加载数据\n         */\n        loadAnalysisResult() {\n            return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    this.loading = true;\n                    uni.__f__('log', 'at pages/AI/selection/result.uvue:152', '尝试从云端加载数据, ID:', this.analysisId);\n                    // 从云端API加载数据\n                    const result = yield callCloudFunction(new UTSJSONObject({\n                        name: aiSelectionApis.getSchoolAnalysis,\n                        data: new UTSJSONObject({\n                            action: 'get',\n                            id: this.analysisId\n                        }),\n                        timeout: 15000\n                    }));\n                    uni.__f__('log', 'at pages/AI/selection/result.uvue:164', '获取分析结果返回:', result);\n                    if (result.result && result.result.code === 0 && result.result.data) {\n                        // 处理API返回的数据\n                        const data = result.result.data;\n                        if (data.analysis_result) {\n                            this.analysisResult = data;\n                            if (data.analysis_result.recommendSchools &&\n                                data.analysis_result.recommendSchools.length > 0) {\n                                this.displaySchools = data.analysis_result.recommendSchools;\n                                uni.__f__('log', 'at pages/AI/selection/result.uvue:176', '成功加载AI推荐学校:', this.displaySchools.length);\n                            }\n                            else if (data.analysis_result.rawResponse) {\n                                // 如果存在原始响应但JSON解析失败\n                                uni.__f__('log', 'at pages/AI/selection/result.uvue:179', 'API返回了原始响应但JSON解析失败');\n                                this.displaySchools = [{\n                                        name: \"API原始响应\",\n                                        features: \"以下是DeepSeek API的原始返回内容\",\n                                        reason: data.analysis_result.rawResponse.substring(0, 300) + '...',\n                                        difficulty: \"解析失败: \" + (data.analysis_result.parseError || \"未知原因\"),\n                                        suggestion: \"请尝试重新分析\",\n                                        rating: 0,\n                                        recommendMajor: \"无法解析\"\n                                    }];\n                            }\n                            else {\n                                // 没有推荐学校，显示错误\n                                this.showError('分析结果异常', '没有找到推荐学校信息，请尝试重新分析');\n                            }\n                        }\n                        else {\n                            // 缺少分析结果，显示错误\n                            this.showError('分析结果异常', '分析结果格式错误，请尝试重新分析');\n                        }\n                    }\n                    else {\n                        // API返回错误\n                        this.showError('获取分析结果失败', '无法获取分析结果，请尝试重新分析');\n                    }\n                }\n                catch (e) {\n                    // 捕获到异常\n                    this.showError('系统错误', '加载分析结果时发生错误: ' + e.message);\n                }\n                finally {\n                    this.loading = false;\n                }\n            });\n        },\n        /**\n         * @description 显示错误提示\n         * @param {String} title - 错误标题\n         * @param {String} content - 错误内容\n         */\n        showError(title = null, content = null) {\n            uni.showModal({\n                title: title,\n                content: content,\n                showCancel: false,\n                success: () => {\n                    uni.navigateBack();\n                }\n            });\n        },\n        /**\n         * @description 轮播图变化事件\n         * @param {Object} e - 事件对象\n         */\n        swiperChange(e = null) {\n            this.currentIndex = e.detail.current;\n        },\n        /**\n         * @description 跳转到指定卡片\n         * @param {Number} index - 卡片索引\n         */\n        jumpToCard(index = null) {\n            this.currentIndex = index;\n        },\n        /**\n         * @description 重新开始分析\n         */\n        restartAnalysis() {\n            uni.navigateBack({\n                delta: 10,\n                success: () => {\n                    uni.navigateTo({\n                        url: '/pages/AI/selection/selection'\n                    });\n                }\n            });\n        },\n        /**\n         * @description 分享结果\n         */\n        shareResult() {\n            uni.showToast({\n                title: '分享功能开发中',\n                icon: 'none'\n            });\n        },\n        /**\n         * @description 生成星星文本\n         * @param {Number} rating - 评分\n         * @returns {String} 星星文本\n         */\n        getStarText(rating = null) {\n            if (!rating && rating !== 0)\n                return '☆☆☆☆☆';\n            const score = parseFloat(rating) || 0;\n            const fullStars = Math.floor(score);\n            const hasHalfStar = (score - fullStars) >= 0.5;\n            let stars = '★'.repeat(fullStars);\n            if (hasHalfStar) {\n                stars += '☆';\n            }\n            const emptyStars = 5 - stars.length;\n            stars += '☆'.repeat(emptyStars);\n            return stars;\n        },\n        /**\n         * @description 格式化建议内容\n         * @param {String} text - 建议内容\n         * @returns {String} 格式化后的HTML\n         */\n        formatAdviceContent(text = null) {\n            if (!text)\n                return '暂无数据';\n            // 首先将内容按换行符分割\n            const lines = text.split('\\n');\n            let html = '';\n            // 逐行处理\n            for (let i = 0; i < lines.length; i++) {\n                const line = lines[i].trim();\n                if (!line)\n                    continue;\n                // 提取编号部分（如\"1.\"）\n                const numberMatch = line.match(/^(\\d+)\\.\\s*(.*)$/);\n                if (numberMatch) {\n                    // 找到编号格式，包装为列表项\n                    html += `<div class=\"list-item\"><strong>${numberMatch[1]}.</strong> ${numberMatch[2]}</div>`;\n                }\n                else {\n                    // 普通文本行\n                    html += `<div>${line}</div>`;\n                }\n            }\n            return html || text;\n        }\n    }\n});\n//# sourceMappingURL=E:/yanshilu%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AFyanshilu/pages/AI/selection/result.uvue?vue&type=script&lang.uts.js.map","references":["E:/yanshilu小程序前端/前端yanshilu/config.js","E:/yanshilu小程序前端/前端yanshilu/utils/cloudFunction.js"],"uniExtApis":["uni.__f__","uni.showModal","uni.navigateBack","uni.navigateTo","uni.showToast"],"map":"{\"version\":3,\"file\":\"result.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"result.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
