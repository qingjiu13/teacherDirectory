{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\n/**\n * @description AI择校分析中页面\n */\nimport { aiSelectionApis } from '../../../config.js';\nimport callCloudFunction from '../../../utils/cloudFunction.js';\nexport default defineComponent({\n    name: 'AISelectionAnalyzing',\n    data() {\n        return {\n            progressPercent: 0,\n            intervalId: null,\n            statusCheckInterval: null,\n            analysisId: '',\n            tips: [\n                '正在分析您的学术背景...',\n                '正在匹配最适合的院校...',\n                '正在评估录取可能性...',\n                '正在生成个性化建议...',\n                '即将完成分析，请稍等...'\n            ],\n            currentTip: '正在分析您的学术背景...',\n            checkCount: 0,\n            maxChecks: 30 // 最多检查30次（约1.5分钟）\n        };\n    },\n    onLoad(options) {\n        uni.__f__('log', 'at pages/AI/selection/analyzing.uvue:57', '分析页面加载，ID:', options.id);\n        this.analysisId = options.id || '';\n        // 在本地存储中保存此ID，以防页面跳转时丢失\n        if (this.analysisId) {\n            uni.setStorageSync('current_analysis_id', this.analysisId);\n        }\n        else {\n            uni.showModal({\n                title: '错误',\n                content: '未找到分析ID，请重新开始',\n                showCancel: false,\n                success: () => {\n                    uni.navigateBack();\n                }\n            });\n            return null;\n        }\n        // 启动进度条动画（仅起到视觉反馈作用）\n        this.startProgressAnimation();\n        // 开始检查分析状态\n        this.checkAnalysisStatus();\n    },\n    onUnload() {\n        // 清除所有定时器\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n        }\n        if (this.statusCheckInterval) {\n            clearInterval(this.statusCheckInterval);\n        }\n    },\n    methods: {\n        /**\n         * @description 启动进度条动画\n         */\n        startProgressAnimation() {\n            // 进度条初始值设为10%，给用户一些反馈\n            this.progressPercent = 10;\n            // 每5秒更换提示文字\n            this.intervalId = setInterval(() => {\n                const nextTipIndex = this.tips.indexOf(this.currentTip) + 1;\n                this.currentTip = this.tips[nextTipIndex % this.tips.length];\n                // 缓慢增加进度条\n                if (this.progressPercent < 85) {\n                    this.progressPercent += Math.floor(Math.random() * 3) + 1;\n                }\n            }, 3000);\n        },\n        /**\n         * @description 检查分析状态\n         */\n        checkAnalysisStatus() {\n            // 每3秒检查一次分析状态\n            this.statusCheckInterval = setInterval(() => { return __awaiter(this, void 0, void 0, function* () {\n                try {\n                    this.checkCount++;\n                    uni.__f__('log', 'at pages/AI/selection/analyzing.uvue:118', '检查分析状态，ID:', this.analysisId, '次数:', this.checkCount);\n                    // 超过最大检查次数\n                    if (this.checkCount > this.maxChecks) {\n                        clearInterval(this.statusCheckInterval);\n                        uni.showModal({\n                            title: '分析超时',\n                            content: '分析时间超过预期，您可以继续等待或稍后查看结果',\n                            confirmText: '继续等待',\n                            cancelText: '稍后查看',\n                            success: (res) => {\n                                if (res.confirm) {\n                                    // 重置计数器，继续检查\n                                    this.checkCount = 0;\n                                    this.checkAnalysisStatus();\n                                }\n                                else {\n                                    uni.navigateBack();\n                                }\n                            }\n                        });\n                        return Promise.resolve(null);\n                    }\n                    // 真实请求API检查状态\n                    const result = yield callCloudFunction(new UTSJSONObject({\n                        name: aiSelectionApis.getSchoolAnalysis,\n                        data: new UTSJSONObject({\n                            action: 'get',\n                            id: this.analysisId\n                        }),\n                        timeout: 15000\n                    }));\n                    uni.__f__('log', 'at pages/AI/selection/analyzing.uvue:151', '分析状态查询结果:', result);\n                    if (result.result && result.result.code === 0) {\n                        const data = result.result.data;\n                        if (data && data.analysis_status === 'completed') {\n                            // 分析完成，跳转到结果页\n                            uni.__f__('log', 'at pages/AI/selection/analyzing.uvue:158', '分析已完成，准备展示结果');\n                            this.progressPercent = 100;\n                            clearInterval(this.intervalId);\n                            clearInterval(this.statusCheckInterval);\n                            setTimeout(() => {\n                                this.goToResult(this.analysisId);\n                            }, 800);\n                        }\n                        else if (data && data.analysis_status === 'failed') {\n                            // 分析失败，显示错误信息\n                            clearInterval(this.intervalId);\n                            clearInterval(this.statusCheckInterval);\n                            uni.showModal({\n                                title: '分析失败',\n                                content: data.error_message || '很抱歉，分析过程中出现问题',\n                                showCancel: false,\n                                success: () => {\n                                    uni.navigateBack();\n                                }\n                            });\n                        }\n                        else if (data && data.analysis_status === 'analyzing') {\n                            // 分析正在进行中，更新进度\n                            uni.__f__('log', 'at pages/AI/selection/analyzing.uvue:180', '分析进行中...');\n                            if (this.progressPercent < 90) {\n                                // 让进度条显示分析进行中，但不要到100%\n                                this.progressPercent += 2;\n                                if (this.progressPercent > 90)\n                                    this.progressPercent = 90;\n                            }\n                        }\n                        else if (data && data.analysis_status === 'pending') {\n                            // 等待分析开始\n                            uni.__f__('log', 'at pages/AI/selection/analyzing.uvue:188', '等待分析开始...');\n                            if (this.progressPercent < 30) {\n                                this.progressPercent += 2;\n                            }\n                        }\n                    }\n                    else {\n                        uni.__f__('error', 'at pages/AI/selection/analyzing.uvue:194', '检查状态API调用失败:', result);\n                        // 不自动关闭，继续尝试\n                    }\n                }\n                catch (e) {\n                    uni.__f__('error', 'at pages/AI/selection/analyzing.uvue:198', '检查分析状态失败:', e);\n                }\n            }); }, 3000); // 每3秒检查一次\n        },\n        /**\n         * @description 取消分析\n         */\n        cancelAnalysis() {\n            uni.showModal({\n                title: '取消分析',\n                content: '确定要取消当前分析吗？',\n                success: (res) => {\n                    if (res.confirm) {\n                        // 清除定时器\n                        if (this.intervalId) {\n                            clearInterval(this.intervalId);\n                        }\n                        if (this.statusCheckInterval) {\n                            clearInterval(this.statusCheckInterval);\n                        }\n                        uni.navigateBack();\n                    }\n                }\n            });\n        },\n        goToResult(id = null) {\n            // 确保导航URL使用正确的大小写\n            uni.redirectTo({\n                url: '/pages/AI/selection/result?id=' + id\n            });\n        }\n    }\n});\n//# sourceMappingURL=E:/yanshilu%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AFyanshilu/pages/AI/selection/analyzing.uvue?vue&type=script&lang.uts.js.map","references":["E:/yanshilu小程序前端/前端yanshilu/config.js","E:/yanshilu小程序前端/前端yanshilu/utils/cloudFunction.js"],"uniExtApis":["uni.__f__","uni.setStorageSync","uni.showModal","uni.navigateBack","uni.redirectTo"],"map":"{\"version\":3,\"file\":\"analyzing.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"analyzing.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
