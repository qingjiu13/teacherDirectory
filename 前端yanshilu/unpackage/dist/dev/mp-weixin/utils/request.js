"use strict";const e=require("../common/vendor.js"),t=require("./jwt.js"),o=require("./routes.js"),n=require("../config.js").BASE_URL,i=(o={})=>{const{url:a,method:d="GET",data:c={},header:u={},auth:h=!0,loading:l=!0}=o;l&&e.index.showLoading({title:"加载中...",mask:!0});const m=a.startsWith("http")?a:n+a,f={"Content-Type":"application/json",...u};if(h){const e=t.getToken();e&&(f.Authorization=`Bearer ${e}`)}return new Promise(((n,a)=>{e.index.request({url:m,method:d,data:c,header:f,success:async d=>{const{statusCode:c,data:u}=d;if(l&&e.index.hideLoading(),c>=200&&c<300)n(u);else if(401===c)try{if(await t.checkAndRefreshToken()){const e={...o,loading:!1},t=await i(e);n(t)}else r(),a(new Error("未授权，请重新登录"))}catch(h){r(),a(h)}else{const e=(null==u?void 0:u.message)||`请求失败(${c})`;s(e),a(new Error(e))}},fail:t=>{l&&e.index.hideLoading();const o="网络请求失败，请检查网络连接";s(o),a(new Error(o))}})}))};function r(){t.clearTokens(),e.index.showToast({title:"登录已过期，请重新登录",icon:"none",duration:2e3}),setTimeout((()=>{o.Navigator.reLaunch(o.CommonRoutes.LOGIN)}),1500)}function s(t){e.index.showToast({title:t,icon:"none",duration:2e3})}exports.post=function(e,t={},o={}){return i({url:e,method:"POST",data:t,...o})};
//# sourceMappingURL=../../.sourcemap/mp-weixin/utils/request.js.map
