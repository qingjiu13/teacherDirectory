"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),s=e.defineComponent({components:{TabBar:()=>"../../components/tab-bar/tab-bar.js"},data:()=>({posts:[],filter:new UTSJSONObject({category:"专业课",school:"",major:"",userType:"all",sort:"latest"}),currentPage:1,isLoading:!1,hasMore:!0,isRefreshing:!1}),onShow(){try{e.index.hideTabBar({fail:t=>{e.index.__f__("error","at pages/publish/publish.uvue:132","hideTabBar失败:",t)}})}catch(t){e.index.__f__("error","at pages/publish/publish.uvue:136","hideTabBar异常:",t)}this.loadPosts()},onPullDownRefresh(){this.currentPage=1,this.posts=[],this.loadPosts((()=>{e.index.stopPullDownRefresh()}))},onReachBottom(){this.hasMore&&!this.isLoading&&this.loadMorePosts()},methods:{loadPosts(e=null){if(this.isLoading)return null;this.isLoading=!0,new UTSJSONObject({page:this.currentPage,pageSize:10,category:this.filter.category,school:this.filter.school,major:this.filter.major,userType:this.filter.userType,sort:this.filter.sort});const t=this.getMockData();this.posts=1===this.currentPage?t:[...this.posts,...t],this.hasMore=this.currentPage<3,setTimeout((()=>{this.isLoading=!1,e&&e()}),500)},hasFilter(){return this.filter.school||this.filter.major||"all"!==this.filter.userType||"latest"!==this.filter.sort},loadRelatedPosts(){e.index.showModal({title:"暂无匹配内容",content:"为您推荐相关内容",showCancel:!1,success:()=>{const t=new UTSJSONObject({category:this.filter.category,major:this.filter.major,school:"",userType:"all",sort:"latest"});e.index.request({url:"YOUR_API_URL/related-posts",data:t,method:"GET",success:t=>{200===t.statusCode&&t.data&&(this.posts=t.data.posts||[],0===this.posts.length&&e.index.showToast({title:"没有找到相关内容",icon:"none"}))}})}})},loadMorePosts(){this.currentPage++,this.loadPosts()},viewPostDetail(t=null){e.index.navigateTo({url:`/pages/post/detail?id=${t}`})},navigateToUserDetail(t=null){e.index.navigateTo({url:`/pages/teacher/profile?id=${t}`})},toggleFollow(t=null){const s=t.isFollowed?"unfollow":"follow",o=t.userId;e.index.request({url:`YOUR_API_URL/user/${s}`,method:"POST",data:new UTSJSONObject({userId:o}),success:s=>{200===s.statusCode&&(t.isFollowed=!t.isFollowed,e.index.showToast({title:t.isFollowed?"已关注":"已取消关注",icon:"none"}))}})},likePost(t=null){const s=t.isLiked?"unlike":"like";e.index.request({url:`YOUR_API_URL/post/${s}`,method:"POST",data:new UTSJSONObject({postId:t.id}),success:e=>{200===e.statusCode&&(t.isLiked=!t.isLiked,t.likeCount+=t.isLiked?1:-1)}})},commentPost(t=null){e.index.navigateTo({url:`/pages/post/detail?id=${t.id}&showComment=true`})},collectPost(t=null){const s=t.isCollected?"uncollect":"collect";e.index.request({url:`YOUR_API_URL/post/${s}`,method:"POST",data:new UTSJSONObject({postId:t.id}),success:s=>{200===s.statusCode&&(t.isCollected=!t.isCollected,t.collectCount+=t.isCollected?1:-1,e.index.showToast({title:t.isCollected?"已收藏":"已取消收藏",icon:"none"}))}})},sharePost(t=null){e.index.showActionSheet({itemList:["分享给好友","分享到微信好友","分享到微信群聊","分享到朋友圈"],success:s=>{const o=s.tapIndex;switch(o){case 0:e.index.navigateTo({url:`/pages/share/friends?postId=${t.id}`});break;case 1:case 2:case 3:e.index.share(new UTSJSONObject({provider:"weixin",scene:1===o||2===o?"WXSceneSession":"WXSceneTimeline",type:0,title:t.title||"分享内容",summary:t.content.substring(0,50)+(t.content.length>50?"...":""),imageUrl:t.images&&t.images.length>0?t.images[0]:"/static/image/share_default.png",href:`YOUR_SHARE_URL/post/${t.id}`,success:function(){e.index.__f__("log","at pages/publish/publish.uvue:417","分享成功"),t.shareCount++},fail:function(){e.index.__f__("log","at pages/publish/publish.uvue:422","分享失败")}}))}}})},navigateToPublishEditor(){e.index.navigateTo({url:"/pages/publish/editor"})},getMockData:()=>[new UTSJSONObject({id:1,userId:101,nickname:"研究生活小助手",avatar:"/static/image/default_avatar.png",school:"北京大学",major:"计算机科学",content:"今天分享一下考研复习经验，希望对大家有帮助！数学部分要注重基础，多做真题。#考研# #复习经验#",viewCount:256,likeCount:42,commentCount:8,collectCount:15,shareCount:3,isLiked:!1,isCollected:!1,isFollowed:!1,images:[]}),new UTSJSONObject({id:2,userId:102,nickname:"考研达人",avatar:"/static/image/default_avatar.png",school:"清华大学",major:"电子工程",content:"考研英语阅读理解技巧分享，掌握这些方法效率提升50%！长难句分析方法和常见词汇搭配整理。",viewCount:189,likeCount:36,commentCount:12,collectCount:20,shareCount:5,isLiked:!0,isCollected:!1,isFollowed:!0,images:[]}),new UTSJSONObject({id:3,userId:103,nickname:"政治高分学姐",avatar:"/static/image/default_avatar.png",school:"复旦大学",major:"政治学",content:"考研政治复习时间规划，建议8月开始系统学习，10月开始真题训练，12月开始背诵考点。提供我整理的笔记供大家参考。",viewCount:320,likeCount:67,commentCount:23,collectCount:45,shareCount:12,isLiked:!1,isCollected:!0,isFollowed:!1,images:[]})],selectCategory(e=null){this.filter.category=e,this.currentPage=1,this.posts=[],this.loadPosts()}}});if(!Array){e.resolveComponent("tab-bar")()}Math;const o=e._export_sfc(s,[["render",function(s,o,i,a,l,n){return e.e({a:l.isRefreshing},(l.isRefreshing,{}),{b:t._imports_0$2,c:"专业课"===l.filter.category?1:"",d:e.o((e=>n.selectCategory("专业课"))),e:"数学"===l.filter.category?1:"",f:e.o((e=>n.selectCategory("数学"))),g:"英语"===l.filter.category?1:"",h:e.o((e=>n.selectCategory("英语"))),i:"政治"===l.filter.category?1:"",j:e.o((e=>n.selectCategory("政治"))),k:e.f(l.posts,((t,s,o)=>({a:t.avatar||"/static/image/default_avatar.png",b:e.o((e=>n.navigateToUserDetail(t.userId)),s),c:e.t(t.nickname),d:e.t(t.school),e:e.t(t.major),f:e.t(t.isFollowed?"已关注":"关注"),g:t.isFollowed?1:"",h:e.o((e=>n.toggleFollow(t)),s),i:e.t(t.content),j:e.t(t.viewCount),k:t.isLiked?"/static/image/like_filled.svg":"/static/image/like.svg",l:e.t(t.likeCount),m:e.o((e=>n.likePost(t)),s),n:e.t(t.commentCount),o:e.o((e=>n.commentPost(t)),s),p:t.isCollected?"/static/image/star_filled.svg":"/static/image/star.svg",q:e.t(t.collectCount),r:e.o((e=>n.collectPost(t)),s),s:e.t(t.shareCount),t:e.o((e=>n.sharePost(t)),s),v:s,w:e.o((e=>n.viewPostDetail(t.id)),s)}))),l:t._imports_0$3,m:t._imports_1,n:l.isLoading&&l.posts.length>0},(l.isLoading&&l.posts.length,{}),{o:0===l.posts.length&&!l.isLoading},(0!==l.posts.length||l.isLoading,{}),{p:e.o(((...e)=>n.navigateToPublishEditor&&n.navigateToPublishEditor(...e))),q:e.p({pageName:"publish"}),r:e.sei(s.virtualHostId,"view")})}]]);wx.createPage(o);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/publish/publish.js.map
