"use strict";const e=require("../../../common/vendor.js"),t=require("../../../config.js"),s=require("../../../utils/cloudFunction.js"),n=require("../../../common/assets.js"),a=e.defineComponent({name:"AISelectionAnalyzing",data:()=>({progressPercent:0,intervalId:null,statusCheckInterval:null,analysisId:"",tips:["正在分析您的学术背景...","正在匹配最适合的院校...","正在评估录取可能性...","正在生成个性化建议...","即将完成分析，请稍等..."],currentTip:"正在分析您的学术背景...",checkCount:0,maxChecks:30}),onLoad(t){if(e.index.__f__("log","at pages/AI/selection/analyzing.uvue:57","分析页面加载，ID:",t.id),this.analysisId=t.id||"",!this.analysisId)return e.index.showModal({title:"错误",content:"未找到分析ID，请重新开始",showCancel:!1,success:()=>{e.index.navigateBack()}}),null;e.index.setStorageSync("current_analysis_id",this.analysisId),this.startProgressAnimation(),this.checkAnalysisStatus()},onUnload(){this.intervalId&&clearInterval(this.intervalId),this.statusCheckInterval&&clearInterval(this.statusCheckInterval)},methods:{startProgressAnimation(){this.progressPercent=10,this.intervalId=setInterval((()=>{const e=this.tips.indexOf(this.currentTip)+1;this.currentTip=this.tips[e%this.tips.length],this.progressPercent<85&&(this.progressPercent+=Math.floor(3*Math.random())+1)}),3e3)},checkAnalysisStatus(){this.statusCheckInterval=setInterval((()=>e.__awaiter(this,void 0,void 0,(function*(){try{if(this.checkCount++,e.index.__f__("log","at pages/AI/selection/analyzing.uvue:118","检查分析状态，ID:",this.analysisId,"次数:",this.checkCount),this.checkCount>this.maxChecks)return clearInterval(this.statusCheckInterval),e.index.showModal({title:"分析超时",content:"分析时间超过预期，您可以继续等待或稍后查看结果",confirmText:"继续等待",cancelText:"稍后查看",success:t=>{t.confirm?(this.checkCount=0,this.checkAnalysisStatus()):e.index.navigateBack()}}),Promise.resolve(null);const n=yield s.callCloudFunction(new UTSJSONObject({name:t.aiSelectionApis.getSchoolAnalysis,data:new UTSJSONObject({action:"get",id:this.analysisId}),timeout:15e3}));if(e.index.__f__("log","at pages/AI/selection/analyzing.uvue:151","分析状态查询结果:",n),n.result&&0===n.result.code){const t=n.result.data;t&&"completed"===t.analysis_status?(e.index.__f__("log","at pages/AI/selection/analyzing.uvue:158","分析已完成，准备展示结果"),this.progressPercent=100,clearInterval(this.intervalId),clearInterval(this.statusCheckInterval),setTimeout((()=>{this.goToResult(this.analysisId)}),800)):t&&"failed"===t.analysis_status?(clearInterval(this.intervalId),clearInterval(this.statusCheckInterval),e.index.showModal({title:"分析失败",content:t.error_message||"很抱歉，分析过程中出现问题",showCancel:!1,success:()=>{e.index.navigateBack()}})):t&&"analyzing"===t.analysis_status?(e.index.__f__("log","at pages/AI/selection/analyzing.uvue:180","分析进行中..."),this.progressPercent<90&&(this.progressPercent+=2,this.progressPercent>90&&(this.progressPercent=90))):t&&"pending"===t.analysis_status&&(e.index.__f__("log","at pages/AI/selection/analyzing.uvue:188","等待分析开始..."),this.progressPercent<30&&(this.progressPercent+=2))}else e.index.__f__("error","at pages/AI/selection/analyzing.uvue:194","检查状态API调用失败:",n)}catch(n){e.index.__f__("error","at pages/AI/selection/analyzing.uvue:198","检查分析状态失败:",n)}}))),3e3)},cancelAnalysis(){e.index.showModal({title:"取消分析",content:"确定要取消当前分析吗？",success:t=>{t.confirm&&(this.intervalId&&clearInterval(this.intervalId),this.statusCheckInterval&&clearInterval(this.statusCheckInterval),e.index.navigateBack())}})},goToResult(t=null){e.index.redirectTo({url:"/pages/AI/selection/result?id="+t})}}});const i=e._export_sfc(a,[["render",function(t,s,a,i,r,l){return{a:r.progressPercent+"%",b:n._imports_0$4,c:r.progressPercent+"%",d:e.t(r.progressPercent),e:e.t(r.currentTip),f:e.o(((...e)=>l.cancelAnalysis&&l.cancelAnalysis(...e))),g:e.sei(t.virtualHostId,"view")}}]]);wx.createPage(i);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/AI/selection/analyzing.js.map
