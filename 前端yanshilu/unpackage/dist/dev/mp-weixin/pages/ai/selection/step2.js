"use strict";const e=require("../../../common/vendor.js"),t=require("../../../config.js"),o=require("../../../utils/cloudFunction.js"),s=require("../../../utils/routes.js"),i=e.defineComponent({name:"AISelectionStep2",data:()=>({selectedSchool:"",selectedMajor:"",showSchoolList:!1,showMajorList:!1,searchText:"",searchMajorText:"",schools:[],majors:[],localSchools:["北京大学","清华大学","复旦大学","上海交通大学","浙江大学","南京大学","中国人民大学","武汉大学","中山大学","华中科技大学","北京师范大学","厦门大学","南开大学","吉林大学","西安交通大学","哈尔滨工业大学","电子科技大学","东南大学","四川大学","中南大学"],localMajors:["计算机科学与技术","软件工程","人工智能","数据科学与大数据技术","网络空间安全","电子信息工程","通信工程","自动化","机械工程","土木工程","建筑学","工商管理","会计学","金融学","经济学","法学","医学","生物科学","化学","物理学","数学","英语","汉语言文学","新闻学","心理学","教育学"]}),computed:{filteredSchools(){if(!this.searchText)return this.schools.length>0?this.schools:this.localSchools;const e=this.searchText.toLowerCase();return(this.schools.length>0?this.schools:this.localSchools).filter((t=>t.toLowerCase().includes(e)))},filteredMajors(){if(!this.searchMajorText)return this.majors.length>0?this.majors:this.localMajors;const e=this.searchMajorText.toLowerCase();return(this.majors.length>0?this.majors:this.localMajors).filter((t=>t.toLowerCase().includes(e)))}},onLoad(){this.loadSchools();const t=e.index.getStorageSync("step2_school"),o=e.index.getStorageSync("step2_major");t&&(this.selectedSchool=t,this.searchText=t),o&&(this.selectedMajor=o,this.searchMajorText=o)},methods:{loadSchools(){return e.__awaiter(this,void 0,void 0,(function*(){try{e.index.showLoading({title:"加载中..."});const s=yield o.callCloudFunction(new UTSJSONObject({name:t.aiSelectionApis.getSchools,data:new UTSJSONObject({}),timeout:1e4})).catch(((t=null)=>(e.index.__f__("error","at pages/AI/selection/step2.uvue:161","获取学校列表失败:",t),new UTSJSONObject({result:new UTSJSONObject({code:-1,msg:t.message})}))));e.index.hideLoading(),s.result&&0===s.result.code?(this.schools=s.result.data||[],e.index.__f__("log","at pages/AI/selection/step2.uvue:169","获取到学校列表:",this.schools)):(e.index.__f__("warn","at pages/AI/selection/step2.uvue:171","使用本地学校列表"),this.schools=this.localSchools)}catch(s){e.index.hideLoading(),e.index.__f__("error","at pages/AI/selection/step2.uvue:176","加载学校列表异常:",s),this.schools=this.localSchools}}))},selectSchool(t=null){this.selectedSchool=t,this.searchText=t,this.showSchoolList=!1,e.index.setStorageSync("step2_school",t)},loadMajors(){return e.__awaiter(this,void 0,void 0,(function*(){try{if(!this.selectedSchool)return Promise.resolve(null);e.index.showLoading({title:"加载中..."});const s=yield o.callCloudFunction(new UTSJSONObject({name:t.aiSelectionApis.getUndergraduateMajors,data:new UTSJSONObject({school:this.selectedSchool}),timeout:1e4})).catch(((t=null)=>(e.index.__f__("error","at pages/AI/selection/step2.uvue:213","获取专业列表失败:",t),new UTSJSONObject({result:new UTSJSONObject({code:-1,msg:t.message})}))));e.index.hideLoading(),s.result&&0===s.result.code?(this.majors=s.result.data||[],e.index.__f__("log","at pages/AI/selection/step2.uvue:222","获取到专业列表:",this.majors)):(e.index.__f__("warn","at pages/AI/selection/step2.uvue:224","使用本地专业列表"),this.majors=this.localMajors)}catch(s){e.index.hideLoading(),e.index.__f__("error","at pages/AI/selection/step2.uvue:229","加载专业列表异常:",s),this.majors=this.localMajors}}))},selectMajor(t=null){this.selectedMajor=t,this.searchMajorText=t,this.showMajorList=!1,e.index.setStorageSync("step2_major",t)},prevPage(){e.index.navigateBack()},nextPage(){return this.selectedSchool?this.selectedMajor?(this.formData.university=this.selectedSchool,this.formData.major=this.selectedMajor,e.index.setStorageSync("step2_data",new UTSJSONObject({university:this.selectedSchool,major:this.selectedMajor})),void s.Routes.navigator.navigateTo(s.Routes.ai.step3)):(e.index.showToast({title:"请选择您的本科专业",icon:"none"}),null):(e.index.showToast({title:"请选择您的本科院校",icon:"none"}),null)}}});const a=e._export_sfc(i,[["render",function(t,o,s,i,a,l){return e.e({a:e.o((e=>a.showSchoolList=!0)),b:a.searchText,c:e.o((e=>a.searchText=e.detail.value)),d:a.showSchoolList},a.showSchoolList?{e:e.f(l.filteredSchools,((t,o,s)=>({a:e.t(t),b:o,c:e.o((e=>l.selectSchool(t)),o)})))}:{},{f:e.o((e=>a.showMajorList=!0)),g:a.searchMajorText,h:e.o((e=>a.searchMajorText=e.detail.value)),i:a.showMajorList},a.showMajorList?{j:e.f(l.filteredMajors,((t,o,s)=>({a:e.t(t),b:o,c:e.o((e=>l.selectMajor(t)),o)})))}:{},{k:e.o(((...e)=>l.prevPage&&l.prevPage(...e))),l:e.o(((...e)=>l.nextPage&&l.nextPage(...e))),m:e.sei(t.virtualHostId,"view")})}]]);wx.createPage(a);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/AI/selection/step2.js.map
