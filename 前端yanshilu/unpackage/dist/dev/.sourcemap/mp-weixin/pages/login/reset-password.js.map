{"version":3,"file":"reset-password.js","sources":["pages/login/reset-password.uvue","../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vcmVzZXQtcGFzc3dvcmQudXZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"reset-container\">\r\n    <view class=\"reset-header\">\r\n      <text class=\"title\">重置密码</text>\r\n      <text class=\"subtitle\">请输入您的手机号，我们将发送验证码帮助您重置密码</text>\r\n    </view>\r\n    \r\n    <view class=\"reset-form\">\r\n      <view class=\"input-group\">\r\n        <text class=\"input-label\">手机号</text>\r\n        <view class=\"phone-input\">\r\n          <input class=\"input-box\" type=\"number\" v-model=\"mobile\" placeholder=\"请输入手机号\" />\r\n          <button class=\"send-code-btn\" :disabled=\"countdown > 0\" @click=\"sendCode\">\r\n            {{ countdown > 0 ? `${countdown}秒后重试` : '获取验证码' }}\r\n          </button>\r\n        </view>\r\n      </view>\r\n      \r\n      <view class=\"input-group\" v-if=\"step >= 2\">\r\n        <text class=\"input-label\">验证码</text>\r\n        <input class=\"input-box\" type=\"number\" maxlength=\"6\" v-model=\"code\" placeholder=\"请输入验证码\" />\r\n      </view>\r\n      \r\n      <view class=\"input-group\" v-if=\"step >= 3\">\r\n        <text class=\"input-label\">新密码</text>\r\n        <input class=\"input-box\" type=\"password\" v-model=\"newPassword\" placeholder=\"请输入新密码\" />\r\n      </view>\r\n      \r\n      <view class=\"input-group\" v-if=\"step >= 3\">\r\n        <text class=\"input-label\">确认密码</text>\r\n        <input class=\"input-box\" type=\"password\" v-model=\"confirmPassword\" placeholder=\"请再次输入新密码\" />\r\n      </view>\r\n      \r\n      <button class=\"next-btn\" @click=\"handleNextStep\" :loading=\"loading\">\r\n        {{ step < 3 ? '下一步' : '重置密码' }}\r\n      </button>\r\n      \r\n      <view class=\"back-link\">\r\n        <text @click=\"goBack\">返回登录</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n  /**\r\n   * 重置密码页面\r\n   * @description 通过手机验证码重置密码\r\n   */\r\n  import { sendVerificationCode, verifyCode, resetPassword } from '../../api/auth.js';\r\n  \r\n  export default {\r\n    data() {\r\n      return {\r\n        step: 1, // 当前步骤：1-输入手机号, 2-验证码, 3-设置新密码\r\n        mobile: '',\r\n        code: '',\r\n        newPassword: '',\r\n        confirmPassword: '',\r\n        countdown: 0, // 验证码倒计时\r\n        loading: false,\r\n        timer: null\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * 页面卸载时清除计时器\r\n     */\r\n    onUnload() {\r\n      if (this.timer) {\r\n        clearInterval(this.timer);\r\n        this.timer = null;\r\n      }\r\n    },\r\n    \r\n    methods: {\r\n      /**\r\n       * 处理下一步操作\r\n       */\r\n      async handleNextStep() {\r\n        if (this.loading) return;\r\n        \r\n        switch (this.step) {\r\n          case 1:\r\n            await this.validateMobile();\r\n            break;\r\n          case 2:\r\n            await this.validateCode();\r\n            break;\r\n          case 3:\r\n            await this.submitNewPassword();\r\n            break;\r\n        }\r\n      },\r\n      \r\n      /**\r\n       * 验证手机号\r\n       */\r\n      async validateMobile() {\r\n        // 手机号验证\r\n        if (!this.mobile || !/^1\\d{10}$/.test(this.mobile)) {\r\n          uni.showToast({\r\n            title: '请输入有效的手机号',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        \r\n        // 进入下一步\r\n        this.step = 2;\r\n      },\r\n      \r\n      /**\r\n       * 验证验证码\r\n       */\r\n      async validateCode() {\r\n        if (!this.code || this.code.length !== 6) {\r\n          uni.showToast({\r\n            title: '请输入6位验证码',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        \r\n        this.loading = true;\r\n        \r\n        try {\r\n          // 验证验证码\r\n          await verifyCode(this.mobile, this.code);\r\n          \r\n          // 验证成功，进入下一步\r\n          this.step = 3;\r\n        } catch (error) {\r\n          uni.showToast({\r\n            title: error.message || '验证码错误',\r\n            icon: 'none'\r\n          });\r\n        } finally {\r\n          this.loading = false;\r\n        }\r\n      },\r\n      \r\n      /**\r\n       * 提交新密码\r\n       */\r\n      async submitNewPassword() {\r\n        // 密码验证\r\n        if (!this.newPassword) {\r\n          uni.showToast({\r\n            title: '请输入新密码',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        \r\n        if (this.newPassword.length < 6) {\r\n          uni.showToast({\r\n            title: '密码长度至少6位',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        \r\n        if (this.newPassword !== this.confirmPassword) {\r\n          uni.showToast({\r\n            title: '两次密码输入不一致',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        \r\n        this.loading = true;\r\n        \r\n        try {\r\n          // 重置密码\r\n          await resetPassword(this.mobile, this.code, this.newPassword);\r\n          \r\n          // 重置成功\r\n          uni.showToast({\r\n            title: '密码重置成功',\r\n            icon: 'success'\r\n          });\r\n          \r\n          // 返回登录页\r\n          setTimeout(() => {\r\n            uni.navigateBack();\r\n          }, 1500);\r\n          \r\n        } catch (error) {\r\n          uni.showToast({\r\n            title: error.message || '密码重置失败',\r\n            icon: 'none'\r\n          });\r\n        } finally {\r\n          this.loading = false;\r\n        }\r\n      },\r\n      \r\n      /**\r\n       * 发送验证码\r\n       */\r\n      async sendCode() {\r\n        if (this.countdown > 0 || !this.mobile) return;\r\n        \r\n        if (!/^1\\d{10}$/.test(this.mobile)) {\r\n          uni.showToast({\r\n            title: '请输入有效的手机号',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        \r\n        try {\r\n          // 发送验证码\r\n          await sendVerificationCode(this.mobile);\r\n          \r\n          // 开始倒计时\r\n          this.startCountdown();\r\n          \r\n          uni.showToast({\r\n            title: '验证码已发送',\r\n            icon: 'success'\r\n          });\r\n        } catch (error) {\r\n          uni.showToast({\r\n            title: error.message || '发送验证码失败',\r\n            icon: 'none'\r\n          });\r\n        }\r\n      },\r\n      \r\n      /**\r\n       * 开始倒计时\r\n       */\r\n      startCountdown() {\r\n        this.countdown = 60;\r\n        \r\n        if (this.timer) {\r\n          clearInterval(this.timer);\r\n        }\r\n        \r\n        this.timer = setInterval(() => {\r\n          if (this.countdown > 0) {\r\n            this.countdown--;\r\n          } else {\r\n            clearInterval(this.timer);\r\n            this.timer = null;\r\n          }\r\n        }, 1000);\r\n      },\r\n      \r\n      /**\r\n       * 返回登录页\r\n       */\r\n      goBack() {\r\n        uni.navigateBack();\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .reset-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: 40rpx;\r\n    background-color: #ffffff;\r\n    min-height: 100vh;\r\n  }\r\n  \r\n  .reset-header {\r\n    margin-top: 60rpx;\r\n    margin-bottom: 60rpx;\r\n  }\r\n  \r\n  .title {\r\n    font-size: 36rpx;\r\n    font-weight: bold;\r\n    color: #333;\r\n    margin-bottom: 20rpx;\r\n    display: block;\r\n  }\r\n  \r\n  .subtitle {\r\n    font-size: 28rpx;\r\n    color: #666;\r\n    line-height: 1.5;\r\n  }\r\n  \r\n  .reset-form {\r\n    width: 100%;\r\n  }\r\n  \r\n  .input-group {\r\n    margin-bottom: 30rpx;\r\n  }\r\n  \r\n  .input-label {\r\n    font-size: 28rpx;\r\n    color: #333;\r\n    margin-bottom: 10rpx;\r\n    display: block;\r\n  }\r\n  \r\n  .phone-input {\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n  \r\n  .input-box {\r\n    flex: 1;\r\n    height: 90rpx;\r\n    background-color: #f8f8f8;\r\n    border-radius: 12rpx;\r\n    padding: 0 20rpx;\r\n    box-sizing: border-box;\r\n    font-size: 28rpx;\r\n  }\r\n  \r\n  .phone-input .input-box {\r\n    border-top-right-radius: 0;\r\n    border-bottom-right-radius: 0;\r\n  }\r\n  \r\n  .send-code-btn {\r\n    width: 220rpx;\r\n    height: 90rpx;\r\n    background-color: #007AFF;\r\n    color: white;\r\n    border-radius: 0 12rpx 12rpx 0;\r\n    font-size: 26rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 0;\r\n  }\r\n  \r\n  .send-code-btn[disabled] {\r\n    background-color: #cccccc;\r\n  }\r\n  \r\n  .next-btn {\r\n    width: 100%;\r\n    height: 90rpx;\r\n    background-color: #007AFF;\r\n    color: white;\r\n    border-radius: 12rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    margin-top: 40rpx;\r\n    margin-bottom: 30rpx;\r\n  }\r\n  \r\n  .back-link {\r\n    text-align: center;\r\n    margin-top: 20rpx;\r\n    font-size: 28rpx;\r\n    color: #007AFF;\r\n  }\r\n</style> ","import MiniProgramPage from 'E:/yanshilu小程序前端/前端yanshilu/pages/login/reset-password.uvue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","defineComponent","data","step","mobile","code","newPassword","confirmPassword","countdown","loading","timer","onUnload","this","clearInterval","methods","handleNextStep","Promise","resolve","validateMobile","validateCode","submitNewPassword","test","uni","showToast","title","icon","length","verifyCode","error","message","resetPassword","setTimeout","index","navigateBack","sendCode","sendVerificationCode","startCountdown","setInterval","goBack","wx","createPage","MiniProgramPage"],"mappings":"sFAmDEA,EAAeC,kBAAA,CACbC,KAAI,KACK,CACLC,KAAM,EACNC,OAAQ,GACRC,KAAM,GACNC,YAAa,GACbC,gBAAiB,GACjBC,UAAW,EACXC,SAAS,EACTC,MAAO,OAOXC,WACMC,KAAKF,QACPG,cAAcD,KAAKF,OACnBE,KAAKF,MAAQ,KAEhB,EAEDI,QAAS,CAIDC,oEACJ,GAAIH,KAAKH,QAAe,OAAAO,QAAAC,QAAA,MAExB,OAAQL,KAAKT,MACX,KAAK,QACGS,KAAKM,iBACX,MACF,KAAK,QACGN,KAAKO,eACX,MACF,KAAK,QACGP,KAAKQ,uBAGhB,EAKKF,oEAEA,IAACN,KAAKR,SAAW,YAAYiB,KAAKT,KAAKR,QAKnC,OAJNkB,EAAAA,MAAIC,UAAU,CACZC,MAAO,YACPC,KAAM,SAEFT,QAAAC,QAAA,MAIRL,KAAKT,KAAO,IACb,EAKKgB,kEACJ,IAAKP,KAAKP,MAA6B,IAArBO,KAAKP,KAAKqB,OAKpB,OAJNJ,EAAAA,MAAIC,UAAU,CACZC,MAAO,WACPC,KAAM,SAEFT,QAAAC,QAAA,MAGRL,KAAKH,SAAU,EAEX,UAEIkB,EAAUA,WAACf,KAAKR,OAAQQ,KAAKP,MAGnCO,KAAKT,KAAO,CAQd,OAPSyB,GACPN,EAAAA,MAAIC,UAAU,CACZC,MAAOI,EAAMC,SAAW,QACxBJ,KAAM,QAEV,CAAU,QACRb,KAAKH,SAAU,CACjB,IACD,EAKKW,uEAEA,IAACR,KAAKN,YAKF,OAJNgB,EAAAA,MAAIC,UAAU,CACZC,MAAO,SACPC,KAAM,SAEFT,QAAAC,QAAA,MAGJ,GAAAL,KAAKN,YAAYoB,OAAS,EAKtB,OAJNJ,EAAAA,MAAIC,UAAU,CACZC,MAAO,WACPC,KAAM,SAEFT,QAAAC,QAAA,MAGJ,GAAAL,KAAKN,cAAgBM,KAAKL,gBAKtB,OAJNe,EAAAA,MAAIC,UAAU,CACZC,MAAO,YACPC,KAAM,SAEFT,QAAAC,QAAA,MAGRL,KAAKH,SAAU,EAEX,UAEIqB,EAAAA,cAAclB,KAAKR,OAAQQ,KAAKP,KAAMO,KAAKN,aAGjDgB,EAAAA,MAAIC,UAAU,CACZC,MAAO,SACPC,KAAM,YAIRM,YAAW,KACTT,EAAGU,MAACC,cAAY,GACf,KASL,OAPSL,GACPN,EAAAA,MAAIC,UAAU,CACZC,MAAOI,EAAMC,SAAW,SACxBJ,KAAM,QAEV,CAAU,QACRb,KAAKH,SAAU,CACjB,IACD,EAKKyB,8DACJ,GAAItB,KAAKJ,UAAY,IAAMI,KAAKR,OAAc,OAAAY,QAAAC,QAAA,MAE9C,IAAK,YAAYI,KAAKT,KAAKR,QAKnB,OAJNkB,EAAAA,MAAIC,UAAU,CACZC,MAAO,YACPC,KAAM,SAEFT,QAAAC,QAAA,MAGJ,UAEIkB,EAAoBA,qBAACvB,KAAKR,QAGhCQ,KAAKwB,iBAELd,EAAAA,MAAIC,UAAU,CACZC,MAAO,SACPC,KAAM,WAOV,OALSG,GACPN,EAAAA,MAAIC,UAAU,CACZC,MAAOI,EAAMC,SAAW,UACxBJ,KAAM,QAEV,IACD,EAKDW,iBACExB,KAAKJ,UAAY,GAEbI,KAAKF,OACPG,cAAcD,KAAKF,OAGhBE,KAAAF,MAAQ2B,aAAY,KACnBzB,KAAKJ,UAAY,EACdI,KAAAJ,aAELK,cAAcD,KAAKF,OACnBE,KAAKF,MAAQ,KACf,GACC,IACJ,EAKD4B,SACEhB,EAAGU,MAACC,cACN,wpBC/PNM,GAAGC,WAAWC"}