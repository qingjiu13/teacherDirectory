{"version":3,"file":"analyzing.js","sources":["pages/AI/selection/analyzing.uvue","../../HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQUkvc2VsZWN0aW9uL2FuYWx5emluZy51dnVl"],"sourcesContent":["<template>\r\n\t<view class=\"analyzing-container\">\r\n\t\t<view class=\"analysis-title\">\r\n\t\t\t<text>AI 智能分析中</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"progress-container\">\r\n\t\t\t<view class=\"progress-bar\">\r\n\t\t\t\t<view class=\"progress-filled\" :style=\"{ width: progressPercent + '%' }\"></view>\r\n\t\t\t\t<view class=\"robot-icon\" :style=\"{ left: progressPercent + '%' }\">\r\n\t\t\t\t\t<image src=\"/static/robot.png\" mode=\"aspectFit\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<text class=\"progress-text\">{{progressPercent}}%</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"tips-container\">\r\n\t\t\t<text class=\"tip-title\">分析中，请稍候...</text>\r\n\t\t\t<text class=\"tip-content\">{{currentTip}}</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 添加取消按钮 -->\r\n\t\t<view class=\"button-container\">\r\n\t\t\t<button class=\"cancel-btn\" @click=\"cancelAnalysis\">取消</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script lang=\"uts\">\r\n\t/**\r\n\t * @description AI择校分析中页面\r\n\t */\r\n\timport { aiSelectionApis } from '../../../config.js';\r\n\timport callCloudFunction from '../../../utils/cloudFunction.js';\r\n\t\r\n\texport default {\r\n\t\tname: 'AISelectionAnalyzing',\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tprogressPercent: 0,\r\n\t\t\t\tintervalId: null,\r\n\t\t\t\tstatusCheckInterval: null,\r\n\t\t\t\tanalysisId: '',\r\n\t\t\t\ttips: [\r\n\t\t\t\t\t'正在分析您的学术背景...',\r\n\t\t\t\t\t'正在匹配最适合的院校...',\r\n\t\t\t\t\t'正在评估录取可能性...',\r\n\t\t\t\t\t'正在生成个性化建议...',\r\n\t\t\t\t\t'即将完成分析，请稍等...'\r\n\t\t\t\t],\r\n\t\t\t\tcurrentTip: '正在分析您的学术背景...',\r\n\t\t\t\tcheckCount: 0,\r\n\t\t\t\tmaxChecks: 30 // 最多检查30次（约1.5分钟）\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tuni.__f__('log','at pages/AI/selection/analyzing.uvue:57','分析页面加载，ID:', options.id);\r\n\t\t\tthis.analysisId = options.id || '';\r\n\t\t\t\r\n\t\t\t// 在本地存储中保存此ID，以防页面跳转时丢失\r\n\t\t\tif (this.analysisId) {\r\n\t\t\t\tuni.setStorageSync('current_analysis_id', this.analysisId);\r\n\t\t\t} else {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '错误',\r\n\t\t\t\t\tcontent: '未找到分析ID，请重新开始',\r\n\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 启动进度条动画（仅起到视觉反馈作用）\r\n\t\t\tthis.startProgressAnimation();\r\n\t\t\t\r\n\t\t\t// 开始检查分析状态\r\n\t\t\tthis.checkAnalysisStatus();\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t// 清除所有定时器\r\n\t\t\tif (this.intervalId) {\r\n\t\t\t\tclearInterval(this.intervalId);\r\n\t\t\t}\r\n\t\t\tif (this.statusCheckInterval) {\r\n\t\t\t\tclearInterval(this.statusCheckInterval);\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * @description 启动进度条动画\r\n\t\t\t */\r\n\t\t\tstartProgressAnimation() {\r\n\t\t\t\t// 进度条初始值设为10%，给用户一些反馈\r\n\t\t\t\tthis.progressPercent = 10;\r\n\t\t\t\t\r\n\t\t\t\t// 每5秒更换提示文字\r\n\t\t\t\tthis.intervalId = setInterval(() => {\r\n\t\t\t\t\tconst nextTipIndex = this.tips.indexOf(this.currentTip) + 1;\r\n\t\t\t\t\tthis.currentTip = this.tips[nextTipIndex % this.tips.length];\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 缓慢增加进度条\r\n\t\t\t\t\tif (this.progressPercent < 85) {\r\n\t\t\t\t\t\tthis.progressPercent += Math.floor(Math.random() * 3) + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 3000);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 检查分析状态\r\n\t\t\t */\r\n\t\t\tcheckAnalysisStatus() {\r\n\t\t\t\t// 每3秒检查一次分析状态\r\n\t\t\t\tthis.statusCheckInterval = setInterval(async () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tthis.checkCount++;\r\n\t\t\t\t\t\tuni.__f__('log','at pages/AI/selection/analyzing.uvue:118','检查分析状态，ID:', this.analysisId, '次数:', this.checkCount);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 超过最大检查次数\r\n\t\t\t\t\t\tif (this.checkCount > this.maxChecks) {\r\n\t\t\t\t\t\t\tclearInterval(this.statusCheckInterval);\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '分析超时',\r\n\t\t\t\t\t\t\t\tcontent: '分析时间超过预期，您可以继续等待或稍后查看结果',\r\n\t\t\t\t\t\t\t\tconfirmText: '继续等待',\r\n\t\t\t\t\t\t\t\tcancelText: '稍后查看',\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t\t// 重置计数器，继续检查\r\n\t\t\t\t\t\t\t\t\t\tthis.checkCount = 0;\r\n\t\t\t\t\t\t\t\t\t\tthis.checkAnalysisStatus();\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 真实请求API检查状态\r\n\t\t\t\t\t\tconst result = await callCloudFunction({\r\n\t\t\t\t\t\t\tname: aiSelectionApis.getSchoolAnalysis,\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\taction: 'get',\r\n\t\t\t\t\t\t\t\tid: this.analysisId\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttimeout: 15000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tuni.__f__('log','at pages/AI/selection/analyzing.uvue:151','分析状态查询结果:', result);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (result.result && result.result.code === 0) {\r\n\t\t\t\t\t\t\tconst data = result.result.data;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (data && data.analysis_status === 'completed') {\r\n\t\t\t\t\t\t\t\t// 分析完成，跳转到结果页\r\n\t\t\t\t\t\t\t\tuni.__f__('log','at pages/AI/selection/analyzing.uvue:158','分析已完成，准备展示结果');\r\n\t\t\t\t\t\t\t\tthis.progressPercent = 100;\r\n\t\t\t\t\t\t\t\tclearInterval(this.intervalId);\r\n\t\t\t\t\t\t\t\tclearInterval(this.statusCheckInterval);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\tthis.goToResult(this.analysisId);\r\n\t\t\t\t\t\t\t\t}, 800);\r\n\t\t\t\t\t\t\t} else if (data && data.analysis_status === 'failed') {\r\n\t\t\t\t\t\t\t\t// 分析失败，显示错误信息\r\n\t\t\t\t\t\t\t\tclearInterval(this.intervalId);\r\n\t\t\t\t\t\t\t\tclearInterval(this.statusCheckInterval);\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\ttitle: '分析失败',\r\n\t\t\t\t\t\t\t\t\tcontent: data.error_message || '很抱歉，分析过程中出现问题',\r\n\t\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else if (data && data.analysis_status === 'analyzing') {\r\n\t\t\t\t\t\t\t\t// 分析正在进行中，更新进度\r\n\t\t\t\t\t\t\t\tuni.__f__('log','at pages/AI/selection/analyzing.uvue:180','分析进行中...');\r\n\t\t\t\t\t\t\t\tif (this.progressPercent < 90) {\r\n\t\t\t\t\t\t\t\t\t// 让进度条显示分析进行中，但不要到100%\r\n\t\t\t\t\t\t\t\t\tthis.progressPercent += 2;\r\n\t\t\t\t\t\t\t\t\tif (this.progressPercent > 90) this.progressPercent = 90;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (data && data.analysis_status === 'pending') {\r\n\t\t\t\t\t\t\t\t// 等待分析开始\r\n\t\t\t\t\t\t\t\tuni.__f__('log','at pages/AI/selection/analyzing.uvue:188','等待分析开始...');\r\n\t\t\t\t\t\t\t\tif (this.progressPercent < 30) {\r\n\t\t\t\t\t\t\t\t\tthis.progressPercent += 2;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.__f__('error','at pages/AI/selection/analyzing.uvue:194','检查状态API调用失败:', result);\r\n\t\t\t\t\t\t\t// 不自动关闭，继续尝试\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tuni.__f__('error','at pages/AI/selection/analyzing.uvue:198','检查分析状态失败:', e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 3000); // 每3秒检查一次\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @description 取消分析\r\n\t\t\t */\r\n\t\t\tcancelAnalysis() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '取消分析',\r\n\t\t\t\t\tcontent: '确定要取消当前分析吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t// 清除定时器\r\n\t\t\t\t\t\t\tif (this.intervalId) {\r\n\t\t\t\t\t\t\t\tclearInterval(this.intervalId);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (this.statusCheckInterval) {\r\n\t\t\t\t\t\t\t\tclearInterval(this.statusCheckInterval);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tgoToResult(id) {\r\n\t\t\t\t// 确保导航URL使用正确的大小写\r\n\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\turl: '/pages/AI/selection/result?id=' + id\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.analyzing-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 40rpx;\r\n\t\tmin-height: 80vh;\r\n\t}\r\n\t\r\n\t.analysis-title {\r\n\t\tfont-size: 40rpx;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-bottom: 80rpx;\r\n\t\tcolor: #007AFF;\r\n\t}\r\n\t\r\n\t.progress-container {\r\n\t\twidth: 100%;\r\n\t\tmargin-bottom: 60rpx;\r\n\t}\r\n\t\r\n\t.progress-bar {\r\n\t\theight: 20rpx;\r\n\t\tbackground-color: #f0f0f0;\r\n\t\tborder-radius: 10rpx;\r\n\t\tposition: relative;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\toverflow: visible;\r\n\t}\r\n\t\r\n\t.progress-filled {\r\n\t\theight: 100%;\r\n\t\tbackground: linear-gradient(to right, #3fadea, #007AFF);\r\n\t\tborder-radius: 10rpx;\r\n\t\ttransition: width 0.3s ease;\r\n\t}\r\n\t\r\n\t.robot-icon {\r\n\t\tposition: absolute;\r\n\t\ttop: -20rpx;\r\n\t\ttransform: translateX(-50%);\r\n\t\ttransition: left 0.3s ease;\r\n\t}\r\n\t\r\n\t.robot-icon image {\r\n\t\twidth: 60rpx;\r\n\t\theight: 60rpx;\r\n\t\tanimation: bounce 0.6s infinite alternate;\r\n\t}\r\n\t\r\n\t@keyframes bounce {\r\n\t\tfrom {\r\n\t\t\ttransform: translateY(0);\r\n\t\t}\r\n\t\tto {\r\n\t\t\ttransform: translateY(-10rpx);\r\n\t\t}\r\n\t}\r\n\t\r\n\t.progress-text {\r\n\t\ttext-align: center;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #007AFF;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t\r\n\t.tips-container {\r\n\t\tbackground: #f8f8f8;\r\n\t\tpadding: 30rpx;\r\n\t\tborder-radius: 20rpx;\r\n\t\twidth: 90%;\r\n\t\ttext-align: center;\r\n\t\tmargin-bottom: 60rpx;\r\n\t}\r\n\t\r\n\t.tip-title {\r\n\t\tfont-size: 32rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #333;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tdisplay: block;\r\n\t}\r\n\t\r\n\t.tip-content {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666;\r\n\t\tline-height: 1.5;\r\n\t}\r\n\t\r\n\t/* 取消按钮样式 */\r\n\t.button-container {\r\n\t\tmargin-top: 40rpx;\r\n\t}\r\n\t\r\n\t.cancel-btn {\r\n\t\twidth: 200rpx;\r\n\t\theight: 80rpx;\r\n\t\tline-height: 80rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666;\r\n\t\tbackground: #f2f2f2;\r\n\t\tborder-radius: 40rpx;\r\n\t}\r\n</style> ","import MiniProgramPage from 'E:/yanshilu小程序前端/前端yanshilu/pages/AI/selection/analyzing.uvue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","defineComponent","name","data","progressPercent","intervalId","statusCheckInterval","analysisId","tips","currentTip","checkCount","maxChecks","onLoad","options","uni","index","__f__","id","this","showModal","title","content","showCancel","success","navigateBack","setStorageSync","startProgressAnimation","checkAnalysisStatus","onUnload","clearInterval","methods","setInterval","nextTipIndex","indexOf","length","Math","floor","random","__awaiter","confirmText","cancelText","res","confirm","Promise","resolve","result","callCloudFunction","UTSJSONObject","aiSelectionApis","getSchoolAnalysis","action","timeout","code","analysis_status","setTimeout","goToResult","error_message","e","cancelAnalysis","redirectTo","url","wx","createPage","MiniProgramPage"],"mappings":"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"}