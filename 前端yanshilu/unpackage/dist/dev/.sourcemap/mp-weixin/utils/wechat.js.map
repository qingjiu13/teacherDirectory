{"version":3,"file":"wechat.js","sources":["utils/wechat.js"],"sourcesContent":["/**\r\n * 微信小程序工具类\r\n * @module utils/wechat\r\n */\r\n\r\n/**\r\n * 获取微信登录凭证\r\n * @returns {Promise<object>} 登录结果对象，包含 code\r\n */\r\nexport function wxLogin() {\r\n  return new Promise((resolve, reject) => {\r\n    // #ifdef MP-WEIXIN\r\n    uni.login({\r\n      provider: 'weixin',\r\n      success: (res) => {\r\n        if (res.code) {\r\n          resolve({ code: res.code });\r\n        } else {\r\n          reject(new Error('微信登录失败'));\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error('微信登录失败: ' + JSON.stringify(err)));\r\n      }\r\n    });\r\n    // #endif\r\n    \r\n    // #ifndef MP-WEIXIN\r\n    reject(new Error('当前不是微信小程序环境'));\r\n    // #endif\r\n  });\r\n}\r\n\r\n/**\r\n * 获取用户信息\r\n * @returns {Promise<object>} 用户信息\r\n */\r\nexport function getUserProfile() {\r\n  return new Promise((resolve, reject) => {\r\n    // #ifdef MP-WEIXIN\r\n    uni.getUserProfile({\r\n      desc: '用于完善用户资料',\r\n      success: (res) => {\r\n        resolve(res.userInfo);\r\n      },\r\n      fail: (err) => {\r\n        reject(new Error('获取用户信息失败: ' + JSON.stringify(err)));\r\n      }\r\n    });\r\n    // #endif\r\n    \r\n    // #ifndef MP-WEIXIN\r\n    reject(new Error('当前不是微信小程序环境'));\r\n    // #endif\r\n  });\r\n}\r\n\r\n/**\r\n * 检查用户是否授权获取用户信息\r\n * @returns {Promise<boolean>} 是否已授权\r\n */\r\nexport function checkUserInfoAuth() {\r\n  return new Promise((resolve) => {\r\n    // #ifdef MP-WEIXIN\r\n    uni.getSetting({\r\n      success: (res) => {\r\n        resolve(!!res.authSetting['scope.userInfo']);\r\n      },\r\n      fail: () => {\r\n        resolve(false);\r\n      }\r\n    });\r\n    // #endif\r\n    \r\n    // #ifndef MP-WEIXIN\r\n    resolve(false);\r\n    // #endif\r\n  });\r\n}\r\n\r\n/**\r\n * 获取微信用户手机号\r\n * @returns {Promise<object>} 包含加密数据的对象\r\n */\r\nexport function getPhoneNumber() {\r\n  // 注意：微信小程序获取手机号需要通过button组件的getPhoneNumber事件获取\r\n  // 此方法仅作为占位符，实际业务需在组件中处理\r\n  return Promise.reject(new Error('请通过button组件的getPhoneNumber事件获取手机号'));\r\n}\r\n\r\n/**\r\n * 微信一键登录并获取用户信息\r\n * @returns {Promise<object>} 登录结果和用户信息\r\n */\r\nexport async function wxQuickLogin() {\r\n  try {\r\n    // 登录获取code\r\n    const loginResult = await wxLogin();\r\n    \r\n    // 尝试获取用户信息\r\n    try {\r\n      const userInfo = await getUserProfile();\r\n      return {\r\n        ...loginResult,\r\n        userInfo\r\n      };\r\n    } catch (userInfoErr) {\r\n      // 获取用户信息失败，仅返回登录凭证\r\n      return loginResult;\r\n    }\r\n  } catch (error) {\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport default {\r\n  wxLogin,\r\n  getUserProfile,\r\n  checkUserInfoAuth,\r\n  getPhoneNumber,\r\n  wxQuickLogin\r\n}; "],"names":["Promise","resolve","reject","uni","login","provider","success","res","code","Error","fail","err","JSON","stringify"],"mappings":"oEASO,WACL,OAAO,IAAIA,SAAQ,CAACC,EAASC,KAE3BC,EAAAA,MAAIC,MAAM,CACRC,SAAU,SACVC,QAAUC,IACJA,EAAIC,KACNP,EAAQ,CAAEO,KAAMD,EAAIC,OAEbN,EAAA,IAAIO,MAAM,UAClB,EAEHC,KAAOC,IACLT,EAAO,IAAIO,MAAM,WAAaG,KAAKC,UAAUF,IAAK,GAErD,GAOL"}